<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="FastAPI：(8)依赖项, Hkini, 学习, 生活, 工作, 记录">
    <meta name="description" content=" FastAPI：(8)依赖项

        
          
            
            概述
            文章内容概括
          
        
      
graph TD
">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->

<script async src="https://www.googletagmanager.com/gtag/js?id="></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
        dataLayer.push(arguments);
    }

    gtag('js', new Date());
    gtag('config', '');
</script>


    <title>FastAPI：(8)依赖项 | Hkini</title>
    <link rel="icon" type="image/png" href="/medias/logo.png">
    <link rel="stylesheet" type="text/css" href="/libs/prism/prism.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.bootcdn.net/ajax/libs/prism/1.9.0/plugins/line-numbers/prism-line-numbers.css">
    
    <style>
        body{
            background-image: url(/medias/images/3.png);
            background-repeat:no-repeat;
            background-size: 100% 100%;
            background-attachment:fixed;
        }
    </style>



    <!-- bg-cover style     -->



<link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
<link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
<link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
<link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
<link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
<link rel="stylesheet" type="text/css" href="/css/matery.css">
<link rel="stylesheet" type="text/css" href="/css/my.css">
<link rel="stylesheet" type="text/css" href="/css/dark.css" media="none" onload="if(media!='all')media='all'">




    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
    <link rel="stylesheet" href="/css/post.css">




    
        <link rel="stylesheet" type="text/css" href="/css/reward.css">
    



    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>
    <!-- Mermaid -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.4.0/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>


<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="Hkini" type="application/atom+xml">
</head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper head-container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">Hkini</span>
                </a>
            </div>
            



<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  
    <li class="menu-level-1">
      <a href="/" class="waves-effect waves-light">
        
        <i class="fas fa-home moz-zoom" style="zoom: 0.6;"></i>
        
        <span>首页</span>
        
      </a>
      
    </li>
  
    <li class="menu-level-1">
      <a href="/" class="waves-effect waves-light">
        
        <i class="fas fa-graduation-cap moz-zoom" style="zoom: 0.6;"></i>
        
        <span>专业</span>
        
        <i class="fas fa-chevron-right moz-zoom" aria-hidden="true" style="zoom: 0.6;"></i>
        
      </a>
      
      <ul class="sub-nav menu-level-2 menus_item_child">
        
  
    <li class="menu-level-2">
      <a href="/categories/%E4%B8%93%E4%B8%9A/%E5%9F%BA%E7%A1%80%E7%90%86%E8%AE%BA" class="waves-effect waves-light">
        
        <i class="fas fa-book moz-zoom" style="zoom: 0.6;"></i>
        
        <span>01基础理论</span>
        
      </a>
      
    </li>
  
    <li class="menu-level-2">
      <a href="/categories/%E4%B8%93%E4%B8%9A/%E6%A1%86%E6%9E%B6" class="waves-effect waves-light">
        
        <i class="fas fa-cubes moz-zoom" style="zoom: 0.6;"></i>
        
        <span>02框架</span>
        
      </a>
      
    </li>
  
    <li class="menu-level-2">
      <a href="/categories/%E4%B8%93%E4%B8%9A/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80" class="waves-effect waves-light">
        
        <i class="fas fa-code moz-zoom" style="zoom: 0.6;"></i>
        
        <span>03编程语言</span>
        
      </a>
      
    </li>
  
    <li class="menu-level-2">
      <a href="/categories/%E4%B8%93%E4%B8%9A/%E5%AE%9E%E8%B7%B5%E9%A1%B9%E7%9B%AE" class="waves-effect waves-light">
        
        <i class="fas fa-project-diagram moz-zoom" style="zoom: 0.6;"></i>
        
        <span>04实践项目</span>
        
      </a>
      
    </li>
  
    <li class="menu-level-2">
      <a href="/categories/%E4%B8%93%E4%B8%9A/%E9%85%8D%E7%BD%AE%E8%AE%B0%E5%BD%95" class="waves-effect waves-light">
        
        <i class="fas fa-tools moz-zoom" style="zoom: 0.6;"></i>
        
        <span>05配置记录</span>
        
      </a>
      
    </li>
  

      </ul>
      
    </li>
  
    <li class="menu-level-1">
      <a href="/" class="waves-effect waves-light">
        
        <i class="fas fa-briefcase moz-zoom" style="zoom: 0.6;"></i>
        
        <span>工作</span>
        
        <i class="fas fa-chevron-right moz-zoom" aria-hidden="true" style="zoom: 0.6;"></i>
        
      </a>
      
      <ul class="sub-nav menu-level-2 menus_item_child">
        
  
    <li class="menu-level-2">
      <a href="/categories/%E5%B7%A5%E4%BD%9C/%E9%A1%B9%E7%9B%AE" class="waves-effect waves-light">
        
        <i class="fas fa-tasks moz-zoom" style="zoom: 0.6;"></i>
        
        <span>01项目</span>
        
      </a>
      
    </li>
  

      </ul>
      
    </li>
  
    <li class="menu-level-1">
      <a href="/" class="waves-effect waves-light">
        
        <i class="fas fa-icons moz-zoom" style="zoom: 0.6;"></i>
        
        <span>兴趣</span>
        
        <i class="fas fa-chevron-right moz-zoom" aria-hidden="true" style="zoom: 0.6;"></i>
        
      </a>
      
      <ul class="sub-nav menu-level-2 menus_item_child">
        
  
    <li class="menu-level-2">
      <a href="/categories/%E5%85%B4%E8%B6%A3/%E9%98%85%E8%AF%BB" class="waves-effect waves-light">
        
        <i class="fas fa-book-open moz-zoom" style="zoom: 0.6;"></i>
        
        <span>01阅读</span>
        
      </a>
      
    </li>
  
    <li class="menu-level-2">
      <a href="/categories/%E5%85%B4%E8%B6%A3/%E7%85%A7%E7%89%87" class="waves-effect waves-light">
        
        <i class="fas fa-image moz-zoom" style="zoom: 0.6;"></i>
        
        <span>02照片</span>
        
      </a>
      
    </li>
  

      </ul>
      
    </li>
  
    <li class="menu-level-1">
      <a href="/" class="waves-effect waves-light">
        
        <i class="fas fa-seedling moz-zoom" style="zoom: 0.6;"></i>
        
        <span>个人成长</span>
        
        <i class="fas fa-chevron-right moz-zoom" aria-hidden="true" style="zoom: 0.6;"></i>
        
      </a>
      
      <ul class="sub-nav menu-level-2 menus_item_child">
        
  
    <li class="menu-level-2">
      <a href="/categories/%E4%B8%AA%E4%BA%BA%E6%88%90%E9%95%BF/%E8%AE%A1%E5%88%92%E4%B8%8E%E6%80%BB%E7%BB%93" class="waves-effect waves-light">
        
        <i class="fas fa-tasks moz-zoom" style="zoom: 0.6;"></i>
        
        <span>01计划与总结</span>
        
      </a>
      
    </li>
  
    <li class="menu-level-2">
      <a href="/categories/%E4%B8%AA%E4%BA%BA%E6%88%90%E9%95%BF/%E6%84%9F%E6%82%9F" class="waves-effect waves-light">
        
        <i class="fas fa-lightbulb moz-zoom" style="zoom: 0.6;"></i>
        
        <span>02感悟</span>
        
      </a>
      
    </li>
  

      </ul>
      
    </li>
  
    <li class="menu-level-1">
      <a href="/" class="waves-effect waves-light">
        
        <i class="fas fa-list moz-zoom" style="zoom: 0.6;"></i>
        
        <span>整理</span>
        
        <i class="fas fa-chevron-right moz-zoom" aria-hidden="true" style="zoom: 0.6;"></i>
        
      </a>
      
      <ul class="sub-nav menu-level-2 menus_item_child">
        
  
    <li class="menu-level-2">
      <a href="/catstags" class="waves-effect waves-light">
        
        <i class="fas fa-bookmark moz-zoom" style="zoom: 0.6;"></i>
        
        <span>分类&标签</span>
        
      </a>
      
    </li>
  
    <li class="menu-level-2">
      <a href="/archives" class="waves-effect waves-light">
        
        <i class="fas fa-file-lines moz-zoom" style="zoom: 0.6;"></i>
        
        <span>归档</span>
        
      </a>
      
    </li>
  
    <li class="menu-level-2">
      <a href="/friends" class="waves-effect waves-light">
        
        <i class="fas fa-address-book moz-zoom" style="zoom: 0.6;"></i>
        
        <span>友链</span>
        
      </a>
      
    </li>
  
    <li class="menu-level-2">
      <a href="/contact" class="waves-effect waves-light">
        
        <i class="fas fa-comments moz-zoom" style="zoom: 0.6;"></i>
        
        <span>留言</span>
        
      </a>
      
    </li>
  
    <li class="menu-level-2">
      <a href="/about" class="waves-effect waves-light">
        
        <i class="fas fa-chart-bar moz-zoom" style="zoom: 0.6;"></i>
        
        <span>统计</span>
        
      </a>
      
    </li>
  

      </ul>
      
    </li>
  
    <li class="menu-level-1">
      <a href="/about" class="waves-effect waves-light">
        
        <i class="fas fa-user-circle moz-zoom" style="zoom: 0.6;"></i>
        
        <span>关于我</span>
        
      </a>
      
    </li>
  

  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search " title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">Hkini</div>
        <div class="logo-desc">
            
            一个记录生活、学习和工作的地方。记录生活中的点滴，分享学习的经验和工作中的思考。
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="javascript:;">
			
				<i class="fa-fw fas fa-graduation-cap"></i>
			
			专业
			<span class="m-icon"><i class="fas fa-chevron-right"></i></span>
		</a>
            <ul  style="background:  ;" >
              
                <li>

                  <a href="/categories/%E4%B8%93%E4%B8%9A/%E5%9F%BA%E7%A1%80%E7%90%86%E8%AE%BA " style="margin-left:75px">
				  
				   <i class="fa fas fa-book" style="position: absolute;left:50px" ></i>
			      
		          <span>01基础理论</span>
                  </a>
                </li>
              
                <li>

                  <a href="/categories/%E4%B8%93%E4%B8%9A/%E6%A1%86%E6%9E%B6 " style="margin-left:75px">
				  
				   <i class="fa fas fa-cubes" style="position: absolute;left:50px" ></i>
			      
		          <span>02框架</span>
                  </a>
                </li>
              
                <li>

                  <a href="/categories/%E4%B8%93%E4%B8%9A/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80 " style="margin-left:75px">
				  
				   <i class="fa fas fa-code" style="position: absolute;left:50px" ></i>
			      
		          <span>03编程语言</span>
                  </a>
                </li>
              
                <li>

                  <a href="/categories/%E4%B8%93%E4%B8%9A/%E5%AE%9E%E8%B7%B5%E9%A1%B9%E7%9B%AE " style="margin-left:75px">
				  
				   <i class="fa fas fa-project-diagram" style="position: absolute;left:50px" ></i>
			      
		          <span>04实践项目</span>
                  </a>
                </li>
              
                <li>

                  <a href="/categories/%E4%B8%93%E4%B8%9A/%E9%85%8D%E7%BD%AE%E8%AE%B0%E5%BD%95 " style="margin-left:75px">
				  
				   <i class="fa fas fa-tools" style="position: absolute;left:50px" ></i>
			      
		          <span>05配置记录</span>
                  </a>
                </li>
              
            </ul>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="javascript:;">
			
				<i class="fa-fw fas fa-briefcase"></i>
			
			工作
			<span class="m-icon"><i class="fas fa-chevron-right"></i></span>
		</a>
            <ul  style="background:  ;" >
              
                <li>

                  <a href="/categories/%E5%B7%A5%E4%BD%9C/%E9%A1%B9%E7%9B%AE " style="margin-left:75px">
				  
				   <i class="fa fas fa-tasks" style="position: absolute;left:50px" ></i>
			      
		          <span>01项目</span>
                  </a>
                </li>
              
            </ul>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="javascript:;">
			
				<i class="fa-fw fas fa-icons"></i>
			
			兴趣
			<span class="m-icon"><i class="fas fa-chevron-right"></i></span>
		</a>
            <ul  style="background:  ;" >
              
                <li>

                  <a href="/categories/%E5%85%B4%E8%B6%A3/%E9%98%85%E8%AF%BB " style="margin-left:75px">
				  
				   <i class="fa fas fa-book-open" style="position: absolute;left:50px" ></i>
			      
		          <span>01阅读</span>
                  </a>
                </li>
              
                <li>

                  <a href="/categories/%E5%85%B4%E8%B6%A3/%E7%85%A7%E7%89%87 " style="margin-left:75px">
				  
				   <i class="fa fas fa-image" style="position: absolute;left:50px" ></i>
			      
		          <span>02照片</span>
                  </a>
                </li>
              
            </ul>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="javascript:;">
			
				<i class="fa-fw fas fa-seedling"></i>
			
			个人成长
			<span class="m-icon"><i class="fas fa-chevron-right"></i></span>
		</a>
            <ul  style="background:  ;" >
              
                <li>

                  <a href="/categories/%E4%B8%AA%E4%BA%BA%E6%88%90%E9%95%BF/%E8%AE%A1%E5%88%92%E4%B8%8E%E6%80%BB%E7%BB%93 " style="margin-left:75px">
				  
				   <i class="fa fas fa-tasks" style="position: absolute;left:50px" ></i>
			      
		          <span>01计划与总结</span>
                  </a>
                </li>
              
                <li>

                  <a href="/categories/%E4%B8%AA%E4%BA%BA%E6%88%90%E9%95%BF/%E6%84%9F%E6%82%9F " style="margin-left:75px">
				  
				   <i class="fa fas fa-lightbulb" style="position: absolute;left:50px" ></i>
			      
		          <span>02感悟</span>
                  </a>
                </li>
              
            </ul>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="javascript:;">
			
				<i class="fa-fw fas fa-list"></i>
			
			整理
			<span class="m-icon"><i class="fas fa-chevron-right"></i></span>
		</a>
            <ul  style="background:  ;" >
              
                <li>

                  <a href="/catstags " style="margin-left:75px">
				  
				   <i class="fa fas fa-bookmark" style="position: absolute;left:50px" ></i>
			      
		          <span>分类&标签</span>
                  </a>
                </li>
              
                <li>

                  <a href="/archives " style="margin-left:75px">
				  
				   <i class="fa fas fa-file-lines" style="position: absolute;left:50px" ></i>
			      
		          <span>归档</span>
                  </a>
                </li>
              
                <li>

                  <a href="/friends " style="margin-left:75px">
				  
				   <i class="fa fas fa-address-book" style="position: absolute;left:50px" ></i>
			      
		          <span>友链</span>
                  </a>
                </li>
              
                <li>

                  <a href="/contact " style="margin-left:75px">
				  
				   <i class="fa fas fa-comments" style="position: absolute;left:50px" ></i>
			      
		          <span>留言</span>
                  </a>
                </li>
              
                <li>

                  <a href="/about " style="margin-left:75px">
				  
				   <i class="fa fas fa-chart-bar" style="position: absolute;left:50px" ></i>
			      
		          <span>统计</span>
                  </a>
                </li>
              
            </ul>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于我
		</a>
          
        </li>
        
        
    </ul>
</div>


        </div>

        
    </nav>

</header>

    
<script src="/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('请输入访问本文章的密码')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/3.png')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">FastAPI：(8)依赖项</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/FastAPI/">
                                <span class="chip bg-color">FastAPI</span>
                            </a>
                        
                            <a href="/tags/Python/">
                                <span class="chip bg-color">Python</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/%E4%B8%93%E4%B8%9A/" class="post-category">
                                专业
                            </a>
                        
                            <a href="/categories/%E4%B8%93%E4%B8%9A/%E6%A1%86%E6%9E%B6/" class="post-category">
                                框架
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2025-06-01
                </div>

                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2025-06-13
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    8.6k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    33 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        

        
        <!-- 代码块折行 -->
        <style type="text/css">
            code[class*="language-"], pre[class*="language-"] { white-space: pre-wrap !important; }
        </style>
        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <html><head></head><body><h1 id="fastapi8依赖项"><a class="markdownIt-Anchor" href="#fastapi8依赖项"></a> FastAPI：(8)依赖项</h1>

        <div class="evoldown" id="文章内容概括" type="c">
          <span class="icon">
            <svg type="c" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m6.825 4.8749c1.8175-0.03033 2.3249 0.02869 2.25 2.0152 0.01496 1.139 0.01338 1.984-1.3875 1.9798-1.6108-0.01491-2.7285 0.30288-2.6124-1.796-0.019-1.5193-0.04171-2.2697 1.7499-2.1989zm0-2c-2.5847-0.10689-3.8882 1.4181-3.7496 3.8782-0.058825 1.6262 0.20934 2.9456 1.5713 3.7018 0.98591 0.49526 1.6843 0.40204 2.4713 0.42016 0.661-0.00557 1.2079 0.02014 1.9275-0.21866 1.051-0.35295 1.7794-1.2693 1.9533-2.3675 0.08948-0.54803 0.07327-0.95095 0.0762-1.3975-0.00196-0.42752 0.01114-0.8053-0.05632-1.306-0.24162-1.9408-1.9089-2.8188-3.6634-2.7097-0.17686-7.9441e-4 -0.35349-2.3937e-4 -0.53038-7.7934e-4z" fill="currentColor"></path><path d="m17.075 8.6749c1.8175-0.03034 2.3249 0.02868 2.25 2.0152 0.01495 1.139 0.01338 1.984-1.3875 1.9797-1.6108-0.01491-2.7285 0.30288-2.6124-1.796-0.01899-1.5193-0.04171-2.2697 1.7499-2.1989zm0-2c-2.5847-0.10689-3.8882 1.4181-3.7496 3.8782-0.05882 1.6262 0.20933 2.9457 1.5713 3.7017 0.98593 0.49528 1.6843 0.40205 2.4713 0.42017 0.66099-0.00556 1.2079 0.02015 1.9275-0.21865 1.051-0.35295 1.7794-1.2693 1.9533-2.3675 0.08949-0.54803 0.07328-0.95095 0.07621-1.3975-0.00197-0.42839 0.0112-0.80698-0.05673-1.3089-0.24288-1.9391-1.9097-2.8158-3.663-2.7068-0.17688-7.9346e-4 -0.35351-2.388e-4 -0.5304-7.7896e-4z" fill="currentColor"></path><path d="m8.4749 15.525c1.8175-0.03033 2.3249 0.02868 2.25 2.0152 0.01496 1.139 0.01338 1.984-1.3875 1.9797-1.6108-0.01491-2.7285 0.30288-2.6124-1.796-0.01899-1.5193-0.04172-2.2697 1.7499-2.1989zm0-2c-2.5847-0.10689-3.8882 1.4181-3.7496 3.8782-0.058825 1.6262 0.20934 2.9456 1.5713 3.7018 0.98591 0.49526 1.6843 0.40203 2.4713 0.42016 0.66099-0.00557 1.2079 0.02014 1.9276-0.21866 1.051-0.35294 1.7794-1.2693 1.9533-2.3675 0.08949-0.54803 0.07328-0.95095 0.07621-1.3975-0.00197-0.42753 0.01113-0.80529-0.05633-1.306-0.24162-1.9408-1.9089-2.8188-3.6634-2.7097-0.17688-7.9346e-4 -0.35351-2.4262e-4 -0.5304-7.8736e-4z" fill="currentColor"></path></svg>
            <p name="label">概述</p>
            <p name="id">文章内容概括</p>
          </span>
        </div>
      
<pre class="mermaid">graph TD
    A[依赖项] --&gt; B[函数依赖]
    A --&gt; C[类依赖]
    A --&gt; D[子依赖]
    A --&gt; E[全局依赖]
    A --&gt; F[资源依赖]
    
    B --&gt;|普通函数| G[Depends]
    C --&gt;|封装逻辑| H[自动注入]
    D --&gt;|嵌套调用| I[依赖链]
    E --&gt;|应用范围| J[所有路由]
    F --&gt;|yield语法| K[自动清理]
    
    G --&gt;|支持| L[认证/数据库]
    H --&gt;|用于| M[分页/校验]
    I --&gt;|形成| N[依赖树]
    K --&gt;|管理| O[文件/连接]</pre>
<h2 id="1依赖项"><a class="markdownIt-Anchor" href="#1依赖项"></a> 1.依赖项</h2>

        <div class="evoldown" id="可调用对象" type="d">
          <span class="icon">
            <svg type="d" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m21.15 6.85c0-2.2056-1.7944-4-4-4-4.1765-0.01989-5.4993 5.7322-1.8147 7.5629-0.263 0.63631-0.4627 1.4421-0.6559 2.2215-0.1397 0.56337-0.2841 1.1459-0.4405 1.6084-0.0728 0.2155-0.1286 0.4813-0.1891 0.4813-0.5072-0.7362-0.8126-2.2507-1.0979-3.3161-0.47879-1.5358-0.72936-4.4237-2.8018-4.558-0.77422 7e-5 -1.3844 0.52253-1.8138 1.553-0.55019 1.254-0.75064 3.2421-1.3784 4.4472-0.39648 3e-4 -0.79576 0.0045-1.1877 0.0703-0.67978 0.1073-1.3339 0.4195-1.798 0.9347-0.39707 0.4315-0.6427 0.9874-0.74275 1.5623-0.063545 0.351-0.07691 0.7094-0.07883 1.0654 0.001935 0.4718-0.01324 0.9457 0.027745 1.4163 0.09435 1.151 0.65732 2.1308 1.7281 2.6237 0.43467 0.1975 0.91053 0.2877 1.3854 0.3129 0.40096 0.0215 0.80345 0.0129 1.2048 0.0139 0.6491 2e-4 1.2891-0.0515 1.888-0.3229 0.90042-0.4067 1.4845-1.2039 1.6712-2.1666 0.0761-0.3779 0.09179-0.7654 0.09344-1.15 7.7e-4 -0.2699 0.00148-0.5413-7.8e-4 -0.8111-0.00379-0.4854-0.04143-0.9771-0.19121-1.4414-0.28748-0.9172-0.98053-1.616-1.8964-1.909 0.43984-1.1576 0.66815-2.7594 1.1268-3.8895 0.3537 0.72804 0.57113 1.7669 0.82283 2.7298 0.26567 1.0724 0.5404 2.1814 0.90896 3.0557 0.87204 2.2985 3.1124 2.7586 4.0452 0.392 0.5508-1.2642 0.7508-3.279 1.3828-4.4916 2.1142-0.10339 3.8024-1.8557 3.8024-3.995zm-12.073 8.8023c0.05605 0.2275 0.06623 0.465 0.07092 0.6983 0.00363 0.2444 0.00195 0.4906 0.00214 0.735-0.0063 0.408 0.01486 0.882-0.18359 1.2496-0.24573 0.4539-0.8026 0.501-1.2651 0.5114-0.33714 0.0058-0.67525 0.0041-1.0124 0.0018-0.46455-0.0092-1.0361-0.0245-1.3192-0.4545-0.16612-0.2552-0.19733-0.5702-0.21202-0.8673-0.01004-0.2443-0.00683-0.4906-0.0075-0.735 5.9e-4 -0.2322-0.00201-0.4664 0.01171-0.6983 0.01886-0.2936 0.06332-0.6069 0.24969-0.8453 0.34185-0.4331 1.0226-0.3889 1.5228-0.3979 0.38828 0.0035 0.77905-0.0131 1.1658 0.0285 0.49865 0.0566 0.85211 0.2621 0.97684 0.7737zm8.0732-6.8023c-2.6379-0.06696-2.6373-3.9334 0-4 2.6378 0.06697 2.6373 3.9334 0 4z" fill="currentColor"></path></svg>
            <p name="id">可调用对象</p>
          </span>
        </div>
      
<p>在 FastAPI 中，可调用对象是指<strong>可以像函数一样被调用</strong>的任何对象。除了普通函数以外，<strong>类实现了 <code>__call__</code> 方法的实例</strong>、<code>lambda</code> 表达式、<code>functools.partial</code> 返回值等都属于可调用对象。FastAPI 在依赖注入系统和路由处理逻辑中支持将这些可调用对象作为处理函数或依赖项，确保灵活性和高可扩展性。</p>
<p><strong>重要特征：</strong></p>
<ul>
<li><strong>函数式接口</strong>：必须实现可调用接口（例如函数或定义了 <code>__call__</code> 方法的类实例）。</li>
<li><strong>兼容依赖注入</strong>：可被 <code>Depends()</code> 等机制识别并执行。</li>
<li><strong>可状态化</strong>：类实例可维护内部状态，实现参数化行为。</li>
<li><strong>可复用与组合</strong>：可调用对象可以被多次复用，并组合使用。</li>
</ul>

        <div class="evoldown" id="图像尺寸校验(正例)" type="e">
          <span class="icon">
            <svg type="e" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path fill="currentColor" d="m21.9 15.621c0.1248-1.8535-0.6087-3.4099-2.6058-3.8292-0.7712-0.15744-1.3921-0.13977-2.1113-0.14543-0.6323 0.0048-1.1718-0.01567-1.8401 0.03203 1.5356-0.8078 1.6998-2.205 1.6567-3.546 0.1272-2.3708-1.4685-3.666-3.7727-3.673-2.2427-0.04024-5.0463-0.27229-5.9443 1.9172-0.28083 0.6692-0.27606 1.2179-0.28202 1.6587-0.08527 1.4303 0.20687 2.9224 1.662 3.6429-2.3051-0.05275-5.3273-0.39212-6.28 1.8983-0.28073 0.66862-0.27595 1.2174-0.282 1.6572-0.10329 1.6061 0.3059 3.171 2.0252 3.8067 1.2061 0.4187 2.2175 0.2869 3.3945 0.3134 2.0524 0.0901 4.0448-0.4637 4.4796-2.4982 0.609 2.5638 3.2086 2.5463 5.3204 2.4982 2.7823 0.1278 4.7024-0.9368 4.5798-3.7329zm-12.899-7.6287c-0.14889-1.8665 1.8839-1.4921 3.1358-1.546 0.8939 0.05358 2.4743-0.21158 2.8003 0.88445 0.2729 2.4494-0.0297 2.8555-2.5242 2.8232-0.94713-0.07259-2.869 0.28949-3.3134-0.77077-0.14881-0.44557-0.08538-0.92893-0.09846-1.3909zm0.2606 9.2128c-0.56638 0.162-1.1652 0.1412-1.7487 0.1488-0.59786-0.0036-1.1977 0.0131-1.7948-0.0233-0.93407-0.0365-1.6776-0.3579-1.6157-1.4217 0.01574-0.5119-0.06845-1.0551 0.11822-1.5436 0.4432-0.84155 1.5978-0.6728 2.4032-0.7191 0.81712 0.01614 1.6464-0.05154 2.4536 0.10154 0.99382 0.17537 1.0564 0.91742 1.0227 1.7752-6.1e-4 0.7729 0.04085 1.416-0.83867 1.6821zm2.9212-3.6286c-0.0836 0.19457-0.14194 0.3848-0.18279 0.56614-0.18535-0.87758-0.76293-1.6189-1.5605-2.02 1.0871 0.04933 2.0387 0.04959 3.1216-8e-5 -0.7672 0.39034-1.1687 0.96486-1.3783 1.4539zm6.8788 3.6286c-0.5664 0.162-1.1652 0.1412-1.7488 0.1488-0.5978-0.0036-1.1977 0.0131-1.7947-0.0233-0.9341-0.0365-1.6776-0.3579-1.6157-1.4217 0.0157-0.5119-0.0685-1.0551 0.1182-1.5436 0.4432-0.84155 1.5978-0.6728 2.4033-0.7191 0.8171 0.01614 1.6464-0.05154 2.4536 0.10154 0.9938 0.17537 1.0563 0.91742 1.0227 1.7752-6e-4 0.7729 0.0409 1.416-0.8386 1.6821z"></path></svg>
            <p name="id">图像尺寸校验(正例)</p>
          </span>
          <span class="link-icon ml-[0.5em] mr-[0.25em]">
            <svg xmlns="http://www.w3.org/2000/svg" width="0.9411764705882353em" height="0.9411764705882353em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class="untouchable"><path d="m9.5652 14.45 0.72891-2.0026c-0.651 0.00713-1.3027 0.00104-1.9532 0.00179-1.0991-0.02908-3.0336 0.08306-3.605-1.0524-0.28828-0.61588-0.2054-1.3226-0.22136-1.9833 0.00663-0.74044-0.05553-1.6362 0.5758-2.1558 0.70637-0.5555 1.7411-0.56129 2.6027-0.59834 0.743-0.015 1.4884-0.00764 2.2315-0.00868 0.68471 0.01536 1.6274-0.01783 2.4184 0.16762l0.68711-1.8879c-0.0146-0.003965-0.0287-0.00841-0.0435-0.01227-0.94653-0.24905-1.9355-0.25901-2.9083-0.26688-0.78352-1.3008e-4 -1.5692-0.0063751-2.3527 0.006805-1.2709 0.027555-2.6299 0.13739-3.6978 0.89566-1.6654 1.2031-1.53 2.9573-1.5068 4.79-0.0012251 1.7732 0.89765 3.2159 2.626 3.7562 0.80589 0.26191 1.6615 0.32018 2.5036 0.34101 0.6376 0.01106 1.2763 0.01096 1.9146 0.00915z" fill="currentColor"></path><path d="m14.589 9.125h1.3099c0.02865-0.88714-0.11774-1.6826-0.45594-2.3461l-0.85392 2.3461z" fill="currentColor"></path><path d="m15.587 12.025h-2.0527l-0.80604 2.2146c1.2326-0.27362 2.3169-0.88582 2.8588-2.2146z" fill="currentColor"></path><path d="m8.394 12.025h2.0538l0.82406-2.2641c-1.2457 0.2734-2.3327 0.8901-2.8779 2.2641z" fill="currentColor"></path><path d="m8.5566 17.221 0.83571-2.2961h-1.2914c-0.025394 0.86685 0.12295 1.645 0.45565 2.2961z" fill="currentColor"></path><path d="m21.485 14.399c7e-4 -0.67593 0.0063-1.3662-0.1779-2.0223-0.58881-2.115-2.5706-2.7532-4.5608-2.8041-0.76964-0.031175-1.5416-0.02264-2.3121-0.022365l-0.72832 2.0011c0.38557-0.00297 0.77131 7.6e-4 1.1559-0.00173 1.1244 0.02284 2.8396-0.10221 3.8152 0.44616 0.82512 0.45526 0.81194 1.4036 0.80798 2.2308-0.01538 0.64171 0.05949 1.3145-0.1601 1.93-0.39418 1.0145-1.651 1.1102-2.5915 1.1694-0.7426 0.03331-1.4884 0.0209-2.2315 0.02365-0.81334-0.01641-1.9395 0.04306-2.8448-0.16914l-0.68792 1.89c0.014845 0.00401 0.02915 0.0085 0.044115 0.0124 0.94522 0.24688 1.9316 0.25913 2.9027 0.2657 0.83456-2.2e-4 1.6713 0.00786 2.5057-0.00999 2.0286-0.02122 4.1491-0.51576 4.8438-2.6752 0.2358-0.7292 0.22-1.5067 0.2196-2.2644z" fill="currentColor"></path><path d="m14.979 6.7378c0.17824-0.52033 0.90905-2.4486 1.0626-2.9514 0.05601-0.19527 0.10768-0.39984 0.08232-0.60408-0.03096-0.33264-0.36035-0.4603-0.63671-0.55464-0.20794-0.070665-0.41593-0.17228-0.63943-0.174-0.33751 0.005805-0.52152 0.33878-0.64452 0.61072-1.4256 3.8005-4.7612 13.07-6.1617 16.891-0.10636 0.34-0.29285 0.7891-0.06874 1.1109 0.1296 0.1673 0.34386 0.232 0.53431 0.3042 0.30778 0.1107 0.70325 0.3075 0.98251 0.0365 0.14514-0.1339 0.23561-0.315 0.31595-0.4926 0.10005-0.2274 0.1811-0.4632 0.26694-0.6962 0.4854-1.3337 4.3257-11.885 4.9065-13.481z" fill="currentColor"></path></svg>
          </span>
          
          <span class="icon">
            <svg type="d" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m21.15 6.85c0-2.2056-1.7944-4-4-4-4.1765-0.01989-5.4993 5.7322-1.8147 7.5629-0.263 0.63631-0.4627 1.4421-0.6559 2.2215-0.1397 0.56337-0.2841 1.1459-0.4405 1.6084-0.0728 0.2155-0.1286 0.4813-0.1891 0.4813-0.5072-0.7362-0.8126-2.2507-1.0979-3.3161-0.47879-1.5358-0.72936-4.4237-2.8018-4.558-0.77422 7e-5 -1.3844 0.52253-1.8138 1.553-0.55019 1.254-0.75064 3.2421-1.3784 4.4472-0.39648 3e-4 -0.79576 0.0045-1.1877 0.0703-0.67978 0.1073-1.3339 0.4195-1.798 0.9347-0.39707 0.4315-0.6427 0.9874-0.74275 1.5623-0.063545 0.351-0.07691 0.7094-0.07883 1.0654 0.001935 0.4718-0.01324 0.9457 0.027745 1.4163 0.09435 1.151 0.65732 2.1308 1.7281 2.6237 0.43467 0.1975 0.91053 0.2877 1.3854 0.3129 0.40096 0.0215 0.80345 0.0129 1.2048 0.0139 0.6491 2e-4 1.2891-0.0515 1.888-0.3229 0.90042-0.4067 1.4845-1.2039 1.6712-2.1666 0.0761-0.3779 0.09179-0.7654 0.09344-1.15 7.7e-4 -0.2699 0.00148-0.5413-7.8e-4 -0.8111-0.00379-0.4854-0.04143-0.9771-0.19121-1.4414-0.28748-0.9172-0.98053-1.616-1.8964-1.909 0.43984-1.1576 0.66815-2.7594 1.1268-3.8895 0.3537 0.72804 0.57113 1.7669 0.82283 2.7298 0.26567 1.0724 0.5404 2.1814 0.90896 3.0557 0.87204 2.2985 3.1124 2.7586 4.0452 0.392 0.5508-1.2642 0.7508-3.279 1.3828-4.4916 2.1142-0.10339 3.8024-1.8557 3.8024-3.995zm-12.073 8.8023c0.05605 0.2275 0.06623 0.465 0.07092 0.6983 0.00363 0.2444 0.00195 0.4906 0.00214 0.735-0.0063 0.408 0.01486 0.882-0.18359 1.2496-0.24573 0.4539-0.8026 0.501-1.2651 0.5114-0.33714 0.0058-0.67525 0.0041-1.0124 0.0018-0.46455-0.0092-1.0361-0.0245-1.3192-0.4545-0.16612-0.2552-0.19733-0.5702-0.21202-0.8673-0.01004-0.2443-0.00683-0.4906-0.0075-0.735 5.9e-4 -0.2322-0.00201-0.4664 0.01171-0.6983 0.01886-0.2936 0.06332-0.6069 0.24969-0.8453 0.34185-0.4331 1.0226-0.3889 1.5228-0.3979 0.38828 0.0035 0.77905-0.0131 1.1658 0.0285 0.49865 0.0566 0.85211 0.2621 0.97684 0.7737zm8.0732-6.8023c-2.6379-0.06696-2.6373-3.9334 0-4 2.6378 0.06697 2.6373 3.9334 0 4z" fill="currentColor"></path></svg>
            <p name="id">可调用对象</p>
          </span>
        </div>
      
<p><strong>图像处理系统中实现 <code>__call__</code> 的类对象用于图像尺寸校验</strong><br>
<strong>现象：</strong><br>
某图像上传系统要求用户上传的图片必须符合特定的尺寸限制。开发者定义了一个带有 <code>__init__</code> 参数的类，该类通过 <code>__call__</code> 实现具体的尺寸校验逻辑。多个接口可共享这一逻辑，仅需以类实例作为依赖传入。</p>
<p><strong>特征对比</strong></p>
<ul>
<li>✅ <strong>函数式接口</strong>：通过 <code>__call__</code> 实现了函数行为</li>
<li>✅ <strong>可状态化</strong>：类接收 <code>max_size</code> 等参数，灵活性强</li>
<li>✅ <strong>兼容注入机制</strong>：可直接用于 <code>Depends()</code></li>
<li>✅ <strong>高复用性</strong>：多个上传接口复用此逻辑</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> fastapi <span class="token keyword">import</span> FastAPI<span class="token punctuation">,</span> File<span class="token punctuation">,</span> UploadFile<span class="token punctuation">,</span> Depends<span class="token punctuation">,</span> HTTPException

app <span class="token operator">=</span> FastAPI<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">SizeValidator</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> max_size_kb<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>max_size_kb <span class="token operator">=</span> max_size_kb

    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token builtin">file</span><span class="token punctuation">:</span> UploadFile <span class="token operator">=</span> File<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token builtin">file</span><span class="token punctuation">.</span>spool_max_size <span class="token operator">&gt;</span> self<span class="token punctuation">.</span>max_size_kb <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> HTTPException<span class="token punctuation">(</span>status_code<span class="token operator">=</span><span class="token number">400</span><span class="token punctuation">,</span> detail<span class="token operator">=</span><span class="token string">"File too large"</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token builtin">file</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>post</span><span class="token punctuation">(</span><span class="token string">"/upload/"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">upload_file</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">:</span> UploadFile <span class="token operator">=</span> Depends<span class="token punctuation">(</span>SizeValidator<span class="token punctuation">(</span>max_size_kb<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token string">"filename"</span><span class="token punctuation">:</span> <span class="token builtin">file</span><span class="token punctuation">.</span>filename<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

        <div class="evoldown" id="functools.partial(正例)" type="e">
          <span class="icon">
            <svg type="e" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path fill="currentColor" d="m21.9 15.621c0.1248-1.8535-0.6087-3.4099-2.6058-3.8292-0.7712-0.15744-1.3921-0.13977-2.1113-0.14543-0.6323 0.0048-1.1718-0.01567-1.8401 0.03203 1.5356-0.8078 1.6998-2.205 1.6567-3.546 0.1272-2.3708-1.4685-3.666-3.7727-3.673-2.2427-0.04024-5.0463-0.27229-5.9443 1.9172-0.28083 0.6692-0.27606 1.2179-0.28202 1.6587-0.08527 1.4303 0.20687 2.9224 1.662 3.6429-2.3051-0.05275-5.3273-0.39212-6.28 1.8983-0.28073 0.66862-0.27595 1.2174-0.282 1.6572-0.10329 1.6061 0.3059 3.171 2.0252 3.8067 1.2061 0.4187 2.2175 0.2869 3.3945 0.3134 2.0524 0.0901 4.0448-0.4637 4.4796-2.4982 0.609 2.5638 3.2086 2.5463 5.3204 2.4982 2.7823 0.1278 4.7024-0.9368 4.5798-3.7329zm-12.899-7.6287c-0.14889-1.8665 1.8839-1.4921 3.1358-1.546 0.8939 0.05358 2.4743-0.21158 2.8003 0.88445 0.2729 2.4494-0.0297 2.8555-2.5242 2.8232-0.94713-0.07259-2.869 0.28949-3.3134-0.77077-0.14881-0.44557-0.08538-0.92893-0.09846-1.3909zm0.2606 9.2128c-0.56638 0.162-1.1652 0.1412-1.7487 0.1488-0.59786-0.0036-1.1977 0.0131-1.7948-0.0233-0.93407-0.0365-1.6776-0.3579-1.6157-1.4217 0.01574-0.5119-0.06845-1.0551 0.11822-1.5436 0.4432-0.84155 1.5978-0.6728 2.4032-0.7191 0.81712 0.01614 1.6464-0.05154 2.4536 0.10154 0.99382 0.17537 1.0564 0.91742 1.0227 1.7752-6.1e-4 0.7729 0.04085 1.416-0.83867 1.6821zm2.9212-3.6286c-0.0836 0.19457-0.14194 0.3848-0.18279 0.56614-0.18535-0.87758-0.76293-1.6189-1.5605-2.02 1.0871 0.04933 2.0387 0.04959 3.1216-8e-5 -0.7672 0.39034-1.1687 0.96486-1.3783 1.4539zm6.8788 3.6286c-0.5664 0.162-1.1652 0.1412-1.7488 0.1488-0.5978-0.0036-1.1977 0.0131-1.7947-0.0233-0.9341-0.0365-1.6776-0.3579-1.6157-1.4217 0.0157-0.5119-0.0685-1.0551 0.1182-1.5436 0.4432-0.84155 1.5978-0.6728 2.4033-0.7191 0.8171 0.01614 1.6464-0.05154 2.4536 0.10154 0.9938 0.17537 1.0563 0.91742 1.0227 1.7752-6e-4 0.7729 0.0409 1.416-0.8386 1.6821z"></path></svg>
            <p name="id">functools.partial(正例)</p>
          </span>
          <span class="link-icon ml-[0.5em] mr-[0.25em]">
            <svg xmlns="http://www.w3.org/2000/svg" width="0.9411764705882353em" height="0.9411764705882353em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class="untouchable"><path d="m9.5652 14.45 0.72891-2.0026c-0.651 0.00713-1.3027 0.00104-1.9532 0.00179-1.0991-0.02908-3.0336 0.08306-3.605-1.0524-0.28828-0.61588-0.2054-1.3226-0.22136-1.9833 0.00663-0.74044-0.05553-1.6362 0.5758-2.1558 0.70637-0.5555 1.7411-0.56129 2.6027-0.59834 0.743-0.015 1.4884-0.00764 2.2315-0.00868 0.68471 0.01536 1.6274-0.01783 2.4184 0.16762l0.68711-1.8879c-0.0146-0.003965-0.0287-0.00841-0.0435-0.01227-0.94653-0.24905-1.9355-0.25901-2.9083-0.26688-0.78352-1.3008e-4 -1.5692-0.0063751-2.3527 0.006805-1.2709 0.027555-2.6299 0.13739-3.6978 0.89566-1.6654 1.2031-1.53 2.9573-1.5068 4.79-0.0012251 1.7732 0.89765 3.2159 2.626 3.7562 0.80589 0.26191 1.6615 0.32018 2.5036 0.34101 0.6376 0.01106 1.2763 0.01096 1.9146 0.00915z" fill="currentColor"></path><path d="m14.589 9.125h1.3099c0.02865-0.88714-0.11774-1.6826-0.45594-2.3461l-0.85392 2.3461z" fill="currentColor"></path><path d="m15.587 12.025h-2.0527l-0.80604 2.2146c1.2326-0.27362 2.3169-0.88582 2.8588-2.2146z" fill="currentColor"></path><path d="m8.394 12.025h2.0538l0.82406-2.2641c-1.2457 0.2734-2.3327 0.8901-2.8779 2.2641z" fill="currentColor"></path><path d="m8.5566 17.221 0.83571-2.2961h-1.2914c-0.025394 0.86685 0.12295 1.645 0.45565 2.2961z" fill="currentColor"></path><path d="m21.485 14.399c7e-4 -0.67593 0.0063-1.3662-0.1779-2.0223-0.58881-2.115-2.5706-2.7532-4.5608-2.8041-0.76964-0.031175-1.5416-0.02264-2.3121-0.022365l-0.72832 2.0011c0.38557-0.00297 0.77131 7.6e-4 1.1559-0.00173 1.1244 0.02284 2.8396-0.10221 3.8152 0.44616 0.82512 0.45526 0.81194 1.4036 0.80798 2.2308-0.01538 0.64171 0.05949 1.3145-0.1601 1.93-0.39418 1.0145-1.651 1.1102-2.5915 1.1694-0.7426 0.03331-1.4884 0.0209-2.2315 0.02365-0.81334-0.01641-1.9395 0.04306-2.8448-0.16914l-0.68792 1.89c0.014845 0.00401 0.02915 0.0085 0.044115 0.0124 0.94522 0.24688 1.9316 0.25913 2.9027 0.2657 0.83456-2.2e-4 1.6713 0.00786 2.5057-0.00999 2.0286-0.02122 4.1491-0.51576 4.8438-2.6752 0.2358-0.7292 0.22-1.5067 0.2196-2.2644z" fill="currentColor"></path><path d="m14.979 6.7378c0.17824-0.52033 0.90905-2.4486 1.0626-2.9514 0.05601-0.19527 0.10768-0.39984 0.08232-0.60408-0.03096-0.33264-0.36035-0.4603-0.63671-0.55464-0.20794-0.070665-0.41593-0.17228-0.63943-0.174-0.33751 0.005805-0.52152 0.33878-0.64452 0.61072-1.4256 3.8005-4.7612 13.07-6.1617 16.891-0.10636 0.34-0.29285 0.7891-0.06874 1.1109 0.1296 0.1673 0.34386 0.232 0.53431 0.3042 0.30778 0.1107 0.70325 0.3075 0.98251 0.0365 0.14514-0.1339 0.23561-0.315 0.31595-0.4926 0.10005-0.2274 0.1811-0.4632 0.26694-0.6962 0.4854-1.3337 4.3257-11.885 4.9065-13.481z" fill="currentColor"></path></svg>
          </span>
          
          <span class="icon">
            <svg type="d" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m21.15 6.85c0-2.2056-1.7944-4-4-4-4.1765-0.01989-5.4993 5.7322-1.8147 7.5629-0.263 0.63631-0.4627 1.4421-0.6559 2.2215-0.1397 0.56337-0.2841 1.1459-0.4405 1.6084-0.0728 0.2155-0.1286 0.4813-0.1891 0.4813-0.5072-0.7362-0.8126-2.2507-1.0979-3.3161-0.47879-1.5358-0.72936-4.4237-2.8018-4.558-0.77422 7e-5 -1.3844 0.52253-1.8138 1.553-0.55019 1.254-0.75064 3.2421-1.3784 4.4472-0.39648 3e-4 -0.79576 0.0045-1.1877 0.0703-0.67978 0.1073-1.3339 0.4195-1.798 0.9347-0.39707 0.4315-0.6427 0.9874-0.74275 1.5623-0.063545 0.351-0.07691 0.7094-0.07883 1.0654 0.001935 0.4718-0.01324 0.9457 0.027745 1.4163 0.09435 1.151 0.65732 2.1308 1.7281 2.6237 0.43467 0.1975 0.91053 0.2877 1.3854 0.3129 0.40096 0.0215 0.80345 0.0129 1.2048 0.0139 0.6491 2e-4 1.2891-0.0515 1.888-0.3229 0.90042-0.4067 1.4845-1.2039 1.6712-2.1666 0.0761-0.3779 0.09179-0.7654 0.09344-1.15 7.7e-4 -0.2699 0.00148-0.5413-7.8e-4 -0.8111-0.00379-0.4854-0.04143-0.9771-0.19121-1.4414-0.28748-0.9172-0.98053-1.616-1.8964-1.909 0.43984-1.1576 0.66815-2.7594 1.1268-3.8895 0.3537 0.72804 0.57113 1.7669 0.82283 2.7298 0.26567 1.0724 0.5404 2.1814 0.90896 3.0557 0.87204 2.2985 3.1124 2.7586 4.0452 0.392 0.5508-1.2642 0.7508-3.279 1.3828-4.4916 2.1142-0.10339 3.8024-1.8557 3.8024-3.995zm-12.073 8.8023c0.05605 0.2275 0.06623 0.465 0.07092 0.6983 0.00363 0.2444 0.00195 0.4906 0.00214 0.735-0.0063 0.408 0.01486 0.882-0.18359 1.2496-0.24573 0.4539-0.8026 0.501-1.2651 0.5114-0.33714 0.0058-0.67525 0.0041-1.0124 0.0018-0.46455-0.0092-1.0361-0.0245-1.3192-0.4545-0.16612-0.2552-0.19733-0.5702-0.21202-0.8673-0.01004-0.2443-0.00683-0.4906-0.0075-0.735 5.9e-4 -0.2322-0.00201-0.4664 0.01171-0.6983 0.01886-0.2936 0.06332-0.6069 0.24969-0.8453 0.34185-0.4331 1.0226-0.3889 1.5228-0.3979 0.38828 0.0035 0.77905-0.0131 1.1658 0.0285 0.49865 0.0566 0.85211 0.2621 0.97684 0.7737zm8.0732-6.8023c-2.6379-0.06696-2.6373-3.9334 0-4 2.6378 0.06697 2.6373 3.9334 0 4z" fill="currentColor"></path></svg>
            <p name="id">可调用对象</p>
          </span>
        </div>
      
<p><strong>财务审批系统中使用 <code>functools.partial</code> 构造具有固定参数的审计函数</strong></p>
<p><strong>例子描述</strong><br>
在企业审批系统中，多个接口需要进行审计日志记录。日志函数结构相似，但模块名不同。开发者用 <code>functools.partial</code> 固定部分参数（如模块名），生成多个定制化的可调用对象，用于依赖注入，实现代码简洁复用。</p>
<p><strong>特征对比</strong></p>
<ul>
<li>✅ <strong>函数式接口</strong>：partial 对象仍可被调用</li>
<li>✅ <strong>兼容注入机制</strong>：FastAPI 识别并执行 partial 返回对象</li>
<li>✅ <strong>可复用与组合</strong>：基于相同模板创建多个不同版本函数</li>
<li>✅ <strong>简化调用逻辑</strong>：无需重复写多个函数</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> fastapi <span class="token keyword">import</span> FastAPI<span class="token punctuation">,</span> Depends
<span class="token keyword">from</span> functools <span class="token keyword">import</span> partial

app <span class="token operator">=</span> FastAPI<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">audit_log</span><span class="token punctuation">(</span>module<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> action<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[Audit] Module: </span><span class="token interpolation"><span class="token punctuation">{</span>module<span class="token punctuation">}</span></span><span class="token string">, Action: </span><span class="token interpolation"><span class="token punctuation">{</span>action<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token string">"module"</span><span class="token punctuation">:</span> module<span class="token punctuation">,</span> <span class="token string">"action"</span><span class="token punctuation">:</span> action<span class="token punctuation">}</span>

<span class="token comment"># 构造可调用对象</span>
log_sales <span class="token operator">=</span> partial<span class="token punctuation">(</span>audit_log<span class="token punctuation">,</span> module<span class="token operator">=</span><span class="token string">"sales"</span><span class="token punctuation">)</span>
log_hr <span class="token operator">=</span> partial<span class="token punctuation">(</span>audit_log<span class="token punctuation">,</span> module<span class="token operator">=</span><span class="token string">"hr"</span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>get</span><span class="token punctuation">(</span><span class="token string">"/sales/"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">sales_view</span><span class="token punctuation">(</span>log<span class="token operator">=</span>Depends<span class="token punctuation">(</span>log_sales<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token string">"info"</span><span class="token punctuation">:</span> <span class="token string">"Sales Access"</span><span class="token punctuation">,</span> <span class="token string">"log"</span><span class="token punctuation">:</span> log<span class="token punctuation">}</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>get</span><span class="token punctuation">(</span><span class="token string">"/hr/"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">hr_view</span><span class="token punctuation">(</span>log<span class="token operator">=</span>Depends<span class="token punctuation">(</span>log_hr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token string">"info"</span><span class="token punctuation">:</span> <span class="token string">"HR Access"</span><span class="token punctuation">,</span> <span class="token string">"log"</span><span class="token punctuation">:</span> log<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

        <div class="evoldown" id="依赖项" type="d">
          <span class="icon">
            <svg type="d" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m21.15 6.85c0-2.2056-1.7944-4-4-4-4.1765-0.01989-5.4993 5.7322-1.8147 7.5629-0.263 0.63631-0.4627 1.4421-0.6559 2.2215-0.1397 0.56337-0.2841 1.1459-0.4405 1.6084-0.0728 0.2155-0.1286 0.4813-0.1891 0.4813-0.5072-0.7362-0.8126-2.2507-1.0979-3.3161-0.47879-1.5358-0.72936-4.4237-2.8018-4.558-0.77422 7e-5 -1.3844 0.52253-1.8138 1.553-0.55019 1.254-0.75064 3.2421-1.3784 4.4472-0.39648 3e-4 -0.79576 0.0045-1.1877 0.0703-0.67978 0.1073-1.3339 0.4195-1.798 0.9347-0.39707 0.4315-0.6427 0.9874-0.74275 1.5623-0.063545 0.351-0.07691 0.7094-0.07883 1.0654 0.001935 0.4718-0.01324 0.9457 0.027745 1.4163 0.09435 1.151 0.65732 2.1308 1.7281 2.6237 0.43467 0.1975 0.91053 0.2877 1.3854 0.3129 0.40096 0.0215 0.80345 0.0129 1.2048 0.0139 0.6491 2e-4 1.2891-0.0515 1.888-0.3229 0.90042-0.4067 1.4845-1.2039 1.6712-2.1666 0.0761-0.3779 0.09179-0.7654 0.09344-1.15 7.7e-4 -0.2699 0.00148-0.5413-7.8e-4 -0.8111-0.00379-0.4854-0.04143-0.9771-0.19121-1.4414-0.28748-0.9172-0.98053-1.616-1.8964-1.909 0.43984-1.1576 0.66815-2.7594 1.1268-3.8895 0.3537 0.72804 0.57113 1.7669 0.82283 2.7298 0.26567 1.0724 0.5404 2.1814 0.90896 3.0557 0.87204 2.2985 3.1124 2.7586 4.0452 0.392 0.5508-1.2642 0.7508-3.279 1.3828-4.4916 2.1142-0.10339 3.8024-1.8557 3.8024-3.995zm-12.073 8.8023c0.05605 0.2275 0.06623 0.465 0.07092 0.6983 0.00363 0.2444 0.00195 0.4906 0.00214 0.735-0.0063 0.408 0.01486 0.882-0.18359 1.2496-0.24573 0.4539-0.8026 0.501-1.2651 0.5114-0.33714 0.0058-0.67525 0.0041-1.0124 0.0018-0.46455-0.0092-1.0361-0.0245-1.3192-0.4545-0.16612-0.2552-0.19733-0.5702-0.21202-0.8673-0.01004-0.2443-0.00683-0.4906-0.0075-0.735 5.9e-4 -0.2322-0.00201-0.4664 0.01171-0.6983 0.01886-0.2936 0.06332-0.6069 0.24969-0.8453 0.34185-0.4331 1.0226-0.3889 1.5228-0.3979 0.38828 0.0035 0.77905-0.0131 1.1658 0.0285 0.49865 0.0566 0.85211 0.2621 0.97684 0.7737zm8.0732-6.8023c-2.6379-0.06696-2.6373-3.9334 0-4 2.6378 0.06697 2.6373 3.9334 0 4z" fill="currentColor"></path></svg>
            <p name="id">依赖项</p>
          </span>
        </div>
      
<p>FastAPI 中的依赖项是<strong>一种声明式机制</strong>，用于将某些通用功能（如认证、数据库连接、配置共享等）提取为<strong>可复用的组件</strong>，<strong>自动注入到路径操作函数、路径参数、请求体等中</strong>。依赖项的核心思想是“依赖注入”，即<strong>通过函数参数的方式自动提供某些值或执行某些逻辑</strong>，提升模块解耦性、复用性和代码清晰度。</p>
<blockquote>
<p>依赖项就是一个函数，且可以使用与「路径操作函数」相同的参数，依赖项函数形式和结构和「路劲操作函数」一样，因此可以把依赖项当作没有「装饰器」（即，没有&nbsp;<code>@app.get("/some-path")</code>&nbsp;）的路径操作函数。</p>
<p>虽然，在路径操作函数的参数中使用&nbsp;<code>Depends</code>&nbsp;的方式与&nbsp;<code>Body</code>、<code>Query</code>&nbsp;相同，但&nbsp;<code>Depends</code>&nbsp;的工作方式略有不同。这里只能传给 Depends 一个参数。且该参数必须是「可调用对象」，比如函数。该函数接收的参数和「路径操作函数」的参数一样。</p>
<p>接收到新的请求时，<strong>FastAPI</strong>&nbsp;执行如下操作：</p>
<ul>
<li>用正确的参数调用依赖项函数（「可依赖项」）</li>
<li>获取函数返回的结果</li>
<li>把函数返回的结果赋值给「路径操作函数」的参数</li>
</ul>
</blockquote>
<p><strong>重要特征：</strong></p>
<ul>
<li><strong>声明式注入</strong>：开发者只需在函数参数中声明依赖项，由 FastAPI 自动解析与注入，无需显式调用。</li>
<li><strong>高内聚低耦合</strong>：依赖项封装了独立逻辑，使主函数关注其核心职责，提升可维护性与复用性。</li>
<li><strong>支持层层依赖（嵌套）</strong>：一个依赖项可以依赖其他依赖项，形成依赖树结构。</li>
<li><strong>作用域控制</strong>：依赖可以按请求、会话或生命周期进行作用域管理。</li>
<li><strong>与安全机制无缝结合</strong>：依赖项是实现认证、授权、权限控制的推荐方式。</li>
</ul>

        <div class="evoldown" id="用户认证校验函数(正例)" type="e">
          <span class="icon">
            <svg type="e" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path fill="currentColor" d="m21.9 15.621c0.1248-1.8535-0.6087-3.4099-2.6058-3.8292-0.7712-0.15744-1.3921-0.13977-2.1113-0.14543-0.6323 0.0048-1.1718-0.01567-1.8401 0.03203 1.5356-0.8078 1.6998-2.205 1.6567-3.546 0.1272-2.3708-1.4685-3.666-3.7727-3.673-2.2427-0.04024-5.0463-0.27229-5.9443 1.9172-0.28083 0.6692-0.27606 1.2179-0.28202 1.6587-0.08527 1.4303 0.20687 2.9224 1.662 3.6429-2.3051-0.05275-5.3273-0.39212-6.28 1.8983-0.28073 0.66862-0.27595 1.2174-0.282 1.6572-0.10329 1.6061 0.3059 3.171 2.0252 3.8067 1.2061 0.4187 2.2175 0.2869 3.3945 0.3134 2.0524 0.0901 4.0448-0.4637 4.4796-2.4982 0.609 2.5638 3.2086 2.5463 5.3204 2.4982 2.7823 0.1278 4.7024-0.9368 4.5798-3.7329zm-12.899-7.6287c-0.14889-1.8665 1.8839-1.4921 3.1358-1.546 0.8939 0.05358 2.4743-0.21158 2.8003 0.88445 0.2729 2.4494-0.0297 2.8555-2.5242 2.8232-0.94713-0.07259-2.869 0.28949-3.3134-0.77077-0.14881-0.44557-0.08538-0.92893-0.09846-1.3909zm0.2606 9.2128c-0.56638 0.162-1.1652 0.1412-1.7487 0.1488-0.59786-0.0036-1.1977 0.0131-1.7948-0.0233-0.93407-0.0365-1.6776-0.3579-1.6157-1.4217 0.01574-0.5119-0.06845-1.0551 0.11822-1.5436 0.4432-0.84155 1.5978-0.6728 2.4032-0.7191 0.81712 0.01614 1.6464-0.05154 2.4536 0.10154 0.99382 0.17537 1.0564 0.91742 1.0227 1.7752-6.1e-4 0.7729 0.04085 1.416-0.83867 1.6821zm2.9212-3.6286c-0.0836 0.19457-0.14194 0.3848-0.18279 0.56614-0.18535-0.87758-0.76293-1.6189-1.5605-2.02 1.0871 0.04933 2.0387 0.04959 3.1216-8e-5 -0.7672 0.39034-1.1687 0.96486-1.3783 1.4539zm6.8788 3.6286c-0.5664 0.162-1.1652 0.1412-1.7488 0.1488-0.5978-0.0036-1.1977 0.0131-1.7947-0.0233-0.9341-0.0365-1.6776-0.3579-1.6157-1.4217 0.0157-0.5119-0.0685-1.0551 0.1182-1.5436 0.4432-0.84155 1.5978-0.6728 2.4033-0.7191 0.8171 0.01614 1.6464-0.05154 2.4536 0.10154 0.9938 0.17537 1.0563 0.91742 1.0227 1.7752-6e-4 0.7729 0.0409 1.416-0.8386 1.6821z"></path></svg>
            <p name="id">用户认证校验函数(正例)</p>
          </span>
          <span class="link-icon ml-[0.5em] mr-[0.25em]">
            <svg xmlns="http://www.w3.org/2000/svg" width="0.9411764705882353em" height="0.9411764705882353em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class="untouchable"><path d="m9.5652 14.45 0.72891-2.0026c-0.651 0.00713-1.3027 0.00104-1.9532 0.00179-1.0991-0.02908-3.0336 0.08306-3.605-1.0524-0.28828-0.61588-0.2054-1.3226-0.22136-1.9833 0.00663-0.74044-0.05553-1.6362 0.5758-2.1558 0.70637-0.5555 1.7411-0.56129 2.6027-0.59834 0.743-0.015 1.4884-0.00764 2.2315-0.00868 0.68471 0.01536 1.6274-0.01783 2.4184 0.16762l0.68711-1.8879c-0.0146-0.003965-0.0287-0.00841-0.0435-0.01227-0.94653-0.24905-1.9355-0.25901-2.9083-0.26688-0.78352-1.3008e-4 -1.5692-0.0063751-2.3527 0.006805-1.2709 0.027555-2.6299 0.13739-3.6978 0.89566-1.6654 1.2031-1.53 2.9573-1.5068 4.79-0.0012251 1.7732 0.89765 3.2159 2.626 3.7562 0.80589 0.26191 1.6615 0.32018 2.5036 0.34101 0.6376 0.01106 1.2763 0.01096 1.9146 0.00915z" fill="currentColor"></path><path d="m14.589 9.125h1.3099c0.02865-0.88714-0.11774-1.6826-0.45594-2.3461l-0.85392 2.3461z" fill="currentColor"></path><path d="m15.587 12.025h-2.0527l-0.80604 2.2146c1.2326-0.27362 2.3169-0.88582 2.8588-2.2146z" fill="currentColor"></path><path d="m8.394 12.025h2.0538l0.82406-2.2641c-1.2457 0.2734-2.3327 0.8901-2.8779 2.2641z" fill="currentColor"></path><path d="m8.5566 17.221 0.83571-2.2961h-1.2914c-0.025394 0.86685 0.12295 1.645 0.45565 2.2961z" fill="currentColor"></path><path d="m21.485 14.399c7e-4 -0.67593 0.0063-1.3662-0.1779-2.0223-0.58881-2.115-2.5706-2.7532-4.5608-2.8041-0.76964-0.031175-1.5416-0.02264-2.3121-0.022365l-0.72832 2.0011c0.38557-0.00297 0.77131 7.6e-4 1.1559-0.00173 1.1244 0.02284 2.8396-0.10221 3.8152 0.44616 0.82512 0.45526 0.81194 1.4036 0.80798 2.2308-0.01538 0.64171 0.05949 1.3145-0.1601 1.93-0.39418 1.0145-1.651 1.1102-2.5915 1.1694-0.7426 0.03331-1.4884 0.0209-2.2315 0.02365-0.81334-0.01641-1.9395 0.04306-2.8448-0.16914l-0.68792 1.89c0.014845 0.00401 0.02915 0.0085 0.044115 0.0124 0.94522 0.24688 1.9316 0.25913 2.9027 0.2657 0.83456-2.2e-4 1.6713 0.00786 2.5057-0.00999 2.0286-0.02122 4.1491-0.51576 4.8438-2.6752 0.2358-0.7292 0.22-1.5067 0.2196-2.2644z" fill="currentColor"></path><path d="m14.979 6.7378c0.17824-0.52033 0.90905-2.4486 1.0626-2.9514 0.05601-0.19527 0.10768-0.39984 0.08232-0.60408-0.03096-0.33264-0.36035-0.4603-0.63671-0.55464-0.20794-0.070665-0.41593-0.17228-0.63943-0.174-0.33751 0.005805-0.52152 0.33878-0.64452 0.61072-1.4256 3.8005-4.7612 13.07-6.1617 16.891-0.10636 0.34-0.29285 0.7891-0.06874 1.1109 0.1296 0.1673 0.34386 0.232 0.53431 0.3042 0.30778 0.1107 0.70325 0.3075 0.98251 0.0365 0.14514-0.1339 0.23561-0.315 0.31595-0.4926 0.10005-0.2274 0.1811-0.4632 0.26694-0.6962 0.4854-1.3337 4.3257-11.885 4.9065-13.481z" fill="currentColor"></path></svg>
          </span>
          
          <span class="icon">
            <svg type="d" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m21.15 6.85c0-2.2056-1.7944-4-4-4-4.1765-0.01989-5.4993 5.7322-1.8147 7.5629-0.263 0.63631-0.4627 1.4421-0.6559 2.2215-0.1397 0.56337-0.2841 1.1459-0.4405 1.6084-0.0728 0.2155-0.1286 0.4813-0.1891 0.4813-0.5072-0.7362-0.8126-2.2507-1.0979-3.3161-0.47879-1.5358-0.72936-4.4237-2.8018-4.558-0.77422 7e-5 -1.3844 0.52253-1.8138 1.553-0.55019 1.254-0.75064 3.2421-1.3784 4.4472-0.39648 3e-4 -0.79576 0.0045-1.1877 0.0703-0.67978 0.1073-1.3339 0.4195-1.798 0.9347-0.39707 0.4315-0.6427 0.9874-0.74275 1.5623-0.063545 0.351-0.07691 0.7094-0.07883 1.0654 0.001935 0.4718-0.01324 0.9457 0.027745 1.4163 0.09435 1.151 0.65732 2.1308 1.7281 2.6237 0.43467 0.1975 0.91053 0.2877 1.3854 0.3129 0.40096 0.0215 0.80345 0.0129 1.2048 0.0139 0.6491 2e-4 1.2891-0.0515 1.888-0.3229 0.90042-0.4067 1.4845-1.2039 1.6712-2.1666 0.0761-0.3779 0.09179-0.7654 0.09344-1.15 7.7e-4 -0.2699 0.00148-0.5413-7.8e-4 -0.8111-0.00379-0.4854-0.04143-0.9771-0.19121-1.4414-0.28748-0.9172-0.98053-1.616-1.8964-1.909 0.43984-1.1576 0.66815-2.7594 1.1268-3.8895 0.3537 0.72804 0.57113 1.7669 0.82283 2.7298 0.26567 1.0724 0.5404 2.1814 0.90896 3.0557 0.87204 2.2985 3.1124 2.7586 4.0452 0.392 0.5508-1.2642 0.7508-3.279 1.3828-4.4916 2.1142-0.10339 3.8024-1.8557 3.8024-3.995zm-12.073 8.8023c0.05605 0.2275 0.06623 0.465 0.07092 0.6983 0.00363 0.2444 0.00195 0.4906 0.00214 0.735-0.0063 0.408 0.01486 0.882-0.18359 1.2496-0.24573 0.4539-0.8026 0.501-1.2651 0.5114-0.33714 0.0058-0.67525 0.0041-1.0124 0.0018-0.46455-0.0092-1.0361-0.0245-1.3192-0.4545-0.16612-0.2552-0.19733-0.5702-0.21202-0.8673-0.01004-0.2443-0.00683-0.4906-0.0075-0.735 5.9e-4 -0.2322-0.00201-0.4664 0.01171-0.6983 0.01886-0.2936 0.06332-0.6069 0.24969-0.8453 0.34185-0.4331 1.0226-0.3889 1.5228-0.3979 0.38828 0.0035 0.77905-0.0131 1.1658 0.0285 0.49865 0.0566 0.85211 0.2621 0.97684 0.7737zm8.0732-6.8023c-2.6379-0.06696-2.6373-3.9334 0-4 2.6378 0.06697 2.6373 3.9334 0 4z" fill="currentColor"></path></svg>
            <p name="id">依赖项</p>
          </span>
        </div>
      
<p><strong>现象：</strong><br>
一个 Web 应用的接口需要验证用户身份。开发者将“从请求头中获取并验证 Token”的逻辑封装为一个独立的函数，作为依赖项注入到需要认证的接口中。该函数独立于主业务逻辑，接口函数只需接收“当前用户”对象并执行业务处理。</p>
<p><strong>特征对比</strong></p>
<ul>
<li>✅ <strong>声明式注入</strong>：使用 <code>Depends(get_current_user)</code> 方式注入，无需在主函数中显式调用验证逻辑</li>
<li>✅ <strong>高内聚低耦合</strong>：认证逻辑独立封装，与业务逻辑分离</li>
<li>✅ <strong>嵌套依赖支持</strong>：Token 验证可能依赖数据库连接或加密函数</li>
<li>✅ <strong>安全机制结合</strong>：是 FastAPI 安全机制的标准实现方式</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> fastapi <span class="token keyword">import</span> FastAPI<span class="token punctuation">,</span> Depends<span class="token punctuation">,</span> HTTPException<span class="token punctuation">,</span> Header

app <span class="token operator">=</span> FastAPI<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">verify_token</span><span class="token punctuation">(</span>token<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> Header<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 依赖项函数</span>
    <span class="token keyword">if</span> token <span class="token operator">!=</span> <span class="token string">"secret-token"</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> HTTPException<span class="token punctuation">(</span>status_code<span class="token operator">=</span><span class="token number">403</span><span class="token punctuation">,</span> detail<span class="token operator">=</span><span class="token string">"Invalid token"</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token string">"user_id"</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"admin"</span><span class="token punctuation">}</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>get</span><span class="token punctuation">(</span><span class="token string">"/protected"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">read_protected</span><span class="token punctuation">(</span>current_user<span class="token punctuation">:</span> <span class="token builtin">dict</span> <span class="token operator">=</span> Depends<span class="token punctuation">(</span>verify_token<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># 声明依赖项</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token string">"message"</span><span class="token punctuation">:</span> <span class="token string">"Hello, user"</span><span class="token punctuation">,</span> <span class="token string">"user"</span><span class="token punctuation">:</span> current_user<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

        <div class="evoldown" id="数据库Session(正例)" type="e">
          <span class="icon">
            <svg type="e" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path fill="currentColor" d="m21.9 15.621c0.1248-1.8535-0.6087-3.4099-2.6058-3.8292-0.7712-0.15744-1.3921-0.13977-2.1113-0.14543-0.6323 0.0048-1.1718-0.01567-1.8401 0.03203 1.5356-0.8078 1.6998-2.205 1.6567-3.546 0.1272-2.3708-1.4685-3.666-3.7727-3.673-2.2427-0.04024-5.0463-0.27229-5.9443 1.9172-0.28083 0.6692-0.27606 1.2179-0.28202 1.6587-0.08527 1.4303 0.20687 2.9224 1.662 3.6429-2.3051-0.05275-5.3273-0.39212-6.28 1.8983-0.28073 0.66862-0.27595 1.2174-0.282 1.6572-0.10329 1.6061 0.3059 3.171 2.0252 3.8067 1.2061 0.4187 2.2175 0.2869 3.3945 0.3134 2.0524 0.0901 4.0448-0.4637 4.4796-2.4982 0.609 2.5638 3.2086 2.5463 5.3204 2.4982 2.7823 0.1278 4.7024-0.9368 4.5798-3.7329zm-12.899-7.6287c-0.14889-1.8665 1.8839-1.4921 3.1358-1.546 0.8939 0.05358 2.4743-0.21158 2.8003 0.88445 0.2729 2.4494-0.0297 2.8555-2.5242 2.8232-0.94713-0.07259-2.869 0.28949-3.3134-0.77077-0.14881-0.44557-0.08538-0.92893-0.09846-1.3909zm0.2606 9.2128c-0.56638 0.162-1.1652 0.1412-1.7487 0.1488-0.59786-0.0036-1.1977 0.0131-1.7948-0.0233-0.93407-0.0365-1.6776-0.3579-1.6157-1.4217 0.01574-0.5119-0.06845-1.0551 0.11822-1.5436 0.4432-0.84155 1.5978-0.6728 2.4032-0.7191 0.81712 0.01614 1.6464-0.05154 2.4536 0.10154 0.99382 0.17537 1.0564 0.91742 1.0227 1.7752-6.1e-4 0.7729 0.04085 1.416-0.83867 1.6821zm2.9212-3.6286c-0.0836 0.19457-0.14194 0.3848-0.18279 0.56614-0.18535-0.87758-0.76293-1.6189-1.5605-2.02 1.0871 0.04933 2.0387 0.04959 3.1216-8e-5 -0.7672 0.39034-1.1687 0.96486-1.3783 1.4539zm6.8788 3.6286c-0.5664 0.162-1.1652 0.1412-1.7488 0.1488-0.5978-0.0036-1.1977 0.0131-1.7947-0.0233-0.9341-0.0365-1.6776-0.3579-1.6157-1.4217 0.0157-0.5119-0.0685-1.0551 0.1182-1.5436 0.4432-0.84155 1.5978-0.6728 2.4033-0.7191 0.8171 0.01614 1.6464-0.05154 2.4536 0.10154 0.9938 0.17537 1.0563 0.91742 1.0227 1.7752-6e-4 0.7729 0.0409 1.416-0.8386 1.6821z"></path></svg>
            <p name="id">数据库Session(正例)</p>
          </span>
          <span class="link-icon ml-[0.5em] mr-[0.25em]">
            <svg xmlns="http://www.w3.org/2000/svg" width="0.9411764705882353em" height="0.9411764705882353em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class="untouchable"><path d="m9.5652 14.45 0.72891-2.0026c-0.651 0.00713-1.3027 0.00104-1.9532 0.00179-1.0991-0.02908-3.0336 0.08306-3.605-1.0524-0.28828-0.61588-0.2054-1.3226-0.22136-1.9833 0.00663-0.74044-0.05553-1.6362 0.5758-2.1558 0.70637-0.5555 1.7411-0.56129 2.6027-0.59834 0.743-0.015 1.4884-0.00764 2.2315-0.00868 0.68471 0.01536 1.6274-0.01783 2.4184 0.16762l0.68711-1.8879c-0.0146-0.003965-0.0287-0.00841-0.0435-0.01227-0.94653-0.24905-1.9355-0.25901-2.9083-0.26688-0.78352-1.3008e-4 -1.5692-0.0063751-2.3527 0.006805-1.2709 0.027555-2.6299 0.13739-3.6978 0.89566-1.6654 1.2031-1.53 2.9573-1.5068 4.79-0.0012251 1.7732 0.89765 3.2159 2.626 3.7562 0.80589 0.26191 1.6615 0.32018 2.5036 0.34101 0.6376 0.01106 1.2763 0.01096 1.9146 0.00915z" fill="currentColor"></path><path d="m14.589 9.125h1.3099c0.02865-0.88714-0.11774-1.6826-0.45594-2.3461l-0.85392 2.3461z" fill="currentColor"></path><path d="m15.587 12.025h-2.0527l-0.80604 2.2146c1.2326-0.27362 2.3169-0.88582 2.8588-2.2146z" fill="currentColor"></path><path d="m8.394 12.025h2.0538l0.82406-2.2641c-1.2457 0.2734-2.3327 0.8901-2.8779 2.2641z" fill="currentColor"></path><path d="m8.5566 17.221 0.83571-2.2961h-1.2914c-0.025394 0.86685 0.12295 1.645 0.45565 2.2961z" fill="currentColor"></path><path d="m21.485 14.399c7e-4 -0.67593 0.0063-1.3662-0.1779-2.0223-0.58881-2.115-2.5706-2.7532-4.5608-2.8041-0.76964-0.031175-1.5416-0.02264-2.3121-0.022365l-0.72832 2.0011c0.38557-0.00297 0.77131 7.6e-4 1.1559-0.00173 1.1244 0.02284 2.8396-0.10221 3.8152 0.44616 0.82512 0.45526 0.81194 1.4036 0.80798 2.2308-0.01538 0.64171 0.05949 1.3145-0.1601 1.93-0.39418 1.0145-1.651 1.1102-2.5915 1.1694-0.7426 0.03331-1.4884 0.0209-2.2315 0.02365-0.81334-0.01641-1.9395 0.04306-2.8448-0.16914l-0.68792 1.89c0.014845 0.00401 0.02915 0.0085 0.044115 0.0124 0.94522 0.24688 1.9316 0.25913 2.9027 0.2657 0.83456-2.2e-4 1.6713 0.00786 2.5057-0.00999 2.0286-0.02122 4.1491-0.51576 4.8438-2.6752 0.2358-0.7292 0.22-1.5067 0.2196-2.2644z" fill="currentColor"></path><path d="m14.979 6.7378c0.17824-0.52033 0.90905-2.4486 1.0626-2.9514 0.05601-0.19527 0.10768-0.39984 0.08232-0.60408-0.03096-0.33264-0.36035-0.4603-0.63671-0.55464-0.20794-0.070665-0.41593-0.17228-0.63943-0.174-0.33751 0.005805-0.52152 0.33878-0.64452 0.61072-1.4256 3.8005-4.7612 13.07-6.1617 16.891-0.10636 0.34-0.29285 0.7891-0.06874 1.1109 0.1296 0.1673 0.34386 0.232 0.53431 0.3042 0.30778 0.1107 0.70325 0.3075 0.98251 0.0365 0.14514-0.1339 0.23561-0.315 0.31595-0.4926 0.10005-0.2274 0.1811-0.4632 0.26694-0.6962 0.4854-1.3337 4.3257-11.885 4.9065-13.481z" fill="currentColor"></path></svg>
          </span>
          
          <span class="icon">
            <svg type="d" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m21.15 6.85c0-2.2056-1.7944-4-4-4-4.1765-0.01989-5.4993 5.7322-1.8147 7.5629-0.263 0.63631-0.4627 1.4421-0.6559 2.2215-0.1397 0.56337-0.2841 1.1459-0.4405 1.6084-0.0728 0.2155-0.1286 0.4813-0.1891 0.4813-0.5072-0.7362-0.8126-2.2507-1.0979-3.3161-0.47879-1.5358-0.72936-4.4237-2.8018-4.558-0.77422 7e-5 -1.3844 0.52253-1.8138 1.553-0.55019 1.254-0.75064 3.2421-1.3784 4.4472-0.39648 3e-4 -0.79576 0.0045-1.1877 0.0703-0.67978 0.1073-1.3339 0.4195-1.798 0.9347-0.39707 0.4315-0.6427 0.9874-0.74275 1.5623-0.063545 0.351-0.07691 0.7094-0.07883 1.0654 0.001935 0.4718-0.01324 0.9457 0.027745 1.4163 0.09435 1.151 0.65732 2.1308 1.7281 2.6237 0.43467 0.1975 0.91053 0.2877 1.3854 0.3129 0.40096 0.0215 0.80345 0.0129 1.2048 0.0139 0.6491 2e-4 1.2891-0.0515 1.888-0.3229 0.90042-0.4067 1.4845-1.2039 1.6712-2.1666 0.0761-0.3779 0.09179-0.7654 0.09344-1.15 7.7e-4 -0.2699 0.00148-0.5413-7.8e-4 -0.8111-0.00379-0.4854-0.04143-0.9771-0.19121-1.4414-0.28748-0.9172-0.98053-1.616-1.8964-1.909 0.43984-1.1576 0.66815-2.7594 1.1268-3.8895 0.3537 0.72804 0.57113 1.7669 0.82283 2.7298 0.26567 1.0724 0.5404 2.1814 0.90896 3.0557 0.87204 2.2985 3.1124 2.7586 4.0452 0.392 0.5508-1.2642 0.7508-3.279 1.3828-4.4916 2.1142-0.10339 3.8024-1.8557 3.8024-3.995zm-12.073 8.8023c0.05605 0.2275 0.06623 0.465 0.07092 0.6983 0.00363 0.2444 0.00195 0.4906 0.00214 0.735-0.0063 0.408 0.01486 0.882-0.18359 1.2496-0.24573 0.4539-0.8026 0.501-1.2651 0.5114-0.33714 0.0058-0.67525 0.0041-1.0124 0.0018-0.46455-0.0092-1.0361-0.0245-1.3192-0.4545-0.16612-0.2552-0.19733-0.5702-0.21202-0.8673-0.01004-0.2443-0.00683-0.4906-0.0075-0.735 5.9e-4 -0.2322-0.00201-0.4664 0.01171-0.6983 0.01886-0.2936 0.06332-0.6069 0.24969-0.8453 0.34185-0.4331 1.0226-0.3889 1.5228-0.3979 0.38828 0.0035 0.77905-0.0131 1.1658 0.0285 0.49865 0.0566 0.85211 0.2621 0.97684 0.7737zm8.0732-6.8023c-2.6379-0.06696-2.6373-3.9334 0-4 2.6378 0.06697 2.6373 3.9334 0 4z" fill="currentColor"></path></svg>
            <p name="id">依赖项</p>
          </span>
        </div>
      
<p><strong>现象：</strong><br>
在构建 API 时，每次请求都需要连接数据库。开发者将数据库 Session 的创建与关闭逻辑封装为依赖项，并注入到需要数据库访问的路径操作函数中。这确保了每次请求都能自动管理资源，避免连接泄露。</p>
<p><strong>特征对比</strong></p>
<ul>
<li>✅ <strong>声明式注入</strong>：路径函数通过 <code>db: Session = Depends(get_db)</code> 获取数据库连接</li>
<li>✅ <strong>高内聚低耦合</strong>：路径函数只处理业务，不关心连接如何创建</li>
<li>✅ <strong>作用域控制</strong>：依赖项控制连接生命周期（按请求范围自动关闭）</li>
<li>✅ <strong>嵌套依赖支持</strong>：数据库连接依赖配置依赖（如 DB URI）</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> fastapi <span class="token keyword">import</span> FastAPI<span class="token punctuation">,</span> Depends
<span class="token keyword">from</span> sqlalchemy<span class="token punctuation">.</span>orm <span class="token keyword">import</span> Session
<span class="token keyword">from</span> sqlalchemy <span class="token keyword">import</span> create_engine
<span class="token keyword">from</span> sqlalchemy<span class="token punctuation">.</span>orm <span class="token keyword">import</span> sessionmaker

SQLALCHEMY_DATABASE_URL <span class="token operator">=</span> <span class="token string">"sqlite:///./test.db"</span>
engine <span class="token operator">=</span> create_engine<span class="token punctuation">(</span>SQLALCHEMY_DATABASE_URL<span class="token punctuation">,</span> connect_args<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"check_same_thread"</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
SessionLocal <span class="token operator">=</span> sessionmaker<span class="token punctuation">(</span>bind<span class="token operator">=</span>engine<span class="token punctuation">,</span> autocommit<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> autoflush<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>

app <span class="token operator">=</span> FastAPI<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">get_db</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># 依赖项函数</span>
    db <span class="token operator">=</span> SessionLocal<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">yield</span> db
    <span class="token keyword">finally</span><span class="token punctuation">:</span>
        db<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>get</span><span class="token punctuation">(</span><span class="token string">"/items/"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">read_items</span><span class="token punctuation">(</span>db<span class="token punctuation">:</span> Session <span class="token operator">=</span> Depends<span class="token punctuation">(</span>get_db<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># 声明依赖项</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token string">"message"</span><span class="token punctuation">:</span> <span class="token string">"Use db session here"</span><span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

        <div class="evoldown" id="手动实现校验(反例)" type="e">
          <span class="icon">
            <svg type="e" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path fill="currentColor" d="m21.9 15.621c0.1248-1.8535-0.6087-3.4099-2.6058-3.8292-0.7712-0.15744-1.3921-0.13977-2.1113-0.14543-0.6323 0.0048-1.1718-0.01567-1.8401 0.03203 1.5356-0.8078 1.6998-2.205 1.6567-3.546 0.1272-2.3708-1.4685-3.666-3.7727-3.673-2.2427-0.04024-5.0463-0.27229-5.9443 1.9172-0.28083 0.6692-0.27606 1.2179-0.28202 1.6587-0.08527 1.4303 0.20687 2.9224 1.662 3.6429-2.3051-0.05275-5.3273-0.39212-6.28 1.8983-0.28073 0.66862-0.27595 1.2174-0.282 1.6572-0.10329 1.6061 0.3059 3.171 2.0252 3.8067 1.2061 0.4187 2.2175 0.2869 3.3945 0.3134 2.0524 0.0901 4.0448-0.4637 4.4796-2.4982 0.609 2.5638 3.2086 2.5463 5.3204 2.4982 2.7823 0.1278 4.7024-0.9368 4.5798-3.7329zm-12.899-7.6287c-0.14889-1.8665 1.8839-1.4921 3.1358-1.546 0.8939 0.05358 2.4743-0.21158 2.8003 0.88445 0.2729 2.4494-0.0297 2.8555-2.5242 2.8232-0.94713-0.07259-2.869 0.28949-3.3134-0.77077-0.14881-0.44557-0.08538-0.92893-0.09846-1.3909zm0.2606 9.2128c-0.56638 0.162-1.1652 0.1412-1.7487 0.1488-0.59786-0.0036-1.1977 0.0131-1.7948-0.0233-0.93407-0.0365-1.6776-0.3579-1.6157-1.4217 0.01574-0.5119-0.06845-1.0551 0.11822-1.5436 0.4432-0.84155 1.5978-0.6728 2.4032-0.7191 0.81712 0.01614 1.6464-0.05154 2.4536 0.10154 0.99382 0.17537 1.0564 0.91742 1.0227 1.7752-6.1e-4 0.7729 0.04085 1.416-0.83867 1.6821zm2.9212-3.6286c-0.0836 0.19457-0.14194 0.3848-0.18279 0.56614-0.18535-0.87758-0.76293-1.6189-1.5605-2.02 1.0871 0.04933 2.0387 0.04959 3.1216-8e-5 -0.7672 0.39034-1.1687 0.96486-1.3783 1.4539zm6.8788 3.6286c-0.5664 0.162-1.1652 0.1412-1.7488 0.1488-0.5978-0.0036-1.1977 0.0131-1.7947-0.0233-0.9341-0.0365-1.6776-0.3579-1.6157-1.4217 0.0157-0.5119-0.0685-1.0551 0.1182-1.5436 0.4432-0.84155 1.5978-0.6728 2.4033-0.7191 0.8171 0.01614 1.6464-0.05154 2.4536 0.10154 0.9938 0.17537 1.0563 0.91742 1.0227 1.7752-6e-4 0.7729 0.0409 1.416-0.8386 1.6821z"></path></svg>
            <p name="id">手动实现校验(反例)</p>
          </span>
          <span class="link-icon ml-[0.5em] mr-[0.25em]">
            <svg xmlns="http://www.w3.org/2000/svg" width="0.9411764705882353em" height="0.9411764705882353em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class="untouchable"><path d="m9.5652 14.45 0.72891-2.0026c-0.651 0.00713-1.3027 0.00104-1.9532 0.00179-1.0991-0.02908-3.0336 0.08306-3.605-1.0524-0.28828-0.61588-0.2054-1.3226-0.22136-1.9833 0.00663-0.74044-0.05553-1.6362 0.5758-2.1558 0.70637-0.5555 1.7411-0.56129 2.6027-0.59834 0.743-0.015 1.4884-0.00764 2.2315-0.00868 0.68471 0.01536 1.6274-0.01783 2.4184 0.16762l0.68711-1.8879c-0.0146-0.003965-0.0287-0.00841-0.0435-0.01227-0.94653-0.24905-1.9355-0.25901-2.9083-0.26688-0.78352-1.3008e-4 -1.5692-0.0063751-2.3527 0.006805-1.2709 0.027555-2.6299 0.13739-3.6978 0.89566-1.6654 1.2031-1.53 2.9573-1.5068 4.79-0.0012251 1.7732 0.89765 3.2159 2.626 3.7562 0.80589 0.26191 1.6615 0.32018 2.5036 0.34101 0.6376 0.01106 1.2763 0.01096 1.9146 0.00915z" fill="currentColor"></path><path d="m14.589 9.125h1.3099c0.02865-0.88714-0.11774-1.6826-0.45594-2.3461l-0.85392 2.3461z" fill="currentColor"></path><path d="m15.587 12.025h-2.0527l-0.80604 2.2146c1.2326-0.27362 2.3169-0.88582 2.8588-2.2146z" fill="currentColor"></path><path d="m8.394 12.025h2.0538l0.82406-2.2641c-1.2457 0.2734-2.3327 0.8901-2.8779 2.2641z" fill="currentColor"></path><path d="m8.5566 17.221 0.83571-2.2961h-1.2914c-0.025394 0.86685 0.12295 1.645 0.45565 2.2961z" fill="currentColor"></path><path d="m21.485 14.399c7e-4 -0.67593 0.0063-1.3662-0.1779-2.0223-0.58881-2.115-2.5706-2.7532-4.5608-2.8041-0.76964-0.031175-1.5416-0.02264-2.3121-0.022365l-0.72832 2.0011c0.38557-0.00297 0.77131 7.6e-4 1.1559-0.00173 1.1244 0.02284 2.8396-0.10221 3.8152 0.44616 0.82512 0.45526 0.81194 1.4036 0.80798 2.2308-0.01538 0.64171 0.05949 1.3145-0.1601 1.93-0.39418 1.0145-1.651 1.1102-2.5915 1.1694-0.7426 0.03331-1.4884 0.0209-2.2315 0.02365-0.81334-0.01641-1.9395 0.04306-2.8448-0.16914l-0.68792 1.89c0.014845 0.00401 0.02915 0.0085 0.044115 0.0124 0.94522 0.24688 1.9316 0.25913 2.9027 0.2657 0.83456-2.2e-4 1.6713 0.00786 2.5057-0.00999 2.0286-0.02122 4.1491-0.51576 4.8438-2.6752 0.2358-0.7292 0.22-1.5067 0.2196-2.2644z" fill="currentColor"></path><path d="m14.979 6.7378c0.17824-0.52033 0.90905-2.4486 1.0626-2.9514 0.05601-0.19527 0.10768-0.39984 0.08232-0.60408-0.03096-0.33264-0.36035-0.4603-0.63671-0.55464-0.20794-0.070665-0.41593-0.17228-0.63943-0.174-0.33751 0.005805-0.52152 0.33878-0.64452 0.61072-1.4256 3.8005-4.7612 13.07-6.1617 16.891-0.10636 0.34-0.29285 0.7891-0.06874 1.1109 0.1296 0.1673 0.34386 0.232 0.53431 0.3042 0.30778 0.1107 0.70325 0.3075 0.98251 0.0365 0.14514-0.1339 0.23561-0.315 0.31595-0.4926 0.10005-0.2274 0.1811-0.4632 0.26694-0.6962 0.4854-1.3337 4.3257-11.885 4.9065-13.481z" fill="currentColor"></path></svg>
          </span>
          
          <span class="icon">
            <svg type="d" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m21.15 6.85c0-2.2056-1.7944-4-4-4-4.1765-0.01989-5.4993 5.7322-1.8147 7.5629-0.263 0.63631-0.4627 1.4421-0.6559 2.2215-0.1397 0.56337-0.2841 1.1459-0.4405 1.6084-0.0728 0.2155-0.1286 0.4813-0.1891 0.4813-0.5072-0.7362-0.8126-2.2507-1.0979-3.3161-0.47879-1.5358-0.72936-4.4237-2.8018-4.558-0.77422 7e-5 -1.3844 0.52253-1.8138 1.553-0.55019 1.254-0.75064 3.2421-1.3784 4.4472-0.39648 3e-4 -0.79576 0.0045-1.1877 0.0703-0.67978 0.1073-1.3339 0.4195-1.798 0.9347-0.39707 0.4315-0.6427 0.9874-0.74275 1.5623-0.063545 0.351-0.07691 0.7094-0.07883 1.0654 0.001935 0.4718-0.01324 0.9457 0.027745 1.4163 0.09435 1.151 0.65732 2.1308 1.7281 2.6237 0.43467 0.1975 0.91053 0.2877 1.3854 0.3129 0.40096 0.0215 0.80345 0.0129 1.2048 0.0139 0.6491 2e-4 1.2891-0.0515 1.888-0.3229 0.90042-0.4067 1.4845-1.2039 1.6712-2.1666 0.0761-0.3779 0.09179-0.7654 0.09344-1.15 7.7e-4 -0.2699 0.00148-0.5413-7.8e-4 -0.8111-0.00379-0.4854-0.04143-0.9771-0.19121-1.4414-0.28748-0.9172-0.98053-1.616-1.8964-1.909 0.43984-1.1576 0.66815-2.7594 1.1268-3.8895 0.3537 0.72804 0.57113 1.7669 0.82283 2.7298 0.26567 1.0724 0.5404 2.1814 0.90896 3.0557 0.87204 2.2985 3.1124 2.7586 4.0452 0.392 0.5508-1.2642 0.7508-3.279 1.3828-4.4916 2.1142-0.10339 3.8024-1.8557 3.8024-3.995zm-12.073 8.8023c0.05605 0.2275 0.06623 0.465 0.07092 0.6983 0.00363 0.2444 0.00195 0.4906 0.00214 0.735-0.0063 0.408 0.01486 0.882-0.18359 1.2496-0.24573 0.4539-0.8026 0.501-1.2651 0.5114-0.33714 0.0058-0.67525 0.0041-1.0124 0.0018-0.46455-0.0092-1.0361-0.0245-1.3192-0.4545-0.16612-0.2552-0.19733-0.5702-0.21202-0.8673-0.01004-0.2443-0.00683-0.4906-0.0075-0.735 5.9e-4 -0.2322-0.00201-0.4664 0.01171-0.6983 0.01886-0.2936 0.06332-0.6069 0.24969-0.8453 0.34185-0.4331 1.0226-0.3889 1.5228-0.3979 0.38828 0.0035 0.77905-0.0131 1.1658 0.0285 0.49865 0.0566 0.85211 0.2621 0.97684 0.7737zm8.0732-6.8023c-2.6379-0.06696-2.6373-3.9334 0-4 2.6378 0.06697 2.6373 3.9334 0 4z" fill="currentColor"></path></svg>
            <p name="id">依赖项</p>
          </span>
        </div>
      
<p><strong>现象：</strong><br>
某接口需要判断用户是否为管理员。开发者在接口函数内部显式写死权限逻辑，如手动提取 Header、验证 Token、查询权限。虽然功能完成，但重复出现于多个接口，难以维护。</p>
<p><strong>特征对比</strong></p>
<ul>
<li>❌ <strong>声明式注入缺失</strong>：未使用 <code>Depends</code> 注入，而是手动处理请求内容</li>
<li>❌ <strong>高耦合</strong>：权限逻辑与业务逻辑混杂，降低代码可读性与复用性</li>
<li>❌ <strong>缺乏作用域控制与依赖封装</strong>：资源与流程混乱，难以集中管理</li>
<li>❌ <strong>无法复用</strong>：其他接口无法方便复用该权限逻辑</li>
</ul>
<h2 id="2类依赖项"><a class="markdownIt-Anchor" href="#2类依赖项"></a> 2.类依赖项</h2>

        <div class="evoldown" id="类依赖项" type="d">
          <span class="icon">
            <svg type="d" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m21.15 6.85c0-2.2056-1.7944-4-4-4-4.1765-0.01989-5.4993 5.7322-1.8147 7.5629-0.263 0.63631-0.4627 1.4421-0.6559 2.2215-0.1397 0.56337-0.2841 1.1459-0.4405 1.6084-0.0728 0.2155-0.1286 0.4813-0.1891 0.4813-0.5072-0.7362-0.8126-2.2507-1.0979-3.3161-0.47879-1.5358-0.72936-4.4237-2.8018-4.558-0.77422 7e-5 -1.3844 0.52253-1.8138 1.553-0.55019 1.254-0.75064 3.2421-1.3784 4.4472-0.39648 3e-4 -0.79576 0.0045-1.1877 0.0703-0.67978 0.1073-1.3339 0.4195-1.798 0.9347-0.39707 0.4315-0.6427 0.9874-0.74275 1.5623-0.063545 0.351-0.07691 0.7094-0.07883 1.0654 0.001935 0.4718-0.01324 0.9457 0.027745 1.4163 0.09435 1.151 0.65732 2.1308 1.7281 2.6237 0.43467 0.1975 0.91053 0.2877 1.3854 0.3129 0.40096 0.0215 0.80345 0.0129 1.2048 0.0139 0.6491 2e-4 1.2891-0.0515 1.888-0.3229 0.90042-0.4067 1.4845-1.2039 1.6712-2.1666 0.0761-0.3779 0.09179-0.7654 0.09344-1.15 7.7e-4 -0.2699 0.00148-0.5413-7.8e-4 -0.8111-0.00379-0.4854-0.04143-0.9771-0.19121-1.4414-0.28748-0.9172-0.98053-1.616-1.8964-1.909 0.43984-1.1576 0.66815-2.7594 1.1268-3.8895 0.3537 0.72804 0.57113 1.7669 0.82283 2.7298 0.26567 1.0724 0.5404 2.1814 0.90896 3.0557 0.87204 2.2985 3.1124 2.7586 4.0452 0.392 0.5508-1.2642 0.7508-3.279 1.3828-4.4916 2.1142-0.10339 3.8024-1.8557 3.8024-3.995zm-12.073 8.8023c0.05605 0.2275 0.06623 0.465 0.07092 0.6983 0.00363 0.2444 0.00195 0.4906 0.00214 0.735-0.0063 0.408 0.01486 0.882-0.18359 1.2496-0.24573 0.4539-0.8026 0.501-1.2651 0.5114-0.33714 0.0058-0.67525 0.0041-1.0124 0.0018-0.46455-0.0092-1.0361-0.0245-1.3192-0.4545-0.16612-0.2552-0.19733-0.5702-0.21202-0.8673-0.01004-0.2443-0.00683-0.4906-0.0075-0.735 5.9e-4 -0.2322-0.00201-0.4664 0.01171-0.6983 0.01886-0.2936 0.06332-0.6069 0.24969-0.8453 0.34185-0.4331 1.0226-0.3889 1.5228-0.3979 0.38828 0.0035 0.77905-0.0131 1.1658 0.0285 0.49865 0.0566 0.85211 0.2621 0.97684 0.7737zm8.0732-6.8023c-2.6379-0.06696-2.6373-3.9334 0-4 2.6378 0.06697 2.6373 3.9334 0 4z" fill="currentColor"></path></svg>
            <p name="id">类依赖项</p>
          </span>
        </div>
      
<p>类依赖项是 FastAPI 提供的一种「依赖注入」机制，它允许开发者通过定义类的方式封装多个依赖逻辑。在「路径操作函数」中引入该类时，FastAPI 会自动调用类的 <code>__init__</code> 方法并注入其参数，之后可以将类的属性用于后续的逻辑处理。它通常用于封装多个参数、共享逻辑或资源管理（如认证、分页、查询参数聚合等）。</p>
<p><strong>重要特征：</strong></p>
<ul>
<li><strong>特征1：结构化封装</strong><br>
类依赖项能够将多个逻辑参数或行为整合为一个对象，使代码更具可维护性和模块化。</li>
<li><strong>特征2：自动依赖注入机制</strong><br>
FastAPI 能够自动解析类构造函数的参数并注入依赖，不需要显式调用。</li>
<li><strong>特征3：支持嵌套依赖</strong><br>
类依赖项本身可以依赖其他依赖项或类，支持复杂的依赖图构建。</li>
<li><strong>特征4：复用性高</strong><br>
适合将逻辑独立封装后跨多个路径或服务重用。</li>
</ul>

        <div class="evoldown" id="分页请求对象封装(正例)" type="e">
          <span class="icon">
            <svg type="e" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path fill="currentColor" d="m21.9 15.621c0.1248-1.8535-0.6087-3.4099-2.6058-3.8292-0.7712-0.15744-1.3921-0.13977-2.1113-0.14543-0.6323 0.0048-1.1718-0.01567-1.8401 0.03203 1.5356-0.8078 1.6998-2.205 1.6567-3.546 0.1272-2.3708-1.4685-3.666-3.7727-3.673-2.2427-0.04024-5.0463-0.27229-5.9443 1.9172-0.28083 0.6692-0.27606 1.2179-0.28202 1.6587-0.08527 1.4303 0.20687 2.9224 1.662 3.6429-2.3051-0.05275-5.3273-0.39212-6.28 1.8983-0.28073 0.66862-0.27595 1.2174-0.282 1.6572-0.10329 1.6061 0.3059 3.171 2.0252 3.8067 1.2061 0.4187 2.2175 0.2869 3.3945 0.3134 2.0524 0.0901 4.0448-0.4637 4.4796-2.4982 0.609 2.5638 3.2086 2.5463 5.3204 2.4982 2.7823 0.1278 4.7024-0.9368 4.5798-3.7329zm-12.899-7.6287c-0.14889-1.8665 1.8839-1.4921 3.1358-1.546 0.8939 0.05358 2.4743-0.21158 2.8003 0.88445 0.2729 2.4494-0.0297 2.8555-2.5242 2.8232-0.94713-0.07259-2.869 0.28949-3.3134-0.77077-0.14881-0.44557-0.08538-0.92893-0.09846-1.3909zm0.2606 9.2128c-0.56638 0.162-1.1652 0.1412-1.7487 0.1488-0.59786-0.0036-1.1977 0.0131-1.7948-0.0233-0.93407-0.0365-1.6776-0.3579-1.6157-1.4217 0.01574-0.5119-0.06845-1.0551 0.11822-1.5436 0.4432-0.84155 1.5978-0.6728 2.4032-0.7191 0.81712 0.01614 1.6464-0.05154 2.4536 0.10154 0.99382 0.17537 1.0564 0.91742 1.0227 1.7752-6.1e-4 0.7729 0.04085 1.416-0.83867 1.6821zm2.9212-3.6286c-0.0836 0.19457-0.14194 0.3848-0.18279 0.56614-0.18535-0.87758-0.76293-1.6189-1.5605-2.02 1.0871 0.04933 2.0387 0.04959 3.1216-8e-5 -0.7672 0.39034-1.1687 0.96486-1.3783 1.4539zm6.8788 3.6286c-0.5664 0.162-1.1652 0.1412-1.7488 0.1488-0.5978-0.0036-1.1977 0.0131-1.7947-0.0233-0.9341-0.0365-1.6776-0.3579-1.6157-1.4217 0.0157-0.5119-0.0685-1.0551 0.1182-1.5436 0.4432-0.84155 1.5978-0.6728 2.4033-0.7191 0.8171 0.01614 1.6464-0.05154 2.4536 0.10154 0.9938 0.17537 1.0563 0.91742 1.0227 1.7752-6e-4 0.7729 0.0409 1.416-0.8386 1.6821z"></path></svg>
            <p name="id">分页请求对象封装(正例)</p>
          </span>
          <span class="link-icon ml-[0.5em] mr-[0.25em]">
            <svg xmlns="http://www.w3.org/2000/svg" width="0.9411764705882353em" height="0.9411764705882353em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class="untouchable"><path d="m9.5652 14.45 0.72891-2.0026c-0.651 0.00713-1.3027 0.00104-1.9532 0.00179-1.0991-0.02908-3.0336 0.08306-3.605-1.0524-0.28828-0.61588-0.2054-1.3226-0.22136-1.9833 0.00663-0.74044-0.05553-1.6362 0.5758-2.1558 0.70637-0.5555 1.7411-0.56129 2.6027-0.59834 0.743-0.015 1.4884-0.00764 2.2315-0.00868 0.68471 0.01536 1.6274-0.01783 2.4184 0.16762l0.68711-1.8879c-0.0146-0.003965-0.0287-0.00841-0.0435-0.01227-0.94653-0.24905-1.9355-0.25901-2.9083-0.26688-0.78352-1.3008e-4 -1.5692-0.0063751-2.3527 0.006805-1.2709 0.027555-2.6299 0.13739-3.6978 0.89566-1.6654 1.2031-1.53 2.9573-1.5068 4.79-0.0012251 1.7732 0.89765 3.2159 2.626 3.7562 0.80589 0.26191 1.6615 0.32018 2.5036 0.34101 0.6376 0.01106 1.2763 0.01096 1.9146 0.00915z" fill="currentColor"></path><path d="m14.589 9.125h1.3099c0.02865-0.88714-0.11774-1.6826-0.45594-2.3461l-0.85392 2.3461z" fill="currentColor"></path><path d="m15.587 12.025h-2.0527l-0.80604 2.2146c1.2326-0.27362 2.3169-0.88582 2.8588-2.2146z" fill="currentColor"></path><path d="m8.394 12.025h2.0538l0.82406-2.2641c-1.2457 0.2734-2.3327 0.8901-2.8779 2.2641z" fill="currentColor"></path><path d="m8.5566 17.221 0.83571-2.2961h-1.2914c-0.025394 0.86685 0.12295 1.645 0.45565 2.2961z" fill="currentColor"></path><path d="m21.485 14.399c7e-4 -0.67593 0.0063-1.3662-0.1779-2.0223-0.58881-2.115-2.5706-2.7532-4.5608-2.8041-0.76964-0.031175-1.5416-0.02264-2.3121-0.022365l-0.72832 2.0011c0.38557-0.00297 0.77131 7.6e-4 1.1559-0.00173 1.1244 0.02284 2.8396-0.10221 3.8152 0.44616 0.82512 0.45526 0.81194 1.4036 0.80798 2.2308-0.01538 0.64171 0.05949 1.3145-0.1601 1.93-0.39418 1.0145-1.651 1.1102-2.5915 1.1694-0.7426 0.03331-1.4884 0.0209-2.2315 0.02365-0.81334-0.01641-1.9395 0.04306-2.8448-0.16914l-0.68792 1.89c0.014845 0.00401 0.02915 0.0085 0.044115 0.0124 0.94522 0.24688 1.9316 0.25913 2.9027 0.2657 0.83456-2.2e-4 1.6713 0.00786 2.5057-0.00999 2.0286-0.02122 4.1491-0.51576 4.8438-2.6752 0.2358-0.7292 0.22-1.5067 0.2196-2.2644z" fill="currentColor"></path><path d="m14.979 6.7378c0.17824-0.52033 0.90905-2.4486 1.0626-2.9514 0.05601-0.19527 0.10768-0.39984 0.08232-0.60408-0.03096-0.33264-0.36035-0.4603-0.63671-0.55464-0.20794-0.070665-0.41593-0.17228-0.63943-0.174-0.33751 0.005805-0.52152 0.33878-0.64452 0.61072-1.4256 3.8005-4.7612 13.07-6.1617 16.891-0.10636 0.34-0.29285 0.7891-0.06874 1.1109 0.1296 0.1673 0.34386 0.232 0.53431 0.3042 0.30778 0.1107 0.70325 0.3075 0.98251 0.0365 0.14514-0.1339 0.23561-0.315 0.31595-0.4926 0.10005-0.2274 0.1811-0.4632 0.26694-0.6962 0.4854-1.3337 4.3257-11.885 4.9065-13.481z" fill="currentColor"></path></svg>
          </span>
          
          <span class="icon">
            <svg type="d" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m21.15 6.85c0-2.2056-1.7944-4-4-4-4.1765-0.01989-5.4993 5.7322-1.8147 7.5629-0.263 0.63631-0.4627 1.4421-0.6559 2.2215-0.1397 0.56337-0.2841 1.1459-0.4405 1.6084-0.0728 0.2155-0.1286 0.4813-0.1891 0.4813-0.5072-0.7362-0.8126-2.2507-1.0979-3.3161-0.47879-1.5358-0.72936-4.4237-2.8018-4.558-0.77422 7e-5 -1.3844 0.52253-1.8138 1.553-0.55019 1.254-0.75064 3.2421-1.3784 4.4472-0.39648 3e-4 -0.79576 0.0045-1.1877 0.0703-0.67978 0.1073-1.3339 0.4195-1.798 0.9347-0.39707 0.4315-0.6427 0.9874-0.74275 1.5623-0.063545 0.351-0.07691 0.7094-0.07883 1.0654 0.001935 0.4718-0.01324 0.9457 0.027745 1.4163 0.09435 1.151 0.65732 2.1308 1.7281 2.6237 0.43467 0.1975 0.91053 0.2877 1.3854 0.3129 0.40096 0.0215 0.80345 0.0129 1.2048 0.0139 0.6491 2e-4 1.2891-0.0515 1.888-0.3229 0.90042-0.4067 1.4845-1.2039 1.6712-2.1666 0.0761-0.3779 0.09179-0.7654 0.09344-1.15 7.7e-4 -0.2699 0.00148-0.5413-7.8e-4 -0.8111-0.00379-0.4854-0.04143-0.9771-0.19121-1.4414-0.28748-0.9172-0.98053-1.616-1.8964-1.909 0.43984-1.1576 0.66815-2.7594 1.1268-3.8895 0.3537 0.72804 0.57113 1.7669 0.82283 2.7298 0.26567 1.0724 0.5404 2.1814 0.90896 3.0557 0.87204 2.2985 3.1124 2.7586 4.0452 0.392 0.5508-1.2642 0.7508-3.279 1.3828-4.4916 2.1142-0.10339 3.8024-1.8557 3.8024-3.995zm-12.073 8.8023c0.05605 0.2275 0.06623 0.465 0.07092 0.6983 0.00363 0.2444 0.00195 0.4906 0.00214 0.735-0.0063 0.408 0.01486 0.882-0.18359 1.2496-0.24573 0.4539-0.8026 0.501-1.2651 0.5114-0.33714 0.0058-0.67525 0.0041-1.0124 0.0018-0.46455-0.0092-1.0361-0.0245-1.3192-0.4545-0.16612-0.2552-0.19733-0.5702-0.21202-0.8673-0.01004-0.2443-0.00683-0.4906-0.0075-0.735 5.9e-4 -0.2322-0.00201-0.4664 0.01171-0.6983 0.01886-0.2936 0.06332-0.6069 0.24969-0.8453 0.34185-0.4331 1.0226-0.3889 1.5228-0.3979 0.38828 0.0035 0.77905-0.0131 1.1658 0.0285 0.49865 0.0566 0.85211 0.2621 0.97684 0.7737zm8.0732-6.8023c-2.6379-0.06696-2.6373-3.9334 0-4 2.6378 0.06697 2.6373 3.9334 0 4z" fill="currentColor"></path></svg>
            <p name="id">类依赖项</p>
          </span>
        </div>
      
<p><strong>例子描述：</strong><br>
在一个新闻网站的 API 中，使用类依赖项 <code>PaginationParams</code> 将 <code>page</code> 和 <code>size</code> 封装为类的两个字段，用于统一处理分页查询请求。</p>
<p><strong>特征对比：</strong></p>
<ul>
<li>✅ 符合<strong>结构化封装</strong>：将多个查询参数封装为分页类。</li>
<li>✅ 使用<strong>自动依赖注入机制</strong>：类初始化由 FastAPI 自动完成。</li>
<li>✅ 支持<strong>复用</strong>：分页类可用于多个接口，如新闻列表、评论列表等。</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> fastapi <span class="token keyword">import</span> FastAPI<span class="token punctuation">,</span> Depends<span class="token punctuation">,</span> Query

app <span class="token operator">=</span> FastAPI<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">PaginationParams</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> page<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> Query<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> ge<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> size<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> Query<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> ge<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> le<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>page <span class="token operator">=</span> page
        self<span class="token punctuation">.</span>size <span class="token operator">=</span> size

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>get</span><span class="token punctuation">(</span><span class="token string">"/items/"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">list_items</span><span class="token punctuation">(</span>pagination<span class="token punctuation">:</span> PaginationParams <span class="token operator">=</span> Depends<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    start <span class="token operator">=</span> <span class="token punctuation">(</span>pagination<span class="token punctuation">.</span>page <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> pagination<span class="token punctuation">.</span>size
    end <span class="token operator">=</span> start <span class="token operator">+</span> pagination<span class="token punctuation">.</span>size
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token string">"start"</span><span class="token punctuation">:</span> start<span class="token punctuation">,</span> <span class="token string">"end"</span><span class="token punctuation">:</span> end<span class="token punctuation">,</span> <span class="token string">"message"</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"Listing items </span><span class="token interpolation"><span class="token punctuation">{</span>start<span class="token punctuation">}</span></span><span class="token string"> to </span><span class="token interpolation"><span class="token punctuation">{</span>end<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

        <div class="evoldown" id="身份验证逻辑封装(正例)" type="e">
          <span class="icon">
            <svg type="e" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path fill="currentColor" d="m21.9 15.621c0.1248-1.8535-0.6087-3.4099-2.6058-3.8292-0.7712-0.15744-1.3921-0.13977-2.1113-0.14543-0.6323 0.0048-1.1718-0.01567-1.8401 0.03203 1.5356-0.8078 1.6998-2.205 1.6567-3.546 0.1272-2.3708-1.4685-3.666-3.7727-3.673-2.2427-0.04024-5.0463-0.27229-5.9443 1.9172-0.28083 0.6692-0.27606 1.2179-0.28202 1.6587-0.08527 1.4303 0.20687 2.9224 1.662 3.6429-2.3051-0.05275-5.3273-0.39212-6.28 1.8983-0.28073 0.66862-0.27595 1.2174-0.282 1.6572-0.10329 1.6061 0.3059 3.171 2.0252 3.8067 1.2061 0.4187 2.2175 0.2869 3.3945 0.3134 2.0524 0.0901 4.0448-0.4637 4.4796-2.4982 0.609 2.5638 3.2086 2.5463 5.3204 2.4982 2.7823 0.1278 4.7024-0.9368 4.5798-3.7329zm-12.899-7.6287c-0.14889-1.8665 1.8839-1.4921 3.1358-1.546 0.8939 0.05358 2.4743-0.21158 2.8003 0.88445 0.2729 2.4494-0.0297 2.8555-2.5242 2.8232-0.94713-0.07259-2.869 0.28949-3.3134-0.77077-0.14881-0.44557-0.08538-0.92893-0.09846-1.3909zm0.2606 9.2128c-0.56638 0.162-1.1652 0.1412-1.7487 0.1488-0.59786-0.0036-1.1977 0.0131-1.7948-0.0233-0.93407-0.0365-1.6776-0.3579-1.6157-1.4217 0.01574-0.5119-0.06845-1.0551 0.11822-1.5436 0.4432-0.84155 1.5978-0.6728 2.4032-0.7191 0.81712 0.01614 1.6464-0.05154 2.4536 0.10154 0.99382 0.17537 1.0564 0.91742 1.0227 1.7752-6.1e-4 0.7729 0.04085 1.416-0.83867 1.6821zm2.9212-3.6286c-0.0836 0.19457-0.14194 0.3848-0.18279 0.56614-0.18535-0.87758-0.76293-1.6189-1.5605-2.02 1.0871 0.04933 2.0387 0.04959 3.1216-8e-5 -0.7672 0.39034-1.1687 0.96486-1.3783 1.4539zm6.8788 3.6286c-0.5664 0.162-1.1652 0.1412-1.7488 0.1488-0.5978-0.0036-1.1977 0.0131-1.7947-0.0233-0.9341-0.0365-1.6776-0.3579-1.6157-1.4217 0.0157-0.5119-0.0685-1.0551 0.1182-1.5436 0.4432-0.84155 1.5978-0.6728 2.4033-0.7191 0.8171 0.01614 1.6464-0.05154 2.4536 0.10154 0.9938 0.17537 1.0563 0.91742 1.0227 1.7752-6e-4 0.7729 0.0409 1.416-0.8386 1.6821z"></path></svg>
            <p name="id">身份验证逻辑封装(正例)</p>
          </span>
          <span class="link-icon ml-[0.5em] mr-[0.25em]">
            <svg xmlns="http://www.w3.org/2000/svg" width="0.9411764705882353em" height="0.9411764705882353em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class="untouchable"><path d="m9.5652 14.45 0.72891-2.0026c-0.651 0.00713-1.3027 0.00104-1.9532 0.00179-1.0991-0.02908-3.0336 0.08306-3.605-1.0524-0.28828-0.61588-0.2054-1.3226-0.22136-1.9833 0.00663-0.74044-0.05553-1.6362 0.5758-2.1558 0.70637-0.5555 1.7411-0.56129 2.6027-0.59834 0.743-0.015 1.4884-0.00764 2.2315-0.00868 0.68471 0.01536 1.6274-0.01783 2.4184 0.16762l0.68711-1.8879c-0.0146-0.003965-0.0287-0.00841-0.0435-0.01227-0.94653-0.24905-1.9355-0.25901-2.9083-0.26688-0.78352-1.3008e-4 -1.5692-0.0063751-2.3527 0.006805-1.2709 0.027555-2.6299 0.13739-3.6978 0.89566-1.6654 1.2031-1.53 2.9573-1.5068 4.79-0.0012251 1.7732 0.89765 3.2159 2.626 3.7562 0.80589 0.26191 1.6615 0.32018 2.5036 0.34101 0.6376 0.01106 1.2763 0.01096 1.9146 0.00915z" fill="currentColor"></path><path d="m14.589 9.125h1.3099c0.02865-0.88714-0.11774-1.6826-0.45594-2.3461l-0.85392 2.3461z" fill="currentColor"></path><path d="m15.587 12.025h-2.0527l-0.80604 2.2146c1.2326-0.27362 2.3169-0.88582 2.8588-2.2146z" fill="currentColor"></path><path d="m8.394 12.025h2.0538l0.82406-2.2641c-1.2457 0.2734-2.3327 0.8901-2.8779 2.2641z" fill="currentColor"></path><path d="m8.5566 17.221 0.83571-2.2961h-1.2914c-0.025394 0.86685 0.12295 1.645 0.45565 2.2961z" fill="currentColor"></path><path d="m21.485 14.399c7e-4 -0.67593 0.0063-1.3662-0.1779-2.0223-0.58881-2.115-2.5706-2.7532-4.5608-2.8041-0.76964-0.031175-1.5416-0.02264-2.3121-0.022365l-0.72832 2.0011c0.38557-0.00297 0.77131 7.6e-4 1.1559-0.00173 1.1244 0.02284 2.8396-0.10221 3.8152 0.44616 0.82512 0.45526 0.81194 1.4036 0.80798 2.2308-0.01538 0.64171 0.05949 1.3145-0.1601 1.93-0.39418 1.0145-1.651 1.1102-2.5915 1.1694-0.7426 0.03331-1.4884 0.0209-2.2315 0.02365-0.81334-0.01641-1.9395 0.04306-2.8448-0.16914l-0.68792 1.89c0.014845 0.00401 0.02915 0.0085 0.044115 0.0124 0.94522 0.24688 1.9316 0.25913 2.9027 0.2657 0.83456-2.2e-4 1.6713 0.00786 2.5057-0.00999 2.0286-0.02122 4.1491-0.51576 4.8438-2.6752 0.2358-0.7292 0.22-1.5067 0.2196-2.2644z" fill="currentColor"></path><path d="m14.979 6.7378c0.17824-0.52033 0.90905-2.4486 1.0626-2.9514 0.05601-0.19527 0.10768-0.39984 0.08232-0.60408-0.03096-0.33264-0.36035-0.4603-0.63671-0.55464-0.20794-0.070665-0.41593-0.17228-0.63943-0.174-0.33751 0.005805-0.52152 0.33878-0.64452 0.61072-1.4256 3.8005-4.7612 13.07-6.1617 16.891-0.10636 0.34-0.29285 0.7891-0.06874 1.1109 0.1296 0.1673 0.34386 0.232 0.53431 0.3042 0.30778 0.1107 0.70325 0.3075 0.98251 0.0365 0.14514-0.1339 0.23561-0.315 0.31595-0.4926 0.10005-0.2274 0.1811-0.4632 0.26694-0.6962 0.4854-1.3337 4.3257-11.885 4.9065-13.481z" fill="currentColor"></path></svg>
          </span>
          
          <span class="icon">
            <svg type="d" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m21.15 6.85c0-2.2056-1.7944-4-4-4-4.1765-0.01989-5.4993 5.7322-1.8147 7.5629-0.263 0.63631-0.4627 1.4421-0.6559 2.2215-0.1397 0.56337-0.2841 1.1459-0.4405 1.6084-0.0728 0.2155-0.1286 0.4813-0.1891 0.4813-0.5072-0.7362-0.8126-2.2507-1.0979-3.3161-0.47879-1.5358-0.72936-4.4237-2.8018-4.558-0.77422 7e-5 -1.3844 0.52253-1.8138 1.553-0.55019 1.254-0.75064 3.2421-1.3784 4.4472-0.39648 3e-4 -0.79576 0.0045-1.1877 0.0703-0.67978 0.1073-1.3339 0.4195-1.798 0.9347-0.39707 0.4315-0.6427 0.9874-0.74275 1.5623-0.063545 0.351-0.07691 0.7094-0.07883 1.0654 0.001935 0.4718-0.01324 0.9457 0.027745 1.4163 0.09435 1.151 0.65732 2.1308 1.7281 2.6237 0.43467 0.1975 0.91053 0.2877 1.3854 0.3129 0.40096 0.0215 0.80345 0.0129 1.2048 0.0139 0.6491 2e-4 1.2891-0.0515 1.888-0.3229 0.90042-0.4067 1.4845-1.2039 1.6712-2.1666 0.0761-0.3779 0.09179-0.7654 0.09344-1.15 7.7e-4 -0.2699 0.00148-0.5413-7.8e-4 -0.8111-0.00379-0.4854-0.04143-0.9771-0.19121-1.4414-0.28748-0.9172-0.98053-1.616-1.8964-1.909 0.43984-1.1576 0.66815-2.7594 1.1268-3.8895 0.3537 0.72804 0.57113 1.7669 0.82283 2.7298 0.26567 1.0724 0.5404 2.1814 0.90896 3.0557 0.87204 2.2985 3.1124 2.7586 4.0452 0.392 0.5508-1.2642 0.7508-3.279 1.3828-4.4916 2.1142-0.10339 3.8024-1.8557 3.8024-3.995zm-12.073 8.8023c0.05605 0.2275 0.06623 0.465 0.07092 0.6983 0.00363 0.2444 0.00195 0.4906 0.00214 0.735-0.0063 0.408 0.01486 0.882-0.18359 1.2496-0.24573 0.4539-0.8026 0.501-1.2651 0.5114-0.33714 0.0058-0.67525 0.0041-1.0124 0.0018-0.46455-0.0092-1.0361-0.0245-1.3192-0.4545-0.16612-0.2552-0.19733-0.5702-0.21202-0.8673-0.01004-0.2443-0.00683-0.4906-0.0075-0.735 5.9e-4 -0.2322-0.00201-0.4664 0.01171-0.6983 0.01886-0.2936 0.06332-0.6069 0.24969-0.8453 0.34185-0.4331 1.0226-0.3889 1.5228-0.3979 0.38828 0.0035 0.77905-0.0131 1.1658 0.0285 0.49865 0.0566 0.85211 0.2621 0.97684 0.7737zm8.0732-6.8023c-2.6379-0.06696-2.6373-3.9334 0-4 2.6378 0.06697 2.6373 3.9334 0 4z" fill="currentColor"></path></svg>
            <p name="id">类依赖项</p>
          </span>
        </div>
      
<p><strong>例子描述：</strong><br>
在一个医疗系统中，将用户身份验证封装为类 <code>AuthUser</code>，在其构造函数中解析请求头中的 token，并解析为用户对象传入接口处理函数。</p>
<p><strong>特征对比：</strong></p>
<ul>
<li>✅ 结构清晰地封装了身份校验与用户提取逻辑。</li>
<li>✅ 利用了 FastAPI 的自动注入机制从头信息中提取 token。</li>
<li>✅ 高复用性，所有需要身份认证的 API 都可复用该类。</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> fastapi <span class="token keyword">import</span> FastAPI<span class="token punctuation">,</span> Depends<span class="token punctuation">,</span> Header<span class="token punctuation">,</span> HTTPException

app <span class="token operator">=</span> FastAPI<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">AuthUser</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> token<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> Header<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> token <span class="token operator">!=</span> <span class="token string">"secrettoken123"</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> HTTPException<span class="token punctuation">(</span>status_code<span class="token operator">=</span><span class="token number">401</span><span class="token punctuation">,</span> detail<span class="token operator">=</span><span class="token string">"Invalid token"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>username <span class="token operator">=</span> <span class="token string">"authenticated_user"</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>get</span><span class="token punctuation">(</span><span class="token string">"/secure-data/"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">get_secure_data</span><span class="token punctuation">(</span>user<span class="token punctuation">:</span> AuthUser <span class="token operator">=</span> Depends<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token string">"message"</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"Hello </span><span class="token interpolation"><span class="token punctuation">{</span>user<span class="token punctuation">.</span>username<span class="token punctuation">}</span></span><span class="token string">, here is your secure data."</span></span><span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

        <div class="evoldown" id="仅用于存储返回数据结构的类(反例)" type="e">
          <span class="icon">
            <svg type="e" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path fill="currentColor" d="m21.9 15.621c0.1248-1.8535-0.6087-3.4099-2.6058-3.8292-0.7712-0.15744-1.3921-0.13977-2.1113-0.14543-0.6323 0.0048-1.1718-0.01567-1.8401 0.03203 1.5356-0.8078 1.6998-2.205 1.6567-3.546 0.1272-2.3708-1.4685-3.666-3.7727-3.673-2.2427-0.04024-5.0463-0.27229-5.9443 1.9172-0.28083 0.6692-0.27606 1.2179-0.28202 1.6587-0.08527 1.4303 0.20687 2.9224 1.662 3.6429-2.3051-0.05275-5.3273-0.39212-6.28 1.8983-0.28073 0.66862-0.27595 1.2174-0.282 1.6572-0.10329 1.6061 0.3059 3.171 2.0252 3.8067 1.2061 0.4187 2.2175 0.2869 3.3945 0.3134 2.0524 0.0901 4.0448-0.4637 4.4796-2.4982 0.609 2.5638 3.2086 2.5463 5.3204 2.4982 2.7823 0.1278 4.7024-0.9368 4.5798-3.7329zm-12.899-7.6287c-0.14889-1.8665 1.8839-1.4921 3.1358-1.546 0.8939 0.05358 2.4743-0.21158 2.8003 0.88445 0.2729 2.4494-0.0297 2.8555-2.5242 2.8232-0.94713-0.07259-2.869 0.28949-3.3134-0.77077-0.14881-0.44557-0.08538-0.92893-0.09846-1.3909zm0.2606 9.2128c-0.56638 0.162-1.1652 0.1412-1.7487 0.1488-0.59786-0.0036-1.1977 0.0131-1.7948-0.0233-0.93407-0.0365-1.6776-0.3579-1.6157-1.4217 0.01574-0.5119-0.06845-1.0551 0.11822-1.5436 0.4432-0.84155 1.5978-0.6728 2.4032-0.7191 0.81712 0.01614 1.6464-0.05154 2.4536 0.10154 0.99382 0.17537 1.0564 0.91742 1.0227 1.7752-6.1e-4 0.7729 0.04085 1.416-0.83867 1.6821zm2.9212-3.6286c-0.0836 0.19457-0.14194 0.3848-0.18279 0.56614-0.18535-0.87758-0.76293-1.6189-1.5605-2.02 1.0871 0.04933 2.0387 0.04959 3.1216-8e-5 -0.7672 0.39034-1.1687 0.96486-1.3783 1.4539zm6.8788 3.6286c-0.5664 0.162-1.1652 0.1412-1.7488 0.1488-0.5978-0.0036-1.1977 0.0131-1.7947-0.0233-0.9341-0.0365-1.6776-0.3579-1.6157-1.4217 0.0157-0.5119-0.0685-1.0551 0.1182-1.5436 0.4432-0.84155 1.5978-0.6728 2.4033-0.7191 0.8171 0.01614 1.6464-0.05154 2.4536 0.10154 0.9938 0.17537 1.0563 0.91742 1.0227 1.7752-6e-4 0.7729 0.0409 1.416-0.8386 1.6821z"></path></svg>
            <p name="id">仅用于存储返回数据结构的类(反例)</p>
          </span>
          <span class="link-icon ml-[0.5em] mr-[0.25em]">
            <svg xmlns="http://www.w3.org/2000/svg" width="0.9411764705882353em" height="0.9411764705882353em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class="untouchable"><path d="m9.5652 14.45 0.72891-2.0026c-0.651 0.00713-1.3027 0.00104-1.9532 0.00179-1.0991-0.02908-3.0336 0.08306-3.605-1.0524-0.28828-0.61588-0.2054-1.3226-0.22136-1.9833 0.00663-0.74044-0.05553-1.6362 0.5758-2.1558 0.70637-0.5555 1.7411-0.56129 2.6027-0.59834 0.743-0.015 1.4884-0.00764 2.2315-0.00868 0.68471 0.01536 1.6274-0.01783 2.4184 0.16762l0.68711-1.8879c-0.0146-0.003965-0.0287-0.00841-0.0435-0.01227-0.94653-0.24905-1.9355-0.25901-2.9083-0.26688-0.78352-1.3008e-4 -1.5692-0.0063751-2.3527 0.006805-1.2709 0.027555-2.6299 0.13739-3.6978 0.89566-1.6654 1.2031-1.53 2.9573-1.5068 4.79-0.0012251 1.7732 0.89765 3.2159 2.626 3.7562 0.80589 0.26191 1.6615 0.32018 2.5036 0.34101 0.6376 0.01106 1.2763 0.01096 1.9146 0.00915z" fill="currentColor"></path><path d="m14.589 9.125h1.3099c0.02865-0.88714-0.11774-1.6826-0.45594-2.3461l-0.85392 2.3461z" fill="currentColor"></path><path d="m15.587 12.025h-2.0527l-0.80604 2.2146c1.2326-0.27362 2.3169-0.88582 2.8588-2.2146z" fill="currentColor"></path><path d="m8.394 12.025h2.0538l0.82406-2.2641c-1.2457 0.2734-2.3327 0.8901-2.8779 2.2641z" fill="currentColor"></path><path d="m8.5566 17.221 0.83571-2.2961h-1.2914c-0.025394 0.86685 0.12295 1.645 0.45565 2.2961z" fill="currentColor"></path><path d="m21.485 14.399c7e-4 -0.67593 0.0063-1.3662-0.1779-2.0223-0.58881-2.115-2.5706-2.7532-4.5608-2.8041-0.76964-0.031175-1.5416-0.02264-2.3121-0.022365l-0.72832 2.0011c0.38557-0.00297 0.77131 7.6e-4 1.1559-0.00173 1.1244 0.02284 2.8396-0.10221 3.8152 0.44616 0.82512 0.45526 0.81194 1.4036 0.80798 2.2308-0.01538 0.64171 0.05949 1.3145-0.1601 1.93-0.39418 1.0145-1.651 1.1102-2.5915 1.1694-0.7426 0.03331-1.4884 0.0209-2.2315 0.02365-0.81334-0.01641-1.9395 0.04306-2.8448-0.16914l-0.68792 1.89c0.014845 0.00401 0.02915 0.0085 0.044115 0.0124 0.94522 0.24688 1.9316 0.25913 2.9027 0.2657 0.83456-2.2e-4 1.6713 0.00786 2.5057-0.00999 2.0286-0.02122 4.1491-0.51576 4.8438-2.6752 0.2358-0.7292 0.22-1.5067 0.2196-2.2644z" fill="currentColor"></path><path d="m14.979 6.7378c0.17824-0.52033 0.90905-2.4486 1.0626-2.9514 0.05601-0.19527 0.10768-0.39984 0.08232-0.60408-0.03096-0.33264-0.36035-0.4603-0.63671-0.55464-0.20794-0.070665-0.41593-0.17228-0.63943-0.174-0.33751 0.005805-0.52152 0.33878-0.64452 0.61072-1.4256 3.8005-4.7612 13.07-6.1617 16.891-0.10636 0.34-0.29285 0.7891-0.06874 1.1109 0.1296 0.1673 0.34386 0.232 0.53431 0.3042 0.30778 0.1107 0.70325 0.3075 0.98251 0.0365 0.14514-0.1339 0.23561-0.315 0.31595-0.4926 0.10005-0.2274 0.1811-0.4632 0.26694-0.6962 0.4854-1.3337 4.3257-11.885 4.9065-13.481z" fill="currentColor"></path></svg>
          </span>
          
          <span class="icon">
            <svg type="d" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m21.15 6.85c0-2.2056-1.7944-4-4-4-4.1765-0.01989-5.4993 5.7322-1.8147 7.5629-0.263 0.63631-0.4627 1.4421-0.6559 2.2215-0.1397 0.56337-0.2841 1.1459-0.4405 1.6084-0.0728 0.2155-0.1286 0.4813-0.1891 0.4813-0.5072-0.7362-0.8126-2.2507-1.0979-3.3161-0.47879-1.5358-0.72936-4.4237-2.8018-4.558-0.77422 7e-5 -1.3844 0.52253-1.8138 1.553-0.55019 1.254-0.75064 3.2421-1.3784 4.4472-0.39648 3e-4 -0.79576 0.0045-1.1877 0.0703-0.67978 0.1073-1.3339 0.4195-1.798 0.9347-0.39707 0.4315-0.6427 0.9874-0.74275 1.5623-0.063545 0.351-0.07691 0.7094-0.07883 1.0654 0.001935 0.4718-0.01324 0.9457 0.027745 1.4163 0.09435 1.151 0.65732 2.1308 1.7281 2.6237 0.43467 0.1975 0.91053 0.2877 1.3854 0.3129 0.40096 0.0215 0.80345 0.0129 1.2048 0.0139 0.6491 2e-4 1.2891-0.0515 1.888-0.3229 0.90042-0.4067 1.4845-1.2039 1.6712-2.1666 0.0761-0.3779 0.09179-0.7654 0.09344-1.15 7.7e-4 -0.2699 0.00148-0.5413-7.8e-4 -0.8111-0.00379-0.4854-0.04143-0.9771-0.19121-1.4414-0.28748-0.9172-0.98053-1.616-1.8964-1.909 0.43984-1.1576 0.66815-2.7594 1.1268-3.8895 0.3537 0.72804 0.57113 1.7669 0.82283 2.7298 0.26567 1.0724 0.5404 2.1814 0.90896 3.0557 0.87204 2.2985 3.1124 2.7586 4.0452 0.392 0.5508-1.2642 0.7508-3.279 1.3828-4.4916 2.1142-0.10339 3.8024-1.8557 3.8024-3.995zm-12.073 8.8023c0.05605 0.2275 0.06623 0.465 0.07092 0.6983 0.00363 0.2444 0.00195 0.4906 0.00214 0.735-0.0063 0.408 0.01486 0.882-0.18359 1.2496-0.24573 0.4539-0.8026 0.501-1.2651 0.5114-0.33714 0.0058-0.67525 0.0041-1.0124 0.0018-0.46455-0.0092-1.0361-0.0245-1.3192-0.4545-0.16612-0.2552-0.19733-0.5702-0.21202-0.8673-0.01004-0.2443-0.00683-0.4906-0.0075-0.735 5.9e-4 -0.2322-0.00201-0.4664 0.01171-0.6983 0.01886-0.2936 0.06332-0.6069 0.24969-0.8453 0.34185-0.4331 1.0226-0.3889 1.5228-0.3979 0.38828 0.0035 0.77905-0.0131 1.1658 0.0285 0.49865 0.0566 0.85211 0.2621 0.97684 0.7737zm8.0732-6.8023c-2.6379-0.06696-2.6373-3.9334 0-4 2.6378 0.06697 2.6373 3.9334 0 4z" fill="currentColor"></path></svg>
            <p name="id">类依赖项</p>
          </span>
        </div>
      
<p><strong>例子描述：</strong><br>
有开发者将 Pydantic 模型 <code>UserOut</code> 类误用为类依赖项，希望通过它生成响应数据，直接写入依赖中，但这个类并无输入依赖，也不含业务逻辑，仅为结构定义。</p>
<p><strong>特征对比：</strong></p>
<ul>
<li>❌ 没有体现<strong>结构化封装的依赖逻辑</strong>：类不包含任何参数逻辑，仅为数据返回结构定义。</li>
<li>❌ 无<strong>自动注入输入参数</strong>的需要。</li>
<li>❌ 不适合作为依赖复用：它是数据模型，非行为或依赖封装体。</li>
</ul>
<h2 id="3子依赖项"><a class="markdownIt-Anchor" href="#3子依赖项"></a> 3.子依赖项</h2>

        <div class="evoldown" id="子依赖项" type="d">
          <span class="icon">
            <svg type="d" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m21.15 6.85c0-2.2056-1.7944-4-4-4-4.1765-0.01989-5.4993 5.7322-1.8147 7.5629-0.263 0.63631-0.4627 1.4421-0.6559 2.2215-0.1397 0.56337-0.2841 1.1459-0.4405 1.6084-0.0728 0.2155-0.1286 0.4813-0.1891 0.4813-0.5072-0.7362-0.8126-2.2507-1.0979-3.3161-0.47879-1.5358-0.72936-4.4237-2.8018-4.558-0.77422 7e-5 -1.3844 0.52253-1.8138 1.553-0.55019 1.254-0.75064 3.2421-1.3784 4.4472-0.39648 3e-4 -0.79576 0.0045-1.1877 0.0703-0.67978 0.1073-1.3339 0.4195-1.798 0.9347-0.39707 0.4315-0.6427 0.9874-0.74275 1.5623-0.063545 0.351-0.07691 0.7094-0.07883 1.0654 0.001935 0.4718-0.01324 0.9457 0.027745 1.4163 0.09435 1.151 0.65732 2.1308 1.7281 2.6237 0.43467 0.1975 0.91053 0.2877 1.3854 0.3129 0.40096 0.0215 0.80345 0.0129 1.2048 0.0139 0.6491 2e-4 1.2891-0.0515 1.888-0.3229 0.90042-0.4067 1.4845-1.2039 1.6712-2.1666 0.0761-0.3779 0.09179-0.7654 0.09344-1.15 7.7e-4 -0.2699 0.00148-0.5413-7.8e-4 -0.8111-0.00379-0.4854-0.04143-0.9771-0.19121-1.4414-0.28748-0.9172-0.98053-1.616-1.8964-1.909 0.43984-1.1576 0.66815-2.7594 1.1268-3.8895 0.3537 0.72804 0.57113 1.7669 0.82283 2.7298 0.26567 1.0724 0.5404 2.1814 0.90896 3.0557 0.87204 2.2985 3.1124 2.7586 4.0452 0.392 0.5508-1.2642 0.7508-3.279 1.3828-4.4916 2.1142-0.10339 3.8024-1.8557 3.8024-3.995zm-12.073 8.8023c0.05605 0.2275 0.06623 0.465 0.07092 0.6983 0.00363 0.2444 0.00195 0.4906 0.00214 0.735-0.0063 0.408 0.01486 0.882-0.18359 1.2496-0.24573 0.4539-0.8026 0.501-1.2651 0.5114-0.33714 0.0058-0.67525 0.0041-1.0124 0.0018-0.46455-0.0092-1.0361-0.0245-1.3192-0.4545-0.16612-0.2552-0.19733-0.5702-0.21202-0.8673-0.01004-0.2443-0.00683-0.4906-0.0075-0.735 5.9e-4 -0.2322-0.00201-0.4664 0.01171-0.6983 0.01886-0.2936 0.06332-0.6069 0.24969-0.8453 0.34185-0.4331 1.0226-0.3889 1.5228-0.3979 0.38828 0.0035 0.77905-0.0131 1.1658 0.0285 0.49865 0.0566 0.85211 0.2621 0.97684 0.7737zm8.0732-6.8023c-2.6379-0.06696-2.6373-3.9334 0-4 2.6378 0.06697 2.6373 3.9334 0 4z" fill="currentColor"></path></svg>
            <p name="id">子依赖项</p>
          </span>
        </div>
      
<p>指的是在一个依赖项中，<strong>再使用其他依赖项作为其参数或组件</strong>。FastAPI 会自动解析这些嵌套依赖关系，构建出依赖图，从最底层依赖项开始依次解析。这使得开发者可以将复杂逻辑拆分为多个功能明确、可组合的模块，并形成依赖链进行自动注入。</p>
<p><strong>重要特征：</strong></p>
<ul>
<li><strong>特征1：嵌套结构</strong><br>
子依赖项体现为一个依赖项依赖另一个依赖项，支持构建复杂的依赖图。</li>
<li><strong>特征2：自动解析传递链</strong><br>
FastAPI 会从下至上递归地解析依赖，开发者无需手动传递。</li>
<li><strong>特征3：模块化解耦</strong><br>
子依赖允许将不同功能分离为独立函数，提高可维护性和可复用性。</li>
<li><strong>特征4：支持缓存与复用</strong><br>
FastAPI 默认缓存同一请求中相同的依赖项实例，避免重复执行。</li>
</ul>

        <div class="evoldown" id="数据库访问权限依赖链(正例)" type="e">
          <span class="icon">
            <svg type="e" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path fill="currentColor" d="m21.9 15.621c0.1248-1.8535-0.6087-3.4099-2.6058-3.8292-0.7712-0.15744-1.3921-0.13977-2.1113-0.14543-0.6323 0.0048-1.1718-0.01567-1.8401 0.03203 1.5356-0.8078 1.6998-2.205 1.6567-3.546 0.1272-2.3708-1.4685-3.666-3.7727-3.673-2.2427-0.04024-5.0463-0.27229-5.9443 1.9172-0.28083 0.6692-0.27606 1.2179-0.28202 1.6587-0.08527 1.4303 0.20687 2.9224 1.662 3.6429-2.3051-0.05275-5.3273-0.39212-6.28 1.8983-0.28073 0.66862-0.27595 1.2174-0.282 1.6572-0.10329 1.6061 0.3059 3.171 2.0252 3.8067 1.2061 0.4187 2.2175 0.2869 3.3945 0.3134 2.0524 0.0901 4.0448-0.4637 4.4796-2.4982 0.609 2.5638 3.2086 2.5463 5.3204 2.4982 2.7823 0.1278 4.7024-0.9368 4.5798-3.7329zm-12.899-7.6287c-0.14889-1.8665 1.8839-1.4921 3.1358-1.546 0.8939 0.05358 2.4743-0.21158 2.8003 0.88445 0.2729 2.4494-0.0297 2.8555-2.5242 2.8232-0.94713-0.07259-2.869 0.28949-3.3134-0.77077-0.14881-0.44557-0.08538-0.92893-0.09846-1.3909zm0.2606 9.2128c-0.56638 0.162-1.1652 0.1412-1.7487 0.1488-0.59786-0.0036-1.1977 0.0131-1.7948-0.0233-0.93407-0.0365-1.6776-0.3579-1.6157-1.4217 0.01574-0.5119-0.06845-1.0551 0.11822-1.5436 0.4432-0.84155 1.5978-0.6728 2.4032-0.7191 0.81712 0.01614 1.6464-0.05154 2.4536 0.10154 0.99382 0.17537 1.0564 0.91742 1.0227 1.7752-6.1e-4 0.7729 0.04085 1.416-0.83867 1.6821zm2.9212-3.6286c-0.0836 0.19457-0.14194 0.3848-0.18279 0.56614-0.18535-0.87758-0.76293-1.6189-1.5605-2.02 1.0871 0.04933 2.0387 0.04959 3.1216-8e-5 -0.7672 0.39034-1.1687 0.96486-1.3783 1.4539zm6.8788 3.6286c-0.5664 0.162-1.1652 0.1412-1.7488 0.1488-0.5978-0.0036-1.1977 0.0131-1.7947-0.0233-0.9341-0.0365-1.6776-0.3579-1.6157-1.4217 0.0157-0.5119-0.0685-1.0551 0.1182-1.5436 0.4432-0.84155 1.5978-0.6728 2.4033-0.7191 0.8171 0.01614 1.6464-0.05154 2.4536 0.10154 0.9938 0.17537 1.0563 0.91742 1.0227 1.7752-6e-4 0.7729 0.0409 1.416-0.8386 1.6821z"></path></svg>
            <p name="id">数据库访问权限依赖链(正例)</p>
          </span>
          <span class="link-icon ml-[0.5em] mr-[0.25em]">
            <svg xmlns="http://www.w3.org/2000/svg" width="0.9411764705882353em" height="0.9411764705882353em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class="untouchable"><path d="m9.5652 14.45 0.72891-2.0026c-0.651 0.00713-1.3027 0.00104-1.9532 0.00179-1.0991-0.02908-3.0336 0.08306-3.605-1.0524-0.28828-0.61588-0.2054-1.3226-0.22136-1.9833 0.00663-0.74044-0.05553-1.6362 0.5758-2.1558 0.70637-0.5555 1.7411-0.56129 2.6027-0.59834 0.743-0.015 1.4884-0.00764 2.2315-0.00868 0.68471 0.01536 1.6274-0.01783 2.4184 0.16762l0.68711-1.8879c-0.0146-0.003965-0.0287-0.00841-0.0435-0.01227-0.94653-0.24905-1.9355-0.25901-2.9083-0.26688-0.78352-1.3008e-4 -1.5692-0.0063751-2.3527 0.006805-1.2709 0.027555-2.6299 0.13739-3.6978 0.89566-1.6654 1.2031-1.53 2.9573-1.5068 4.79-0.0012251 1.7732 0.89765 3.2159 2.626 3.7562 0.80589 0.26191 1.6615 0.32018 2.5036 0.34101 0.6376 0.01106 1.2763 0.01096 1.9146 0.00915z" fill="currentColor"></path><path d="m14.589 9.125h1.3099c0.02865-0.88714-0.11774-1.6826-0.45594-2.3461l-0.85392 2.3461z" fill="currentColor"></path><path d="m15.587 12.025h-2.0527l-0.80604 2.2146c1.2326-0.27362 2.3169-0.88582 2.8588-2.2146z" fill="currentColor"></path><path d="m8.394 12.025h2.0538l0.82406-2.2641c-1.2457 0.2734-2.3327 0.8901-2.8779 2.2641z" fill="currentColor"></path><path d="m8.5566 17.221 0.83571-2.2961h-1.2914c-0.025394 0.86685 0.12295 1.645 0.45565 2.2961z" fill="currentColor"></path><path d="m21.485 14.399c7e-4 -0.67593 0.0063-1.3662-0.1779-2.0223-0.58881-2.115-2.5706-2.7532-4.5608-2.8041-0.76964-0.031175-1.5416-0.02264-2.3121-0.022365l-0.72832 2.0011c0.38557-0.00297 0.77131 7.6e-4 1.1559-0.00173 1.1244 0.02284 2.8396-0.10221 3.8152 0.44616 0.82512 0.45526 0.81194 1.4036 0.80798 2.2308-0.01538 0.64171 0.05949 1.3145-0.1601 1.93-0.39418 1.0145-1.651 1.1102-2.5915 1.1694-0.7426 0.03331-1.4884 0.0209-2.2315 0.02365-0.81334-0.01641-1.9395 0.04306-2.8448-0.16914l-0.68792 1.89c0.014845 0.00401 0.02915 0.0085 0.044115 0.0124 0.94522 0.24688 1.9316 0.25913 2.9027 0.2657 0.83456-2.2e-4 1.6713 0.00786 2.5057-0.00999 2.0286-0.02122 4.1491-0.51576 4.8438-2.6752 0.2358-0.7292 0.22-1.5067 0.2196-2.2644z" fill="currentColor"></path><path d="m14.979 6.7378c0.17824-0.52033 0.90905-2.4486 1.0626-2.9514 0.05601-0.19527 0.10768-0.39984 0.08232-0.60408-0.03096-0.33264-0.36035-0.4603-0.63671-0.55464-0.20794-0.070665-0.41593-0.17228-0.63943-0.174-0.33751 0.005805-0.52152 0.33878-0.64452 0.61072-1.4256 3.8005-4.7612 13.07-6.1617 16.891-0.10636 0.34-0.29285 0.7891-0.06874 1.1109 0.1296 0.1673 0.34386 0.232 0.53431 0.3042 0.30778 0.1107 0.70325 0.3075 0.98251 0.0365 0.14514-0.1339 0.23561-0.315 0.31595-0.4926 0.10005-0.2274 0.1811-0.4632 0.26694-0.6962 0.4854-1.3337 4.3257-11.885 4.9065-13.481z" fill="currentColor"></path></svg>
          </span>
          
          <span class="icon">
            <svg type="d" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m21.15 6.85c0-2.2056-1.7944-4-4-4-4.1765-0.01989-5.4993 5.7322-1.8147 7.5629-0.263 0.63631-0.4627 1.4421-0.6559 2.2215-0.1397 0.56337-0.2841 1.1459-0.4405 1.6084-0.0728 0.2155-0.1286 0.4813-0.1891 0.4813-0.5072-0.7362-0.8126-2.2507-1.0979-3.3161-0.47879-1.5358-0.72936-4.4237-2.8018-4.558-0.77422 7e-5 -1.3844 0.52253-1.8138 1.553-0.55019 1.254-0.75064 3.2421-1.3784 4.4472-0.39648 3e-4 -0.79576 0.0045-1.1877 0.0703-0.67978 0.1073-1.3339 0.4195-1.798 0.9347-0.39707 0.4315-0.6427 0.9874-0.74275 1.5623-0.063545 0.351-0.07691 0.7094-0.07883 1.0654 0.001935 0.4718-0.01324 0.9457 0.027745 1.4163 0.09435 1.151 0.65732 2.1308 1.7281 2.6237 0.43467 0.1975 0.91053 0.2877 1.3854 0.3129 0.40096 0.0215 0.80345 0.0129 1.2048 0.0139 0.6491 2e-4 1.2891-0.0515 1.888-0.3229 0.90042-0.4067 1.4845-1.2039 1.6712-2.1666 0.0761-0.3779 0.09179-0.7654 0.09344-1.15 7.7e-4 -0.2699 0.00148-0.5413-7.8e-4 -0.8111-0.00379-0.4854-0.04143-0.9771-0.19121-1.4414-0.28748-0.9172-0.98053-1.616-1.8964-1.909 0.43984-1.1576 0.66815-2.7594 1.1268-3.8895 0.3537 0.72804 0.57113 1.7669 0.82283 2.7298 0.26567 1.0724 0.5404 2.1814 0.90896 3.0557 0.87204 2.2985 3.1124 2.7586 4.0452 0.392 0.5508-1.2642 0.7508-3.279 1.3828-4.4916 2.1142-0.10339 3.8024-1.8557 3.8024-3.995zm-12.073 8.8023c0.05605 0.2275 0.06623 0.465 0.07092 0.6983 0.00363 0.2444 0.00195 0.4906 0.00214 0.735-0.0063 0.408 0.01486 0.882-0.18359 1.2496-0.24573 0.4539-0.8026 0.501-1.2651 0.5114-0.33714 0.0058-0.67525 0.0041-1.0124 0.0018-0.46455-0.0092-1.0361-0.0245-1.3192-0.4545-0.16612-0.2552-0.19733-0.5702-0.21202-0.8673-0.01004-0.2443-0.00683-0.4906-0.0075-0.735 5.9e-4 -0.2322-0.00201-0.4664 0.01171-0.6983 0.01886-0.2936 0.06332-0.6069 0.24969-0.8453 0.34185-0.4331 1.0226-0.3889 1.5228-0.3979 0.38828 0.0035 0.77905-0.0131 1.1658 0.0285 0.49865 0.0566 0.85211 0.2621 0.97684 0.7737zm8.0732-6.8023c-2.6379-0.06696-2.6373-3.9334 0-4 2.6378 0.06697 2.6373 3.9334 0 4z" fill="currentColor"></path></svg>
            <p name="id">子依赖项</p>
          </span>
        </div>
      
<p><strong>例子描述：</strong><br>
在企业管理系统中，API 先使用子依赖项 <code>get_current_user</code> 从 token 中提取用户，再由 <code>get_db_session(user)</code> 验证该用户是否有访问数据库权限。<code>get_db_session</code> 是子依赖，依赖 <code>get_current_user</code>。</p>
<p><strong>特征对比：</strong></p>
<ul>
<li>✅ 存在明确<strong>嵌套结构</strong>：数据库访问依赖用户身份。</li>
<li>✅ 使用 FastAPI 的<strong>自动解析链机制</strong>构建依赖图。</li>
<li>✅ 每个函数<strong>模块化解耦</strong>，职责单一。</li>
<li>✅ 多接口可<strong>复用同一子依赖项链</strong>。</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> fastapi <span class="token keyword">import</span> FastAPI<span class="token punctuation">,</span> Depends<span class="token punctuation">,</span> Header<span class="token punctuation">,</span> HTTPException

app <span class="token operator">=</span> FastAPI<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">get_current_user</span><span class="token punctuation">(</span>token<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> Header<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> token <span class="token operator">!=</span> <span class="token string">"valid-token"</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> HTTPException<span class="token punctuation">(</span>status_code<span class="token operator">=</span><span class="token number">401</span><span class="token punctuation">,</span> detail<span class="token operator">=</span><span class="token string">"Unauthorized"</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token string">"username"</span><span class="token punctuation">:</span> <span class="token string">"admin"</span><span class="token punctuation">,</span> <span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"manager"</span><span class="token punctuation">}</span>

<span class="token keyword">def</span> <span class="token function">get_db_session</span><span class="token punctuation">(</span>user<span class="token punctuation">:</span> <span class="token builtin">dict</span> <span class="token operator">=</span> Depends<span class="token punctuation">(</span>get_current_user<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> user<span class="token punctuation">[</span><span class="token string">"role"</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">"manager"</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> HTTPException<span class="token punctuation">(</span>status_code<span class="token operator">=</span><span class="token number">403</span><span class="token punctuation">,</span> detail<span class="token operator">=</span><span class="token string">"Forbidden"</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token string">"fake_db_session"</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>get</span><span class="token punctuation">(</span><span class="token string">"/data/"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">read_data</span><span class="token punctuation">(</span>db <span class="token operator">=</span> Depends<span class="token punctuation">(</span>get_db_session<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token string">"db_session"</span><span class="token punctuation">:</span> db<span class="token punctuation">,</span> <span class="token string">"data"</span><span class="token punctuation">:</span> <span class="token string">"Important data"</span><span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="mermaid">graph TD
    A[read_data] --&gt; B[get_current_user]
    B --&gt; C[get_db_session]
    C --&gt; D[/data/]</pre>

        <div class="evoldown" id="参数验证与权限检查分离(正例)" type="e">
          <span class="icon">
            <svg type="e" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path fill="currentColor" d="m21.9 15.621c0.1248-1.8535-0.6087-3.4099-2.6058-3.8292-0.7712-0.15744-1.3921-0.13977-2.1113-0.14543-0.6323 0.0048-1.1718-0.01567-1.8401 0.03203 1.5356-0.8078 1.6998-2.205 1.6567-3.546 0.1272-2.3708-1.4685-3.666-3.7727-3.673-2.2427-0.04024-5.0463-0.27229-5.9443 1.9172-0.28083 0.6692-0.27606 1.2179-0.28202 1.6587-0.08527 1.4303 0.20687 2.9224 1.662 3.6429-2.3051-0.05275-5.3273-0.39212-6.28 1.8983-0.28073 0.66862-0.27595 1.2174-0.282 1.6572-0.10329 1.6061 0.3059 3.171 2.0252 3.8067 1.2061 0.4187 2.2175 0.2869 3.3945 0.3134 2.0524 0.0901 4.0448-0.4637 4.4796-2.4982 0.609 2.5638 3.2086 2.5463 5.3204 2.4982 2.7823 0.1278 4.7024-0.9368 4.5798-3.7329zm-12.899-7.6287c-0.14889-1.8665 1.8839-1.4921 3.1358-1.546 0.8939 0.05358 2.4743-0.21158 2.8003 0.88445 0.2729 2.4494-0.0297 2.8555-2.5242 2.8232-0.94713-0.07259-2.869 0.28949-3.3134-0.77077-0.14881-0.44557-0.08538-0.92893-0.09846-1.3909zm0.2606 9.2128c-0.56638 0.162-1.1652 0.1412-1.7487 0.1488-0.59786-0.0036-1.1977 0.0131-1.7948-0.0233-0.93407-0.0365-1.6776-0.3579-1.6157-1.4217 0.01574-0.5119-0.06845-1.0551 0.11822-1.5436 0.4432-0.84155 1.5978-0.6728 2.4032-0.7191 0.81712 0.01614 1.6464-0.05154 2.4536 0.10154 0.99382 0.17537 1.0564 0.91742 1.0227 1.7752-6.1e-4 0.7729 0.04085 1.416-0.83867 1.6821zm2.9212-3.6286c-0.0836 0.19457-0.14194 0.3848-0.18279 0.56614-0.18535-0.87758-0.76293-1.6189-1.5605-2.02 1.0871 0.04933 2.0387 0.04959 3.1216-8e-5 -0.7672 0.39034-1.1687 0.96486-1.3783 1.4539zm6.8788 3.6286c-0.5664 0.162-1.1652 0.1412-1.7488 0.1488-0.5978-0.0036-1.1977 0.0131-1.7947-0.0233-0.9341-0.0365-1.6776-0.3579-1.6157-1.4217 0.0157-0.5119-0.0685-1.0551 0.1182-1.5436 0.4432-0.84155 1.5978-0.6728 2.4033-0.7191 0.8171 0.01614 1.6464-0.05154 2.4536 0.10154 0.9938 0.17537 1.0563 0.91742 1.0227 1.7752-6e-4 0.7729 0.0409 1.416-0.8386 1.6821z"></path></svg>
            <p name="id">参数验证与权限检查分离(正例)</p>
          </span>
          <span class="link-icon ml-[0.5em] mr-[0.25em]">
            <svg xmlns="http://www.w3.org/2000/svg" width="0.9411764705882353em" height="0.9411764705882353em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class="untouchable"><path d="m9.5652 14.45 0.72891-2.0026c-0.651 0.00713-1.3027 0.00104-1.9532 0.00179-1.0991-0.02908-3.0336 0.08306-3.605-1.0524-0.28828-0.61588-0.2054-1.3226-0.22136-1.9833 0.00663-0.74044-0.05553-1.6362 0.5758-2.1558 0.70637-0.5555 1.7411-0.56129 2.6027-0.59834 0.743-0.015 1.4884-0.00764 2.2315-0.00868 0.68471 0.01536 1.6274-0.01783 2.4184 0.16762l0.68711-1.8879c-0.0146-0.003965-0.0287-0.00841-0.0435-0.01227-0.94653-0.24905-1.9355-0.25901-2.9083-0.26688-0.78352-1.3008e-4 -1.5692-0.0063751-2.3527 0.006805-1.2709 0.027555-2.6299 0.13739-3.6978 0.89566-1.6654 1.2031-1.53 2.9573-1.5068 4.79-0.0012251 1.7732 0.89765 3.2159 2.626 3.7562 0.80589 0.26191 1.6615 0.32018 2.5036 0.34101 0.6376 0.01106 1.2763 0.01096 1.9146 0.00915z" fill="currentColor"></path><path d="m14.589 9.125h1.3099c0.02865-0.88714-0.11774-1.6826-0.45594-2.3461l-0.85392 2.3461z" fill="currentColor"></path><path d="m15.587 12.025h-2.0527l-0.80604 2.2146c1.2326-0.27362 2.3169-0.88582 2.8588-2.2146z" fill="currentColor"></path><path d="m8.394 12.025h2.0538l0.82406-2.2641c-1.2457 0.2734-2.3327 0.8901-2.8779 2.2641z" fill="currentColor"></path><path d="m8.5566 17.221 0.83571-2.2961h-1.2914c-0.025394 0.86685 0.12295 1.645 0.45565 2.2961z" fill="currentColor"></path><path d="m21.485 14.399c7e-4 -0.67593 0.0063-1.3662-0.1779-2.0223-0.58881-2.115-2.5706-2.7532-4.5608-2.8041-0.76964-0.031175-1.5416-0.02264-2.3121-0.022365l-0.72832 2.0011c0.38557-0.00297 0.77131 7.6e-4 1.1559-0.00173 1.1244 0.02284 2.8396-0.10221 3.8152 0.44616 0.82512 0.45526 0.81194 1.4036 0.80798 2.2308-0.01538 0.64171 0.05949 1.3145-0.1601 1.93-0.39418 1.0145-1.651 1.1102-2.5915 1.1694-0.7426 0.03331-1.4884 0.0209-2.2315 0.02365-0.81334-0.01641-1.9395 0.04306-2.8448-0.16914l-0.68792 1.89c0.014845 0.00401 0.02915 0.0085 0.044115 0.0124 0.94522 0.24688 1.9316 0.25913 2.9027 0.2657 0.83456-2.2e-4 1.6713 0.00786 2.5057-0.00999 2.0286-0.02122 4.1491-0.51576 4.8438-2.6752 0.2358-0.7292 0.22-1.5067 0.2196-2.2644z" fill="currentColor"></path><path d="m14.979 6.7378c0.17824-0.52033 0.90905-2.4486 1.0626-2.9514 0.05601-0.19527 0.10768-0.39984 0.08232-0.60408-0.03096-0.33264-0.36035-0.4603-0.63671-0.55464-0.20794-0.070665-0.41593-0.17228-0.63943-0.174-0.33751 0.005805-0.52152 0.33878-0.64452 0.61072-1.4256 3.8005-4.7612 13.07-6.1617 16.891-0.10636 0.34-0.29285 0.7891-0.06874 1.1109 0.1296 0.1673 0.34386 0.232 0.53431 0.3042 0.30778 0.1107 0.70325 0.3075 0.98251 0.0365 0.14514-0.1339 0.23561-0.315 0.31595-0.4926 0.10005-0.2274 0.1811-0.4632 0.26694-0.6962 0.4854-1.3337 4.3257-11.885 4.9065-13.481z" fill="currentColor"></path></svg>
          </span>
          
          <span class="icon">
            <svg type="d" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m21.15 6.85c0-2.2056-1.7944-4-4-4-4.1765-0.01989-5.4993 5.7322-1.8147 7.5629-0.263 0.63631-0.4627 1.4421-0.6559 2.2215-0.1397 0.56337-0.2841 1.1459-0.4405 1.6084-0.0728 0.2155-0.1286 0.4813-0.1891 0.4813-0.5072-0.7362-0.8126-2.2507-1.0979-3.3161-0.47879-1.5358-0.72936-4.4237-2.8018-4.558-0.77422 7e-5 -1.3844 0.52253-1.8138 1.553-0.55019 1.254-0.75064 3.2421-1.3784 4.4472-0.39648 3e-4 -0.79576 0.0045-1.1877 0.0703-0.67978 0.1073-1.3339 0.4195-1.798 0.9347-0.39707 0.4315-0.6427 0.9874-0.74275 1.5623-0.063545 0.351-0.07691 0.7094-0.07883 1.0654 0.001935 0.4718-0.01324 0.9457 0.027745 1.4163 0.09435 1.151 0.65732 2.1308 1.7281 2.6237 0.43467 0.1975 0.91053 0.2877 1.3854 0.3129 0.40096 0.0215 0.80345 0.0129 1.2048 0.0139 0.6491 2e-4 1.2891-0.0515 1.888-0.3229 0.90042-0.4067 1.4845-1.2039 1.6712-2.1666 0.0761-0.3779 0.09179-0.7654 0.09344-1.15 7.7e-4 -0.2699 0.00148-0.5413-7.8e-4 -0.8111-0.00379-0.4854-0.04143-0.9771-0.19121-1.4414-0.28748-0.9172-0.98053-1.616-1.8964-1.909 0.43984-1.1576 0.66815-2.7594 1.1268-3.8895 0.3537 0.72804 0.57113 1.7669 0.82283 2.7298 0.26567 1.0724 0.5404 2.1814 0.90896 3.0557 0.87204 2.2985 3.1124 2.7586 4.0452 0.392 0.5508-1.2642 0.7508-3.279 1.3828-4.4916 2.1142-0.10339 3.8024-1.8557 3.8024-3.995zm-12.073 8.8023c0.05605 0.2275 0.06623 0.465 0.07092 0.6983 0.00363 0.2444 0.00195 0.4906 0.00214 0.735-0.0063 0.408 0.01486 0.882-0.18359 1.2496-0.24573 0.4539-0.8026 0.501-1.2651 0.5114-0.33714 0.0058-0.67525 0.0041-1.0124 0.0018-0.46455-0.0092-1.0361-0.0245-1.3192-0.4545-0.16612-0.2552-0.19733-0.5702-0.21202-0.8673-0.01004-0.2443-0.00683-0.4906-0.0075-0.735 5.9e-4 -0.2322-0.00201-0.4664 0.01171-0.6983 0.01886-0.2936 0.06332-0.6069 0.24969-0.8453 0.34185-0.4331 1.0226-0.3889 1.5228-0.3979 0.38828 0.0035 0.77905-0.0131 1.1658 0.0285 0.49865 0.0566 0.85211 0.2621 0.97684 0.7737zm8.0732-6.8023c-2.6379-0.06696-2.6373-3.9334 0-4 2.6378 0.06697 2.6373 3.9334 0 4z" fill="currentColor"></path></svg>
            <p name="id">子依赖项</p>
          </span>
        </div>
      
<p><strong>例子描述：</strong><br>
在教育平台中，获取课程内容的接口通过 <code>get_course_id</code> 验证 query 参数是否合法，再通过子依赖 <code>check_user_permission(course_id)</code> 判断当前用户是否能访问该课程。</p>
<p><strong>特征对比：</strong></p>
<ul>
<li>✅ 明确的<strong>功能拆分</strong>：一个负责参数校验，一个负责权限验证。</li>
<li>✅ 利用了<strong>自动传参机制</strong>：无需手动将参数从一个依赖传到另一个。</li>
<li>✅ 各函数职责清晰，<strong>高内聚低耦合</strong>。</li>
<li>✅ 可以将 <code>check_user_permission</code> 复用于多个资源权限场景。</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> fastapi <span class="token keyword">import</span> FastAPI<span class="token punctuation">,</span> Depends<span class="token punctuation">,</span> Query<span class="token punctuation">,</span> HTTPException

app <span class="token operator">=</span> FastAPI<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">get_course_id</span><span class="token punctuation">(</span>course_id<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> Query<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> gt<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> course_id

<span class="token keyword">def</span> <span class="token function">check_user_permission</span><span class="token punctuation">(</span>course_id<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> Depends<span class="token punctuation">(</span>get_course_id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> course_id <span class="token keyword">not</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">202</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> HTTPException<span class="token punctuation">(</span>status_code<span class="token operator">=</span><span class="token number">403</span><span class="token punctuation">,</span> detail<span class="token operator">=</span><span class="token string">"Access denied to course"</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"course_</span><span class="token interpolation"><span class="token punctuation">{</span>course_id<span class="token punctuation">}</span></span><span class="token string">"</span></span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>get</span><span class="token punctuation">(</span><span class="token string">"/course/"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">get_course</span><span class="token punctuation">(</span>course <span class="token operator">=</span> Depends<span class="token punctuation">(</span>check_user_permission<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token string">"message"</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"Access granted to </span><span class="token interpolation"><span class="token punctuation">{</span>course<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="mermaid">graph TD
    A[get_course] --&gt; B[get_course_id]
    B --&gt; C[check_user_permission]
    C --&gt; D[/course/]</pre>

        <div class="evoldown" id="手动嵌套调用的依赖函数(反例)" type="e">
          <span class="icon">
            <svg type="e" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path fill="currentColor" d="m21.9 15.621c0.1248-1.8535-0.6087-3.4099-2.6058-3.8292-0.7712-0.15744-1.3921-0.13977-2.1113-0.14543-0.6323 0.0048-1.1718-0.01567-1.8401 0.03203 1.5356-0.8078 1.6998-2.205 1.6567-3.546 0.1272-2.3708-1.4685-3.666-3.7727-3.673-2.2427-0.04024-5.0463-0.27229-5.9443 1.9172-0.28083 0.6692-0.27606 1.2179-0.28202 1.6587-0.08527 1.4303 0.20687 2.9224 1.662 3.6429-2.3051-0.05275-5.3273-0.39212-6.28 1.8983-0.28073 0.66862-0.27595 1.2174-0.282 1.6572-0.10329 1.6061 0.3059 3.171 2.0252 3.8067 1.2061 0.4187 2.2175 0.2869 3.3945 0.3134 2.0524 0.0901 4.0448-0.4637 4.4796-2.4982 0.609 2.5638 3.2086 2.5463 5.3204 2.4982 2.7823 0.1278 4.7024-0.9368 4.5798-3.7329zm-12.899-7.6287c-0.14889-1.8665 1.8839-1.4921 3.1358-1.546 0.8939 0.05358 2.4743-0.21158 2.8003 0.88445 0.2729 2.4494-0.0297 2.8555-2.5242 2.8232-0.94713-0.07259-2.869 0.28949-3.3134-0.77077-0.14881-0.44557-0.08538-0.92893-0.09846-1.3909zm0.2606 9.2128c-0.56638 0.162-1.1652 0.1412-1.7487 0.1488-0.59786-0.0036-1.1977 0.0131-1.7948-0.0233-0.93407-0.0365-1.6776-0.3579-1.6157-1.4217 0.01574-0.5119-0.06845-1.0551 0.11822-1.5436 0.4432-0.84155 1.5978-0.6728 2.4032-0.7191 0.81712 0.01614 1.6464-0.05154 2.4536 0.10154 0.99382 0.17537 1.0564 0.91742 1.0227 1.7752-6.1e-4 0.7729 0.04085 1.416-0.83867 1.6821zm2.9212-3.6286c-0.0836 0.19457-0.14194 0.3848-0.18279 0.56614-0.18535-0.87758-0.76293-1.6189-1.5605-2.02 1.0871 0.04933 2.0387 0.04959 3.1216-8e-5 -0.7672 0.39034-1.1687 0.96486-1.3783 1.4539zm6.8788 3.6286c-0.5664 0.162-1.1652 0.1412-1.7488 0.1488-0.5978-0.0036-1.1977 0.0131-1.7947-0.0233-0.9341-0.0365-1.6776-0.3579-1.6157-1.4217 0.0157-0.5119-0.0685-1.0551 0.1182-1.5436 0.4432-0.84155 1.5978-0.6728 2.4033-0.7191 0.8171 0.01614 1.6464-0.05154 2.4536 0.10154 0.9938 0.17537 1.0563 0.91742 1.0227 1.7752-6e-4 0.7729 0.0409 1.416-0.8386 1.6821z"></path></svg>
            <p name="id">手动嵌套调用的依赖函数(反例)</p>
          </span>
          <span class="link-icon ml-[0.5em] mr-[0.25em]">
            <svg xmlns="http://www.w3.org/2000/svg" width="0.9411764705882353em" height="0.9411764705882353em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class="untouchable"><path d="m9.5652 14.45 0.72891-2.0026c-0.651 0.00713-1.3027 0.00104-1.9532 0.00179-1.0991-0.02908-3.0336 0.08306-3.605-1.0524-0.28828-0.61588-0.2054-1.3226-0.22136-1.9833 0.00663-0.74044-0.05553-1.6362 0.5758-2.1558 0.70637-0.5555 1.7411-0.56129 2.6027-0.59834 0.743-0.015 1.4884-0.00764 2.2315-0.00868 0.68471 0.01536 1.6274-0.01783 2.4184 0.16762l0.68711-1.8879c-0.0146-0.003965-0.0287-0.00841-0.0435-0.01227-0.94653-0.24905-1.9355-0.25901-2.9083-0.26688-0.78352-1.3008e-4 -1.5692-0.0063751-2.3527 0.006805-1.2709 0.027555-2.6299 0.13739-3.6978 0.89566-1.6654 1.2031-1.53 2.9573-1.5068 4.79-0.0012251 1.7732 0.89765 3.2159 2.626 3.7562 0.80589 0.26191 1.6615 0.32018 2.5036 0.34101 0.6376 0.01106 1.2763 0.01096 1.9146 0.00915z" fill="currentColor"></path><path d="m14.589 9.125h1.3099c0.02865-0.88714-0.11774-1.6826-0.45594-2.3461l-0.85392 2.3461z" fill="currentColor"></path><path d="m15.587 12.025h-2.0527l-0.80604 2.2146c1.2326-0.27362 2.3169-0.88582 2.8588-2.2146z" fill="currentColor"></path><path d="m8.394 12.025h2.0538l0.82406-2.2641c-1.2457 0.2734-2.3327 0.8901-2.8779 2.2641z" fill="currentColor"></path><path d="m8.5566 17.221 0.83571-2.2961h-1.2914c-0.025394 0.86685 0.12295 1.645 0.45565 2.2961z" fill="currentColor"></path><path d="m21.485 14.399c7e-4 -0.67593 0.0063-1.3662-0.1779-2.0223-0.58881-2.115-2.5706-2.7532-4.5608-2.8041-0.76964-0.031175-1.5416-0.02264-2.3121-0.022365l-0.72832 2.0011c0.38557-0.00297 0.77131 7.6e-4 1.1559-0.00173 1.1244 0.02284 2.8396-0.10221 3.8152 0.44616 0.82512 0.45526 0.81194 1.4036 0.80798 2.2308-0.01538 0.64171 0.05949 1.3145-0.1601 1.93-0.39418 1.0145-1.651 1.1102-2.5915 1.1694-0.7426 0.03331-1.4884 0.0209-2.2315 0.02365-0.81334-0.01641-1.9395 0.04306-2.8448-0.16914l-0.68792 1.89c0.014845 0.00401 0.02915 0.0085 0.044115 0.0124 0.94522 0.24688 1.9316 0.25913 2.9027 0.2657 0.83456-2.2e-4 1.6713 0.00786 2.5057-0.00999 2.0286-0.02122 4.1491-0.51576 4.8438-2.6752 0.2358-0.7292 0.22-1.5067 0.2196-2.2644z" fill="currentColor"></path><path d="m14.979 6.7378c0.17824-0.52033 0.90905-2.4486 1.0626-2.9514 0.05601-0.19527 0.10768-0.39984 0.08232-0.60408-0.03096-0.33264-0.36035-0.4603-0.63671-0.55464-0.20794-0.070665-0.41593-0.17228-0.63943-0.174-0.33751 0.005805-0.52152 0.33878-0.64452 0.61072-1.4256 3.8005-4.7612 13.07-6.1617 16.891-0.10636 0.34-0.29285 0.7891-0.06874 1.1109 0.1296 0.1673 0.34386 0.232 0.53431 0.3042 0.30778 0.1107 0.70325 0.3075 0.98251 0.0365 0.14514-0.1339 0.23561-0.315 0.31595-0.4926 0.10005-0.2274 0.1811-0.4632 0.26694-0.6962 0.4854-1.3337 4.3257-11.885 4.9065-13.481z" fill="currentColor"></path></svg>
          </span>
          
          <span class="icon">
            <svg type="d" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m21.15 6.85c0-2.2056-1.7944-4-4-4-4.1765-0.01989-5.4993 5.7322-1.8147 7.5629-0.263 0.63631-0.4627 1.4421-0.6559 2.2215-0.1397 0.56337-0.2841 1.1459-0.4405 1.6084-0.0728 0.2155-0.1286 0.4813-0.1891 0.4813-0.5072-0.7362-0.8126-2.2507-1.0979-3.3161-0.47879-1.5358-0.72936-4.4237-2.8018-4.558-0.77422 7e-5 -1.3844 0.52253-1.8138 1.553-0.55019 1.254-0.75064 3.2421-1.3784 4.4472-0.39648 3e-4 -0.79576 0.0045-1.1877 0.0703-0.67978 0.1073-1.3339 0.4195-1.798 0.9347-0.39707 0.4315-0.6427 0.9874-0.74275 1.5623-0.063545 0.351-0.07691 0.7094-0.07883 1.0654 0.001935 0.4718-0.01324 0.9457 0.027745 1.4163 0.09435 1.151 0.65732 2.1308 1.7281 2.6237 0.43467 0.1975 0.91053 0.2877 1.3854 0.3129 0.40096 0.0215 0.80345 0.0129 1.2048 0.0139 0.6491 2e-4 1.2891-0.0515 1.888-0.3229 0.90042-0.4067 1.4845-1.2039 1.6712-2.1666 0.0761-0.3779 0.09179-0.7654 0.09344-1.15 7.7e-4 -0.2699 0.00148-0.5413-7.8e-4 -0.8111-0.00379-0.4854-0.04143-0.9771-0.19121-1.4414-0.28748-0.9172-0.98053-1.616-1.8964-1.909 0.43984-1.1576 0.66815-2.7594 1.1268-3.8895 0.3537 0.72804 0.57113 1.7669 0.82283 2.7298 0.26567 1.0724 0.5404 2.1814 0.90896 3.0557 0.87204 2.2985 3.1124 2.7586 4.0452 0.392 0.5508-1.2642 0.7508-3.279 1.3828-4.4916 2.1142-0.10339 3.8024-1.8557 3.8024-3.995zm-12.073 8.8023c0.05605 0.2275 0.06623 0.465 0.07092 0.6983 0.00363 0.2444 0.00195 0.4906 0.00214 0.735-0.0063 0.408 0.01486 0.882-0.18359 1.2496-0.24573 0.4539-0.8026 0.501-1.2651 0.5114-0.33714 0.0058-0.67525 0.0041-1.0124 0.0018-0.46455-0.0092-1.0361-0.0245-1.3192-0.4545-0.16612-0.2552-0.19733-0.5702-0.21202-0.8673-0.01004-0.2443-0.00683-0.4906-0.0075-0.735 5.9e-4 -0.2322-0.00201-0.4664 0.01171-0.6983 0.01886-0.2936 0.06332-0.6069 0.24969-0.8453 0.34185-0.4331 1.0226-0.3889 1.5228-0.3979 0.38828 0.0035 0.77905-0.0131 1.1658 0.0285 0.49865 0.0566 0.85211 0.2621 0.97684 0.7737zm8.0732-6.8023c-2.6379-0.06696-2.6373-3.9334 0-4 2.6378 0.06697 2.6373 3.9334 0 4z" fill="currentColor"></path></svg>
            <p name="id">子依赖项</p>
          </span>
        </div>
      
<p><strong>例子描述：</strong><br>
开发者在接口函数中先手动调用 <code>parse_token</code> 获取用户，再显式调用 <code>check_auth(user)</code>，而不是通过 FastAPI 的依赖系统注册嵌套。这种方式绕过了依赖图机制，失去自动注入优势。</p>
<p><strong>特征对比：</strong></p>
<ul>
<li>❌ 没有利用 FastAPI 的<strong>自动依赖解析</strong>。</li>
<li>❌ 不体现<strong>嵌套依赖结构</strong>，而是显式函数调用。</li>
<li>❌ 模块不可自动组合，失去<strong>解耦和缓存复用能力</strong>。</li>
</ul>
<h2 id="4路径装饰器依赖项"><a class="markdownIt-Anchor" href="#4路径装饰器依赖项"></a> 4.路径装饰器依赖项</h2>

        <div class="evoldown" id="路径装饰器依赖项" type="d">
          <span class="icon">
            <svg type="d" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m21.15 6.85c0-2.2056-1.7944-4-4-4-4.1765-0.01989-5.4993 5.7322-1.8147 7.5629-0.263 0.63631-0.4627 1.4421-0.6559 2.2215-0.1397 0.56337-0.2841 1.1459-0.4405 1.6084-0.0728 0.2155-0.1286 0.4813-0.1891 0.4813-0.5072-0.7362-0.8126-2.2507-1.0979-3.3161-0.47879-1.5358-0.72936-4.4237-2.8018-4.558-0.77422 7e-5 -1.3844 0.52253-1.8138 1.553-0.55019 1.254-0.75064 3.2421-1.3784 4.4472-0.39648 3e-4 -0.79576 0.0045-1.1877 0.0703-0.67978 0.1073-1.3339 0.4195-1.798 0.9347-0.39707 0.4315-0.6427 0.9874-0.74275 1.5623-0.063545 0.351-0.07691 0.7094-0.07883 1.0654 0.001935 0.4718-0.01324 0.9457 0.027745 1.4163 0.09435 1.151 0.65732 2.1308 1.7281 2.6237 0.43467 0.1975 0.91053 0.2877 1.3854 0.3129 0.40096 0.0215 0.80345 0.0129 1.2048 0.0139 0.6491 2e-4 1.2891-0.0515 1.888-0.3229 0.90042-0.4067 1.4845-1.2039 1.6712-2.1666 0.0761-0.3779 0.09179-0.7654 0.09344-1.15 7.7e-4 -0.2699 0.00148-0.5413-7.8e-4 -0.8111-0.00379-0.4854-0.04143-0.9771-0.19121-1.4414-0.28748-0.9172-0.98053-1.616-1.8964-1.909 0.43984-1.1576 0.66815-2.7594 1.1268-3.8895 0.3537 0.72804 0.57113 1.7669 0.82283 2.7298 0.26567 1.0724 0.5404 2.1814 0.90896 3.0557 0.87204 2.2985 3.1124 2.7586 4.0452 0.392 0.5508-1.2642 0.7508-3.279 1.3828-4.4916 2.1142-0.10339 3.8024-1.8557 3.8024-3.995zm-12.073 8.8023c0.05605 0.2275 0.06623 0.465 0.07092 0.6983 0.00363 0.2444 0.00195 0.4906 0.00214 0.735-0.0063 0.408 0.01486 0.882-0.18359 1.2496-0.24573 0.4539-0.8026 0.501-1.2651 0.5114-0.33714 0.0058-0.67525 0.0041-1.0124 0.0018-0.46455-0.0092-1.0361-0.0245-1.3192-0.4545-0.16612-0.2552-0.19733-0.5702-0.21202-0.8673-0.01004-0.2443-0.00683-0.4906-0.0075-0.735 5.9e-4 -0.2322-0.00201-0.4664 0.01171-0.6983 0.01886-0.2936 0.06332-0.6069 0.24969-0.8453 0.34185-0.4331 1.0226-0.3889 1.5228-0.3979 0.38828 0.0035 0.77905-0.0131 1.1658 0.0285 0.49865 0.0566 0.85211 0.2621 0.97684 0.7737zm8.0732-6.8023c-2.6379-0.06696-2.6373-3.9334 0-4 2.6378 0.06697 2.6373 3.9334 0 4z" fill="currentColor"></path></svg>
            <p name="id">路径装饰器依赖项</p>
          </span>
        </div>
      
<p>FastAPI 的路径装饰器（如 <code>@app.get()</code>、<code>@app.post()</code> 等）允许通过 <code>dependencies</code> 参数声明全局性或结构性依赖项，这些依赖项不是直接传递给路径操作函数的参数，而是作为执行前的前置逻辑执行。这类依赖项常用于权限校验、日志记录、速率限制等无返回值或非业务输入输出相关的控制性逻辑。就算这些依赖项会返回值，它们的值也不会传递给「路径操作函数」，因此，可以复用在其他位置使用过的、（能返回值的）普通依赖项，即使没有使用这个值，也会执行该依赖项。</p>
<p><strong>重要特征：</strong></p>
<ul>
<li><strong>特征1：不注入函数参数</strong><br>
依赖项只在装饰器中声明，不会作为路径操作函数的参数被传入。</li>
<li><strong>特征2：常用于副作用逻辑</strong><br>
如权限验证、资源控制、速率限制等功能，依赖的副作用（如抛异常）即可影响请求流程。</li>
<li><strong>特征3：适合路由级或全局控制</strong><br>
用于统一为某些路由加控制逻辑，避免每个接口重复依赖声明。</li>
<li><strong>特征4：执行顺序明确</strong><br>
依赖函数在路径函数执行前自动触发，且可以层层嵌套其他依赖。</li>
</ul>

        <div class="evoldown" id="统一身份认证检查(正例)" type="e">
          <span class="icon">
            <svg type="e" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path fill="currentColor" d="m21.9 15.621c0.1248-1.8535-0.6087-3.4099-2.6058-3.8292-0.7712-0.15744-1.3921-0.13977-2.1113-0.14543-0.6323 0.0048-1.1718-0.01567-1.8401 0.03203 1.5356-0.8078 1.6998-2.205 1.6567-3.546 0.1272-2.3708-1.4685-3.666-3.7727-3.673-2.2427-0.04024-5.0463-0.27229-5.9443 1.9172-0.28083 0.6692-0.27606 1.2179-0.28202 1.6587-0.08527 1.4303 0.20687 2.9224 1.662 3.6429-2.3051-0.05275-5.3273-0.39212-6.28 1.8983-0.28073 0.66862-0.27595 1.2174-0.282 1.6572-0.10329 1.6061 0.3059 3.171 2.0252 3.8067 1.2061 0.4187 2.2175 0.2869 3.3945 0.3134 2.0524 0.0901 4.0448-0.4637 4.4796-2.4982 0.609 2.5638 3.2086 2.5463 5.3204 2.4982 2.7823 0.1278 4.7024-0.9368 4.5798-3.7329zm-12.899-7.6287c-0.14889-1.8665 1.8839-1.4921 3.1358-1.546 0.8939 0.05358 2.4743-0.21158 2.8003 0.88445 0.2729 2.4494-0.0297 2.8555-2.5242 2.8232-0.94713-0.07259-2.869 0.28949-3.3134-0.77077-0.14881-0.44557-0.08538-0.92893-0.09846-1.3909zm0.2606 9.2128c-0.56638 0.162-1.1652 0.1412-1.7487 0.1488-0.59786-0.0036-1.1977 0.0131-1.7948-0.0233-0.93407-0.0365-1.6776-0.3579-1.6157-1.4217 0.01574-0.5119-0.06845-1.0551 0.11822-1.5436 0.4432-0.84155 1.5978-0.6728 2.4032-0.7191 0.81712 0.01614 1.6464-0.05154 2.4536 0.10154 0.99382 0.17537 1.0564 0.91742 1.0227 1.7752-6.1e-4 0.7729 0.04085 1.416-0.83867 1.6821zm2.9212-3.6286c-0.0836 0.19457-0.14194 0.3848-0.18279 0.56614-0.18535-0.87758-0.76293-1.6189-1.5605-2.02 1.0871 0.04933 2.0387 0.04959 3.1216-8e-5 -0.7672 0.39034-1.1687 0.96486-1.3783 1.4539zm6.8788 3.6286c-0.5664 0.162-1.1652 0.1412-1.7488 0.1488-0.5978-0.0036-1.1977 0.0131-1.7947-0.0233-0.9341-0.0365-1.6776-0.3579-1.6157-1.4217 0.0157-0.5119-0.0685-1.0551 0.1182-1.5436 0.4432-0.84155 1.5978-0.6728 2.4033-0.7191 0.8171 0.01614 1.6464-0.05154 2.4536 0.10154 0.9938 0.17537 1.0563 0.91742 1.0227 1.7752-6e-4 0.7729 0.0409 1.416-0.8386 1.6821z"></path></svg>
            <p name="id">统一身份认证检查(正例)</p>
          </span>
          <span class="link-icon ml-[0.5em] mr-[0.25em]">
            <svg xmlns="http://www.w3.org/2000/svg" width="0.9411764705882353em" height="0.9411764705882353em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class="untouchable"><path d="m9.5652 14.45 0.72891-2.0026c-0.651 0.00713-1.3027 0.00104-1.9532 0.00179-1.0991-0.02908-3.0336 0.08306-3.605-1.0524-0.28828-0.61588-0.2054-1.3226-0.22136-1.9833 0.00663-0.74044-0.05553-1.6362 0.5758-2.1558 0.70637-0.5555 1.7411-0.56129 2.6027-0.59834 0.743-0.015 1.4884-0.00764 2.2315-0.00868 0.68471 0.01536 1.6274-0.01783 2.4184 0.16762l0.68711-1.8879c-0.0146-0.003965-0.0287-0.00841-0.0435-0.01227-0.94653-0.24905-1.9355-0.25901-2.9083-0.26688-0.78352-1.3008e-4 -1.5692-0.0063751-2.3527 0.006805-1.2709 0.027555-2.6299 0.13739-3.6978 0.89566-1.6654 1.2031-1.53 2.9573-1.5068 4.79-0.0012251 1.7732 0.89765 3.2159 2.626 3.7562 0.80589 0.26191 1.6615 0.32018 2.5036 0.34101 0.6376 0.01106 1.2763 0.01096 1.9146 0.00915z" fill="currentColor"></path><path d="m14.589 9.125h1.3099c0.02865-0.88714-0.11774-1.6826-0.45594-2.3461l-0.85392 2.3461z" fill="currentColor"></path><path d="m15.587 12.025h-2.0527l-0.80604 2.2146c1.2326-0.27362 2.3169-0.88582 2.8588-2.2146z" fill="currentColor"></path><path d="m8.394 12.025h2.0538l0.82406-2.2641c-1.2457 0.2734-2.3327 0.8901-2.8779 2.2641z" fill="currentColor"></path><path d="m8.5566 17.221 0.83571-2.2961h-1.2914c-0.025394 0.86685 0.12295 1.645 0.45565 2.2961z" fill="currentColor"></path><path d="m21.485 14.399c7e-4 -0.67593 0.0063-1.3662-0.1779-2.0223-0.58881-2.115-2.5706-2.7532-4.5608-2.8041-0.76964-0.031175-1.5416-0.02264-2.3121-0.022365l-0.72832 2.0011c0.38557-0.00297 0.77131 7.6e-4 1.1559-0.00173 1.1244 0.02284 2.8396-0.10221 3.8152 0.44616 0.82512 0.45526 0.81194 1.4036 0.80798 2.2308-0.01538 0.64171 0.05949 1.3145-0.1601 1.93-0.39418 1.0145-1.651 1.1102-2.5915 1.1694-0.7426 0.03331-1.4884 0.0209-2.2315 0.02365-0.81334-0.01641-1.9395 0.04306-2.8448-0.16914l-0.68792 1.89c0.014845 0.00401 0.02915 0.0085 0.044115 0.0124 0.94522 0.24688 1.9316 0.25913 2.9027 0.2657 0.83456-2.2e-4 1.6713 0.00786 2.5057-0.00999 2.0286-0.02122 4.1491-0.51576 4.8438-2.6752 0.2358-0.7292 0.22-1.5067 0.2196-2.2644z" fill="currentColor"></path><path d="m14.979 6.7378c0.17824-0.52033 0.90905-2.4486 1.0626-2.9514 0.05601-0.19527 0.10768-0.39984 0.08232-0.60408-0.03096-0.33264-0.36035-0.4603-0.63671-0.55464-0.20794-0.070665-0.41593-0.17228-0.63943-0.174-0.33751 0.005805-0.52152 0.33878-0.64452 0.61072-1.4256 3.8005-4.7612 13.07-6.1617 16.891-0.10636 0.34-0.29285 0.7891-0.06874 1.1109 0.1296 0.1673 0.34386 0.232 0.53431 0.3042 0.30778 0.1107 0.70325 0.3075 0.98251 0.0365 0.14514-0.1339 0.23561-0.315 0.31595-0.4926 0.10005-0.2274 0.1811-0.4632 0.26694-0.6962 0.4854-1.3337 4.3257-11.885 4.9065-13.481z" fill="currentColor"></path></svg>
          </span>
          
          <span class="icon">
            <svg type="d" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m21.15 6.85c0-2.2056-1.7944-4-4-4-4.1765-0.01989-5.4993 5.7322-1.8147 7.5629-0.263 0.63631-0.4627 1.4421-0.6559 2.2215-0.1397 0.56337-0.2841 1.1459-0.4405 1.6084-0.0728 0.2155-0.1286 0.4813-0.1891 0.4813-0.5072-0.7362-0.8126-2.2507-1.0979-3.3161-0.47879-1.5358-0.72936-4.4237-2.8018-4.558-0.77422 7e-5 -1.3844 0.52253-1.8138 1.553-0.55019 1.254-0.75064 3.2421-1.3784 4.4472-0.39648 3e-4 -0.79576 0.0045-1.1877 0.0703-0.67978 0.1073-1.3339 0.4195-1.798 0.9347-0.39707 0.4315-0.6427 0.9874-0.74275 1.5623-0.063545 0.351-0.07691 0.7094-0.07883 1.0654 0.001935 0.4718-0.01324 0.9457 0.027745 1.4163 0.09435 1.151 0.65732 2.1308 1.7281 2.6237 0.43467 0.1975 0.91053 0.2877 1.3854 0.3129 0.40096 0.0215 0.80345 0.0129 1.2048 0.0139 0.6491 2e-4 1.2891-0.0515 1.888-0.3229 0.90042-0.4067 1.4845-1.2039 1.6712-2.1666 0.0761-0.3779 0.09179-0.7654 0.09344-1.15 7.7e-4 -0.2699 0.00148-0.5413-7.8e-4 -0.8111-0.00379-0.4854-0.04143-0.9771-0.19121-1.4414-0.28748-0.9172-0.98053-1.616-1.8964-1.909 0.43984-1.1576 0.66815-2.7594 1.1268-3.8895 0.3537 0.72804 0.57113 1.7669 0.82283 2.7298 0.26567 1.0724 0.5404 2.1814 0.90896 3.0557 0.87204 2.2985 3.1124 2.7586 4.0452 0.392 0.5508-1.2642 0.7508-3.279 1.3828-4.4916 2.1142-0.10339 3.8024-1.8557 3.8024-3.995zm-12.073 8.8023c0.05605 0.2275 0.06623 0.465 0.07092 0.6983 0.00363 0.2444 0.00195 0.4906 0.00214 0.735-0.0063 0.408 0.01486 0.882-0.18359 1.2496-0.24573 0.4539-0.8026 0.501-1.2651 0.5114-0.33714 0.0058-0.67525 0.0041-1.0124 0.0018-0.46455-0.0092-1.0361-0.0245-1.3192-0.4545-0.16612-0.2552-0.19733-0.5702-0.21202-0.8673-0.01004-0.2443-0.00683-0.4906-0.0075-0.735 5.9e-4 -0.2322-0.00201-0.4664 0.01171-0.6983 0.01886-0.2936 0.06332-0.6069 0.24969-0.8453 0.34185-0.4331 1.0226-0.3889 1.5228-0.3979 0.38828 0.0035 0.77905-0.0131 1.1658 0.0285 0.49865 0.0566 0.85211 0.2621 0.97684 0.7737zm8.0732-6.8023c-2.6379-0.06696-2.6373-3.9334 0-4 2.6378 0.06697 2.6373 3.9334 0 4z" fill="currentColor"></path></svg>
            <p name="id">路径装饰器依赖项</p>
          </span>
        </div>
      
<p><strong>例子描述：</strong><br>
在金融系统的多个 API 路由上使用 <code>dependencies=[Depends(verify_token)]</code> 来统一进行 token 身份验证，<code>verify_token</code> 不传入路径函数，仅用于提前拒绝未授权请求。</p>
<p><strong>特征对比：</strong></p>
<ul>
<li>✅ 使用 <strong>装饰器层级声明</strong>，而非函数参数。</li>
<li>✅ <code>verify_token</code> 用于副作用控制（异常处理），不返回数据。</li>
<li>✅ 符合<strong>控制性逻辑目的</strong>，在函数调用前验证合法性。</li>
<li>✅ 提升路由模块结构性与安全一致性。</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> fastapi <span class="token keyword">import</span> Depends<span class="token punctuation">,</span> FastAPI<span class="token punctuation">,</span> Header<span class="token punctuation">,</span> HTTPException

app <span class="token operator">=</span> FastAPI<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">verify_token</span><span class="token punctuation">(</span>x_token<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> Header<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> x_token <span class="token operator">!=</span> <span class="token string">"fake-super-secret-token"</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> HTTPException<span class="token punctuation">(</span>status_code<span class="token operator">=</span><span class="token number">400</span><span class="token punctuation">,</span> detail<span class="token operator">=</span><span class="token string">"X-Token header invalid"</span><span class="token punctuation">)</span> <span class="token comment"># 路径装饰器依赖项与正常的依赖项一样，可以 `raise` 异常</span>

<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">verify_key</span><span class="token punctuation">(</span>x_key<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> Header<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> x_key <span class="token operator">!=</span> <span class="token string">"fake-super-secret-key"</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> HTTPException<span class="token punctuation">(</span>status_code<span class="token operator">=</span><span class="token number">400</span><span class="token punctuation">,</span> detail<span class="token operator">=</span><span class="token string">"X-Key header invalid"</span><span class="token punctuation">)</span> <span class="token comment"># 路径装饰器依赖项与正常的依赖项一样，可以 `raise` 异常</span>
    <span class="token keyword">return</span> x_key <span class="token comment"># 复用在其他位置使用过的、（能返回值的）普通依赖项，即使没有使用这个值，也会执行该依赖项</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>get</span><span class="token punctuation">(</span><span class="token string">"/items/"</span><span class="token punctuation">,</span> dependencies<span class="token operator">=</span><span class="token punctuation">[</span>Depends<span class="token punctuation">(</span>verify_token<span class="token punctuation">)</span><span class="token punctuation">,</span> Depends<span class="token punctuation">(</span>verify_key<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">read_items</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">"item"</span><span class="token punctuation">:</span> <span class="token string">"Foo"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">"item"</span><span class="token punctuation">:</span> <span class="token string">"Bar"</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

        <div class="evoldown" id="请求记录审计日志(正例)" type="e">
          <span class="icon">
            <svg type="e" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path fill="currentColor" d="m21.9 15.621c0.1248-1.8535-0.6087-3.4099-2.6058-3.8292-0.7712-0.15744-1.3921-0.13977-2.1113-0.14543-0.6323 0.0048-1.1718-0.01567-1.8401 0.03203 1.5356-0.8078 1.6998-2.205 1.6567-3.546 0.1272-2.3708-1.4685-3.666-3.7727-3.673-2.2427-0.04024-5.0463-0.27229-5.9443 1.9172-0.28083 0.6692-0.27606 1.2179-0.28202 1.6587-0.08527 1.4303 0.20687 2.9224 1.662 3.6429-2.3051-0.05275-5.3273-0.39212-6.28 1.8983-0.28073 0.66862-0.27595 1.2174-0.282 1.6572-0.10329 1.6061 0.3059 3.171 2.0252 3.8067 1.2061 0.4187 2.2175 0.2869 3.3945 0.3134 2.0524 0.0901 4.0448-0.4637 4.4796-2.4982 0.609 2.5638 3.2086 2.5463 5.3204 2.4982 2.7823 0.1278 4.7024-0.9368 4.5798-3.7329zm-12.899-7.6287c-0.14889-1.8665 1.8839-1.4921 3.1358-1.546 0.8939 0.05358 2.4743-0.21158 2.8003 0.88445 0.2729 2.4494-0.0297 2.8555-2.5242 2.8232-0.94713-0.07259-2.869 0.28949-3.3134-0.77077-0.14881-0.44557-0.08538-0.92893-0.09846-1.3909zm0.2606 9.2128c-0.56638 0.162-1.1652 0.1412-1.7487 0.1488-0.59786-0.0036-1.1977 0.0131-1.7948-0.0233-0.93407-0.0365-1.6776-0.3579-1.6157-1.4217 0.01574-0.5119-0.06845-1.0551 0.11822-1.5436 0.4432-0.84155 1.5978-0.6728 2.4032-0.7191 0.81712 0.01614 1.6464-0.05154 2.4536 0.10154 0.99382 0.17537 1.0564 0.91742 1.0227 1.7752-6.1e-4 0.7729 0.04085 1.416-0.83867 1.6821zm2.9212-3.6286c-0.0836 0.19457-0.14194 0.3848-0.18279 0.56614-0.18535-0.87758-0.76293-1.6189-1.5605-2.02 1.0871 0.04933 2.0387 0.04959 3.1216-8e-5 -0.7672 0.39034-1.1687 0.96486-1.3783 1.4539zm6.8788 3.6286c-0.5664 0.162-1.1652 0.1412-1.7488 0.1488-0.5978-0.0036-1.1977 0.0131-1.7947-0.0233-0.9341-0.0365-1.6776-0.3579-1.6157-1.4217 0.0157-0.5119-0.0685-1.0551 0.1182-1.5436 0.4432-0.84155 1.5978-0.6728 2.4033-0.7191 0.8171 0.01614 1.6464-0.05154 2.4536 0.10154 0.9938 0.17537 1.0563 0.91742 1.0227 1.7752-6e-4 0.7729 0.0409 1.416-0.8386 1.6821z"></path></svg>
            <p name="id">请求记录审计日志(正例)</p>
          </span>
          <span class="link-icon ml-[0.5em] mr-[0.25em]">
            <svg xmlns="http://www.w3.org/2000/svg" width="0.9411764705882353em" height="0.9411764705882353em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class="untouchable"><path d="m9.5652 14.45 0.72891-2.0026c-0.651 0.00713-1.3027 0.00104-1.9532 0.00179-1.0991-0.02908-3.0336 0.08306-3.605-1.0524-0.28828-0.61588-0.2054-1.3226-0.22136-1.9833 0.00663-0.74044-0.05553-1.6362 0.5758-2.1558 0.70637-0.5555 1.7411-0.56129 2.6027-0.59834 0.743-0.015 1.4884-0.00764 2.2315-0.00868 0.68471 0.01536 1.6274-0.01783 2.4184 0.16762l0.68711-1.8879c-0.0146-0.003965-0.0287-0.00841-0.0435-0.01227-0.94653-0.24905-1.9355-0.25901-2.9083-0.26688-0.78352-1.3008e-4 -1.5692-0.0063751-2.3527 0.006805-1.2709 0.027555-2.6299 0.13739-3.6978 0.89566-1.6654 1.2031-1.53 2.9573-1.5068 4.79-0.0012251 1.7732 0.89765 3.2159 2.626 3.7562 0.80589 0.26191 1.6615 0.32018 2.5036 0.34101 0.6376 0.01106 1.2763 0.01096 1.9146 0.00915z" fill="currentColor"></path><path d="m14.589 9.125h1.3099c0.02865-0.88714-0.11774-1.6826-0.45594-2.3461l-0.85392 2.3461z" fill="currentColor"></path><path d="m15.587 12.025h-2.0527l-0.80604 2.2146c1.2326-0.27362 2.3169-0.88582 2.8588-2.2146z" fill="currentColor"></path><path d="m8.394 12.025h2.0538l0.82406-2.2641c-1.2457 0.2734-2.3327 0.8901-2.8779 2.2641z" fill="currentColor"></path><path d="m8.5566 17.221 0.83571-2.2961h-1.2914c-0.025394 0.86685 0.12295 1.645 0.45565 2.2961z" fill="currentColor"></path><path d="m21.485 14.399c7e-4 -0.67593 0.0063-1.3662-0.1779-2.0223-0.58881-2.115-2.5706-2.7532-4.5608-2.8041-0.76964-0.031175-1.5416-0.02264-2.3121-0.022365l-0.72832 2.0011c0.38557-0.00297 0.77131 7.6e-4 1.1559-0.00173 1.1244 0.02284 2.8396-0.10221 3.8152 0.44616 0.82512 0.45526 0.81194 1.4036 0.80798 2.2308-0.01538 0.64171 0.05949 1.3145-0.1601 1.93-0.39418 1.0145-1.651 1.1102-2.5915 1.1694-0.7426 0.03331-1.4884 0.0209-2.2315 0.02365-0.81334-0.01641-1.9395 0.04306-2.8448-0.16914l-0.68792 1.89c0.014845 0.00401 0.02915 0.0085 0.044115 0.0124 0.94522 0.24688 1.9316 0.25913 2.9027 0.2657 0.83456-2.2e-4 1.6713 0.00786 2.5057-0.00999 2.0286-0.02122 4.1491-0.51576 4.8438-2.6752 0.2358-0.7292 0.22-1.5067 0.2196-2.2644z" fill="currentColor"></path><path d="m14.979 6.7378c0.17824-0.52033 0.90905-2.4486 1.0626-2.9514 0.05601-0.19527 0.10768-0.39984 0.08232-0.60408-0.03096-0.33264-0.36035-0.4603-0.63671-0.55464-0.20794-0.070665-0.41593-0.17228-0.63943-0.174-0.33751 0.005805-0.52152 0.33878-0.64452 0.61072-1.4256 3.8005-4.7612 13.07-6.1617 16.891-0.10636 0.34-0.29285 0.7891-0.06874 1.1109 0.1296 0.1673 0.34386 0.232 0.53431 0.3042 0.30778 0.1107 0.70325 0.3075 0.98251 0.0365 0.14514-0.1339 0.23561-0.315 0.31595-0.4926 0.10005-0.2274 0.1811-0.4632 0.26694-0.6962 0.4854-1.3337 4.3257-11.885 4.9065-13.481z" fill="currentColor"></path></svg>
          </span>
          
          <span class="icon">
            <svg type="d" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m21.15 6.85c0-2.2056-1.7944-4-4-4-4.1765-0.01989-5.4993 5.7322-1.8147 7.5629-0.263 0.63631-0.4627 1.4421-0.6559 2.2215-0.1397 0.56337-0.2841 1.1459-0.4405 1.6084-0.0728 0.2155-0.1286 0.4813-0.1891 0.4813-0.5072-0.7362-0.8126-2.2507-1.0979-3.3161-0.47879-1.5358-0.72936-4.4237-2.8018-4.558-0.77422 7e-5 -1.3844 0.52253-1.8138 1.553-0.55019 1.254-0.75064 3.2421-1.3784 4.4472-0.39648 3e-4 -0.79576 0.0045-1.1877 0.0703-0.67978 0.1073-1.3339 0.4195-1.798 0.9347-0.39707 0.4315-0.6427 0.9874-0.74275 1.5623-0.063545 0.351-0.07691 0.7094-0.07883 1.0654 0.001935 0.4718-0.01324 0.9457 0.027745 1.4163 0.09435 1.151 0.65732 2.1308 1.7281 2.6237 0.43467 0.1975 0.91053 0.2877 1.3854 0.3129 0.40096 0.0215 0.80345 0.0129 1.2048 0.0139 0.6491 2e-4 1.2891-0.0515 1.888-0.3229 0.90042-0.4067 1.4845-1.2039 1.6712-2.1666 0.0761-0.3779 0.09179-0.7654 0.09344-1.15 7.7e-4 -0.2699 0.00148-0.5413-7.8e-4 -0.8111-0.00379-0.4854-0.04143-0.9771-0.19121-1.4414-0.28748-0.9172-0.98053-1.616-1.8964-1.909 0.43984-1.1576 0.66815-2.7594 1.1268-3.8895 0.3537 0.72804 0.57113 1.7669 0.82283 2.7298 0.26567 1.0724 0.5404 2.1814 0.90896 3.0557 0.87204 2.2985 3.1124 2.7586 4.0452 0.392 0.5508-1.2642 0.7508-3.279 1.3828-4.4916 2.1142-0.10339 3.8024-1.8557 3.8024-3.995zm-12.073 8.8023c0.05605 0.2275 0.06623 0.465 0.07092 0.6983 0.00363 0.2444 0.00195 0.4906 0.00214 0.735-0.0063 0.408 0.01486 0.882-0.18359 1.2496-0.24573 0.4539-0.8026 0.501-1.2651 0.5114-0.33714 0.0058-0.67525 0.0041-1.0124 0.0018-0.46455-0.0092-1.0361-0.0245-1.3192-0.4545-0.16612-0.2552-0.19733-0.5702-0.21202-0.8673-0.01004-0.2443-0.00683-0.4906-0.0075-0.735 5.9e-4 -0.2322-0.00201-0.4664 0.01171-0.6983 0.01886-0.2936 0.06332-0.6069 0.24969-0.8453 0.34185-0.4331 1.0226-0.3889 1.5228-0.3979 0.38828 0.0035 0.77905-0.0131 1.1658 0.0285 0.49865 0.0566 0.85211 0.2621 0.97684 0.7737zm8.0732-6.8023c-2.6379-0.06696-2.6373-3.9334 0-4 2.6378 0.06697 2.6373 3.9334 0 4z" fill="currentColor"></path></svg>
            <p name="id">路径装饰器依赖项</p>
          </span>
        </div>
      
<p><strong>例子描述：</strong><br>
在医疗系统的敏感数据访问路由中使用 <code>dependencies=[Depends(log_access)]</code> 来记录访问日志，<code>log_access</code> 会记录用户与时间，但不传给接口处理逻辑。</p>
<p><strong>特征对比：</strong></p>
<ul>
<li>✅ <code>log_access</code> 不参与路径函数输入。</li>
<li>✅ 用于<strong>副作用性审计行为</strong>，如记录日志。</li>
<li>✅ 在多个路径下通用复用，减少重复性代码。</li>
<li>✅ 明确分离业务逻辑与审计逻辑。</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> fastapi <span class="token keyword">import</span> FastAPI<span class="token punctuation">,</span> Depends<span class="token punctuation">,</span> Request

app <span class="token operator">=</span> FastAPI<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">log_access</span><span class="token punctuation">(</span>request<span class="token punctuation">:</span> Request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"User accessed </span><span class="token interpolation"><span class="token punctuation">{</span>request<span class="token punctuation">.</span>url<span class="token punctuation">}</span></span><span class="token string"> from </span><span class="token interpolation"><span class="token punctuation">{</span>request<span class="token punctuation">.</span>client<span class="token punctuation">.</span>host<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>get</span><span class="token punctuation">(</span><span class="token string">"/medical/record"</span><span class="token punctuation">,</span> dependencies<span class="token operator">=</span><span class="token punctuation">[</span>Depends<span class="token punctuation">(</span>log_access<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">get_medical_record</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token string">"record"</span><span class="token punctuation">:</span> <span class="token string">"patient MRI data"</span><span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

        <div class="evoldown" id="输入参数错的装饰器(反例)" type="e">
          <span class="icon">
            <svg type="e" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path fill="currentColor" d="m21.9 15.621c0.1248-1.8535-0.6087-3.4099-2.6058-3.8292-0.7712-0.15744-1.3921-0.13977-2.1113-0.14543-0.6323 0.0048-1.1718-0.01567-1.8401 0.03203 1.5356-0.8078 1.6998-2.205 1.6567-3.546 0.1272-2.3708-1.4685-3.666-3.7727-3.673-2.2427-0.04024-5.0463-0.27229-5.9443 1.9172-0.28083 0.6692-0.27606 1.2179-0.28202 1.6587-0.08527 1.4303 0.20687 2.9224 1.662 3.6429-2.3051-0.05275-5.3273-0.39212-6.28 1.8983-0.28073 0.66862-0.27595 1.2174-0.282 1.6572-0.10329 1.6061 0.3059 3.171 2.0252 3.8067 1.2061 0.4187 2.2175 0.2869 3.3945 0.3134 2.0524 0.0901 4.0448-0.4637 4.4796-2.4982 0.609 2.5638 3.2086 2.5463 5.3204 2.4982 2.7823 0.1278 4.7024-0.9368 4.5798-3.7329zm-12.899-7.6287c-0.14889-1.8665 1.8839-1.4921 3.1358-1.546 0.8939 0.05358 2.4743-0.21158 2.8003 0.88445 0.2729 2.4494-0.0297 2.8555-2.5242 2.8232-0.94713-0.07259-2.869 0.28949-3.3134-0.77077-0.14881-0.44557-0.08538-0.92893-0.09846-1.3909zm0.2606 9.2128c-0.56638 0.162-1.1652 0.1412-1.7487 0.1488-0.59786-0.0036-1.1977 0.0131-1.7948-0.0233-0.93407-0.0365-1.6776-0.3579-1.6157-1.4217 0.01574-0.5119-0.06845-1.0551 0.11822-1.5436 0.4432-0.84155 1.5978-0.6728 2.4032-0.7191 0.81712 0.01614 1.6464-0.05154 2.4536 0.10154 0.99382 0.17537 1.0564 0.91742 1.0227 1.7752-6.1e-4 0.7729 0.04085 1.416-0.83867 1.6821zm2.9212-3.6286c-0.0836 0.19457-0.14194 0.3848-0.18279 0.56614-0.18535-0.87758-0.76293-1.6189-1.5605-2.02 1.0871 0.04933 2.0387 0.04959 3.1216-8e-5 -0.7672 0.39034-1.1687 0.96486-1.3783 1.4539zm6.8788 3.6286c-0.5664 0.162-1.1652 0.1412-1.7488 0.1488-0.5978-0.0036-1.1977 0.0131-1.7947-0.0233-0.9341-0.0365-1.6776-0.3579-1.6157-1.4217 0.0157-0.5119-0.0685-1.0551 0.1182-1.5436 0.4432-0.84155 1.5978-0.6728 2.4033-0.7191 0.8171 0.01614 1.6464-0.05154 2.4536 0.10154 0.9938 0.17537 1.0563 0.91742 1.0227 1.7752-6e-4 0.7729 0.0409 1.416-0.8386 1.6821z"></path></svg>
            <p name="id">输入参数错的装饰器(反例)</p>
          </span>
          <span class="link-icon ml-[0.5em] mr-[0.25em]">
            <svg xmlns="http://www.w3.org/2000/svg" width="0.9411764705882353em" height="0.9411764705882353em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class="untouchable"><path d="m9.5652 14.45 0.72891-2.0026c-0.651 0.00713-1.3027 0.00104-1.9532 0.00179-1.0991-0.02908-3.0336 0.08306-3.605-1.0524-0.28828-0.61588-0.2054-1.3226-0.22136-1.9833 0.00663-0.74044-0.05553-1.6362 0.5758-2.1558 0.70637-0.5555 1.7411-0.56129 2.6027-0.59834 0.743-0.015 1.4884-0.00764 2.2315-0.00868 0.68471 0.01536 1.6274-0.01783 2.4184 0.16762l0.68711-1.8879c-0.0146-0.003965-0.0287-0.00841-0.0435-0.01227-0.94653-0.24905-1.9355-0.25901-2.9083-0.26688-0.78352-1.3008e-4 -1.5692-0.0063751-2.3527 0.006805-1.2709 0.027555-2.6299 0.13739-3.6978 0.89566-1.6654 1.2031-1.53 2.9573-1.5068 4.79-0.0012251 1.7732 0.89765 3.2159 2.626 3.7562 0.80589 0.26191 1.6615 0.32018 2.5036 0.34101 0.6376 0.01106 1.2763 0.01096 1.9146 0.00915z" fill="currentColor"></path><path d="m14.589 9.125h1.3099c0.02865-0.88714-0.11774-1.6826-0.45594-2.3461l-0.85392 2.3461z" fill="currentColor"></path><path d="m15.587 12.025h-2.0527l-0.80604 2.2146c1.2326-0.27362 2.3169-0.88582 2.8588-2.2146z" fill="currentColor"></path><path d="m8.394 12.025h2.0538l0.82406-2.2641c-1.2457 0.2734-2.3327 0.8901-2.8779 2.2641z" fill="currentColor"></path><path d="m8.5566 17.221 0.83571-2.2961h-1.2914c-0.025394 0.86685 0.12295 1.645 0.45565 2.2961z" fill="currentColor"></path><path d="m21.485 14.399c7e-4 -0.67593 0.0063-1.3662-0.1779-2.0223-0.58881-2.115-2.5706-2.7532-4.5608-2.8041-0.76964-0.031175-1.5416-0.02264-2.3121-0.022365l-0.72832 2.0011c0.38557-0.00297 0.77131 7.6e-4 1.1559-0.00173 1.1244 0.02284 2.8396-0.10221 3.8152 0.44616 0.82512 0.45526 0.81194 1.4036 0.80798 2.2308-0.01538 0.64171 0.05949 1.3145-0.1601 1.93-0.39418 1.0145-1.651 1.1102-2.5915 1.1694-0.7426 0.03331-1.4884 0.0209-2.2315 0.02365-0.81334-0.01641-1.9395 0.04306-2.8448-0.16914l-0.68792 1.89c0.014845 0.00401 0.02915 0.0085 0.044115 0.0124 0.94522 0.24688 1.9316 0.25913 2.9027 0.2657 0.83456-2.2e-4 1.6713 0.00786 2.5057-0.00999 2.0286-0.02122 4.1491-0.51576 4.8438-2.6752 0.2358-0.7292 0.22-1.5067 0.2196-2.2644z" fill="currentColor"></path><path d="m14.979 6.7378c0.17824-0.52033 0.90905-2.4486 1.0626-2.9514 0.05601-0.19527 0.10768-0.39984 0.08232-0.60408-0.03096-0.33264-0.36035-0.4603-0.63671-0.55464-0.20794-0.070665-0.41593-0.17228-0.63943-0.174-0.33751 0.005805-0.52152 0.33878-0.64452 0.61072-1.4256 3.8005-4.7612 13.07-6.1617 16.891-0.10636 0.34-0.29285 0.7891-0.06874 1.1109 0.1296 0.1673 0.34386 0.232 0.53431 0.3042 0.30778 0.1107 0.70325 0.3075 0.98251 0.0365 0.14514-0.1339 0.23561-0.315 0.31595-0.4926 0.10005-0.2274 0.1811-0.4632 0.26694-0.6962 0.4854-1.3337 4.3257-11.885 4.9065-13.481z" fill="currentColor"></path></svg>
          </span>
          
          <span class="icon">
            <svg type="d" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m21.15 6.85c0-2.2056-1.7944-4-4-4-4.1765-0.01989-5.4993 5.7322-1.8147 7.5629-0.263 0.63631-0.4627 1.4421-0.6559 2.2215-0.1397 0.56337-0.2841 1.1459-0.4405 1.6084-0.0728 0.2155-0.1286 0.4813-0.1891 0.4813-0.5072-0.7362-0.8126-2.2507-1.0979-3.3161-0.47879-1.5358-0.72936-4.4237-2.8018-4.558-0.77422 7e-5 -1.3844 0.52253-1.8138 1.553-0.55019 1.254-0.75064 3.2421-1.3784 4.4472-0.39648 3e-4 -0.79576 0.0045-1.1877 0.0703-0.67978 0.1073-1.3339 0.4195-1.798 0.9347-0.39707 0.4315-0.6427 0.9874-0.74275 1.5623-0.063545 0.351-0.07691 0.7094-0.07883 1.0654 0.001935 0.4718-0.01324 0.9457 0.027745 1.4163 0.09435 1.151 0.65732 2.1308 1.7281 2.6237 0.43467 0.1975 0.91053 0.2877 1.3854 0.3129 0.40096 0.0215 0.80345 0.0129 1.2048 0.0139 0.6491 2e-4 1.2891-0.0515 1.888-0.3229 0.90042-0.4067 1.4845-1.2039 1.6712-2.1666 0.0761-0.3779 0.09179-0.7654 0.09344-1.15 7.7e-4 -0.2699 0.00148-0.5413-7.8e-4 -0.8111-0.00379-0.4854-0.04143-0.9771-0.19121-1.4414-0.28748-0.9172-0.98053-1.616-1.8964-1.909 0.43984-1.1576 0.66815-2.7594 1.1268-3.8895 0.3537 0.72804 0.57113 1.7669 0.82283 2.7298 0.26567 1.0724 0.5404 2.1814 0.90896 3.0557 0.87204 2.2985 3.1124 2.7586 4.0452 0.392 0.5508-1.2642 0.7508-3.279 1.3828-4.4916 2.1142-0.10339 3.8024-1.8557 3.8024-3.995zm-12.073 8.8023c0.05605 0.2275 0.06623 0.465 0.07092 0.6983 0.00363 0.2444 0.00195 0.4906 0.00214 0.735-0.0063 0.408 0.01486 0.882-0.18359 1.2496-0.24573 0.4539-0.8026 0.501-1.2651 0.5114-0.33714 0.0058-0.67525 0.0041-1.0124 0.0018-0.46455-0.0092-1.0361-0.0245-1.3192-0.4545-0.16612-0.2552-0.19733-0.5702-0.21202-0.8673-0.01004-0.2443-0.00683-0.4906-0.0075-0.735 5.9e-4 -0.2322-0.00201-0.4664 0.01171-0.6983 0.01886-0.2936 0.06332-0.6069 0.24969-0.8453 0.34185-0.4331 1.0226-0.3889 1.5228-0.3979 0.38828 0.0035 0.77905-0.0131 1.1658 0.0285 0.49865 0.0566 0.85211 0.2621 0.97684 0.7737zm8.0732-6.8023c-2.6379-0.06696-2.6373-3.9334 0-4 2.6378 0.06697 2.6373 3.9334 0 4z" fill="currentColor"></path></svg>
            <p name="id">路径装饰器依赖项</p>
          </span>
        </div>
      
<p><strong>例子描述：</strong><br>
在电商系统的商品接口中，将 <code>get_product_id</code>（用于校验并返回 product_id）放入装饰器依赖项中，结果路径函数内获取不到 product_id，导致业务无法继续执行。</p>
<p><strong>特征对比：</strong></p>
<ul>
<li>❌ 违反<strong>不注入参数</strong>原则：需要的值未传入函数参数中。</li>
<li>❌ 功能不应是<strong>副作用控制</strong>而是业务数据传递。</li>
<li>❌ 依赖应在函数参数中显式声明而非装饰器中隐藏，导致数据丢失。</li>
<li>❌ 与“结构性逻辑分离”的设计目标相悖。</li>
</ul>
<h2 id="5全局依赖项"><a class="markdownIt-Anchor" href="#5全局依赖项"></a> 5.全局依赖项</h2>

        <div class="evoldown" id="全局依赖项" type="d">
          <span class="icon">
            <svg type="d" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m21.15 6.85c0-2.2056-1.7944-4-4-4-4.1765-0.01989-5.4993 5.7322-1.8147 7.5629-0.263 0.63631-0.4627 1.4421-0.6559 2.2215-0.1397 0.56337-0.2841 1.1459-0.4405 1.6084-0.0728 0.2155-0.1286 0.4813-0.1891 0.4813-0.5072-0.7362-0.8126-2.2507-1.0979-3.3161-0.47879-1.5358-0.72936-4.4237-2.8018-4.558-0.77422 7e-5 -1.3844 0.52253-1.8138 1.553-0.55019 1.254-0.75064 3.2421-1.3784 4.4472-0.39648 3e-4 -0.79576 0.0045-1.1877 0.0703-0.67978 0.1073-1.3339 0.4195-1.798 0.9347-0.39707 0.4315-0.6427 0.9874-0.74275 1.5623-0.063545 0.351-0.07691 0.7094-0.07883 1.0654 0.001935 0.4718-0.01324 0.9457 0.027745 1.4163 0.09435 1.151 0.65732 2.1308 1.7281 2.6237 0.43467 0.1975 0.91053 0.2877 1.3854 0.3129 0.40096 0.0215 0.80345 0.0129 1.2048 0.0139 0.6491 2e-4 1.2891-0.0515 1.888-0.3229 0.90042-0.4067 1.4845-1.2039 1.6712-2.1666 0.0761-0.3779 0.09179-0.7654 0.09344-1.15 7.7e-4 -0.2699 0.00148-0.5413-7.8e-4 -0.8111-0.00379-0.4854-0.04143-0.9771-0.19121-1.4414-0.28748-0.9172-0.98053-1.616-1.8964-1.909 0.43984-1.1576 0.66815-2.7594 1.1268-3.8895 0.3537 0.72804 0.57113 1.7669 0.82283 2.7298 0.26567 1.0724 0.5404 2.1814 0.90896 3.0557 0.87204 2.2985 3.1124 2.7586 4.0452 0.392 0.5508-1.2642 0.7508-3.279 1.3828-4.4916 2.1142-0.10339 3.8024-1.8557 3.8024-3.995zm-12.073 8.8023c0.05605 0.2275 0.06623 0.465 0.07092 0.6983 0.00363 0.2444 0.00195 0.4906 0.00214 0.735-0.0063 0.408 0.01486 0.882-0.18359 1.2496-0.24573 0.4539-0.8026 0.501-1.2651 0.5114-0.33714 0.0058-0.67525 0.0041-1.0124 0.0018-0.46455-0.0092-1.0361-0.0245-1.3192-0.4545-0.16612-0.2552-0.19733-0.5702-0.21202-0.8673-0.01004-0.2443-0.00683-0.4906-0.0075-0.735 5.9e-4 -0.2322-0.00201-0.4664 0.01171-0.6983 0.01886-0.2936 0.06332-0.6069 0.24969-0.8453 0.34185-0.4331 1.0226-0.3889 1.5228-0.3979 0.38828 0.0035 0.77905-0.0131 1.1658 0.0285 0.49865 0.0566 0.85211 0.2621 0.97684 0.7737zm8.0732-6.8023c-2.6379-0.06696-2.6373-3.9334 0-4 2.6378 0.06697 2.6373 3.9334 0 4z" fill="currentColor"></path></svg>
            <p name="id">全局依赖项</p>
          </span>
        </div>
      
<p>全局依赖项是 FastAPI 中通过在 <code>FastAPI()</code> 实例化时使用 <code>dependencies</code> 参数设置的依赖项。它们会自动作用于应用中的所有路径操作函数，无需在每个路由或函数中重复声明。这种机制通常用于系统范围内的前置操作，如统一身份验证、全局日志记录、IP 白名单检查等。</p>
<p><strong>重要特征：</strong></p>
<ul>
<li><strong>特征1：全局适用性</strong><br>
一次声明，应用中所有路由都将执行该依赖项。</li>
<li><strong>特征2：主要用于非返回值的副作用逻辑</strong><br>
如权限验证、行为记录、速率限制等控制类操作。</li>
<li><strong>特征3：不注入到函数参数</strong><br>
与装饰器依赖类似，不将值传递给路由函数，仅做控制或检查。</li>
<li><strong>特征4：配置入口在 <code>FastAPI()</code> 初始化处</strong><br>
与局部路径依赖不同，配置统一且不依赖于具体模块定义。</li>
</ul>

        <div class="evoldown" id="统一访问令牌验证(正例)" type="e">
          <span class="icon">
            <svg type="e" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path fill="currentColor" d="m21.9 15.621c0.1248-1.8535-0.6087-3.4099-2.6058-3.8292-0.7712-0.15744-1.3921-0.13977-2.1113-0.14543-0.6323 0.0048-1.1718-0.01567-1.8401 0.03203 1.5356-0.8078 1.6998-2.205 1.6567-3.546 0.1272-2.3708-1.4685-3.666-3.7727-3.673-2.2427-0.04024-5.0463-0.27229-5.9443 1.9172-0.28083 0.6692-0.27606 1.2179-0.28202 1.6587-0.08527 1.4303 0.20687 2.9224 1.662 3.6429-2.3051-0.05275-5.3273-0.39212-6.28 1.8983-0.28073 0.66862-0.27595 1.2174-0.282 1.6572-0.10329 1.6061 0.3059 3.171 2.0252 3.8067 1.2061 0.4187 2.2175 0.2869 3.3945 0.3134 2.0524 0.0901 4.0448-0.4637 4.4796-2.4982 0.609 2.5638 3.2086 2.5463 5.3204 2.4982 2.7823 0.1278 4.7024-0.9368 4.5798-3.7329zm-12.899-7.6287c-0.14889-1.8665 1.8839-1.4921 3.1358-1.546 0.8939 0.05358 2.4743-0.21158 2.8003 0.88445 0.2729 2.4494-0.0297 2.8555-2.5242 2.8232-0.94713-0.07259-2.869 0.28949-3.3134-0.77077-0.14881-0.44557-0.08538-0.92893-0.09846-1.3909zm0.2606 9.2128c-0.56638 0.162-1.1652 0.1412-1.7487 0.1488-0.59786-0.0036-1.1977 0.0131-1.7948-0.0233-0.93407-0.0365-1.6776-0.3579-1.6157-1.4217 0.01574-0.5119-0.06845-1.0551 0.11822-1.5436 0.4432-0.84155 1.5978-0.6728 2.4032-0.7191 0.81712 0.01614 1.6464-0.05154 2.4536 0.10154 0.99382 0.17537 1.0564 0.91742 1.0227 1.7752-6.1e-4 0.7729 0.04085 1.416-0.83867 1.6821zm2.9212-3.6286c-0.0836 0.19457-0.14194 0.3848-0.18279 0.56614-0.18535-0.87758-0.76293-1.6189-1.5605-2.02 1.0871 0.04933 2.0387 0.04959 3.1216-8e-5 -0.7672 0.39034-1.1687 0.96486-1.3783 1.4539zm6.8788 3.6286c-0.5664 0.162-1.1652 0.1412-1.7488 0.1488-0.5978-0.0036-1.1977 0.0131-1.7947-0.0233-0.9341-0.0365-1.6776-0.3579-1.6157-1.4217 0.0157-0.5119-0.0685-1.0551 0.1182-1.5436 0.4432-0.84155 1.5978-0.6728 2.4033-0.7191 0.8171 0.01614 1.6464-0.05154 2.4536 0.10154 0.9938 0.17537 1.0563 0.91742 1.0227 1.7752-6e-4 0.7729 0.0409 1.416-0.8386 1.6821z"></path></svg>
            <p name="id">统一访问令牌验证(正例)</p>
          </span>
          <span class="link-icon ml-[0.5em] mr-[0.25em]">
            <svg xmlns="http://www.w3.org/2000/svg" width="0.9411764705882353em" height="0.9411764705882353em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class="untouchable"><path d="m9.5652 14.45 0.72891-2.0026c-0.651 0.00713-1.3027 0.00104-1.9532 0.00179-1.0991-0.02908-3.0336 0.08306-3.605-1.0524-0.28828-0.61588-0.2054-1.3226-0.22136-1.9833 0.00663-0.74044-0.05553-1.6362 0.5758-2.1558 0.70637-0.5555 1.7411-0.56129 2.6027-0.59834 0.743-0.015 1.4884-0.00764 2.2315-0.00868 0.68471 0.01536 1.6274-0.01783 2.4184 0.16762l0.68711-1.8879c-0.0146-0.003965-0.0287-0.00841-0.0435-0.01227-0.94653-0.24905-1.9355-0.25901-2.9083-0.26688-0.78352-1.3008e-4 -1.5692-0.0063751-2.3527 0.006805-1.2709 0.027555-2.6299 0.13739-3.6978 0.89566-1.6654 1.2031-1.53 2.9573-1.5068 4.79-0.0012251 1.7732 0.89765 3.2159 2.626 3.7562 0.80589 0.26191 1.6615 0.32018 2.5036 0.34101 0.6376 0.01106 1.2763 0.01096 1.9146 0.00915z" fill="currentColor"></path><path d="m14.589 9.125h1.3099c0.02865-0.88714-0.11774-1.6826-0.45594-2.3461l-0.85392 2.3461z" fill="currentColor"></path><path d="m15.587 12.025h-2.0527l-0.80604 2.2146c1.2326-0.27362 2.3169-0.88582 2.8588-2.2146z" fill="currentColor"></path><path d="m8.394 12.025h2.0538l0.82406-2.2641c-1.2457 0.2734-2.3327 0.8901-2.8779 2.2641z" fill="currentColor"></path><path d="m8.5566 17.221 0.83571-2.2961h-1.2914c-0.025394 0.86685 0.12295 1.645 0.45565 2.2961z" fill="currentColor"></path><path d="m21.485 14.399c7e-4 -0.67593 0.0063-1.3662-0.1779-2.0223-0.58881-2.115-2.5706-2.7532-4.5608-2.8041-0.76964-0.031175-1.5416-0.02264-2.3121-0.022365l-0.72832 2.0011c0.38557-0.00297 0.77131 7.6e-4 1.1559-0.00173 1.1244 0.02284 2.8396-0.10221 3.8152 0.44616 0.82512 0.45526 0.81194 1.4036 0.80798 2.2308-0.01538 0.64171 0.05949 1.3145-0.1601 1.93-0.39418 1.0145-1.651 1.1102-2.5915 1.1694-0.7426 0.03331-1.4884 0.0209-2.2315 0.02365-0.81334-0.01641-1.9395 0.04306-2.8448-0.16914l-0.68792 1.89c0.014845 0.00401 0.02915 0.0085 0.044115 0.0124 0.94522 0.24688 1.9316 0.25913 2.9027 0.2657 0.83456-2.2e-4 1.6713 0.00786 2.5057-0.00999 2.0286-0.02122 4.1491-0.51576 4.8438-2.6752 0.2358-0.7292 0.22-1.5067 0.2196-2.2644z" fill="currentColor"></path><path d="m14.979 6.7378c0.17824-0.52033 0.90905-2.4486 1.0626-2.9514 0.05601-0.19527 0.10768-0.39984 0.08232-0.60408-0.03096-0.33264-0.36035-0.4603-0.63671-0.55464-0.20794-0.070665-0.41593-0.17228-0.63943-0.174-0.33751 0.005805-0.52152 0.33878-0.64452 0.61072-1.4256 3.8005-4.7612 13.07-6.1617 16.891-0.10636 0.34-0.29285 0.7891-0.06874 1.1109 0.1296 0.1673 0.34386 0.232 0.53431 0.3042 0.30778 0.1107 0.70325 0.3075 0.98251 0.0365 0.14514-0.1339 0.23561-0.315 0.31595-0.4926 0.10005-0.2274 0.1811-0.4632 0.26694-0.6962 0.4854-1.3337 4.3257-11.885 4.9065-13.481z" fill="currentColor"></path></svg>
          </span>
          
          <span class="icon">
            <svg type="d" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m21.15 6.85c0-2.2056-1.7944-4-4-4-4.1765-0.01989-5.4993 5.7322-1.8147 7.5629-0.263 0.63631-0.4627 1.4421-0.6559 2.2215-0.1397 0.56337-0.2841 1.1459-0.4405 1.6084-0.0728 0.2155-0.1286 0.4813-0.1891 0.4813-0.5072-0.7362-0.8126-2.2507-1.0979-3.3161-0.47879-1.5358-0.72936-4.4237-2.8018-4.558-0.77422 7e-5 -1.3844 0.52253-1.8138 1.553-0.55019 1.254-0.75064 3.2421-1.3784 4.4472-0.39648 3e-4 -0.79576 0.0045-1.1877 0.0703-0.67978 0.1073-1.3339 0.4195-1.798 0.9347-0.39707 0.4315-0.6427 0.9874-0.74275 1.5623-0.063545 0.351-0.07691 0.7094-0.07883 1.0654 0.001935 0.4718-0.01324 0.9457 0.027745 1.4163 0.09435 1.151 0.65732 2.1308 1.7281 2.6237 0.43467 0.1975 0.91053 0.2877 1.3854 0.3129 0.40096 0.0215 0.80345 0.0129 1.2048 0.0139 0.6491 2e-4 1.2891-0.0515 1.888-0.3229 0.90042-0.4067 1.4845-1.2039 1.6712-2.1666 0.0761-0.3779 0.09179-0.7654 0.09344-1.15 7.7e-4 -0.2699 0.00148-0.5413-7.8e-4 -0.8111-0.00379-0.4854-0.04143-0.9771-0.19121-1.4414-0.28748-0.9172-0.98053-1.616-1.8964-1.909 0.43984-1.1576 0.66815-2.7594 1.1268-3.8895 0.3537 0.72804 0.57113 1.7669 0.82283 2.7298 0.26567 1.0724 0.5404 2.1814 0.90896 3.0557 0.87204 2.2985 3.1124 2.7586 4.0452 0.392 0.5508-1.2642 0.7508-3.279 1.3828-4.4916 2.1142-0.10339 3.8024-1.8557 3.8024-3.995zm-12.073 8.8023c0.05605 0.2275 0.06623 0.465 0.07092 0.6983 0.00363 0.2444 0.00195 0.4906 0.00214 0.735-0.0063 0.408 0.01486 0.882-0.18359 1.2496-0.24573 0.4539-0.8026 0.501-1.2651 0.5114-0.33714 0.0058-0.67525 0.0041-1.0124 0.0018-0.46455-0.0092-1.0361-0.0245-1.3192-0.4545-0.16612-0.2552-0.19733-0.5702-0.21202-0.8673-0.01004-0.2443-0.00683-0.4906-0.0075-0.735 5.9e-4 -0.2322-0.00201-0.4664 0.01171-0.6983 0.01886-0.2936 0.06332-0.6069 0.24969-0.8453 0.34185-0.4331 1.0226-0.3889 1.5228-0.3979 0.38828 0.0035 0.77905-0.0131 1.1658 0.0285 0.49865 0.0566 0.85211 0.2621 0.97684 0.7737zm8.0732-6.8023c-2.6379-0.06696-2.6373-3.9334 0-4 2.6378 0.06697 2.6373 3.9334 0 4z" fill="currentColor"></path></svg>
            <p name="id">全局依赖项</p>
          </span>
        </div>
      
<p><strong>例子描述：</strong><br>
在一个 SaaS 平台中，每个请求都需验证 API token，开发者将验证逻辑作为全局依赖项添加到 <code>FastAPI(dependencies=[Depends(check_token)])</code>，保证所有请求均自动进行验证。</p>
<p><strong>特征对比：</strong></p>
<ul>
<li>✅ 使用 <strong>FastAPI 构造函数添加依赖项</strong>。</li>
<li>✅ <strong>不传入函数参数</strong>，只通过副作用控制访问权限。</li>
<li>✅ 体现全局一致性，无需逐路由声明。</li>
<li>✅ 可跨模块复用，维护性强。</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> fastapi <span class="token keyword">import</span> FastAPI<span class="token punctuation">,</span> Depends<span class="token punctuation">,</span> Header<span class="token punctuation">,</span> HTTPException

<span class="token keyword">def</span> <span class="token function">check_token</span><span class="token punctuation">(</span>token<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> Header<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> token <span class="token operator">!=</span> <span class="token string">"valid-api-token"</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> HTTPException<span class="token punctuation">(</span>status_code<span class="token operator">=</span><span class="token number">401</span><span class="token punctuation">,</span> detail<span class="token operator">=</span><span class="token string">"Invalid token"</span><span class="token punctuation">)</span>

app <span class="token operator">=</span> FastAPI<span class="token punctuation">(</span>dependencies<span class="token operator">=</span><span class="token punctuation">[</span>Depends<span class="token punctuation">(</span>check_token<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">#　全局注入依赖项</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>get</span><span class="token punctuation">(</span><span class="token string">"/items/"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">read_items</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token string">"message"</span><span class="token punctuation">:</span> <span class="token string">"Token verified, items listed."</span><span class="token punctuation">}</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>post</span><span class="token punctuation">(</span><span class="token string">"/submit/"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">submit_data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token string">"message"</span><span class="token punctuation">:</span> <span class="token string">"Data submitted with valid token."</span><span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

        <div class="evoldown" id="访问日志系统监控(正例)" type="e">
          <span class="icon">
            <svg type="e" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path fill="currentColor" d="m21.9 15.621c0.1248-1.8535-0.6087-3.4099-2.6058-3.8292-0.7712-0.15744-1.3921-0.13977-2.1113-0.14543-0.6323 0.0048-1.1718-0.01567-1.8401 0.03203 1.5356-0.8078 1.6998-2.205 1.6567-3.546 0.1272-2.3708-1.4685-3.666-3.7727-3.673-2.2427-0.04024-5.0463-0.27229-5.9443 1.9172-0.28083 0.6692-0.27606 1.2179-0.28202 1.6587-0.08527 1.4303 0.20687 2.9224 1.662 3.6429-2.3051-0.05275-5.3273-0.39212-6.28 1.8983-0.28073 0.66862-0.27595 1.2174-0.282 1.6572-0.10329 1.6061 0.3059 3.171 2.0252 3.8067 1.2061 0.4187 2.2175 0.2869 3.3945 0.3134 2.0524 0.0901 4.0448-0.4637 4.4796-2.4982 0.609 2.5638 3.2086 2.5463 5.3204 2.4982 2.7823 0.1278 4.7024-0.9368 4.5798-3.7329zm-12.899-7.6287c-0.14889-1.8665 1.8839-1.4921 3.1358-1.546 0.8939 0.05358 2.4743-0.21158 2.8003 0.88445 0.2729 2.4494-0.0297 2.8555-2.5242 2.8232-0.94713-0.07259-2.869 0.28949-3.3134-0.77077-0.14881-0.44557-0.08538-0.92893-0.09846-1.3909zm0.2606 9.2128c-0.56638 0.162-1.1652 0.1412-1.7487 0.1488-0.59786-0.0036-1.1977 0.0131-1.7948-0.0233-0.93407-0.0365-1.6776-0.3579-1.6157-1.4217 0.01574-0.5119-0.06845-1.0551 0.11822-1.5436 0.4432-0.84155 1.5978-0.6728 2.4032-0.7191 0.81712 0.01614 1.6464-0.05154 2.4536 0.10154 0.99382 0.17537 1.0564 0.91742 1.0227 1.7752-6.1e-4 0.7729 0.04085 1.416-0.83867 1.6821zm2.9212-3.6286c-0.0836 0.19457-0.14194 0.3848-0.18279 0.56614-0.18535-0.87758-0.76293-1.6189-1.5605-2.02 1.0871 0.04933 2.0387 0.04959 3.1216-8e-5 -0.7672 0.39034-1.1687 0.96486-1.3783 1.4539zm6.8788 3.6286c-0.5664 0.162-1.1652 0.1412-1.7488 0.1488-0.5978-0.0036-1.1977 0.0131-1.7947-0.0233-0.9341-0.0365-1.6776-0.3579-1.6157-1.4217 0.0157-0.5119-0.0685-1.0551 0.1182-1.5436 0.4432-0.84155 1.5978-0.6728 2.4033-0.7191 0.8171 0.01614 1.6464-0.05154 2.4536 0.10154 0.9938 0.17537 1.0563 0.91742 1.0227 1.7752-6e-4 0.7729 0.0409 1.416-0.8386 1.6821z"></path></svg>
            <p name="id">访问日志系统监控(正例)</p>
          </span>
          <span class="link-icon ml-[0.5em] mr-[0.25em]">
            <svg xmlns="http://www.w3.org/2000/svg" width="0.9411764705882353em" height="0.9411764705882353em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class="untouchable"><path d="m9.5652 14.45 0.72891-2.0026c-0.651 0.00713-1.3027 0.00104-1.9532 0.00179-1.0991-0.02908-3.0336 0.08306-3.605-1.0524-0.28828-0.61588-0.2054-1.3226-0.22136-1.9833 0.00663-0.74044-0.05553-1.6362 0.5758-2.1558 0.70637-0.5555 1.7411-0.56129 2.6027-0.59834 0.743-0.015 1.4884-0.00764 2.2315-0.00868 0.68471 0.01536 1.6274-0.01783 2.4184 0.16762l0.68711-1.8879c-0.0146-0.003965-0.0287-0.00841-0.0435-0.01227-0.94653-0.24905-1.9355-0.25901-2.9083-0.26688-0.78352-1.3008e-4 -1.5692-0.0063751-2.3527 0.006805-1.2709 0.027555-2.6299 0.13739-3.6978 0.89566-1.6654 1.2031-1.53 2.9573-1.5068 4.79-0.0012251 1.7732 0.89765 3.2159 2.626 3.7562 0.80589 0.26191 1.6615 0.32018 2.5036 0.34101 0.6376 0.01106 1.2763 0.01096 1.9146 0.00915z" fill="currentColor"></path><path d="m14.589 9.125h1.3099c0.02865-0.88714-0.11774-1.6826-0.45594-2.3461l-0.85392 2.3461z" fill="currentColor"></path><path d="m15.587 12.025h-2.0527l-0.80604 2.2146c1.2326-0.27362 2.3169-0.88582 2.8588-2.2146z" fill="currentColor"></path><path d="m8.394 12.025h2.0538l0.82406-2.2641c-1.2457 0.2734-2.3327 0.8901-2.8779 2.2641z" fill="currentColor"></path><path d="m8.5566 17.221 0.83571-2.2961h-1.2914c-0.025394 0.86685 0.12295 1.645 0.45565 2.2961z" fill="currentColor"></path><path d="m21.485 14.399c7e-4 -0.67593 0.0063-1.3662-0.1779-2.0223-0.58881-2.115-2.5706-2.7532-4.5608-2.8041-0.76964-0.031175-1.5416-0.02264-2.3121-0.022365l-0.72832 2.0011c0.38557-0.00297 0.77131 7.6e-4 1.1559-0.00173 1.1244 0.02284 2.8396-0.10221 3.8152 0.44616 0.82512 0.45526 0.81194 1.4036 0.80798 2.2308-0.01538 0.64171 0.05949 1.3145-0.1601 1.93-0.39418 1.0145-1.651 1.1102-2.5915 1.1694-0.7426 0.03331-1.4884 0.0209-2.2315 0.02365-0.81334-0.01641-1.9395 0.04306-2.8448-0.16914l-0.68792 1.89c0.014845 0.00401 0.02915 0.0085 0.044115 0.0124 0.94522 0.24688 1.9316 0.25913 2.9027 0.2657 0.83456-2.2e-4 1.6713 0.00786 2.5057-0.00999 2.0286-0.02122 4.1491-0.51576 4.8438-2.6752 0.2358-0.7292 0.22-1.5067 0.2196-2.2644z" fill="currentColor"></path><path d="m14.979 6.7378c0.17824-0.52033 0.90905-2.4486 1.0626-2.9514 0.05601-0.19527 0.10768-0.39984 0.08232-0.60408-0.03096-0.33264-0.36035-0.4603-0.63671-0.55464-0.20794-0.070665-0.41593-0.17228-0.63943-0.174-0.33751 0.005805-0.52152 0.33878-0.64452 0.61072-1.4256 3.8005-4.7612 13.07-6.1617 16.891-0.10636 0.34-0.29285 0.7891-0.06874 1.1109 0.1296 0.1673 0.34386 0.232 0.53431 0.3042 0.30778 0.1107 0.70325 0.3075 0.98251 0.0365 0.14514-0.1339 0.23561-0.315 0.31595-0.4926 0.10005-0.2274 0.1811-0.4632 0.26694-0.6962 0.4854-1.3337 4.3257-11.885 4.9065-13.481z" fill="currentColor"></path></svg>
          </span>
          
          <span class="icon">
            <svg type="d" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m21.15 6.85c0-2.2056-1.7944-4-4-4-4.1765-0.01989-5.4993 5.7322-1.8147 7.5629-0.263 0.63631-0.4627 1.4421-0.6559 2.2215-0.1397 0.56337-0.2841 1.1459-0.4405 1.6084-0.0728 0.2155-0.1286 0.4813-0.1891 0.4813-0.5072-0.7362-0.8126-2.2507-1.0979-3.3161-0.47879-1.5358-0.72936-4.4237-2.8018-4.558-0.77422 7e-5 -1.3844 0.52253-1.8138 1.553-0.55019 1.254-0.75064 3.2421-1.3784 4.4472-0.39648 3e-4 -0.79576 0.0045-1.1877 0.0703-0.67978 0.1073-1.3339 0.4195-1.798 0.9347-0.39707 0.4315-0.6427 0.9874-0.74275 1.5623-0.063545 0.351-0.07691 0.7094-0.07883 1.0654 0.001935 0.4718-0.01324 0.9457 0.027745 1.4163 0.09435 1.151 0.65732 2.1308 1.7281 2.6237 0.43467 0.1975 0.91053 0.2877 1.3854 0.3129 0.40096 0.0215 0.80345 0.0129 1.2048 0.0139 0.6491 2e-4 1.2891-0.0515 1.888-0.3229 0.90042-0.4067 1.4845-1.2039 1.6712-2.1666 0.0761-0.3779 0.09179-0.7654 0.09344-1.15 7.7e-4 -0.2699 0.00148-0.5413-7.8e-4 -0.8111-0.00379-0.4854-0.04143-0.9771-0.19121-1.4414-0.28748-0.9172-0.98053-1.616-1.8964-1.909 0.43984-1.1576 0.66815-2.7594 1.1268-3.8895 0.3537 0.72804 0.57113 1.7669 0.82283 2.7298 0.26567 1.0724 0.5404 2.1814 0.90896 3.0557 0.87204 2.2985 3.1124 2.7586 4.0452 0.392 0.5508-1.2642 0.7508-3.279 1.3828-4.4916 2.1142-0.10339 3.8024-1.8557 3.8024-3.995zm-12.073 8.8023c0.05605 0.2275 0.06623 0.465 0.07092 0.6983 0.00363 0.2444 0.00195 0.4906 0.00214 0.735-0.0063 0.408 0.01486 0.882-0.18359 1.2496-0.24573 0.4539-0.8026 0.501-1.2651 0.5114-0.33714 0.0058-0.67525 0.0041-1.0124 0.0018-0.46455-0.0092-1.0361-0.0245-1.3192-0.4545-0.16612-0.2552-0.19733-0.5702-0.21202-0.8673-0.01004-0.2443-0.00683-0.4906-0.0075-0.735 5.9e-4 -0.2322-0.00201-0.4664 0.01171-0.6983 0.01886-0.2936 0.06332-0.6069 0.24969-0.8453 0.34185-0.4331 1.0226-0.3889 1.5228-0.3979 0.38828 0.0035 0.77905-0.0131 1.1658 0.0285 0.49865 0.0566 0.85211 0.2621 0.97684 0.7737zm8.0732-6.8023c-2.6379-0.06696-2.6373-3.9334 0-4 2.6378 0.06697 2.6373 3.9334 0 4z" fill="currentColor"></path></svg>
            <p name="id">全局依赖项</p>
          </span>
        </div>
      
<p><strong>例子描述：</strong><br>
一个 IoT 平台需要记录所有接口访问行为用于安全分析。开发者将 <code>log_request_info(request)</code> 添加为全局依赖，以在每次请求中记录 URL 和访问 IP。</p>
<p><strong>特征对比：</strong></p>
<ul>
<li>✅ 使用全局依赖配置日志逻辑，无需手动在每个接口声明。</li>
<li>✅ 属于副作用操作，无需返回值或参数注入。</li>
<li>✅ 与路径函数完全解耦，便于维护。</li>
<li>✅ 执行时机统一，符合安全审计需求。</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> fastapi <span class="token keyword">import</span> FastAPI<span class="token punctuation">,</span> Depends<span class="token punctuation">,</span> Request

<span class="token keyword">def</span> <span class="token function">log_request_info</span><span class="token punctuation">(</span>request<span class="token punctuation">:</span> Request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[LOG] Accessed URL: </span><span class="token interpolation"><span class="token punctuation">{</span>request<span class="token punctuation">.</span>url<span class="token punctuation">}</span></span><span class="token string"> from </span><span class="token interpolation"><span class="token punctuation">{</span>request<span class="token punctuation">.</span>client<span class="token punctuation">.</span>host<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

app <span class="token operator">=</span> FastAPI<span class="token punctuation">(</span>dependencies<span class="token operator">=</span><span class="token punctuation">[</span>Depends<span class="token punctuation">(</span>log_request_info<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>get</span><span class="token punctuation">(</span><span class="token string">"/sensor/data"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">get_sensor_data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token string">"sensor"</span><span class="token punctuation">:</span> <span class="token string">"temperature"</span><span class="token punctuation">,</span> <span class="token string">"value"</span><span class="token punctuation">:</span> <span class="token number">23.5</span><span class="token punctuation">}</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>get</span><span class="token punctuation">(</span><span class="token string">"/device/status"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">get_device_status</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token string">"device"</span><span class="token punctuation">:</span> <span class="token string">"sensor-1"</span><span class="token punctuation">,</span> <span class="token string">"status"</span><span class="token punctuation">:</span> <span class="token string">"online"</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="6yield依赖项"><a class="markdownIt-Anchor" href="#6yield依赖项"></a> 6.yield依赖项</h2>

        <div class="evoldown" id="yield依赖项" type="d">
          <span class="icon">
            <svg type="d" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m21.15 6.85c0-2.2056-1.7944-4-4-4-4.1765-0.01989-5.4993 5.7322-1.8147 7.5629-0.263 0.63631-0.4627 1.4421-0.6559 2.2215-0.1397 0.56337-0.2841 1.1459-0.4405 1.6084-0.0728 0.2155-0.1286 0.4813-0.1891 0.4813-0.5072-0.7362-0.8126-2.2507-1.0979-3.3161-0.47879-1.5358-0.72936-4.4237-2.8018-4.558-0.77422 7e-5 -1.3844 0.52253-1.8138 1.553-0.55019 1.254-0.75064 3.2421-1.3784 4.4472-0.39648 3e-4 -0.79576 0.0045-1.1877 0.0703-0.67978 0.1073-1.3339 0.4195-1.798 0.9347-0.39707 0.4315-0.6427 0.9874-0.74275 1.5623-0.063545 0.351-0.07691 0.7094-0.07883 1.0654 0.001935 0.4718-0.01324 0.9457 0.027745 1.4163 0.09435 1.151 0.65732 2.1308 1.7281 2.6237 0.43467 0.1975 0.91053 0.2877 1.3854 0.3129 0.40096 0.0215 0.80345 0.0129 1.2048 0.0139 0.6491 2e-4 1.2891-0.0515 1.888-0.3229 0.90042-0.4067 1.4845-1.2039 1.6712-2.1666 0.0761-0.3779 0.09179-0.7654 0.09344-1.15 7.7e-4 -0.2699 0.00148-0.5413-7.8e-4 -0.8111-0.00379-0.4854-0.04143-0.9771-0.19121-1.4414-0.28748-0.9172-0.98053-1.616-1.8964-1.909 0.43984-1.1576 0.66815-2.7594 1.1268-3.8895 0.3537 0.72804 0.57113 1.7669 0.82283 2.7298 0.26567 1.0724 0.5404 2.1814 0.90896 3.0557 0.87204 2.2985 3.1124 2.7586 4.0452 0.392 0.5508-1.2642 0.7508-3.279 1.3828-4.4916 2.1142-0.10339 3.8024-1.8557 3.8024-3.995zm-12.073 8.8023c0.05605 0.2275 0.06623 0.465 0.07092 0.6983 0.00363 0.2444 0.00195 0.4906 0.00214 0.735-0.0063 0.408 0.01486 0.882-0.18359 1.2496-0.24573 0.4539-0.8026 0.501-1.2651 0.5114-0.33714 0.0058-0.67525 0.0041-1.0124 0.0018-0.46455-0.0092-1.0361-0.0245-1.3192-0.4545-0.16612-0.2552-0.19733-0.5702-0.21202-0.8673-0.01004-0.2443-0.00683-0.4906-0.0075-0.735 5.9e-4 -0.2322-0.00201-0.4664 0.01171-0.6983 0.01886-0.2936 0.06332-0.6069 0.24969-0.8453 0.34185-0.4331 1.0226-0.3889 1.5228-0.3979 0.38828 0.0035 0.77905-0.0131 1.1658 0.0285 0.49865 0.0566 0.85211 0.2621 0.97684 0.7737zm8.0732-6.8023c-2.6379-0.06696-2.6373-3.9334 0-4 2.6378 0.06697 2.6373 3.9334 0 4z" fill="currentColor"></path></svg>
            <p name="id">yield依赖项</p>
          </span>
        </div>
      
<p>FastAPI 支持使用 <code>yield</code> 语法定义依赖项，在请求开始时执行 <code>yield</code> 前的逻辑，<strong>在请求处理完后自动执行 <code>yield</code> 后的清理逻辑</strong>。这种模式类似 Python 上下文管理器，常用于创建并自动释放资源，如数据库连接、文件句柄、会话对象等。FastAPI 会在请求生命周期内自动管理 <code>yield</code> 的调用与清理。</p>
<p><strong>重要特征：</strong></p>
<ul>
<li><strong>特征1：用于资源管理型依赖</strong><br>
可在依赖项内部创建资源，在请求处理后自动释放，如数据库会话、网络连接等。</li>
<li><strong>特征2：具有生命周期感知能力</strong><br>
<code>yield</code> 前的逻辑在请求开始时执行，<code>yield</code> 后的逻辑在请求结束时执行，支持清理操作。</li>
<li><strong>特征3：可返回值给路径函数使用</strong><br>
<code>yield</code> 可以产生值供路径操作函数使用。</li>
<li><strong>特征4：仅支持 <code>Depends()</code>，不支持 <code>dependencies=[Depends(...)]</code></strong><br>
因为清理逻辑只有在有“返回值”的依赖中才能正确执行。</li>
</ul>

        <div class="evoldown" id="数据库会话的自动释放(正例)" type="e">
          <span class="icon">
            <svg type="e" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path fill="currentColor" d="m21.9 15.621c0.1248-1.8535-0.6087-3.4099-2.6058-3.8292-0.7712-0.15744-1.3921-0.13977-2.1113-0.14543-0.6323 0.0048-1.1718-0.01567-1.8401 0.03203 1.5356-0.8078 1.6998-2.205 1.6567-3.546 0.1272-2.3708-1.4685-3.666-3.7727-3.673-2.2427-0.04024-5.0463-0.27229-5.9443 1.9172-0.28083 0.6692-0.27606 1.2179-0.28202 1.6587-0.08527 1.4303 0.20687 2.9224 1.662 3.6429-2.3051-0.05275-5.3273-0.39212-6.28 1.8983-0.28073 0.66862-0.27595 1.2174-0.282 1.6572-0.10329 1.6061 0.3059 3.171 2.0252 3.8067 1.2061 0.4187 2.2175 0.2869 3.3945 0.3134 2.0524 0.0901 4.0448-0.4637 4.4796-2.4982 0.609 2.5638 3.2086 2.5463 5.3204 2.4982 2.7823 0.1278 4.7024-0.9368 4.5798-3.7329zm-12.899-7.6287c-0.14889-1.8665 1.8839-1.4921 3.1358-1.546 0.8939 0.05358 2.4743-0.21158 2.8003 0.88445 0.2729 2.4494-0.0297 2.8555-2.5242 2.8232-0.94713-0.07259-2.869 0.28949-3.3134-0.77077-0.14881-0.44557-0.08538-0.92893-0.09846-1.3909zm0.2606 9.2128c-0.56638 0.162-1.1652 0.1412-1.7487 0.1488-0.59786-0.0036-1.1977 0.0131-1.7948-0.0233-0.93407-0.0365-1.6776-0.3579-1.6157-1.4217 0.01574-0.5119-0.06845-1.0551 0.11822-1.5436 0.4432-0.84155 1.5978-0.6728 2.4032-0.7191 0.81712 0.01614 1.6464-0.05154 2.4536 0.10154 0.99382 0.17537 1.0564 0.91742 1.0227 1.7752-6.1e-4 0.7729 0.04085 1.416-0.83867 1.6821zm2.9212-3.6286c-0.0836 0.19457-0.14194 0.3848-0.18279 0.56614-0.18535-0.87758-0.76293-1.6189-1.5605-2.02 1.0871 0.04933 2.0387 0.04959 3.1216-8e-5 -0.7672 0.39034-1.1687 0.96486-1.3783 1.4539zm6.8788 3.6286c-0.5664 0.162-1.1652 0.1412-1.7488 0.1488-0.5978-0.0036-1.1977 0.0131-1.7947-0.0233-0.9341-0.0365-1.6776-0.3579-1.6157-1.4217 0.0157-0.5119-0.0685-1.0551 0.1182-1.5436 0.4432-0.84155 1.5978-0.6728 2.4033-0.7191 0.8171 0.01614 1.6464-0.05154 2.4536 0.10154 0.9938 0.17537 1.0563 0.91742 1.0227 1.7752-6e-4 0.7729 0.0409 1.416-0.8386 1.6821z"></path></svg>
            <p name="id">数据库会话的自动释放(正例)</p>
          </span>
          <span class="link-icon ml-[0.5em] mr-[0.25em]">
            <svg xmlns="http://www.w3.org/2000/svg" width="0.9411764705882353em" height="0.9411764705882353em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class="untouchable"><path d="m9.5652 14.45 0.72891-2.0026c-0.651 0.00713-1.3027 0.00104-1.9532 0.00179-1.0991-0.02908-3.0336 0.08306-3.605-1.0524-0.28828-0.61588-0.2054-1.3226-0.22136-1.9833 0.00663-0.74044-0.05553-1.6362 0.5758-2.1558 0.70637-0.5555 1.7411-0.56129 2.6027-0.59834 0.743-0.015 1.4884-0.00764 2.2315-0.00868 0.68471 0.01536 1.6274-0.01783 2.4184 0.16762l0.68711-1.8879c-0.0146-0.003965-0.0287-0.00841-0.0435-0.01227-0.94653-0.24905-1.9355-0.25901-2.9083-0.26688-0.78352-1.3008e-4 -1.5692-0.0063751-2.3527 0.006805-1.2709 0.027555-2.6299 0.13739-3.6978 0.89566-1.6654 1.2031-1.53 2.9573-1.5068 4.79-0.0012251 1.7732 0.89765 3.2159 2.626 3.7562 0.80589 0.26191 1.6615 0.32018 2.5036 0.34101 0.6376 0.01106 1.2763 0.01096 1.9146 0.00915z" fill="currentColor"></path><path d="m14.589 9.125h1.3099c0.02865-0.88714-0.11774-1.6826-0.45594-2.3461l-0.85392 2.3461z" fill="currentColor"></path><path d="m15.587 12.025h-2.0527l-0.80604 2.2146c1.2326-0.27362 2.3169-0.88582 2.8588-2.2146z" fill="currentColor"></path><path d="m8.394 12.025h2.0538l0.82406-2.2641c-1.2457 0.2734-2.3327 0.8901-2.8779 2.2641z" fill="currentColor"></path><path d="m8.5566 17.221 0.83571-2.2961h-1.2914c-0.025394 0.86685 0.12295 1.645 0.45565 2.2961z" fill="currentColor"></path><path d="m21.485 14.399c7e-4 -0.67593 0.0063-1.3662-0.1779-2.0223-0.58881-2.115-2.5706-2.7532-4.5608-2.8041-0.76964-0.031175-1.5416-0.02264-2.3121-0.022365l-0.72832 2.0011c0.38557-0.00297 0.77131 7.6e-4 1.1559-0.00173 1.1244 0.02284 2.8396-0.10221 3.8152 0.44616 0.82512 0.45526 0.81194 1.4036 0.80798 2.2308-0.01538 0.64171 0.05949 1.3145-0.1601 1.93-0.39418 1.0145-1.651 1.1102-2.5915 1.1694-0.7426 0.03331-1.4884 0.0209-2.2315 0.02365-0.81334-0.01641-1.9395 0.04306-2.8448-0.16914l-0.68792 1.89c0.014845 0.00401 0.02915 0.0085 0.044115 0.0124 0.94522 0.24688 1.9316 0.25913 2.9027 0.2657 0.83456-2.2e-4 1.6713 0.00786 2.5057-0.00999 2.0286-0.02122 4.1491-0.51576 4.8438-2.6752 0.2358-0.7292 0.22-1.5067 0.2196-2.2644z" fill="currentColor"></path><path d="m14.979 6.7378c0.17824-0.52033 0.90905-2.4486 1.0626-2.9514 0.05601-0.19527 0.10768-0.39984 0.08232-0.60408-0.03096-0.33264-0.36035-0.4603-0.63671-0.55464-0.20794-0.070665-0.41593-0.17228-0.63943-0.174-0.33751 0.005805-0.52152 0.33878-0.64452 0.61072-1.4256 3.8005-4.7612 13.07-6.1617 16.891-0.10636 0.34-0.29285 0.7891-0.06874 1.1109 0.1296 0.1673 0.34386 0.232 0.53431 0.3042 0.30778 0.1107 0.70325 0.3075 0.98251 0.0365 0.14514-0.1339 0.23561-0.315 0.31595-0.4926 0.10005-0.2274 0.1811-0.4632 0.26694-0.6962 0.4854-1.3337 4.3257-11.885 4.9065-13.481z" fill="currentColor"></path></svg>
          </span>
          
          <span class="icon">
            <svg type="d" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m21.15 6.85c0-2.2056-1.7944-4-4-4-4.1765-0.01989-5.4993 5.7322-1.8147 7.5629-0.263 0.63631-0.4627 1.4421-0.6559 2.2215-0.1397 0.56337-0.2841 1.1459-0.4405 1.6084-0.0728 0.2155-0.1286 0.4813-0.1891 0.4813-0.5072-0.7362-0.8126-2.2507-1.0979-3.3161-0.47879-1.5358-0.72936-4.4237-2.8018-4.558-0.77422 7e-5 -1.3844 0.52253-1.8138 1.553-0.55019 1.254-0.75064 3.2421-1.3784 4.4472-0.39648 3e-4 -0.79576 0.0045-1.1877 0.0703-0.67978 0.1073-1.3339 0.4195-1.798 0.9347-0.39707 0.4315-0.6427 0.9874-0.74275 1.5623-0.063545 0.351-0.07691 0.7094-0.07883 1.0654 0.001935 0.4718-0.01324 0.9457 0.027745 1.4163 0.09435 1.151 0.65732 2.1308 1.7281 2.6237 0.43467 0.1975 0.91053 0.2877 1.3854 0.3129 0.40096 0.0215 0.80345 0.0129 1.2048 0.0139 0.6491 2e-4 1.2891-0.0515 1.888-0.3229 0.90042-0.4067 1.4845-1.2039 1.6712-2.1666 0.0761-0.3779 0.09179-0.7654 0.09344-1.15 7.7e-4 -0.2699 0.00148-0.5413-7.8e-4 -0.8111-0.00379-0.4854-0.04143-0.9771-0.19121-1.4414-0.28748-0.9172-0.98053-1.616-1.8964-1.909 0.43984-1.1576 0.66815-2.7594 1.1268-3.8895 0.3537 0.72804 0.57113 1.7669 0.82283 2.7298 0.26567 1.0724 0.5404 2.1814 0.90896 3.0557 0.87204 2.2985 3.1124 2.7586 4.0452 0.392 0.5508-1.2642 0.7508-3.279 1.3828-4.4916 2.1142-0.10339 3.8024-1.8557 3.8024-3.995zm-12.073 8.8023c0.05605 0.2275 0.06623 0.465 0.07092 0.6983 0.00363 0.2444 0.00195 0.4906 0.00214 0.735-0.0063 0.408 0.01486 0.882-0.18359 1.2496-0.24573 0.4539-0.8026 0.501-1.2651 0.5114-0.33714 0.0058-0.67525 0.0041-1.0124 0.0018-0.46455-0.0092-1.0361-0.0245-1.3192-0.4545-0.16612-0.2552-0.19733-0.5702-0.21202-0.8673-0.01004-0.2443-0.00683-0.4906-0.0075-0.735 5.9e-4 -0.2322-0.00201-0.4664 0.01171-0.6983 0.01886-0.2936 0.06332-0.6069 0.24969-0.8453 0.34185-0.4331 1.0226-0.3889 1.5228-0.3979 0.38828 0.0035 0.77905-0.0131 1.1658 0.0285 0.49865 0.0566 0.85211 0.2621 0.97684 0.7737zm8.0732-6.8023c-2.6379-0.06696-2.6373-3.9334 0-4 2.6378 0.06697 2.6373 3.9334 0 4z" fill="currentColor"></path></svg>
            <p name="id">yield依赖项</p>
          </span>
        </div>
      
<p><strong>例子描述：</strong><br>
在 Web 应用中，使用 <code>yield</code> 创建数据库 <code>Session</code>，并在请求完成后自动关闭它，避免连接泄露。路径函数通过依赖获取数据库会话对象。</p>
<p><strong>特征对比：</strong></p>
<ul>
<li>✅ 明确体现资源创建（会话）和释放（close）</li>
<li>✅ 返回资源供业务使用（路径函数获取 session）</li>
<li>✅ 生命周期由 FastAPI 管理，自动清理</li>
<li>✅ 避免重复代码和资源泄漏</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> fastapi <span class="token keyword">import</span> FastAPI<span class="token punctuation">,</span> Depends
<span class="token keyword">from</span> sqlalchemy<span class="token punctuation">.</span>orm <span class="token keyword">import</span> Session
<span class="token keyword">from</span> sqlalchemy <span class="token keyword">import</span> create_engine
<span class="token keyword">from</span> sqlalchemy<span class="token punctuation">.</span>orm <span class="token keyword">import</span> sessionmaker

DATABASE_URL <span class="token operator">=</span> <span class="token string">"sqlite:///./test.db"</span>
engine <span class="token operator">=</span> create_engine<span class="token punctuation">(</span>DATABASE_URL<span class="token punctuation">,</span> connect_args<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"check_same_thread"</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
SessionLocal <span class="token operator">=</span> sessionmaker<span class="token punctuation">(</span>autocommit<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> autoflush<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> bind<span class="token operator">=</span>engine<span class="token punctuation">)</span>

app <span class="token operator">=</span> FastAPI<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">get_db</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    db <span class="token operator">=</span> SessionLocal<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">yield</span> db
    <span class="token keyword">finally</span><span class="token punctuation">:</span>
        db<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>get</span><span class="token punctuation">(</span><span class="token string">"/users/"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">read_users</span><span class="token punctuation">(</span>db<span class="token punctuation">:</span> Session <span class="token operator">=</span> Depends<span class="token punctuation">(</span>get_db<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> db<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">"SELECT 'user1' AS name"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

        <div class="evoldown" id="文件资源读取与自动关闭(正例)" type="e">
          <span class="icon">
            <svg type="e" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path fill="currentColor" d="m21.9 15.621c0.1248-1.8535-0.6087-3.4099-2.6058-3.8292-0.7712-0.15744-1.3921-0.13977-2.1113-0.14543-0.6323 0.0048-1.1718-0.01567-1.8401 0.03203 1.5356-0.8078 1.6998-2.205 1.6567-3.546 0.1272-2.3708-1.4685-3.666-3.7727-3.673-2.2427-0.04024-5.0463-0.27229-5.9443 1.9172-0.28083 0.6692-0.27606 1.2179-0.28202 1.6587-0.08527 1.4303 0.20687 2.9224 1.662 3.6429-2.3051-0.05275-5.3273-0.39212-6.28 1.8983-0.28073 0.66862-0.27595 1.2174-0.282 1.6572-0.10329 1.6061 0.3059 3.171 2.0252 3.8067 1.2061 0.4187 2.2175 0.2869 3.3945 0.3134 2.0524 0.0901 4.0448-0.4637 4.4796-2.4982 0.609 2.5638 3.2086 2.5463 5.3204 2.4982 2.7823 0.1278 4.7024-0.9368 4.5798-3.7329zm-12.899-7.6287c-0.14889-1.8665 1.8839-1.4921 3.1358-1.546 0.8939 0.05358 2.4743-0.21158 2.8003 0.88445 0.2729 2.4494-0.0297 2.8555-2.5242 2.8232-0.94713-0.07259-2.869 0.28949-3.3134-0.77077-0.14881-0.44557-0.08538-0.92893-0.09846-1.3909zm0.2606 9.2128c-0.56638 0.162-1.1652 0.1412-1.7487 0.1488-0.59786-0.0036-1.1977 0.0131-1.7948-0.0233-0.93407-0.0365-1.6776-0.3579-1.6157-1.4217 0.01574-0.5119-0.06845-1.0551 0.11822-1.5436 0.4432-0.84155 1.5978-0.6728 2.4032-0.7191 0.81712 0.01614 1.6464-0.05154 2.4536 0.10154 0.99382 0.17537 1.0564 0.91742 1.0227 1.7752-6.1e-4 0.7729 0.04085 1.416-0.83867 1.6821zm2.9212-3.6286c-0.0836 0.19457-0.14194 0.3848-0.18279 0.56614-0.18535-0.87758-0.76293-1.6189-1.5605-2.02 1.0871 0.04933 2.0387 0.04959 3.1216-8e-5 -0.7672 0.39034-1.1687 0.96486-1.3783 1.4539zm6.8788 3.6286c-0.5664 0.162-1.1652 0.1412-1.7488 0.1488-0.5978-0.0036-1.1977 0.0131-1.7947-0.0233-0.9341-0.0365-1.6776-0.3579-1.6157-1.4217 0.0157-0.5119-0.0685-1.0551 0.1182-1.5436 0.4432-0.84155 1.5978-0.6728 2.4033-0.7191 0.8171 0.01614 1.6464-0.05154 2.4536 0.10154 0.9938 0.17537 1.0563 0.91742 1.0227 1.7752-6e-4 0.7729 0.0409 1.416-0.8386 1.6821z"></path></svg>
            <p name="id">文件资源读取与自动关闭(正例)</p>
          </span>
          <span class="link-icon ml-[0.5em] mr-[0.25em]">
            <svg xmlns="http://www.w3.org/2000/svg" width="0.9411764705882353em" height="0.9411764705882353em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class="untouchable"><path d="m9.5652 14.45 0.72891-2.0026c-0.651 0.00713-1.3027 0.00104-1.9532 0.00179-1.0991-0.02908-3.0336 0.08306-3.605-1.0524-0.28828-0.61588-0.2054-1.3226-0.22136-1.9833 0.00663-0.74044-0.05553-1.6362 0.5758-2.1558 0.70637-0.5555 1.7411-0.56129 2.6027-0.59834 0.743-0.015 1.4884-0.00764 2.2315-0.00868 0.68471 0.01536 1.6274-0.01783 2.4184 0.16762l0.68711-1.8879c-0.0146-0.003965-0.0287-0.00841-0.0435-0.01227-0.94653-0.24905-1.9355-0.25901-2.9083-0.26688-0.78352-1.3008e-4 -1.5692-0.0063751-2.3527 0.006805-1.2709 0.027555-2.6299 0.13739-3.6978 0.89566-1.6654 1.2031-1.53 2.9573-1.5068 4.79-0.0012251 1.7732 0.89765 3.2159 2.626 3.7562 0.80589 0.26191 1.6615 0.32018 2.5036 0.34101 0.6376 0.01106 1.2763 0.01096 1.9146 0.00915z" fill="currentColor"></path><path d="m14.589 9.125h1.3099c0.02865-0.88714-0.11774-1.6826-0.45594-2.3461l-0.85392 2.3461z" fill="currentColor"></path><path d="m15.587 12.025h-2.0527l-0.80604 2.2146c1.2326-0.27362 2.3169-0.88582 2.8588-2.2146z" fill="currentColor"></path><path d="m8.394 12.025h2.0538l0.82406-2.2641c-1.2457 0.2734-2.3327 0.8901-2.8779 2.2641z" fill="currentColor"></path><path d="m8.5566 17.221 0.83571-2.2961h-1.2914c-0.025394 0.86685 0.12295 1.645 0.45565 2.2961z" fill="currentColor"></path><path d="m21.485 14.399c7e-4 -0.67593 0.0063-1.3662-0.1779-2.0223-0.58881-2.115-2.5706-2.7532-4.5608-2.8041-0.76964-0.031175-1.5416-0.02264-2.3121-0.022365l-0.72832 2.0011c0.38557-0.00297 0.77131 7.6e-4 1.1559-0.00173 1.1244 0.02284 2.8396-0.10221 3.8152 0.44616 0.82512 0.45526 0.81194 1.4036 0.80798 2.2308-0.01538 0.64171 0.05949 1.3145-0.1601 1.93-0.39418 1.0145-1.651 1.1102-2.5915 1.1694-0.7426 0.03331-1.4884 0.0209-2.2315 0.02365-0.81334-0.01641-1.9395 0.04306-2.8448-0.16914l-0.68792 1.89c0.014845 0.00401 0.02915 0.0085 0.044115 0.0124 0.94522 0.24688 1.9316 0.25913 2.9027 0.2657 0.83456-2.2e-4 1.6713 0.00786 2.5057-0.00999 2.0286-0.02122 4.1491-0.51576 4.8438-2.6752 0.2358-0.7292 0.22-1.5067 0.2196-2.2644z" fill="currentColor"></path><path d="m14.979 6.7378c0.17824-0.52033 0.90905-2.4486 1.0626-2.9514 0.05601-0.19527 0.10768-0.39984 0.08232-0.60408-0.03096-0.33264-0.36035-0.4603-0.63671-0.55464-0.20794-0.070665-0.41593-0.17228-0.63943-0.174-0.33751 0.005805-0.52152 0.33878-0.64452 0.61072-1.4256 3.8005-4.7612 13.07-6.1617 16.891-0.10636 0.34-0.29285 0.7891-0.06874 1.1109 0.1296 0.1673 0.34386 0.232 0.53431 0.3042 0.30778 0.1107 0.70325 0.3075 0.98251 0.0365 0.14514-0.1339 0.23561-0.315 0.31595-0.4926 0.10005-0.2274 0.1811-0.4632 0.26694-0.6962 0.4854-1.3337 4.3257-11.885 4.9065-13.481z" fill="currentColor"></path></svg>
          </span>
          
          <span class="icon">
            <svg type="d" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m21.15 6.85c0-2.2056-1.7944-4-4-4-4.1765-0.01989-5.4993 5.7322-1.8147 7.5629-0.263 0.63631-0.4627 1.4421-0.6559 2.2215-0.1397 0.56337-0.2841 1.1459-0.4405 1.6084-0.0728 0.2155-0.1286 0.4813-0.1891 0.4813-0.5072-0.7362-0.8126-2.2507-1.0979-3.3161-0.47879-1.5358-0.72936-4.4237-2.8018-4.558-0.77422 7e-5 -1.3844 0.52253-1.8138 1.553-0.55019 1.254-0.75064 3.2421-1.3784 4.4472-0.39648 3e-4 -0.79576 0.0045-1.1877 0.0703-0.67978 0.1073-1.3339 0.4195-1.798 0.9347-0.39707 0.4315-0.6427 0.9874-0.74275 1.5623-0.063545 0.351-0.07691 0.7094-0.07883 1.0654 0.001935 0.4718-0.01324 0.9457 0.027745 1.4163 0.09435 1.151 0.65732 2.1308 1.7281 2.6237 0.43467 0.1975 0.91053 0.2877 1.3854 0.3129 0.40096 0.0215 0.80345 0.0129 1.2048 0.0139 0.6491 2e-4 1.2891-0.0515 1.888-0.3229 0.90042-0.4067 1.4845-1.2039 1.6712-2.1666 0.0761-0.3779 0.09179-0.7654 0.09344-1.15 7.7e-4 -0.2699 0.00148-0.5413-7.8e-4 -0.8111-0.00379-0.4854-0.04143-0.9771-0.19121-1.4414-0.28748-0.9172-0.98053-1.616-1.8964-1.909 0.43984-1.1576 0.66815-2.7594 1.1268-3.8895 0.3537 0.72804 0.57113 1.7669 0.82283 2.7298 0.26567 1.0724 0.5404 2.1814 0.90896 3.0557 0.87204 2.2985 3.1124 2.7586 4.0452 0.392 0.5508-1.2642 0.7508-3.279 1.3828-4.4916 2.1142-0.10339 3.8024-1.8557 3.8024-3.995zm-12.073 8.8023c0.05605 0.2275 0.06623 0.465 0.07092 0.6983 0.00363 0.2444 0.00195 0.4906 0.00214 0.735-0.0063 0.408 0.01486 0.882-0.18359 1.2496-0.24573 0.4539-0.8026 0.501-1.2651 0.5114-0.33714 0.0058-0.67525 0.0041-1.0124 0.0018-0.46455-0.0092-1.0361-0.0245-1.3192-0.4545-0.16612-0.2552-0.19733-0.5702-0.21202-0.8673-0.01004-0.2443-0.00683-0.4906-0.0075-0.735 5.9e-4 -0.2322-0.00201-0.4664 0.01171-0.6983 0.01886-0.2936 0.06332-0.6069 0.24969-0.8453 0.34185-0.4331 1.0226-0.3889 1.5228-0.3979 0.38828 0.0035 0.77905-0.0131 1.1658 0.0285 0.49865 0.0566 0.85211 0.2621 0.97684 0.7737zm8.0732-6.8023c-2.6379-0.06696-2.6373-3.9334 0-4 2.6378 0.06697 2.6373 3.9334 0 4z" fill="currentColor"></path></svg>
            <p name="id">yield依赖项</p>
          </span>
        </div>
      
<p><strong>例子描述：</strong><br>
在大数据接口中，用 <code>yield</code> 打开一个只读文件作为数据源，在返回数据后自动关闭文件句柄，避免文件占用。</p>
<p><strong>特征对比：</strong></p>
<ul>
<li>✅ 创建文件对象供业务使用（<code>yield file</code>）</li>
<li>✅ 在请求处理完成后关闭资源</li>
<li>✅ 支持大数据文件按需打开与关闭</li>
<li>✅ 保持系统资源可控和安全</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> fastapi <span class="token keyword">import</span> FastAPI<span class="token punctuation">,</span> Depends

app <span class="token operator">=</span> FastAPI<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">get_file</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"data.txt"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">yield</span> f
    <span class="token keyword">finally</span><span class="token punctuation">:</span>
        f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>get</span><span class="token punctuation">(</span><span class="token string">"/data"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">read_data</span><span class="token punctuation">(</span><span class="token builtin">file</span> <span class="token operator">=</span> Depends<span class="token punctuation">(</span>get_file<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token string">"lines"</span><span class="token punctuation">:</span> <span class="token builtin">file</span><span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

        <div class="evoldown" id="副作用控制误用yield(反例)" type="e">
          <span class="icon">
            <svg type="e" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path fill="currentColor" d="m21.9 15.621c0.1248-1.8535-0.6087-3.4099-2.6058-3.8292-0.7712-0.15744-1.3921-0.13977-2.1113-0.14543-0.6323 0.0048-1.1718-0.01567-1.8401 0.03203 1.5356-0.8078 1.6998-2.205 1.6567-3.546 0.1272-2.3708-1.4685-3.666-3.7727-3.673-2.2427-0.04024-5.0463-0.27229-5.9443 1.9172-0.28083 0.6692-0.27606 1.2179-0.28202 1.6587-0.08527 1.4303 0.20687 2.9224 1.662 3.6429-2.3051-0.05275-5.3273-0.39212-6.28 1.8983-0.28073 0.66862-0.27595 1.2174-0.282 1.6572-0.10329 1.6061 0.3059 3.171 2.0252 3.8067 1.2061 0.4187 2.2175 0.2869 3.3945 0.3134 2.0524 0.0901 4.0448-0.4637 4.4796-2.4982 0.609 2.5638 3.2086 2.5463 5.3204 2.4982 2.7823 0.1278 4.7024-0.9368 4.5798-3.7329zm-12.899-7.6287c-0.14889-1.8665 1.8839-1.4921 3.1358-1.546 0.8939 0.05358 2.4743-0.21158 2.8003 0.88445 0.2729 2.4494-0.0297 2.8555-2.5242 2.8232-0.94713-0.07259-2.869 0.28949-3.3134-0.77077-0.14881-0.44557-0.08538-0.92893-0.09846-1.3909zm0.2606 9.2128c-0.56638 0.162-1.1652 0.1412-1.7487 0.1488-0.59786-0.0036-1.1977 0.0131-1.7948-0.0233-0.93407-0.0365-1.6776-0.3579-1.6157-1.4217 0.01574-0.5119-0.06845-1.0551 0.11822-1.5436 0.4432-0.84155 1.5978-0.6728 2.4032-0.7191 0.81712 0.01614 1.6464-0.05154 2.4536 0.10154 0.99382 0.17537 1.0564 0.91742 1.0227 1.7752-6.1e-4 0.7729 0.04085 1.416-0.83867 1.6821zm2.9212-3.6286c-0.0836 0.19457-0.14194 0.3848-0.18279 0.56614-0.18535-0.87758-0.76293-1.6189-1.5605-2.02 1.0871 0.04933 2.0387 0.04959 3.1216-8e-5 -0.7672 0.39034-1.1687 0.96486-1.3783 1.4539zm6.8788 3.6286c-0.5664 0.162-1.1652 0.1412-1.7488 0.1488-0.5978-0.0036-1.1977 0.0131-1.7947-0.0233-0.9341-0.0365-1.6776-0.3579-1.6157-1.4217 0.0157-0.5119-0.0685-1.0551 0.1182-1.5436 0.4432-0.84155 1.5978-0.6728 2.4033-0.7191 0.8171 0.01614 1.6464-0.05154 2.4536 0.10154 0.9938 0.17537 1.0563 0.91742 1.0227 1.7752-6e-4 0.7729 0.0409 1.416-0.8386 1.6821z"></path></svg>
            <p name="id">副作用控制误用yield(反例)</p>
          </span>
          <span class="link-icon ml-[0.5em] mr-[0.25em]">
            <svg xmlns="http://www.w3.org/2000/svg" width="0.9411764705882353em" height="0.9411764705882353em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class="untouchable"><path d="m9.5652 14.45 0.72891-2.0026c-0.651 0.00713-1.3027 0.00104-1.9532 0.00179-1.0991-0.02908-3.0336 0.08306-3.605-1.0524-0.28828-0.61588-0.2054-1.3226-0.22136-1.9833 0.00663-0.74044-0.05553-1.6362 0.5758-2.1558 0.70637-0.5555 1.7411-0.56129 2.6027-0.59834 0.743-0.015 1.4884-0.00764 2.2315-0.00868 0.68471 0.01536 1.6274-0.01783 2.4184 0.16762l0.68711-1.8879c-0.0146-0.003965-0.0287-0.00841-0.0435-0.01227-0.94653-0.24905-1.9355-0.25901-2.9083-0.26688-0.78352-1.3008e-4 -1.5692-0.0063751-2.3527 0.006805-1.2709 0.027555-2.6299 0.13739-3.6978 0.89566-1.6654 1.2031-1.53 2.9573-1.5068 4.79-0.0012251 1.7732 0.89765 3.2159 2.626 3.7562 0.80589 0.26191 1.6615 0.32018 2.5036 0.34101 0.6376 0.01106 1.2763 0.01096 1.9146 0.00915z" fill="currentColor"></path><path d="m14.589 9.125h1.3099c0.02865-0.88714-0.11774-1.6826-0.45594-2.3461l-0.85392 2.3461z" fill="currentColor"></path><path d="m15.587 12.025h-2.0527l-0.80604 2.2146c1.2326-0.27362 2.3169-0.88582 2.8588-2.2146z" fill="currentColor"></path><path d="m8.394 12.025h2.0538l0.82406-2.2641c-1.2457 0.2734-2.3327 0.8901-2.8779 2.2641z" fill="currentColor"></path><path d="m8.5566 17.221 0.83571-2.2961h-1.2914c-0.025394 0.86685 0.12295 1.645 0.45565 2.2961z" fill="currentColor"></path><path d="m21.485 14.399c7e-4 -0.67593 0.0063-1.3662-0.1779-2.0223-0.58881-2.115-2.5706-2.7532-4.5608-2.8041-0.76964-0.031175-1.5416-0.02264-2.3121-0.022365l-0.72832 2.0011c0.38557-0.00297 0.77131 7.6e-4 1.1559-0.00173 1.1244 0.02284 2.8396-0.10221 3.8152 0.44616 0.82512 0.45526 0.81194 1.4036 0.80798 2.2308-0.01538 0.64171 0.05949 1.3145-0.1601 1.93-0.39418 1.0145-1.651 1.1102-2.5915 1.1694-0.7426 0.03331-1.4884 0.0209-2.2315 0.02365-0.81334-0.01641-1.9395 0.04306-2.8448-0.16914l-0.68792 1.89c0.014845 0.00401 0.02915 0.0085 0.044115 0.0124 0.94522 0.24688 1.9316 0.25913 2.9027 0.2657 0.83456-2.2e-4 1.6713 0.00786 2.5057-0.00999 2.0286-0.02122 4.1491-0.51576 4.8438-2.6752 0.2358-0.7292 0.22-1.5067 0.2196-2.2644z" fill="currentColor"></path><path d="m14.979 6.7378c0.17824-0.52033 0.90905-2.4486 1.0626-2.9514 0.05601-0.19527 0.10768-0.39984 0.08232-0.60408-0.03096-0.33264-0.36035-0.4603-0.63671-0.55464-0.20794-0.070665-0.41593-0.17228-0.63943-0.174-0.33751 0.005805-0.52152 0.33878-0.64452 0.61072-1.4256 3.8005-4.7612 13.07-6.1617 16.891-0.10636 0.34-0.29285 0.7891-0.06874 1.1109 0.1296 0.1673 0.34386 0.232 0.53431 0.3042 0.30778 0.1107 0.70325 0.3075 0.98251 0.0365 0.14514-0.1339 0.23561-0.315 0.31595-0.4926 0.10005-0.2274 0.1811-0.4632 0.26694-0.6962 0.4854-1.3337 4.3257-11.885 4.9065-13.481z" fill="currentColor"></path></svg>
          </span>
          
          <span class="icon">
            <svg type="d" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m21.15 6.85c0-2.2056-1.7944-4-4-4-4.1765-0.01989-5.4993 5.7322-1.8147 7.5629-0.263 0.63631-0.4627 1.4421-0.6559 2.2215-0.1397 0.56337-0.2841 1.1459-0.4405 1.6084-0.0728 0.2155-0.1286 0.4813-0.1891 0.4813-0.5072-0.7362-0.8126-2.2507-1.0979-3.3161-0.47879-1.5358-0.72936-4.4237-2.8018-4.558-0.77422 7e-5 -1.3844 0.52253-1.8138 1.553-0.55019 1.254-0.75064 3.2421-1.3784 4.4472-0.39648 3e-4 -0.79576 0.0045-1.1877 0.0703-0.67978 0.1073-1.3339 0.4195-1.798 0.9347-0.39707 0.4315-0.6427 0.9874-0.74275 1.5623-0.063545 0.351-0.07691 0.7094-0.07883 1.0654 0.001935 0.4718-0.01324 0.9457 0.027745 1.4163 0.09435 1.151 0.65732 2.1308 1.7281 2.6237 0.43467 0.1975 0.91053 0.2877 1.3854 0.3129 0.40096 0.0215 0.80345 0.0129 1.2048 0.0139 0.6491 2e-4 1.2891-0.0515 1.888-0.3229 0.90042-0.4067 1.4845-1.2039 1.6712-2.1666 0.0761-0.3779 0.09179-0.7654 0.09344-1.15 7.7e-4 -0.2699 0.00148-0.5413-7.8e-4 -0.8111-0.00379-0.4854-0.04143-0.9771-0.19121-1.4414-0.28748-0.9172-0.98053-1.616-1.8964-1.909 0.43984-1.1576 0.66815-2.7594 1.1268-3.8895 0.3537 0.72804 0.57113 1.7669 0.82283 2.7298 0.26567 1.0724 0.5404 2.1814 0.90896 3.0557 0.87204 2.2985 3.1124 2.7586 4.0452 0.392 0.5508-1.2642 0.7508-3.279 1.3828-4.4916 2.1142-0.10339 3.8024-1.8557 3.8024-3.995zm-12.073 8.8023c0.05605 0.2275 0.06623 0.465 0.07092 0.6983 0.00363 0.2444 0.00195 0.4906 0.00214 0.735-0.0063 0.408 0.01486 0.882-0.18359 1.2496-0.24573 0.4539-0.8026 0.501-1.2651 0.5114-0.33714 0.0058-0.67525 0.0041-1.0124 0.0018-0.46455-0.0092-1.0361-0.0245-1.3192-0.4545-0.16612-0.2552-0.19733-0.5702-0.21202-0.8673-0.01004-0.2443-0.00683-0.4906-0.0075-0.735 5.9e-4 -0.2322-0.00201-0.4664 0.01171-0.6983 0.01886-0.2936 0.06332-0.6069 0.24969-0.8453 0.34185-0.4331 1.0226-0.3889 1.5228-0.3979 0.38828 0.0035 0.77905-0.0131 1.1658 0.0285 0.49865 0.0566 0.85211 0.2621 0.97684 0.7737zm8.0732-6.8023c-2.6379-0.06696-2.6373-3.9334 0-4 2.6378 0.06697 2.6373 3.9334 0 4z" fill="currentColor"></path></svg>
            <p name="id">yield依赖项</p>
          </span>
        </div>
      
<p><strong>例子描述：</strong><br>
在权限验证中使用 <code>yield</code> 返回 <code>True</code>，而不是直接抛异常或执行副作用逻辑。这样使得本应是检查行为变成了资源依赖，导致逻辑不清晰，也无任何清理行为。</p>
<p><strong>特征对比：</strong></p>
<ul>
<li>❌ 无资源需要释放，不应使用 <code>yield</code></li>
<li>❌ 不具备生命周期管理的必要性</li>
<li>❌ <code>yield</code> 后代码形同多余，违背设计目的</li>
<li>❌ 模糊副作用逻辑与资源依赖逻辑的边界</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> fastapi <span class="token keyword">import</span> FastAPI<span class="token punctuation">,</span> Depends<span class="token punctuation">,</span> HTTPException

app <span class="token operator">=</span> FastAPI<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 错误示范：使用 yield 进行权限验证</span>
<span class="token keyword">def</span> <span class="token function">check_admin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 模拟权限检查逻辑</span>
    user_is_admin <span class="token operator">=</span> <span class="token boolean">False</span>  <span class="token comment"># 假设当前用户不是管理员</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> user_is_admin<span class="token punctuation">:</span>
        <span class="token keyword">raise</span> HTTPException<span class="token punctuation">(</span>status_code<span class="token operator">=</span><span class="token number">403</span><span class="token punctuation">,</span> detail<span class="token operator">=</span><span class="token string">"Not authorized"</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 没有真正资源返回，但仍使用 yield —— 这是误用</span>
    <span class="token keyword">yield</span> <span class="token boolean">True</span>

    <span class="token comment"># 这段清理逻辑实际上无任何意义</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"This cleanup is meaningless"</span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>get</span><span class="token punctuation">(</span><span class="token string">"/admin"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">get_admin_data</span><span class="token punctuation">(</span>allowed<span class="token punctuation">:</span> <span class="token builtin">bool</span> <span class="token operator">=</span> Depends<span class="token punctuation">(</span>check_admin<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token string">"data"</span><span class="token punctuation">:</span> <span class="token string">"secret admin info"</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

        <div class="evoldown" id="yield子依赖项" type="d">
          <span class="icon">
            <svg type="d" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m21.15 6.85c0-2.2056-1.7944-4-4-4-4.1765-0.01989-5.4993 5.7322-1.8147 7.5629-0.263 0.63631-0.4627 1.4421-0.6559 2.2215-0.1397 0.56337-0.2841 1.1459-0.4405 1.6084-0.0728 0.2155-0.1286 0.4813-0.1891 0.4813-0.5072-0.7362-0.8126-2.2507-1.0979-3.3161-0.47879-1.5358-0.72936-4.4237-2.8018-4.558-0.77422 7e-5 -1.3844 0.52253-1.8138 1.553-0.55019 1.254-0.75064 3.2421-1.3784 4.4472-0.39648 3e-4 -0.79576 0.0045-1.1877 0.0703-0.67978 0.1073-1.3339 0.4195-1.798 0.9347-0.39707 0.4315-0.6427 0.9874-0.74275 1.5623-0.063545 0.351-0.07691 0.7094-0.07883 1.0654 0.001935 0.4718-0.01324 0.9457 0.027745 1.4163 0.09435 1.151 0.65732 2.1308 1.7281 2.6237 0.43467 0.1975 0.91053 0.2877 1.3854 0.3129 0.40096 0.0215 0.80345 0.0129 1.2048 0.0139 0.6491 2e-4 1.2891-0.0515 1.888-0.3229 0.90042-0.4067 1.4845-1.2039 1.6712-2.1666 0.0761-0.3779 0.09179-0.7654 0.09344-1.15 7.7e-4 -0.2699 0.00148-0.5413-7.8e-4 -0.8111-0.00379-0.4854-0.04143-0.9771-0.19121-1.4414-0.28748-0.9172-0.98053-1.616-1.8964-1.909 0.43984-1.1576 0.66815-2.7594 1.1268-3.8895 0.3537 0.72804 0.57113 1.7669 0.82283 2.7298 0.26567 1.0724 0.5404 2.1814 0.90896 3.0557 0.87204 2.2985 3.1124 2.7586 4.0452 0.392 0.5508-1.2642 0.7508-3.279 1.3828-4.4916 2.1142-0.10339 3.8024-1.8557 3.8024-3.995zm-12.073 8.8023c0.05605 0.2275 0.06623 0.465 0.07092 0.6983 0.00363 0.2444 0.00195 0.4906 0.00214 0.735-0.0063 0.408 0.01486 0.882-0.18359 1.2496-0.24573 0.4539-0.8026 0.501-1.2651 0.5114-0.33714 0.0058-0.67525 0.0041-1.0124 0.0018-0.46455-0.0092-1.0361-0.0245-1.3192-0.4545-0.16612-0.2552-0.19733-0.5702-0.21202-0.8673-0.01004-0.2443-0.00683-0.4906-0.0075-0.735 5.9e-4 -0.2322-0.00201-0.4664 0.01171-0.6983 0.01886-0.2936 0.06332-0.6069 0.24969-0.8453 0.34185-0.4331 1.0226-0.3889 1.5228-0.3979 0.38828 0.0035 0.77905-0.0131 1.1658 0.0285 0.49865 0.0566 0.85211 0.2621 0.97684 0.7737zm8.0732-6.8023c-2.6379-0.06696-2.6373-3.9334 0-4 2.6378 0.06697 2.6373 3.9334 0 4z" fill="currentColor"></path></svg>
            <p name="id">yield子依赖项</p>
          </span>
        </div>
      
<p><strong>yield 子依赖项</strong>指的是一个依赖项使用 <code>yield</code> 语法定义资源清理逻辑，并且<strong>被其他依赖项间接调用</strong>，即作为“子依赖项”存在。FastAPI 会递归解析依赖树，确保在整个请求生命周期中，<strong>即使 <code>yield</code> 发生在子依赖中，其清理逻辑仍然会被执行</strong>。这使得在复杂资源链或中间逻辑中能进行自动清理。</p>
<p><strong>重要特征：</strong></p>
<ul>
<li><strong>特征1：清理逻辑位于子层但自动执行</strong><br>
即使 <code>yield</code> 定义在子依赖中，FastAPI 会在请求完成后自动调用其 <code>finally</code> 部分。</li>
<li><strong>特征2：支持依赖链中多级嵌套调用</strong><br>
<code>yield</code> 可以在依赖链中任何一层安全使用，不必直接绑定在路径函数上。</li>
<li><strong>特征3：通常用于资源初始化/封装结构</strong><br>
比如数据库连接 → service 封装 → handler，<code>yield</code> 只需在最底层。</li>
<li><strong>特征4：不应将纯逻辑验证误用为 <code>yield</code> 子依赖</strong><br>
因为没有资源需要清理，会增加无意义的生命周期负担。</li>
</ul>

        <div class="evoldown" id="三个yield子依赖(正例)" type="e">
          <span class="icon">
            <svg type="e" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path fill="currentColor" d="m21.9 15.621c0.1248-1.8535-0.6087-3.4099-2.6058-3.8292-0.7712-0.15744-1.3921-0.13977-2.1113-0.14543-0.6323 0.0048-1.1718-0.01567-1.8401 0.03203 1.5356-0.8078 1.6998-2.205 1.6567-3.546 0.1272-2.3708-1.4685-3.666-3.7727-3.673-2.2427-0.04024-5.0463-0.27229-5.9443 1.9172-0.28083 0.6692-0.27606 1.2179-0.28202 1.6587-0.08527 1.4303 0.20687 2.9224 1.662 3.6429-2.3051-0.05275-5.3273-0.39212-6.28 1.8983-0.28073 0.66862-0.27595 1.2174-0.282 1.6572-0.10329 1.6061 0.3059 3.171 2.0252 3.8067 1.2061 0.4187 2.2175 0.2869 3.3945 0.3134 2.0524 0.0901 4.0448-0.4637 4.4796-2.4982 0.609 2.5638 3.2086 2.5463 5.3204 2.4982 2.7823 0.1278 4.7024-0.9368 4.5798-3.7329zm-12.899-7.6287c-0.14889-1.8665 1.8839-1.4921 3.1358-1.546 0.8939 0.05358 2.4743-0.21158 2.8003 0.88445 0.2729 2.4494-0.0297 2.8555-2.5242 2.8232-0.94713-0.07259-2.869 0.28949-3.3134-0.77077-0.14881-0.44557-0.08538-0.92893-0.09846-1.3909zm0.2606 9.2128c-0.56638 0.162-1.1652 0.1412-1.7487 0.1488-0.59786-0.0036-1.1977 0.0131-1.7948-0.0233-0.93407-0.0365-1.6776-0.3579-1.6157-1.4217 0.01574-0.5119-0.06845-1.0551 0.11822-1.5436 0.4432-0.84155 1.5978-0.6728 2.4032-0.7191 0.81712 0.01614 1.6464-0.05154 2.4536 0.10154 0.99382 0.17537 1.0564 0.91742 1.0227 1.7752-6.1e-4 0.7729 0.04085 1.416-0.83867 1.6821zm2.9212-3.6286c-0.0836 0.19457-0.14194 0.3848-0.18279 0.56614-0.18535-0.87758-0.76293-1.6189-1.5605-2.02 1.0871 0.04933 2.0387 0.04959 3.1216-8e-5 -0.7672 0.39034-1.1687 0.96486-1.3783 1.4539zm6.8788 3.6286c-0.5664 0.162-1.1652 0.1412-1.7488 0.1488-0.5978-0.0036-1.1977 0.0131-1.7947-0.0233-0.9341-0.0365-1.6776-0.3579-1.6157-1.4217 0.0157-0.5119-0.0685-1.0551 0.1182-1.5436 0.4432-0.84155 1.5978-0.6728 2.4033-0.7191 0.8171 0.01614 1.6464-0.05154 2.4536 0.10154 0.9938 0.17537 1.0563 0.91742 1.0227 1.7752-6e-4 0.7729 0.0409 1.416-0.8386 1.6821z"></path></svg>
            <p name="id">三个yield子依赖(正例)</p>
          </span>
        </div>
      
<p>声明任意数量和层级的树状依赖，而且它们中的任何一个或所有的都可以使用&nbsp;<code>yield</code>。<strong>FastAPI</strong>&nbsp;会确保每个带有&nbsp;<code>yield</code>&nbsp;的依赖中的"退出代码"按正确顺序运行。例如，<code>dependency_c</code>&nbsp;可以依赖于&nbsp;<code>dependency_b</code>，而&nbsp;<code>dependency_b</code>&nbsp;则依赖于&nbsp;<code>dependency_a</code>。</p>
<p>在这种情况下，<code>dependency_c</code>&nbsp;在执行其退出代码时需要&nbsp;<code>dependency_b</code>（此处称为&nbsp;<code>dep_b</code>）的值仍然可用。而&nbsp;<code>dependency_b</code>&nbsp;反过来则需要&nbsp;<code>dependency_a</code>（此处称为&nbsp;<code>dep_a</code>&nbsp;）的值在其退出代码中可用。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> typing <span class="token keyword">import</span> Annotated

<span class="token keyword">from</span> fastapi <span class="token keyword">import</span> Depends


<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">dependency_a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    dep_a <span class="token operator">=</span> generate_dep_a<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">yield</span> dep_a
    <span class="token keyword">finally</span><span class="token punctuation">:</span>
        dep_a<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">dependency_b</span><span class="token punctuation">(</span>dep_a<span class="token punctuation">:</span> Annotated<span class="token punctuation">[</span>DepA<span class="token punctuation">,</span> Depends<span class="token punctuation">(</span>dependency_a<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    dep_b <span class="token operator">=</span> generate_dep_b<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">yield</span> dep_b
    <span class="token keyword">finally</span><span class="token punctuation">:</span>
        dep_b<span class="token punctuation">.</span>close<span class="token punctuation">(</span>dep_a<span class="token punctuation">)</span>


<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">dependency_c</span><span class="token punctuation">(</span>dep_b<span class="token punctuation">:</span> Annotated<span class="token punctuation">[</span>DepB<span class="token punctuation">,</span> Depends<span class="token punctuation">(</span>dependency_b<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    dep_c <span class="token operator">=</span> generate_dep_c<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">yield</span> dep_c
    <span class="token keyword">finally</span><span class="token punctuation">:</span>
        dep_c<span class="token punctuation">.</span>close<span class="token punctuation">(</span>dep_b<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

        <div class="evoldown" id="数据库会话在子依赖中清理(正例)" type="e">
          <span class="icon">
            <svg type="e" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path fill="currentColor" d="m21.9 15.621c0.1248-1.8535-0.6087-3.4099-2.6058-3.8292-0.7712-0.15744-1.3921-0.13977-2.1113-0.14543-0.6323 0.0048-1.1718-0.01567-1.8401 0.03203 1.5356-0.8078 1.6998-2.205 1.6567-3.546 0.1272-2.3708-1.4685-3.666-3.7727-3.673-2.2427-0.04024-5.0463-0.27229-5.9443 1.9172-0.28083 0.6692-0.27606 1.2179-0.28202 1.6587-0.08527 1.4303 0.20687 2.9224 1.662 3.6429-2.3051-0.05275-5.3273-0.39212-6.28 1.8983-0.28073 0.66862-0.27595 1.2174-0.282 1.6572-0.10329 1.6061 0.3059 3.171 2.0252 3.8067 1.2061 0.4187 2.2175 0.2869 3.3945 0.3134 2.0524 0.0901 4.0448-0.4637 4.4796-2.4982 0.609 2.5638 3.2086 2.5463 5.3204 2.4982 2.7823 0.1278 4.7024-0.9368 4.5798-3.7329zm-12.899-7.6287c-0.14889-1.8665 1.8839-1.4921 3.1358-1.546 0.8939 0.05358 2.4743-0.21158 2.8003 0.88445 0.2729 2.4494-0.0297 2.8555-2.5242 2.8232-0.94713-0.07259-2.869 0.28949-3.3134-0.77077-0.14881-0.44557-0.08538-0.92893-0.09846-1.3909zm0.2606 9.2128c-0.56638 0.162-1.1652 0.1412-1.7487 0.1488-0.59786-0.0036-1.1977 0.0131-1.7948-0.0233-0.93407-0.0365-1.6776-0.3579-1.6157-1.4217 0.01574-0.5119-0.06845-1.0551 0.11822-1.5436 0.4432-0.84155 1.5978-0.6728 2.4032-0.7191 0.81712 0.01614 1.6464-0.05154 2.4536 0.10154 0.99382 0.17537 1.0564 0.91742 1.0227 1.7752-6.1e-4 0.7729 0.04085 1.416-0.83867 1.6821zm2.9212-3.6286c-0.0836 0.19457-0.14194 0.3848-0.18279 0.56614-0.18535-0.87758-0.76293-1.6189-1.5605-2.02 1.0871 0.04933 2.0387 0.04959 3.1216-8e-5 -0.7672 0.39034-1.1687 0.96486-1.3783 1.4539zm6.8788 3.6286c-0.5664 0.162-1.1652 0.1412-1.7488 0.1488-0.5978-0.0036-1.1977 0.0131-1.7947-0.0233-0.9341-0.0365-1.6776-0.3579-1.6157-1.4217 0.0157-0.5119-0.0685-1.0551 0.1182-1.5436 0.4432-0.84155 1.5978-0.6728 2.4033-0.7191 0.8171 0.01614 1.6464-0.05154 2.4536 0.10154 0.9938 0.17537 1.0563 0.91742 1.0227 1.7752-6e-4 0.7729 0.0409 1.416-0.8386 1.6821z"></path></svg>
            <p name="id">数据库会话在子依赖中清理(正例)</p>
          </span>
        </div>
      
<p><strong>例子描述：</strong><br>
在服务层中封装业务逻辑，这一服务依赖数据库会话。数据库连接通过 <code>yield</code> 创建并在子依赖中释放，路径函数只接收 service 实例，间接完成数据库的生命周期管理。</p>
<p><strong>特征对比：</strong></p>
<ul>
<li>✅ <code>yield</code> 在子层完成资源创建与清理</li>
<li>✅ 清理逻辑被 FastAPI 自动追踪执行</li>
<li>✅ 路径函数无感知底层依赖细节</li>
<li>✅ 结构清晰，符合资源生命周期原则</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> fastapi <span class="token keyword">import</span> FastAPI<span class="token punctuation">,</span> Depends
<span class="token keyword">from</span> sqlalchemy<span class="token punctuation">.</span>orm <span class="token keyword">import</span> Session
<span class="token keyword">from</span> sqlalchemy <span class="token keyword">import</span> create_engine
<span class="token keyword">from</span> sqlalchemy<span class="token punctuation">.</span>orm <span class="token keyword">import</span> sessionmaker

DATABASE_URL <span class="token operator">=</span> <span class="token string">"sqlite:///./test.db"</span>
engine <span class="token operator">=</span> create_engine<span class="token punctuation">(</span>DATABASE_URL<span class="token punctuation">,</span> connect_args<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"check_same_thread"</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
SessionLocal <span class="token operator">=</span> sessionmaker<span class="token punctuation">(</span>bind<span class="token operator">=</span>engine<span class="token punctuation">)</span>

app <span class="token operator">=</span> FastAPI<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># yield 子依赖：数据库会话</span>
<span class="token keyword">def</span> <span class="token function">get_db</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    db <span class="token operator">=</span> SessionLocal<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">yield</span> db
    <span class="token keyword">finally</span><span class="token punctuation">:</span>
        db<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 子依赖：业务服务层</span>
<span class="token keyword">class</span> <span class="token class-name">UserService</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> db<span class="token punctuation">:</span> Session<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>db <span class="token operator">=</span> db

    <span class="token keyword">def</span> <span class="token function">get_users</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>db<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">"SELECT 'user1' AS name"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">get_user_service</span><span class="token punctuation">(</span>db<span class="token punctuation">:</span> Session <span class="token operator">=</span> Depends<span class="token punctuation">(</span>get_db<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> UserService<span class="token punctuation">(</span>db<span class="token punctuation">)</span>

<span class="token comment"># 路径函数：只依赖 service，db 在子层清理</span>
<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>get</span><span class="token punctuation">(</span><span class="token string">"/users"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">read_users</span><span class="token punctuation">(</span>service<span class="token punctuation">:</span> UserService <span class="token operator">=</span> Depends<span class="token punctuation">(</span>get_user_service<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> service<span class="token punctuation">.</span>get_users<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="mermaid">graph TD
    A[read_users 路径函数] --&gt; B[get_user_service]
    B --&gt; C[get_db]
    C --&gt; D[(yield 创建 DB 会话)]
    C --&gt; E[(finally 关闭 DB 会话)]</pre>

        <div class="evoldown" id="文件句柄子依赖于数据处理器(正例)" type="e">
          <span class="icon">
            <svg type="e" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path fill="currentColor" d="m21.9 15.621c0.1248-1.8535-0.6087-3.4099-2.6058-3.8292-0.7712-0.15744-1.3921-0.13977-2.1113-0.14543-0.6323 0.0048-1.1718-0.01567-1.8401 0.03203 1.5356-0.8078 1.6998-2.205 1.6567-3.546 0.1272-2.3708-1.4685-3.666-3.7727-3.673-2.2427-0.04024-5.0463-0.27229-5.9443 1.9172-0.28083 0.6692-0.27606 1.2179-0.28202 1.6587-0.08527 1.4303 0.20687 2.9224 1.662 3.6429-2.3051-0.05275-5.3273-0.39212-6.28 1.8983-0.28073 0.66862-0.27595 1.2174-0.282 1.6572-0.10329 1.6061 0.3059 3.171 2.0252 3.8067 1.2061 0.4187 2.2175 0.2869 3.3945 0.3134 2.0524 0.0901 4.0448-0.4637 4.4796-2.4982 0.609 2.5638 3.2086 2.5463 5.3204 2.4982 2.7823 0.1278 4.7024-0.9368 4.5798-3.7329zm-12.899-7.6287c-0.14889-1.8665 1.8839-1.4921 3.1358-1.546 0.8939 0.05358 2.4743-0.21158 2.8003 0.88445 0.2729 2.4494-0.0297 2.8555-2.5242 2.8232-0.94713-0.07259-2.869 0.28949-3.3134-0.77077-0.14881-0.44557-0.08538-0.92893-0.09846-1.3909zm0.2606 9.2128c-0.56638 0.162-1.1652 0.1412-1.7487 0.1488-0.59786-0.0036-1.1977 0.0131-1.7948-0.0233-0.93407-0.0365-1.6776-0.3579-1.6157-1.4217 0.01574-0.5119-0.06845-1.0551 0.11822-1.5436 0.4432-0.84155 1.5978-0.6728 2.4032-0.7191 0.81712 0.01614 1.6464-0.05154 2.4536 0.10154 0.99382 0.17537 1.0564 0.91742 1.0227 1.7752-6.1e-4 0.7729 0.04085 1.416-0.83867 1.6821zm2.9212-3.6286c-0.0836 0.19457-0.14194 0.3848-0.18279 0.56614-0.18535-0.87758-0.76293-1.6189-1.5605-2.02 1.0871 0.04933 2.0387 0.04959 3.1216-8e-5 -0.7672 0.39034-1.1687 0.96486-1.3783 1.4539zm6.8788 3.6286c-0.5664 0.162-1.1652 0.1412-1.7488 0.1488-0.5978-0.0036-1.1977 0.0131-1.7947-0.0233-0.9341-0.0365-1.6776-0.3579-1.6157-1.4217 0.0157-0.5119-0.0685-1.0551 0.1182-1.5436 0.4432-0.84155 1.5978-0.6728 2.4033-0.7191 0.8171 0.01614 1.6464-0.05154 2.4536 0.10154 0.9938 0.17537 1.0563 0.91742 1.0227 1.7752-6e-4 0.7729 0.0409 1.416-0.8386 1.6821z"></path></svg>
            <p name="id">文件句柄子依赖于数据处理器(正例)</p>
          </span>
        </div>
      
<p><strong>例子描述：</strong><br>
一个文件打开器通过 <code>yield</code> 提供文件对象，中间逻辑处理数据并构建 handler，路径函数只依赖 handler。文件资源作为子依赖项在请求结束时关闭。</p>
<p><strong>特征对比：</strong></p>
<ul>
<li>✅ 文件资源在子层通过 <code>yield</code> 创建</li>
<li>✅ 清理在路径函数外完成，无需显式控制</li>
<li>✅ 依赖链嵌套但依然保持清理语义明确</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> fastapi <span class="token keyword">import</span> FastAPI<span class="token punctuation">,</span> Depends

app <span class="token operator">=</span> FastAPI<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># yield 子依赖：打开文件</span>
<span class="token keyword">def</span> <span class="token function">open_file</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"data.txt"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">yield</span> f
    <span class="token keyword">finally</span><span class="token punctuation">:</span>
        f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 子依赖：数据处理逻辑</span>
<span class="token keyword">class</span> <span class="token class-name">FileProcessor</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token builtin">file</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>lines <span class="token operator">=</span> <span class="token builtin">file</span><span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">get_summary</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token string">"line_count"</span><span class="token punctuation">:</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>lines<span class="token punctuation">)</span><span class="token punctuation">}</span>

<span class="token keyword">def</span> <span class="token function">get_processor</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token operator">=</span>Depends<span class="token punctuation">(</span>open_file<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> FileProcessor<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>get</span><span class="token punctuation">(</span><span class="token string">"/file-summary"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">read_file_summary</span><span class="token punctuation">(</span>processor<span class="token punctuation">:</span> FileProcessor <span class="token operator">=</span> Depends<span class="token punctuation">(</span>get_processor<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> processor<span class="token punctuation">.</span>get_summary<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="mermaid">graph TD
    A[read_file_summary 路径函数] --&gt; B[get_processor]
    B --&gt; C[open_file]
    C --&gt; D[(yield 打开文件)]
    C --&gt; E[(finally 关闭文件)]</pre>

        <div class="evoldown" id="错误的yield" type="e">
          <span class="icon">
            <svg type="e" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path fill="currentColor" d="m21.9 15.621c0.1248-1.8535-0.6087-3.4099-2.6058-3.8292-0.7712-0.15744-1.3921-0.13977-2.1113-0.14543-0.6323 0.0048-1.1718-0.01567-1.8401 0.03203 1.5356-0.8078 1.6998-2.205 1.6567-3.546 0.1272-2.3708-1.4685-3.666-3.7727-3.673-2.2427-0.04024-5.0463-0.27229-5.9443 1.9172-0.28083 0.6692-0.27606 1.2179-0.28202 1.6587-0.08527 1.4303 0.20687 2.9224 1.662 3.6429-2.3051-0.05275-5.3273-0.39212-6.28 1.8983-0.28073 0.66862-0.27595 1.2174-0.282 1.6572-0.10329 1.6061 0.3059 3.171 2.0252 3.8067 1.2061 0.4187 2.2175 0.2869 3.3945 0.3134 2.0524 0.0901 4.0448-0.4637 4.4796-2.4982 0.609 2.5638 3.2086 2.5463 5.3204 2.4982 2.7823 0.1278 4.7024-0.9368 4.5798-3.7329zm-12.899-7.6287c-0.14889-1.8665 1.8839-1.4921 3.1358-1.546 0.8939 0.05358 2.4743-0.21158 2.8003 0.88445 0.2729 2.4494-0.0297 2.8555-2.5242 2.8232-0.94713-0.07259-2.869 0.28949-3.3134-0.77077-0.14881-0.44557-0.08538-0.92893-0.09846-1.3909zm0.2606 9.2128c-0.56638 0.162-1.1652 0.1412-1.7487 0.1488-0.59786-0.0036-1.1977 0.0131-1.7948-0.0233-0.93407-0.0365-1.6776-0.3579-1.6157-1.4217 0.01574-0.5119-0.06845-1.0551 0.11822-1.5436 0.4432-0.84155 1.5978-0.6728 2.4032-0.7191 0.81712 0.01614 1.6464-0.05154 2.4536 0.10154 0.99382 0.17537 1.0564 0.91742 1.0227 1.7752-6.1e-4 0.7729 0.04085 1.416-0.83867 1.6821zm2.9212-3.6286c-0.0836 0.19457-0.14194 0.3848-0.18279 0.56614-0.18535-0.87758-0.76293-1.6189-1.5605-2.02 1.0871 0.04933 2.0387 0.04959 3.1216-8e-5 -0.7672 0.39034-1.1687 0.96486-1.3783 1.4539zm6.8788 3.6286c-0.5664 0.162-1.1652 0.1412-1.7488 0.1488-0.5978-0.0036-1.1977 0.0131-1.7947-0.0233-0.9341-0.0365-1.6776-0.3579-1.6157-1.4217 0.0157-0.5119-0.0685-1.0551 0.1182-1.5436 0.4432-0.84155 1.5978-0.6728 2.4033-0.7191 0.8171 0.01614 1.6464-0.05154 2.4536 0.10154 0.9938 0.17537 1.0563 0.91742 1.0227 1.7752-6e-4 0.7729 0.0409 1.416-0.8386 1.6821z"></path></svg>
            <p name="id">错误的yield</p>
          </span>
          <span class="link-icon ml-[0.5em] mr-[0.25em]">
            <svg xmlns="http://www.w3.org/2000/svg" width="0.9411764705882353em" height="0.9411764705882353em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class="untouchable"><path d="m9.5652 14.45 0.72891-2.0026c-0.651 0.00713-1.3027 0.00104-1.9532 0.00179-1.0991-0.02908-3.0336 0.08306-3.605-1.0524-0.28828-0.61588-0.2054-1.3226-0.22136-1.9833 0.00663-0.74044-0.05553-1.6362 0.5758-2.1558 0.70637-0.5555 1.7411-0.56129 2.6027-0.59834 0.743-0.015 1.4884-0.00764 2.2315-0.00868 0.68471 0.01536 1.6274-0.01783 2.4184 0.16762l0.68711-1.8879c-0.0146-0.003965-0.0287-0.00841-0.0435-0.01227-0.94653-0.24905-1.9355-0.25901-2.9083-0.26688-0.78352-1.3008e-4 -1.5692-0.0063751-2.3527 0.006805-1.2709 0.027555-2.6299 0.13739-3.6978 0.89566-1.6654 1.2031-1.53 2.9573-1.5068 4.79-0.0012251 1.7732 0.89765 3.2159 2.626 3.7562 0.80589 0.26191 1.6615 0.32018 2.5036 0.34101 0.6376 0.01106 1.2763 0.01096 1.9146 0.00915z" fill="currentColor"></path><path d="m14.589 9.125h1.3099c0.02865-0.88714-0.11774-1.6826-0.45594-2.3461l-0.85392 2.3461z" fill="currentColor"></path><path d="m15.587 12.025h-2.0527l-0.80604 2.2146c1.2326-0.27362 2.3169-0.88582 2.8588-2.2146z" fill="currentColor"></path><path d="m8.394 12.025h2.0538l0.82406-2.2641c-1.2457 0.2734-2.3327 0.8901-2.8779 2.2641z" fill="currentColor"></path><path d="m8.5566 17.221 0.83571-2.2961h-1.2914c-0.025394 0.86685 0.12295 1.645 0.45565 2.2961z" fill="currentColor"></path><path d="m21.485 14.399c7e-4 -0.67593 0.0063-1.3662-0.1779-2.0223-0.58881-2.115-2.5706-2.7532-4.5608-2.8041-0.76964-0.031175-1.5416-0.02264-2.3121-0.022365l-0.72832 2.0011c0.38557-0.00297 0.77131 7.6e-4 1.1559-0.00173 1.1244 0.02284 2.8396-0.10221 3.8152 0.44616 0.82512 0.45526 0.81194 1.4036 0.80798 2.2308-0.01538 0.64171 0.05949 1.3145-0.1601 1.93-0.39418 1.0145-1.651 1.1102-2.5915 1.1694-0.7426 0.03331-1.4884 0.0209-2.2315 0.02365-0.81334-0.01641-1.9395 0.04306-2.8448-0.16914l-0.68792 1.89c0.014845 0.00401 0.02915 0.0085 0.044115 0.0124 0.94522 0.24688 1.9316 0.25913 2.9027 0.2657 0.83456-2.2e-4 1.6713 0.00786 2.5057-0.00999 2.0286-0.02122 4.1491-0.51576 4.8438-2.6752 0.2358-0.7292 0.22-1.5067 0.2196-2.2644z" fill="currentColor"></path><path d="m14.979 6.7378c0.17824-0.52033 0.90905-2.4486 1.0626-2.9514 0.05601-0.19527 0.10768-0.39984 0.08232-0.60408-0.03096-0.33264-0.36035-0.4603-0.63671-0.55464-0.20794-0.070665-0.41593-0.17228-0.63943-0.174-0.33751 0.005805-0.52152 0.33878-0.64452 0.61072-1.4256 3.8005-4.7612 13.07-6.1617 16.891-0.10636 0.34-0.29285 0.7891-0.06874 1.1109 0.1296 0.1673 0.34386 0.232 0.53431 0.3042 0.30778 0.1107 0.70325 0.3075 0.98251 0.0365 0.14514-0.1339 0.23561-0.315 0.31595-0.4926 0.10005-0.2274 0.1811-0.4632 0.26694-0.6962 0.4854-1.3337 4.3257-11.885 4.9065-13.481z" fill="currentColor"></path></svg>
          </span>
          
        </div>
      
<p><strong>例子描述：</strong><br>
权限判断函数通过 <code>yield</code> 返回布尔值并作为子依赖，实际无资源需要清理，只用于抛出权限异常。由于无清理行为，使用 <code>yield</code> 仅是误用，造成依赖生命周期语义混乱。</p>
<p><strong>特征对比：</strong></p>
<ul>
<li>❌ 无资源分配，不符合 <code>yield</code> 场景</li>
<li>❌ 清理逻辑无意义</li>
<li>❌ 增加不必要的依赖复杂性</li>
<li>❌ 模糊了依赖职责边界</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> fastapi <span class="token keyword">import</span> FastAPI<span class="token punctuation">,</span> Depends<span class="token punctuation">,</span> HTTPException

app <span class="token operator">=</span> FastAPI<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 错误的子依赖：用 yield 模拟权限逻辑（无清理需要）</span>
<span class="token keyword">def</span> <span class="token function">check_permission</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    authorized <span class="token operator">=</span> <span class="token boolean">False</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> authorized<span class="token punctuation">:</span>
        <span class="token keyword">raise</span> HTTPException<span class="token punctuation">(</span>status_code<span class="token operator">=</span><span class="token number">403</span><span class="token punctuation">,</span> detail<span class="token operator">=</span><span class="token string">"Not authorized"</span><span class="token punctuation">)</span>
    <span class="token keyword">yield</span> <span class="token boolean">True</span>  <span class="token comment"># 无资源，仍用了 yield</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"no-op cleanup"</span><span class="token punctuation">)</span>  <span class="token comment"># 实际无用</span>

<span class="token comment"># 错误：将上面逻辑当作子依赖</span>
<span class="token keyword">class</span> <span class="token class-name">ProtectedHandler</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token string">"ok"</span>

<span class="token keyword">def</span> <span class="token function">get_handler</span><span class="token punctuation">(</span>allowed<span class="token punctuation">:</span> <span class="token builtin">bool</span> <span class="token operator">=</span> Depends<span class="token punctuation">(</span>check_permission<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> ProtectedHandler<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>get</span><span class="token punctuation">(</span><span class="token string">"/secure-data"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">secure_data</span><span class="token punctuation">(</span>handler<span class="token punctuation">:</span> ProtectedHandler <span class="token operator">=</span> Depends<span class="token punctuation">(</span>get_handler<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token string">"status"</span><span class="token punctuation">:</span> handler<span class="token punctuation">.</span>status<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

        <div class="evoldown" id="包含ield与HTTPException依赖项" type="e">
          <span class="icon">
            <svg type="e" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path fill="currentColor" d="m21.9 15.621c0.1248-1.8535-0.6087-3.4099-2.6058-3.8292-0.7712-0.15744-1.3921-0.13977-2.1113-0.14543-0.6323 0.0048-1.1718-0.01567-1.8401 0.03203 1.5356-0.8078 1.6998-2.205 1.6567-3.546 0.1272-2.3708-1.4685-3.666-3.7727-3.673-2.2427-0.04024-5.0463-0.27229-5.9443 1.9172-0.28083 0.6692-0.27606 1.2179-0.28202 1.6587-0.08527 1.4303 0.20687 2.9224 1.662 3.6429-2.3051-0.05275-5.3273-0.39212-6.28 1.8983-0.28073 0.66862-0.27595 1.2174-0.282 1.6572-0.10329 1.6061 0.3059 3.171 2.0252 3.8067 1.2061 0.4187 2.2175 0.2869 3.3945 0.3134 2.0524 0.0901 4.0448-0.4637 4.4796-2.4982 0.609 2.5638 3.2086 2.5463 5.3204 2.4982 2.7823 0.1278 4.7024-0.9368 4.5798-3.7329zm-12.899-7.6287c-0.14889-1.8665 1.8839-1.4921 3.1358-1.546 0.8939 0.05358 2.4743-0.21158 2.8003 0.88445 0.2729 2.4494-0.0297 2.8555-2.5242 2.8232-0.94713-0.07259-2.869 0.28949-3.3134-0.77077-0.14881-0.44557-0.08538-0.92893-0.09846-1.3909zm0.2606 9.2128c-0.56638 0.162-1.1652 0.1412-1.7487 0.1488-0.59786-0.0036-1.1977 0.0131-1.7948-0.0233-0.93407-0.0365-1.6776-0.3579-1.6157-1.4217 0.01574-0.5119-0.06845-1.0551 0.11822-1.5436 0.4432-0.84155 1.5978-0.6728 2.4032-0.7191 0.81712 0.01614 1.6464-0.05154 2.4536 0.10154 0.99382 0.17537 1.0564 0.91742 1.0227 1.7752-6.1e-4 0.7729 0.04085 1.416-0.83867 1.6821zm2.9212-3.6286c-0.0836 0.19457-0.14194 0.3848-0.18279 0.56614-0.18535-0.87758-0.76293-1.6189-1.5605-2.02 1.0871 0.04933 2.0387 0.04959 3.1216-8e-5 -0.7672 0.39034-1.1687 0.96486-1.3783 1.4539zm6.8788 3.6286c-0.5664 0.162-1.1652 0.1412-1.7488 0.1488-0.5978-0.0036-1.1977 0.0131-1.7947-0.0233-0.9341-0.0365-1.6776-0.3579-1.6157-1.4217 0.0157-0.5119-0.0685-1.0551 0.1182-1.5436 0.4432-0.84155 1.5978-0.6728 2.4033-0.7191 0.8171 0.01614 1.6464-0.05154 2.4536 0.10154 0.9938 0.17537 1.0563 0.91742 1.0227 1.7752-6e-4 0.7729 0.0409 1.416-0.8386 1.6821z"></path></svg>
            <p name="id">包含ield与HTTPException依赖项</p>
          </span>
        </div>
      
<p>可以在&nbsp;<code>yield</code>&nbsp;之后的退出代码中抛出一个&nbsp;<code>HTTPException</code>&nbsp;或类似的异常。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> typing <span class="token keyword">import</span> Annotated

<span class="token keyword">from</span> fastapi <span class="token keyword">import</span> Depends<span class="token punctuation">,</span> FastAPI<span class="token punctuation">,</span> HTTPException

app <span class="token operator">=</span> FastAPI<span class="token punctuation">(</span><span class="token punctuation">)</span>


data <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">"plumbus"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">"description"</span><span class="token punctuation">:</span> <span class="token string">"Freshly pickled plumbus"</span><span class="token punctuation">,</span> <span class="token string">"owner"</span><span class="token punctuation">:</span> <span class="token string">"Morty"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">"portal-gun"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">"description"</span><span class="token punctuation">:</span> <span class="token string">"Gun to create portals"</span><span class="token punctuation">,</span> <span class="token string">"owner"</span><span class="token punctuation">:</span> <span class="token string">"Rick"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>


<span class="token keyword">class</span> <span class="token class-name">OwnerError</span><span class="token punctuation">(</span>Exception<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>


<span class="token keyword">def</span> <span class="token function">get_username</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># 使用HTTPException抛出异常</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">yield</span> <span class="token string">"Rick"</span>
    <span class="token keyword">except</span> OwnerError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">raise</span> HTTPException<span class="token punctuation">(</span>status_code<span class="token operator">=</span><span class="token number">400</span><span class="token punctuation">,</span> detail<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f"Owner error: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>


<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>get</span><span class="token punctuation">(</span><span class="token string">"/items/{item_id}"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">get_item</span><span class="token punctuation">(</span>item_id<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> username<span class="token punctuation">:</span> Annotated<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> Depends<span class="token punctuation">(</span>get_username<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> item_id <span class="token keyword">not</span> <span class="token keyword">in</span> data<span class="token punctuation">:</span>
        <span class="token keyword">raise</span> HTTPException<span class="token punctuation">(</span>status_code<span class="token operator">=</span><span class="token number">404</span><span class="token punctuation">,</span> detail<span class="token operator">=</span><span class="token string">"Item not found"</span><span class="token punctuation">)</span>
    item <span class="token operator">=</span> data<span class="token punctuation">[</span>item_id<span class="token punctuation">]</span>
    <span class="token keyword">if</span> item<span class="token punctuation">[</span><span class="token string">"owner"</span><span class="token punctuation">]</span> <span class="token operator">!=</span> username<span class="token punctuation">:</span>
        <span class="token keyword">raise</span> OwnerError<span class="token punctuation">(</span>username<span class="token punctuation">)</span>
    <span class="token keyword">return</span> item<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

        <div class="evoldown" id="包含yield和except的依赖项" type="e">
          <span class="icon">
            <svg type="e" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path fill="currentColor" d="m21.9 15.621c0.1248-1.8535-0.6087-3.4099-2.6058-3.8292-0.7712-0.15744-1.3921-0.13977-2.1113-0.14543-0.6323 0.0048-1.1718-0.01567-1.8401 0.03203 1.5356-0.8078 1.6998-2.205 1.6567-3.546 0.1272-2.3708-1.4685-3.666-3.7727-3.673-2.2427-0.04024-5.0463-0.27229-5.9443 1.9172-0.28083 0.6692-0.27606 1.2179-0.28202 1.6587-0.08527 1.4303 0.20687 2.9224 1.662 3.6429-2.3051-0.05275-5.3273-0.39212-6.28 1.8983-0.28073 0.66862-0.27595 1.2174-0.282 1.6572-0.10329 1.6061 0.3059 3.171 2.0252 3.8067 1.2061 0.4187 2.2175 0.2869 3.3945 0.3134 2.0524 0.0901 4.0448-0.4637 4.4796-2.4982 0.609 2.5638 3.2086 2.5463 5.3204 2.4982 2.7823 0.1278 4.7024-0.9368 4.5798-3.7329zm-12.899-7.6287c-0.14889-1.8665 1.8839-1.4921 3.1358-1.546 0.8939 0.05358 2.4743-0.21158 2.8003 0.88445 0.2729 2.4494-0.0297 2.8555-2.5242 2.8232-0.94713-0.07259-2.869 0.28949-3.3134-0.77077-0.14881-0.44557-0.08538-0.92893-0.09846-1.3909zm0.2606 9.2128c-0.56638 0.162-1.1652 0.1412-1.7487 0.1488-0.59786-0.0036-1.1977 0.0131-1.7948-0.0233-0.93407-0.0365-1.6776-0.3579-1.6157-1.4217 0.01574-0.5119-0.06845-1.0551 0.11822-1.5436 0.4432-0.84155 1.5978-0.6728 2.4032-0.7191 0.81712 0.01614 1.6464-0.05154 2.4536 0.10154 0.99382 0.17537 1.0564 0.91742 1.0227 1.7752-6.1e-4 0.7729 0.04085 1.416-0.83867 1.6821zm2.9212-3.6286c-0.0836 0.19457-0.14194 0.3848-0.18279 0.56614-0.18535-0.87758-0.76293-1.6189-1.5605-2.02 1.0871 0.04933 2.0387 0.04959 3.1216-8e-5 -0.7672 0.39034-1.1687 0.96486-1.3783 1.4539zm6.8788 3.6286c-0.5664 0.162-1.1652 0.1412-1.7488 0.1488-0.5978-0.0036-1.1977 0.0131-1.7947-0.0233-0.9341-0.0365-1.6776-0.3579-1.6157-1.4217 0.0157-0.5119-0.0685-1.0551 0.1182-1.5436 0.4432-0.84155 1.5978-0.6728 2.4033-0.7191 0.8171 0.01614 1.6464-0.05154 2.4536 0.10154 0.9938 0.17537 1.0563 0.91742 1.0227 1.7752-6e-4 0.7729 0.0409 1.416-0.8386 1.6821z"></path></svg>
            <p name="id">包含yield和except的依赖项</p>
          </span>
        </div>
      
<blockquote>
<p>如果在包含&nbsp;<code>yield</code>&nbsp;的依赖项中使用&nbsp;<code>except</code>&nbsp;捕获了一个异常，然后你没有重新抛出该异常（或抛出一个新异常），与在普通的Python代码中相同，FastAPI不会注意到发生了异常。<br>
所以， 在包含&nbsp;<code>yield</code>&nbsp;和&nbsp;<code>except</code>&nbsp;的依赖项中一定要&nbsp;<code>raise</code>，不然客户端将会收到&nbsp;<em>HTTP 500 Internal Server Error</em>&nbsp;的响应，因为我们没有抛出&nbsp;<code>HTTPException</code>&nbsp;或者类似的异常，并且服务器也&nbsp;<strong>不会有任何日志</strong>&nbsp;或者其他提示来告诉我们错误是什么。</p>
</blockquote>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> typing <span class="token keyword">import</span> Annotated

<span class="token keyword">from</span> fastapi <span class="token keyword">import</span> Depends<span class="token punctuation">,</span> FastAPI<span class="token punctuation">,</span> HTTPException

app <span class="token operator">=</span> FastAPI<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">InternalError</span><span class="token punctuation">(</span>Exception<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>


<span class="token keyword">def</span> <span class="token function">get_username</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">yield</span> <span class="token string">"Rick"</span>
    <span class="token keyword">except</span> InternalError<span class="token punctuation">:</span> <span class="token comment"># 自定义报错</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"We don't swallow the internal error here, we raise again 😎"</span><span class="token punctuation">)</span>
        <span class="token keyword">raise</span> <span class="token comment"># 使用raise来发出错误</span>


<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>get</span><span class="token punctuation">(</span><span class="token string">"/items/{item_id}"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">get_item</span><span class="token punctuation">(</span>item_id<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> username<span class="token punctuation">:</span> Annotated<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> Depends<span class="token punctuation">(</span>get_username<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> item_id <span class="token operator">==</span> <span class="token string">"portal-gun"</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> InternalError<span class="token punctuation">(</span>
            <span class="token string-interpolation"><span class="token string">f"The portal gun is too dangerous to be owned by </span><span class="token interpolation"><span class="token punctuation">{</span>username<span class="token punctuation">}</span></span><span class="token string">"</span></span>
        <span class="token punctuation">)</span>
    <span class="token keyword">if</span> item_id <span class="token operator">!=</span> <span class="token string">"plumbus"</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> HTTPException<span class="token punctuation">(</span>
            status_code<span class="token operator">=</span><span class="token number">404</span><span class="token punctuation">,</span> detail<span class="token operator">=</span><span class="token string">"Item not found, there's only a plumbus here"</span>
        <span class="token punctuation">)</span>
    <span class="token keyword">return</span> item_id<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

        <div class="evoldown" id="上下文管理器" type="d">
          <span class="icon">
            <svg type="d" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m21.15 6.85c0-2.2056-1.7944-4-4-4-4.1765-0.01989-5.4993 5.7322-1.8147 7.5629-0.263 0.63631-0.4627 1.4421-0.6559 2.2215-0.1397 0.56337-0.2841 1.1459-0.4405 1.6084-0.0728 0.2155-0.1286 0.4813-0.1891 0.4813-0.5072-0.7362-0.8126-2.2507-1.0979-3.3161-0.47879-1.5358-0.72936-4.4237-2.8018-4.558-0.77422 7e-5 -1.3844 0.52253-1.8138 1.553-0.55019 1.254-0.75064 3.2421-1.3784 4.4472-0.39648 3e-4 -0.79576 0.0045-1.1877 0.0703-0.67978 0.1073-1.3339 0.4195-1.798 0.9347-0.39707 0.4315-0.6427 0.9874-0.74275 1.5623-0.063545 0.351-0.07691 0.7094-0.07883 1.0654 0.001935 0.4718-0.01324 0.9457 0.027745 1.4163 0.09435 1.151 0.65732 2.1308 1.7281 2.6237 0.43467 0.1975 0.91053 0.2877 1.3854 0.3129 0.40096 0.0215 0.80345 0.0129 1.2048 0.0139 0.6491 2e-4 1.2891-0.0515 1.888-0.3229 0.90042-0.4067 1.4845-1.2039 1.6712-2.1666 0.0761-0.3779 0.09179-0.7654 0.09344-1.15 7.7e-4 -0.2699 0.00148-0.5413-7.8e-4 -0.8111-0.00379-0.4854-0.04143-0.9771-0.19121-1.4414-0.28748-0.9172-0.98053-1.616-1.8964-1.909 0.43984-1.1576 0.66815-2.7594 1.1268-3.8895 0.3537 0.72804 0.57113 1.7669 0.82283 2.7298 0.26567 1.0724 0.5404 2.1814 0.90896 3.0557 0.87204 2.2985 3.1124 2.7586 4.0452 0.392 0.5508-1.2642 0.7508-3.279 1.3828-4.4916 2.1142-0.10339 3.8024-1.8557 3.8024-3.995zm-12.073 8.8023c0.05605 0.2275 0.06623 0.465 0.07092 0.6983 0.00363 0.2444 0.00195 0.4906 0.00214 0.735-0.0063 0.408 0.01486 0.882-0.18359 1.2496-0.24573 0.4539-0.8026 0.501-1.2651 0.5114-0.33714 0.0058-0.67525 0.0041-1.0124 0.0018-0.46455-0.0092-1.0361-0.0245-1.3192-0.4545-0.16612-0.2552-0.19733-0.5702-0.21202-0.8673-0.01004-0.2443-0.00683-0.4906-0.0075-0.735 5.9e-4 -0.2322-0.00201-0.4664 0.01171-0.6983 0.01886-0.2936 0.06332-0.6069 0.24969-0.8453 0.34185-0.4331 1.0226-0.3889 1.5228-0.3979 0.38828 0.0035 0.77905-0.0131 1.1658 0.0285 0.49865 0.0566 0.85211 0.2621 0.97684 0.7737zm8.0732-6.8023c-2.6379-0.06696-2.6373-3.9334 0-4 2.6378 0.06697 2.6373 3.9334 0 4z" fill="currentColor"></path></svg>
            <p name="id">上下文管理器</p>
          </span>
        </div>
      
<p>「上下文管理器」是一种用于<strong>资源管理</strong>的编程结构，通常结合 Python 的 <code>with</code> 语句或 <code>@contextmanager</code> 装饰器（或 <code>asynccontextmanager</code>），确保在资源使用完成后，自动执行清理操作。在依赖项（Dependency）中使用上下文管理器，FastAPI 会<strong>自动识别并正确执行资源初始化和释放</strong>，适用于数据库连接、文件操作、网络连接等场景。</p>
<p><strong>重要特征</strong></p>
<ul>
<li><strong>特征1</strong>：结构上使用 <code>with</code> 或 <code>yield</code> + <code>finally</code>，确保进入/退出有界定</li>
<li><strong>特征2</strong>：FastAPI 可以与 <code>@contextmanager</code> 或 <code>@asynccontextmanager</code> 一起使用依赖项，实现资源自动管理</li>
<li><strong>特征3</strong>：适用于需要<strong>显式释放资源</strong>的任务，例如关闭连接、清除缓存、释放文件锁</li>
<li><strong>特征4</strong>：保持依赖项结构清晰，职责分离（资源获取 vs 使用）</li>
<li><strong>特征5</strong>：FastAPI 会在请求生命周期结束后自动处理上下文退出逻辑</li>
</ul>

        <div class="evoldown" id="数据库连接(正例)" type="e">
          <span class="icon">
            <svg type="e" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path fill="currentColor" d="m21.9 15.621c0.1248-1.8535-0.6087-3.4099-2.6058-3.8292-0.7712-0.15744-1.3921-0.13977-2.1113-0.14543-0.6323 0.0048-1.1718-0.01567-1.8401 0.03203 1.5356-0.8078 1.6998-2.205 1.6567-3.546 0.1272-2.3708-1.4685-3.666-3.7727-3.673-2.2427-0.04024-5.0463-0.27229-5.9443 1.9172-0.28083 0.6692-0.27606 1.2179-0.28202 1.6587-0.08527 1.4303 0.20687 2.9224 1.662 3.6429-2.3051-0.05275-5.3273-0.39212-6.28 1.8983-0.28073 0.66862-0.27595 1.2174-0.282 1.6572-0.10329 1.6061 0.3059 3.171 2.0252 3.8067 1.2061 0.4187 2.2175 0.2869 3.3945 0.3134 2.0524 0.0901 4.0448-0.4637 4.4796-2.4982 0.609 2.5638 3.2086 2.5463 5.3204 2.4982 2.7823 0.1278 4.7024-0.9368 4.5798-3.7329zm-12.899-7.6287c-0.14889-1.8665 1.8839-1.4921 3.1358-1.546 0.8939 0.05358 2.4743-0.21158 2.8003 0.88445 0.2729 2.4494-0.0297 2.8555-2.5242 2.8232-0.94713-0.07259-2.869 0.28949-3.3134-0.77077-0.14881-0.44557-0.08538-0.92893-0.09846-1.3909zm0.2606 9.2128c-0.56638 0.162-1.1652 0.1412-1.7487 0.1488-0.59786-0.0036-1.1977 0.0131-1.7948-0.0233-0.93407-0.0365-1.6776-0.3579-1.6157-1.4217 0.01574-0.5119-0.06845-1.0551 0.11822-1.5436 0.4432-0.84155 1.5978-0.6728 2.4032-0.7191 0.81712 0.01614 1.6464-0.05154 2.4536 0.10154 0.99382 0.17537 1.0564 0.91742 1.0227 1.7752-6.1e-4 0.7729 0.04085 1.416-0.83867 1.6821zm2.9212-3.6286c-0.0836 0.19457-0.14194 0.3848-0.18279 0.56614-0.18535-0.87758-0.76293-1.6189-1.5605-2.02 1.0871 0.04933 2.0387 0.04959 3.1216-8e-5 -0.7672 0.39034-1.1687 0.96486-1.3783 1.4539zm6.8788 3.6286c-0.5664 0.162-1.1652 0.1412-1.7488 0.1488-0.5978-0.0036-1.1977 0.0131-1.7947-0.0233-0.9341-0.0365-1.6776-0.3579-1.6157-1.4217 0.0157-0.5119-0.0685-1.0551 0.1182-1.5436 0.4432-0.84155 1.5978-0.6728 2.4033-0.7191 0.8171 0.01614 1.6464-0.05154 2.4536 0.10154 0.9938 0.17537 1.0563 0.91742 1.0227 1.7752-6e-4 0.7729 0.0409 1.416-0.8386 1.6821z"></path></svg>
            <p name="id">数据库连接(正例)</p>
          </span>
          <span class="link-icon ml-[0.5em] mr-[0.25em]">
            <svg xmlns="http://www.w3.org/2000/svg" width="0.9411764705882353em" height="0.9411764705882353em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class="untouchable"><path d="m9.5652 14.45 0.72891-2.0026c-0.651 0.00713-1.3027 0.00104-1.9532 0.00179-1.0991-0.02908-3.0336 0.08306-3.605-1.0524-0.28828-0.61588-0.2054-1.3226-0.22136-1.9833 0.00663-0.74044-0.05553-1.6362 0.5758-2.1558 0.70637-0.5555 1.7411-0.56129 2.6027-0.59834 0.743-0.015 1.4884-0.00764 2.2315-0.00868 0.68471 0.01536 1.6274-0.01783 2.4184 0.16762l0.68711-1.8879c-0.0146-0.003965-0.0287-0.00841-0.0435-0.01227-0.94653-0.24905-1.9355-0.25901-2.9083-0.26688-0.78352-1.3008e-4 -1.5692-0.0063751-2.3527 0.006805-1.2709 0.027555-2.6299 0.13739-3.6978 0.89566-1.6654 1.2031-1.53 2.9573-1.5068 4.79-0.0012251 1.7732 0.89765 3.2159 2.626 3.7562 0.80589 0.26191 1.6615 0.32018 2.5036 0.34101 0.6376 0.01106 1.2763 0.01096 1.9146 0.00915z" fill="currentColor"></path><path d="m14.589 9.125h1.3099c0.02865-0.88714-0.11774-1.6826-0.45594-2.3461l-0.85392 2.3461z" fill="currentColor"></path><path d="m15.587 12.025h-2.0527l-0.80604 2.2146c1.2326-0.27362 2.3169-0.88582 2.8588-2.2146z" fill="currentColor"></path><path d="m8.394 12.025h2.0538l0.82406-2.2641c-1.2457 0.2734-2.3327 0.8901-2.8779 2.2641z" fill="currentColor"></path><path d="m8.5566 17.221 0.83571-2.2961h-1.2914c-0.025394 0.86685 0.12295 1.645 0.45565 2.2961z" fill="currentColor"></path><path d="m21.485 14.399c7e-4 -0.67593 0.0063-1.3662-0.1779-2.0223-0.58881-2.115-2.5706-2.7532-4.5608-2.8041-0.76964-0.031175-1.5416-0.02264-2.3121-0.022365l-0.72832 2.0011c0.38557-0.00297 0.77131 7.6e-4 1.1559-0.00173 1.1244 0.02284 2.8396-0.10221 3.8152 0.44616 0.82512 0.45526 0.81194 1.4036 0.80798 2.2308-0.01538 0.64171 0.05949 1.3145-0.1601 1.93-0.39418 1.0145-1.651 1.1102-2.5915 1.1694-0.7426 0.03331-1.4884 0.0209-2.2315 0.02365-0.81334-0.01641-1.9395 0.04306-2.8448-0.16914l-0.68792 1.89c0.014845 0.00401 0.02915 0.0085 0.044115 0.0124 0.94522 0.24688 1.9316 0.25913 2.9027 0.2657 0.83456-2.2e-4 1.6713 0.00786 2.5057-0.00999 2.0286-0.02122 4.1491-0.51576 4.8438-2.6752 0.2358-0.7292 0.22-1.5067 0.2196-2.2644z" fill="currentColor"></path><path d="m14.979 6.7378c0.17824-0.52033 0.90905-2.4486 1.0626-2.9514 0.05601-0.19527 0.10768-0.39984 0.08232-0.60408-0.03096-0.33264-0.36035-0.4603-0.63671-0.55464-0.20794-0.070665-0.41593-0.17228-0.63943-0.174-0.33751 0.005805-0.52152 0.33878-0.64452 0.61072-1.4256 3.8005-4.7612 13.07-6.1617 16.891-0.10636 0.34-0.29285 0.7891-0.06874 1.1109 0.1296 0.1673 0.34386 0.232 0.53431 0.3042 0.30778 0.1107 0.70325 0.3075 0.98251 0.0365 0.14514-0.1339 0.23561-0.315 0.31595-0.4926 0.10005-0.2274 0.1811-0.4632 0.26694-0.6962 0.4854-1.3337 4.3257-11.885 4.9065-13.481z" fill="currentColor"></path></svg>
          </span>
          
          <span class="icon">
            <svg type="d" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m21.15 6.85c0-2.2056-1.7944-4-4-4-4.1765-0.01989-5.4993 5.7322-1.8147 7.5629-0.263 0.63631-0.4627 1.4421-0.6559 2.2215-0.1397 0.56337-0.2841 1.1459-0.4405 1.6084-0.0728 0.2155-0.1286 0.4813-0.1891 0.4813-0.5072-0.7362-0.8126-2.2507-1.0979-3.3161-0.47879-1.5358-0.72936-4.4237-2.8018-4.558-0.77422 7e-5 -1.3844 0.52253-1.8138 1.553-0.55019 1.254-0.75064 3.2421-1.3784 4.4472-0.39648 3e-4 -0.79576 0.0045-1.1877 0.0703-0.67978 0.1073-1.3339 0.4195-1.798 0.9347-0.39707 0.4315-0.6427 0.9874-0.74275 1.5623-0.063545 0.351-0.07691 0.7094-0.07883 1.0654 0.001935 0.4718-0.01324 0.9457 0.027745 1.4163 0.09435 1.151 0.65732 2.1308 1.7281 2.6237 0.43467 0.1975 0.91053 0.2877 1.3854 0.3129 0.40096 0.0215 0.80345 0.0129 1.2048 0.0139 0.6491 2e-4 1.2891-0.0515 1.888-0.3229 0.90042-0.4067 1.4845-1.2039 1.6712-2.1666 0.0761-0.3779 0.09179-0.7654 0.09344-1.15 7.7e-4 -0.2699 0.00148-0.5413-7.8e-4 -0.8111-0.00379-0.4854-0.04143-0.9771-0.19121-1.4414-0.28748-0.9172-0.98053-1.616-1.8964-1.909 0.43984-1.1576 0.66815-2.7594 1.1268-3.8895 0.3537 0.72804 0.57113 1.7669 0.82283 2.7298 0.26567 1.0724 0.5404 2.1814 0.90896 3.0557 0.87204 2.2985 3.1124 2.7586 4.0452 0.392 0.5508-1.2642 0.7508-3.279 1.3828-4.4916 2.1142-0.10339 3.8024-1.8557 3.8024-3.995zm-12.073 8.8023c0.05605 0.2275 0.06623 0.465 0.07092 0.6983 0.00363 0.2444 0.00195 0.4906 0.00214 0.735-0.0063 0.408 0.01486 0.882-0.18359 1.2496-0.24573 0.4539-0.8026 0.501-1.2651 0.5114-0.33714 0.0058-0.67525 0.0041-1.0124 0.0018-0.46455-0.0092-1.0361-0.0245-1.3192-0.4545-0.16612-0.2552-0.19733-0.5702-0.21202-0.8673-0.01004-0.2443-0.00683-0.4906-0.0075-0.735 5.9e-4 -0.2322-0.00201-0.4664 0.01171-0.6983 0.01886-0.2936 0.06332-0.6069 0.24969-0.8453 0.34185-0.4331 1.0226-0.3889 1.5228-0.3979 0.38828 0.0035 0.77905-0.0131 1.1658 0.0285 0.49865 0.0566 0.85211 0.2621 0.97684 0.7737zm8.0732-6.8023c-2.6379-0.06696-2.6373-3.9334 0-4 2.6378 0.06697 2.6373 3.9334 0 4z" fill="currentColor"></path></svg>
            <p name="id">上下文管理器</p>
          </span>
        </div>
      
<p><strong>例子描述</strong><br>
在一个金融服务应用中，用户请求必须获取数据库会话才能执行账户余额查询。开发者使用 <code>@contextmanager</code> 创建了一个 <code>get_db()</code> 函数，封装数据库连接和关闭逻辑，并将其作为依赖项注入给业务层查询逻辑。</p>
<p><strong>特征对比</strong></p>
<ul>
<li>✅ 使用了 <code>@contextmanager</code> 创建明确的资源生命周期</li>
<li>✅ FastAPI 自动处理请求后关闭连接</li>
<li>✅ 业务逻辑与资源管理解耦</li>
<li>✅ 满足资源安全释放的关键需</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> fastapi <span class="token keyword">import</span> FastAPI<span class="token punctuation">,</span> Depends
<span class="token keyword">from</span> contextlib <span class="token keyword">import</span> contextmanager

app <span class="token operator">=</span> FastAPI<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@contextmanager</span>
<span class="token keyword">def</span> <span class="token function">get_db</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    db <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"conn"</span><span class="token punctuation">:</span> <span class="token string">"数据库连接"</span><span class="token punctuation">}</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">yield</span> db
    <span class="token keyword">finally</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"关闭数据库连接"</span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>get</span><span class="token punctuation">(</span><span class="token string">"/users/"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">read_users</span><span class="token punctuation">(</span>db<span class="token operator">=</span>Depends<span class="token punctuation">(</span>get_db<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token string">"msg"</span><span class="token punctuation">:</span> <span class="token string">"读取成功"</span><span class="token punctuation">,</span> <span class="token string">"db"</span><span class="token punctuation">:</span> db<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

        <div class="evoldown" id="临时配置文件(正例)" type="e">
          <span class="icon">
            <svg type="e" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path fill="currentColor" d="m21.9 15.621c0.1248-1.8535-0.6087-3.4099-2.6058-3.8292-0.7712-0.15744-1.3921-0.13977-2.1113-0.14543-0.6323 0.0048-1.1718-0.01567-1.8401 0.03203 1.5356-0.8078 1.6998-2.205 1.6567-3.546 0.1272-2.3708-1.4685-3.666-3.7727-3.673-2.2427-0.04024-5.0463-0.27229-5.9443 1.9172-0.28083 0.6692-0.27606 1.2179-0.28202 1.6587-0.08527 1.4303 0.20687 2.9224 1.662 3.6429-2.3051-0.05275-5.3273-0.39212-6.28 1.8983-0.28073 0.66862-0.27595 1.2174-0.282 1.6572-0.10329 1.6061 0.3059 3.171 2.0252 3.8067 1.2061 0.4187 2.2175 0.2869 3.3945 0.3134 2.0524 0.0901 4.0448-0.4637 4.4796-2.4982 0.609 2.5638 3.2086 2.5463 5.3204 2.4982 2.7823 0.1278 4.7024-0.9368 4.5798-3.7329zm-12.899-7.6287c-0.14889-1.8665 1.8839-1.4921 3.1358-1.546 0.8939 0.05358 2.4743-0.21158 2.8003 0.88445 0.2729 2.4494-0.0297 2.8555-2.5242 2.8232-0.94713-0.07259-2.869 0.28949-3.3134-0.77077-0.14881-0.44557-0.08538-0.92893-0.09846-1.3909zm0.2606 9.2128c-0.56638 0.162-1.1652 0.1412-1.7487 0.1488-0.59786-0.0036-1.1977 0.0131-1.7948-0.0233-0.93407-0.0365-1.6776-0.3579-1.6157-1.4217 0.01574-0.5119-0.06845-1.0551 0.11822-1.5436 0.4432-0.84155 1.5978-0.6728 2.4032-0.7191 0.81712 0.01614 1.6464-0.05154 2.4536 0.10154 0.99382 0.17537 1.0564 0.91742 1.0227 1.7752-6.1e-4 0.7729 0.04085 1.416-0.83867 1.6821zm2.9212-3.6286c-0.0836 0.19457-0.14194 0.3848-0.18279 0.56614-0.18535-0.87758-0.76293-1.6189-1.5605-2.02 1.0871 0.04933 2.0387 0.04959 3.1216-8e-5 -0.7672 0.39034-1.1687 0.96486-1.3783 1.4539zm6.8788 3.6286c-0.5664 0.162-1.1652 0.1412-1.7488 0.1488-0.5978-0.0036-1.1977 0.0131-1.7947-0.0233-0.9341-0.0365-1.6776-0.3579-1.6157-1.4217 0.0157-0.5119-0.0685-1.0551 0.1182-1.5436 0.4432-0.84155 1.5978-0.6728 2.4033-0.7191 0.8171 0.01614 1.6464-0.05154 2.4536 0.10154 0.9938 0.17537 1.0563 0.91742 1.0227 1.7752-6e-4 0.7729 0.0409 1.416-0.8386 1.6821z"></path></svg>
            <p name="id">临时配置文件(正例)</p>
          </span>
          <span class="link-icon ml-[0.5em] mr-[0.25em]">
            <svg xmlns="http://www.w3.org/2000/svg" width="0.9411764705882353em" height="0.9411764705882353em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class="untouchable"><path d="m9.5652 14.45 0.72891-2.0026c-0.651 0.00713-1.3027 0.00104-1.9532 0.00179-1.0991-0.02908-3.0336 0.08306-3.605-1.0524-0.28828-0.61588-0.2054-1.3226-0.22136-1.9833 0.00663-0.74044-0.05553-1.6362 0.5758-2.1558 0.70637-0.5555 1.7411-0.56129 2.6027-0.59834 0.743-0.015 1.4884-0.00764 2.2315-0.00868 0.68471 0.01536 1.6274-0.01783 2.4184 0.16762l0.68711-1.8879c-0.0146-0.003965-0.0287-0.00841-0.0435-0.01227-0.94653-0.24905-1.9355-0.25901-2.9083-0.26688-0.78352-1.3008e-4 -1.5692-0.0063751-2.3527 0.006805-1.2709 0.027555-2.6299 0.13739-3.6978 0.89566-1.6654 1.2031-1.53 2.9573-1.5068 4.79-0.0012251 1.7732 0.89765 3.2159 2.626 3.7562 0.80589 0.26191 1.6615 0.32018 2.5036 0.34101 0.6376 0.01106 1.2763 0.01096 1.9146 0.00915z" fill="currentColor"></path><path d="m14.589 9.125h1.3099c0.02865-0.88714-0.11774-1.6826-0.45594-2.3461l-0.85392 2.3461z" fill="currentColor"></path><path d="m15.587 12.025h-2.0527l-0.80604 2.2146c1.2326-0.27362 2.3169-0.88582 2.8588-2.2146z" fill="currentColor"></path><path d="m8.394 12.025h2.0538l0.82406-2.2641c-1.2457 0.2734-2.3327 0.8901-2.8779 2.2641z" fill="currentColor"></path><path d="m8.5566 17.221 0.83571-2.2961h-1.2914c-0.025394 0.86685 0.12295 1.645 0.45565 2.2961z" fill="currentColor"></path><path d="m21.485 14.399c7e-4 -0.67593 0.0063-1.3662-0.1779-2.0223-0.58881-2.115-2.5706-2.7532-4.5608-2.8041-0.76964-0.031175-1.5416-0.02264-2.3121-0.022365l-0.72832 2.0011c0.38557-0.00297 0.77131 7.6e-4 1.1559-0.00173 1.1244 0.02284 2.8396-0.10221 3.8152 0.44616 0.82512 0.45526 0.81194 1.4036 0.80798 2.2308-0.01538 0.64171 0.05949 1.3145-0.1601 1.93-0.39418 1.0145-1.651 1.1102-2.5915 1.1694-0.7426 0.03331-1.4884 0.0209-2.2315 0.02365-0.81334-0.01641-1.9395 0.04306-2.8448-0.16914l-0.68792 1.89c0.014845 0.00401 0.02915 0.0085 0.044115 0.0124 0.94522 0.24688 1.9316 0.25913 2.9027 0.2657 0.83456-2.2e-4 1.6713 0.00786 2.5057-0.00999 2.0286-0.02122 4.1491-0.51576 4.8438-2.6752 0.2358-0.7292 0.22-1.5067 0.2196-2.2644z" fill="currentColor"></path><path d="m14.979 6.7378c0.17824-0.52033 0.90905-2.4486 1.0626-2.9514 0.05601-0.19527 0.10768-0.39984 0.08232-0.60408-0.03096-0.33264-0.36035-0.4603-0.63671-0.55464-0.20794-0.070665-0.41593-0.17228-0.63943-0.174-0.33751 0.005805-0.52152 0.33878-0.64452 0.61072-1.4256 3.8005-4.7612 13.07-6.1617 16.891-0.10636 0.34-0.29285 0.7891-0.06874 1.1109 0.1296 0.1673 0.34386 0.232 0.53431 0.3042 0.30778 0.1107 0.70325 0.3075 0.98251 0.0365 0.14514-0.1339 0.23561-0.315 0.31595-0.4926 0.10005-0.2274 0.1811-0.4632 0.26694-0.6962 0.4854-1.3337 4.3257-11.885 4.9065-13.481z" fill="currentColor"></path></svg>
          </span>
          
          <span class="icon">
            <svg type="d" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m21.15 6.85c0-2.2056-1.7944-4-4-4-4.1765-0.01989-5.4993 5.7322-1.8147 7.5629-0.263 0.63631-0.4627 1.4421-0.6559 2.2215-0.1397 0.56337-0.2841 1.1459-0.4405 1.6084-0.0728 0.2155-0.1286 0.4813-0.1891 0.4813-0.5072-0.7362-0.8126-2.2507-1.0979-3.3161-0.47879-1.5358-0.72936-4.4237-2.8018-4.558-0.77422 7e-5 -1.3844 0.52253-1.8138 1.553-0.55019 1.254-0.75064 3.2421-1.3784 4.4472-0.39648 3e-4 -0.79576 0.0045-1.1877 0.0703-0.67978 0.1073-1.3339 0.4195-1.798 0.9347-0.39707 0.4315-0.6427 0.9874-0.74275 1.5623-0.063545 0.351-0.07691 0.7094-0.07883 1.0654 0.001935 0.4718-0.01324 0.9457 0.027745 1.4163 0.09435 1.151 0.65732 2.1308 1.7281 2.6237 0.43467 0.1975 0.91053 0.2877 1.3854 0.3129 0.40096 0.0215 0.80345 0.0129 1.2048 0.0139 0.6491 2e-4 1.2891-0.0515 1.888-0.3229 0.90042-0.4067 1.4845-1.2039 1.6712-2.1666 0.0761-0.3779 0.09179-0.7654 0.09344-1.15 7.7e-4 -0.2699 0.00148-0.5413-7.8e-4 -0.8111-0.00379-0.4854-0.04143-0.9771-0.19121-1.4414-0.28748-0.9172-0.98053-1.616-1.8964-1.909 0.43984-1.1576 0.66815-2.7594 1.1268-3.8895 0.3537 0.72804 0.57113 1.7669 0.82283 2.7298 0.26567 1.0724 0.5404 2.1814 0.90896 3.0557 0.87204 2.2985 3.1124 2.7586 4.0452 0.392 0.5508-1.2642 0.7508-3.279 1.3828-4.4916 2.1142-0.10339 3.8024-1.8557 3.8024-3.995zm-12.073 8.8023c0.05605 0.2275 0.06623 0.465 0.07092 0.6983 0.00363 0.2444 0.00195 0.4906 0.00214 0.735-0.0063 0.408 0.01486 0.882-0.18359 1.2496-0.24573 0.4539-0.8026 0.501-1.2651 0.5114-0.33714 0.0058-0.67525 0.0041-1.0124 0.0018-0.46455-0.0092-1.0361-0.0245-1.3192-0.4545-0.16612-0.2552-0.19733-0.5702-0.21202-0.8673-0.01004-0.2443-0.00683-0.4906-0.0075-0.735 5.9e-4 -0.2322-0.00201-0.4664 0.01171-0.6983 0.01886-0.2936 0.06332-0.6069 0.24969-0.8453 0.34185-0.4331 1.0226-0.3889 1.5228-0.3979 0.38828 0.0035 0.77905-0.0131 1.1658 0.0285 0.49865 0.0566 0.85211 0.2621 0.97684 0.7737zm8.0732-6.8023c-2.6379-0.06696-2.6373-3.9334 0-4 2.6378 0.06697 2.6373 3.9334 0 4z" fill="currentColor"></path></svg>
            <p name="id">上下文管理器</p>
          </span>
        </div>
      
<p><strong>例子描述</strong><br>
在一款图像处理服务中，每次上传图像时，系统会临时生成一个配置文件用于处理参数。该文件在处理完成后应立即删除。开发者使用 <code>@contextmanager</code> 实现 <code>temp_config()</code>，用于生成和清理配置文件。</p>
<p><strong>特征对比</strong></p>
<ul>
<li>✅ 控制文件生命周期，资源释放及时</li>
<li>✅ 使用 <code>with</code> 结构封装文件创建和删除</li>
<li>✅ 应用内只需关注业务处理，清理自动完成</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> fastapi <span class="token keyword">import</span> FastAPI<span class="token punctuation">,</span> Depends
<span class="token keyword">from</span> contextlib <span class="token keyword">import</span> contextmanager
<span class="token keyword">import</span> tempfile
<span class="token keyword">import</span> os

app <span class="token operator">=</span> FastAPI<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@contextmanager</span>
<span class="token keyword">def</span> <span class="token function">temp_config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    path <span class="token operator">=</span> tempfile<span class="token punctuation">.</span>NamedTemporaryFile<span class="token punctuation">(</span>delete<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
            f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"临时配置参数"</span><span class="token punctuation">)</span>
        <span class="token keyword">yield</span> path
    <span class="token keyword">finally</span><span class="token punctuation">:</span>
        os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>path<span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>get</span><span class="token punctuation">(</span><span class="token string">"/process/"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">process_image</span><span class="token punctuation">(</span>config_path<span class="token operator">=</span>Depends<span class="token punctuation">(</span>temp_config<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token string">"config_path"</span><span class="token punctuation">:</span> config_path<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

        <div class="evoldown" id="未封装资源释放的临时文件(反例)" type="e">
          <span class="icon">
            <svg type="e" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path fill="currentColor" d="m21.9 15.621c0.1248-1.8535-0.6087-3.4099-2.6058-3.8292-0.7712-0.15744-1.3921-0.13977-2.1113-0.14543-0.6323 0.0048-1.1718-0.01567-1.8401 0.03203 1.5356-0.8078 1.6998-2.205 1.6567-3.546 0.1272-2.3708-1.4685-3.666-3.7727-3.673-2.2427-0.04024-5.0463-0.27229-5.9443 1.9172-0.28083 0.6692-0.27606 1.2179-0.28202 1.6587-0.08527 1.4303 0.20687 2.9224 1.662 3.6429-2.3051-0.05275-5.3273-0.39212-6.28 1.8983-0.28073 0.66862-0.27595 1.2174-0.282 1.6572-0.10329 1.6061 0.3059 3.171 2.0252 3.8067 1.2061 0.4187 2.2175 0.2869 3.3945 0.3134 2.0524 0.0901 4.0448-0.4637 4.4796-2.4982 0.609 2.5638 3.2086 2.5463 5.3204 2.4982 2.7823 0.1278 4.7024-0.9368 4.5798-3.7329zm-12.899-7.6287c-0.14889-1.8665 1.8839-1.4921 3.1358-1.546 0.8939 0.05358 2.4743-0.21158 2.8003 0.88445 0.2729 2.4494-0.0297 2.8555-2.5242 2.8232-0.94713-0.07259-2.869 0.28949-3.3134-0.77077-0.14881-0.44557-0.08538-0.92893-0.09846-1.3909zm0.2606 9.2128c-0.56638 0.162-1.1652 0.1412-1.7487 0.1488-0.59786-0.0036-1.1977 0.0131-1.7948-0.0233-0.93407-0.0365-1.6776-0.3579-1.6157-1.4217 0.01574-0.5119-0.06845-1.0551 0.11822-1.5436 0.4432-0.84155 1.5978-0.6728 2.4032-0.7191 0.81712 0.01614 1.6464-0.05154 2.4536 0.10154 0.99382 0.17537 1.0564 0.91742 1.0227 1.7752-6.1e-4 0.7729 0.04085 1.416-0.83867 1.6821zm2.9212-3.6286c-0.0836 0.19457-0.14194 0.3848-0.18279 0.56614-0.18535-0.87758-0.76293-1.6189-1.5605-2.02 1.0871 0.04933 2.0387 0.04959 3.1216-8e-5 -0.7672 0.39034-1.1687 0.96486-1.3783 1.4539zm6.8788 3.6286c-0.5664 0.162-1.1652 0.1412-1.7488 0.1488-0.5978-0.0036-1.1977 0.0131-1.7947-0.0233-0.9341-0.0365-1.6776-0.3579-1.6157-1.4217 0.0157-0.5119-0.0685-1.0551 0.1182-1.5436 0.4432-0.84155 1.5978-0.6728 2.4033-0.7191 0.8171 0.01614 1.6464-0.05154 2.4536 0.10154 0.9938 0.17537 1.0563 0.91742 1.0227 1.7752-6e-4 0.7729 0.0409 1.416-0.8386 1.6821z"></path></svg>
            <p name="id">未封装资源释放的临时文件(反例)</p>
          </span>
          <span class="link-icon ml-[0.5em] mr-[0.25em]">
            <svg xmlns="http://www.w3.org/2000/svg" width="0.9411764705882353em" height="0.9411764705882353em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class="untouchable"><path d="m9.5652 14.45 0.72891-2.0026c-0.651 0.00713-1.3027 0.00104-1.9532 0.00179-1.0991-0.02908-3.0336 0.08306-3.605-1.0524-0.28828-0.61588-0.2054-1.3226-0.22136-1.9833 0.00663-0.74044-0.05553-1.6362 0.5758-2.1558 0.70637-0.5555 1.7411-0.56129 2.6027-0.59834 0.743-0.015 1.4884-0.00764 2.2315-0.00868 0.68471 0.01536 1.6274-0.01783 2.4184 0.16762l0.68711-1.8879c-0.0146-0.003965-0.0287-0.00841-0.0435-0.01227-0.94653-0.24905-1.9355-0.25901-2.9083-0.26688-0.78352-1.3008e-4 -1.5692-0.0063751-2.3527 0.006805-1.2709 0.027555-2.6299 0.13739-3.6978 0.89566-1.6654 1.2031-1.53 2.9573-1.5068 4.79-0.0012251 1.7732 0.89765 3.2159 2.626 3.7562 0.80589 0.26191 1.6615 0.32018 2.5036 0.34101 0.6376 0.01106 1.2763 0.01096 1.9146 0.00915z" fill="currentColor"></path><path d="m14.589 9.125h1.3099c0.02865-0.88714-0.11774-1.6826-0.45594-2.3461l-0.85392 2.3461z" fill="currentColor"></path><path d="m15.587 12.025h-2.0527l-0.80604 2.2146c1.2326-0.27362 2.3169-0.88582 2.8588-2.2146z" fill="currentColor"></path><path d="m8.394 12.025h2.0538l0.82406-2.2641c-1.2457 0.2734-2.3327 0.8901-2.8779 2.2641z" fill="currentColor"></path><path d="m8.5566 17.221 0.83571-2.2961h-1.2914c-0.025394 0.86685 0.12295 1.645 0.45565 2.2961z" fill="currentColor"></path><path d="m21.485 14.399c7e-4 -0.67593 0.0063-1.3662-0.1779-2.0223-0.58881-2.115-2.5706-2.7532-4.5608-2.8041-0.76964-0.031175-1.5416-0.02264-2.3121-0.022365l-0.72832 2.0011c0.38557-0.00297 0.77131 7.6e-4 1.1559-0.00173 1.1244 0.02284 2.8396-0.10221 3.8152 0.44616 0.82512 0.45526 0.81194 1.4036 0.80798 2.2308-0.01538 0.64171 0.05949 1.3145-0.1601 1.93-0.39418 1.0145-1.651 1.1102-2.5915 1.1694-0.7426 0.03331-1.4884 0.0209-2.2315 0.02365-0.81334-0.01641-1.9395 0.04306-2.8448-0.16914l-0.68792 1.89c0.014845 0.00401 0.02915 0.0085 0.044115 0.0124 0.94522 0.24688 1.9316 0.25913 2.9027 0.2657 0.83456-2.2e-4 1.6713 0.00786 2.5057-0.00999 2.0286-0.02122 4.1491-0.51576 4.8438-2.6752 0.2358-0.7292 0.22-1.5067 0.2196-2.2644z" fill="currentColor"></path><path d="m14.979 6.7378c0.17824-0.52033 0.90905-2.4486 1.0626-2.9514 0.05601-0.19527 0.10768-0.39984 0.08232-0.60408-0.03096-0.33264-0.36035-0.4603-0.63671-0.55464-0.20794-0.070665-0.41593-0.17228-0.63943-0.174-0.33751 0.005805-0.52152 0.33878-0.64452 0.61072-1.4256 3.8005-4.7612 13.07-6.1617 16.891-0.10636 0.34-0.29285 0.7891-0.06874 1.1109 0.1296 0.1673 0.34386 0.232 0.53431 0.3042 0.30778 0.1107 0.70325 0.3075 0.98251 0.0365 0.14514-0.1339 0.23561-0.315 0.31595-0.4926 0.10005-0.2274 0.1811-0.4632 0.26694-0.6962 0.4854-1.3337 4.3257-11.885 4.9065-13.481z" fill="currentColor"></path></svg>
          </span>
          
          <span class="icon">
            <svg type="d" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m21.15 6.85c0-2.2056-1.7944-4-4-4-4.1765-0.01989-5.4993 5.7322-1.8147 7.5629-0.263 0.63631-0.4627 1.4421-0.6559 2.2215-0.1397 0.56337-0.2841 1.1459-0.4405 1.6084-0.0728 0.2155-0.1286 0.4813-0.1891 0.4813-0.5072-0.7362-0.8126-2.2507-1.0979-3.3161-0.47879-1.5358-0.72936-4.4237-2.8018-4.558-0.77422 7e-5 -1.3844 0.52253-1.8138 1.553-0.55019 1.254-0.75064 3.2421-1.3784 4.4472-0.39648 3e-4 -0.79576 0.0045-1.1877 0.0703-0.67978 0.1073-1.3339 0.4195-1.798 0.9347-0.39707 0.4315-0.6427 0.9874-0.74275 1.5623-0.063545 0.351-0.07691 0.7094-0.07883 1.0654 0.001935 0.4718-0.01324 0.9457 0.027745 1.4163 0.09435 1.151 0.65732 2.1308 1.7281 2.6237 0.43467 0.1975 0.91053 0.2877 1.3854 0.3129 0.40096 0.0215 0.80345 0.0129 1.2048 0.0139 0.6491 2e-4 1.2891-0.0515 1.888-0.3229 0.90042-0.4067 1.4845-1.2039 1.6712-2.1666 0.0761-0.3779 0.09179-0.7654 0.09344-1.15 7.7e-4 -0.2699 0.00148-0.5413-7.8e-4 -0.8111-0.00379-0.4854-0.04143-0.9771-0.19121-1.4414-0.28748-0.9172-0.98053-1.616-1.8964-1.909 0.43984-1.1576 0.66815-2.7594 1.1268-3.8895 0.3537 0.72804 0.57113 1.7669 0.82283 2.7298 0.26567 1.0724 0.5404 2.1814 0.90896 3.0557 0.87204 2.2985 3.1124 2.7586 4.0452 0.392 0.5508-1.2642 0.7508-3.279 1.3828-4.4916 2.1142-0.10339 3.8024-1.8557 3.8024-3.995zm-12.073 8.8023c0.05605 0.2275 0.06623 0.465 0.07092 0.6983 0.00363 0.2444 0.00195 0.4906 0.00214 0.735-0.0063 0.408 0.01486 0.882-0.18359 1.2496-0.24573 0.4539-0.8026 0.501-1.2651 0.5114-0.33714 0.0058-0.67525 0.0041-1.0124 0.0018-0.46455-0.0092-1.0361-0.0245-1.3192-0.4545-0.16612-0.2552-0.19733-0.5702-0.21202-0.8673-0.01004-0.2443-0.00683-0.4906-0.0075-0.735 5.9e-4 -0.2322-0.00201-0.4664 0.01171-0.6983 0.01886-0.2936 0.06332-0.6069 0.24969-0.8453 0.34185-0.4331 1.0226-0.3889 1.5228-0.3979 0.38828 0.0035 0.77905-0.0131 1.1658 0.0285 0.49865 0.0566 0.85211 0.2621 0.97684 0.7737zm8.0732-6.8023c-2.6379-0.06696-2.6373-3.9334 0-4 2.6378 0.06697 2.6373 3.9334 0 4z" fill="currentColor"></path></svg>
            <p name="id">上下文管理器</p>
          </span>
        </div>
      
<p><strong>例子描述</strong><br>
在一个 NLP 训练接口中，上传的语料数据保存为临时文件，供模型读取。然而，开发者直接在路径函数中打开文件，并未封装为上下文管理器，也未在结束时删除或关闭资源，导致多个请求后服务器空间被占满。</p>
<p><strong>特征对比</strong></p>
<ul>
<li>❌ 没有定义上下文管理结构，没有资源清理保证</li>
<li>❌ 文件打开后未关闭，资源泄漏</li>
<li>❌ 不具备自动退出机制</li>
<li>❌ 依赖和处理逻辑耦合，代码可维护性差</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> fastapi <span class="token keyword">import</span> FastAPI
<span class="token keyword">import</span> tempfile

app <span class="token operator">=</span> FastAPI<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>get</span><span class="token punctuation">(</span><span class="token string">"/upload/"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">upload_file</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    path <span class="token operator">=</span> tempfile<span class="token punctuation">.</span>NamedTemporaryFile<span class="token punctuation">(</span>delete<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"用户数据"</span><span class="token punctuation">)</span>
    <span class="token comment"># ❌ 文件未删除，也未用上下文管理</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token string">"temp_file"</span><span class="token punctuation">:</span> path<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></body></html>
                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">Hkini</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://www.hkini.top/posts/45756.html">https://www.hkini.top/posts/45756.html</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">Hkini</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/FastAPI/">
                                    <span class="chip bg-color">FastAPI</span>
                                </a>
                            
                                <a href="/tags/Python/">
                                    <span class="chip bg-color">Python</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="qq,qzone,wechat,weibo,douban" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    
    <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid="></script>
    <div class="addthis_inline_share_toolbox"></div>
    

</div>

                </div>
            </div>
            
                <div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    
        <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }

    #vcomments textarea {
        box-sizing: border-box;
        background: url("/medias/comment_bg.png") 100% 100% no-repeat;
    }

    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #4cbf30;
        font-weight: 500;
        text-decoration: none;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; padding-left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="vcomments" class="card-content" style="display: grid">
    </div>
</div>

<script src="/libs/valine/av-min.js"></script>
<script src="/libs/valine/Valine.min.js"></script>
<script>
    new Valine({
        el: '#vcomments',
        appId: 'AcWiopK3pHt4imczk7wvUFZZ-gzGzoHsz',
        appKey: 'UxlKcVndM3aSrEzt9vM0ul6L',
        serverURLs: 'https://acwiopk3.lc-cn-n1-shared.com',
        notify: 'false' === 'true',
        verify: 'false' === 'true',
        visitor: 'true' === 'true',
        avatar: 'mm',
        pageSize: '10',
        lang: 'zh-cn',
        placeholder: '欢迎评论'
    });
</script>

<!--酷Q推送-->


    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/posts/30980.html">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/26.png" class="responsive-img" alt="FastAPI：(9)安全性">
                        
                        <span class="card-title">FastAPI：(9)安全性</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2025-06-02
                        </span>
                        
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E4%B8%93%E4%B8%9A/" class="post-category">
                                    专业
                                </a>
                            
                            <a href="/categories/%E4%B8%93%E4%B8%9A/%E6%A1%86%E6%9E%B6/" class="post-category">
                                    框架
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/FastAPI/">
                        <span class="chip bg-color">FastAPI</span>
                    </a>
                    
                    <a href="/tags/Python/">
                        <span class="chip bg-color">Python</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/posts/61316.html">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/25.png" class="responsive-img" alt="FastAPI：(7)路劲操作配置与JSON编码兼容">
                        
                        <span class="card-title">FastAPI：(7)路劲操作配置与JSON编码兼容</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2025-05-27
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E4%B8%93%E4%B8%9A/" class="post-category">
                                    专业
                                </a>
                            
                            <a href="/categories/%E4%B8%93%E4%B8%9A/%E6%A1%86%E6%9E%B6/" class="post-category">
                                    框架
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/FastAPI/">
                        <span class="chip bg-color">FastAPI</span>
                    </a>
                    
                    <a href="/tags/Python/">
                        <span class="chip bg-color">Python</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('120')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE' || selection.getRangeAt(0).commonAncestorContainer.nodeName === 'CODE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + '来源: Hkini<br />'
            + '文章作者: Hkini<br />'
            + '文章链接: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者所有，任何形式的转载都请注明出处。';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>


<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>



<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>



    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('2'),
            // headingSelector: 'h1, h2, h3, h4, h5, h6'
            headingSelector: 'none',
        });
        var tocList = $('<ol>', { class: 'toc-list' }); // 创建顶层 <ol> 容器
        var currentLevel = 1; // 当前层级
        var parentStack = [tocList]; // 用于存储父级 <ol> 的栈

        $('#articleContent').find('h1, h2, h3, h4, h5, h6').each(function () {
            var $heading = $(this);
            var headingText = $heading.text();
            var level = parseInt($heading[0].tagName[1], 10); // 获取当前标题的层级，例如 h1 -> 1, h2 -> 2
            
            // var tocList = $('<ol>', { class: 'toc-list ' }); // 创建 <ol> 容器
            var tocListItem = $('<li>', { class: 'toc-list-item' }); // 创建 <li> 容器

            var tocItem = $('<a>', { 
                href: '#' + $heading.attr('id'), 
                class: 'toc-link' // 添加 class="toc-link"
            }).text(headingText); // 创建 <a> 标签

            // 创建箭头 SVG
            var arrowSvg = `<svg class="arrow-icon" xmlns="http://www.w3.org/2000/svg" fill="none" version="1.1" viewBox="0 0 24 24" class="h-[0.96em] w-[0.96em] text-foreground" style="transition: transform 233ms cubic-bezier(0.42, 0, 0.24, 1); transform: rotate(0deg);"><path d="m18.707 9.7075 4e-4 -3.75e-4q0.1407-0.14065 0.2168-0.32442 0.0761-0.18377 0.0761-0.38268t-0.0761-0.38268q-0.0761-0.18377-0.2168-0.32442-0.1406-0.14065-0.3244-0.21677-0.1838-0.07612-0.3827-0.07612t-0.3827 0.076121q-0.1838 0.07612-0.3244 0.21677l-4e-4 3.75e-4 -5.2925 5.2925-5.2929-5.2929q-0.14065-0.14065-0.32442-0.21677-0.18377-0.07612-0.38268-0.07612t-0.38268 0.07612q-0.18377 0.076121-0.32442 0.21677t-0.21677 0.32442q-0.07612 0.18377-0.07612 0.38268t0.07612 0.38268q0.076121 0.18377 0.21677 0.32442l6 6q0.14066 0.14065 0.32443 0.21677 0.18377 0.07612 0.38268 0.07612t0.38268-0.07612q0.18377-0.07612 0.32443-0.21677l5.9996-5.9996z" fill="currentColor" fill-rule="evenodd"></path></svg>`;

            // 包裹 <a> 标签的 <div>
            var tocItemWrapper = $('<div>', { 
                class: 'toc-item-wrapper' // 添加 class="toc-item-wrapper"
            }).append(tocItem).append(arrowSvg); // 将 <a> 添加到 <div>

            // 为 TOC 项添加相应的缩进
            // tocItem.css('padding-left', (level - 1) * 20 + 'px');

            // 将 <a> 添加到 <li>
            tocListItem.append(tocItemWrapper);
             // 如果当前标题层级比上一个标题层级高，创建新的嵌套 <ol>
                if (level > currentLevel) {
                var nestedList = $('<ol>', { class: 'toc-list' }); // 创建嵌套的 <ol>
                parentStack[parentStack.length - 1].children('li:last').append(nestedList); // 将嵌套 <ol> 添加到父级 <li>
                parentStack.push(nestedList); // 将嵌套 <ol> 压入栈
            } 
            // 如果当前标题层级比上一个标题层级低，回退到正确的父级
            else if (level < currentLevel) {
                while (level < currentLevel) {
                    parentStack.pop(); // 弹出栈顶，回退到上一级
                    currentLevel--;
                }
            }

            // 将当前 <li> 添加到当前层级的 <ol>
            parentStack[parentStack.length - 1].append(tocListItem);
            currentLevel = level; // 更新当前层级
      
           
            
            // 查找该标题下的 evoldown 内容（#d, #e, #t, #c, #v, #a）
            $heading.nextUntil('h1, h2, h3, h4, h5, h6').each(function () {
                var $div = $(this);
                if ($div.hasClass('evoldown')) {
                    var type = $div.attr('type');
                    var id = $div.attr('id');
                    var label = $div.text(); // 假设需要从内容中提取 label
                    var icon = '';

                    // 根据类型插入相应的图标
                    switch (type) {
                        case 'd':
                            icon = '<svg type="d" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m21.15 6.85c0-2.2056-1.7944-4-4-4-4.1765-0.01989-5.4993 5.7322-1.8147 7.5629-0.263 0.63631-0.4627 1.4421-0.6559 2.2215-0.1397 0.56337-0.2841 1.1459-0.4405 1.6084-0.0728 0.2155-0.1286 0.4813-0.1891 0.4813-0.5072-0.7362-0.8126-2.2507-1.0979-3.3161-0.47879-1.5358-0.72936-4.4237-2.8018-4.558-0.77422 7e-5 -1.3844 0.52253-1.8138 1.553-0.55019 1.254-0.75064 3.2421-1.3784 4.4472-0.39648 3e-4 -0.79576 0.0045-1.1877 0.0703-0.67978 0.1073-1.3339 0.4195-1.798 0.9347-0.39707 0.4315-0.6427 0.9874-0.74275 1.5623-0.063545 0.351-0.07691 0.7094-0.07883 1.0654 0.001935 0.4718-0.01324 0.9457 0.027745 1.4163 0.09435 1.151 0.65732 2.1308 1.7281 2.6237 0.43467 0.1975 0.91053 0.2877 1.3854 0.3129 0.40096 0.0215 0.80345 0.0129 1.2048 0.0139 0.6491 2e-4 1.2891-0.0515 1.888-0.3229 0.90042-0.4067 1.4845-1.2039 1.6712-2.1666 0.0761-0.3779 0.09179-0.7654 0.09344-1.15 7.7e-4 -0.2699 0.00148-0.5413-7.8e-4 -0.8111-0.00379-0.4854-0.04143-0.9771-0.19121-1.4414-0.28748-0.9172-0.98053-1.616-1.8964-1.909 0.43984-1.1576 0.66815-2.7594 1.1268-3.8895 0.3537 0.72804 0.57113 1.7669 0.82283 2.7298 0.26567 1.0724 0.5404 2.1814 0.90896 3.0557 0.87204 2.2985 3.1124 2.7586 4.0452 0.392 0.5508-1.2642 0.7508-3.279 1.3828-4.4916 2.1142-0.10339 3.8024-1.8557 3.8024-3.995zm-12.073 8.8023c0.05605 0.2275 0.06623 0.465 0.07092 0.6983 0.00363 0.2444 0.00195 0.4906 0.00214 0.735-0.0063 0.408 0.01486 0.882-0.18359 1.2496-0.24573 0.4539-0.8026 0.501-1.2651 0.5114-0.33714 0.0058-0.67525 0.0041-1.0124 0.0018-0.46455-0.0092-1.0361-0.0245-1.3192-0.4545-0.16612-0.2552-0.19733-0.5702-0.21202-0.8673-0.01004-0.2443-0.00683-0.4906-0.0075-0.735 5.9e-4 -0.2322-0.00201-0.4664 0.01171-0.6983 0.01886-0.2936 0.06332-0.6069 0.24969-0.8453 0.34185-0.4331 1.0226-0.3889 1.5228-0.3979 0.38828 0.0035 0.77905-0.0131 1.1658 0.0285 0.49865 0.0566 0.85211 0.2621 0.97684 0.7737zm8.0732-6.8023c-2.6379-0.06696-2.6373-3.9334 0-4 2.6378 0.06697 2.6373 3.9334 0 4z" fill="currentColor"></path></svg>'; // 填入 #d 对应的 SVG 图标
                            break;
                        case 'e':
                            icon = '<svg type="e" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path fill="currentColor" d="m21.9 15.621c0.1248-1.8535-0.6087-3.4099-2.6058-3.8292-0.7712-0.15744-1.3921-0.13977-2.1113-0.14543-0.6323 0.0048-1.1718-0.01567-1.8401 0.03203 1.5356-0.8078 1.6998-2.205 1.6567-3.546 0.1272-2.3708-1.4685-3.666-3.7727-3.673-2.2427-0.04024-5.0463-0.27229-5.9443 1.9172-0.28083 0.6692-0.27606 1.2179-0.28202 1.6587-0.08527 1.4303 0.20687 2.9224 1.662 3.6429-2.3051-0.05275-5.3273-0.39212-6.28 1.8983-0.28073 0.66862-0.27595 1.2174-0.282 1.6572-0.10329 1.6061 0.3059 3.171 2.0252 3.8067 1.2061 0.4187 2.2175 0.2869 3.3945 0.3134 2.0524 0.0901 4.0448-0.4637 4.4796-2.4982 0.609 2.5638 3.2086 2.5463 5.3204 2.4982 2.7823 0.1278 4.7024-0.9368 4.5798-3.7329zm-12.899-7.6287c-0.14889-1.8665 1.8839-1.4921 3.1358-1.546 0.8939 0.05358 2.4743-0.21158 2.8003 0.88445 0.2729 2.4494-0.0297 2.8555-2.5242 2.8232-0.94713-0.07259-2.869 0.28949-3.3134-0.77077-0.14881-0.44557-0.08538-0.92893-0.09846-1.3909zm0.2606 9.2128c-0.56638 0.162-1.1652 0.1412-1.7487 0.1488-0.59786-0.0036-1.1977 0.0131-1.7948-0.0233-0.93407-0.0365-1.6776-0.3579-1.6157-1.4217 0.01574-0.5119-0.06845-1.0551 0.11822-1.5436 0.4432-0.84155 1.5978-0.6728 2.4032-0.7191 0.81712 0.01614 1.6464-0.05154 2.4536 0.10154 0.99382 0.17537 1.0564 0.91742 1.0227 1.7752-6.1e-4 0.7729 0.04085 1.416-0.83867 1.6821zm2.9212-3.6286c-0.0836 0.19457-0.14194 0.3848-0.18279 0.56614-0.18535-0.87758-0.76293-1.6189-1.5605-2.02 1.0871 0.04933 2.0387 0.04959 3.1216-8e-5 -0.7672 0.39034-1.1687 0.96486-1.3783 1.4539zm6.8788 3.6286c-0.5664 0.162-1.1652 0.1412-1.7488 0.1488-0.5978-0.0036-1.1977 0.0131-1.7947-0.0233-0.9341-0.0365-1.6776-0.3579-1.6157-1.4217 0.0157-0.5119-0.0685-1.0551 0.1182-1.5436 0.4432-0.84155 1.5978-0.6728 2.4033-0.7191 0.8171 0.01614 1.6464-0.05154 2.4536 0.10154 0.9938 0.17537 1.0563 0.91742 1.0227 1.7752-6e-4 0.7729 0.0409 1.416-0.8386 1.6821z"></path></svg>'; // 填入 #e 对应的 SVG 图标
                            break;
                        case 't':
                            icon = '<svg type="t" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m15.385 10.538c-0.52922 1.222-0.74082 3.1121-1.2852 4.3107-0.06906-2e-5 -0.24102-0.40954-0.40553-0.85764-0.54849-1.4968-0.91293-3.7816-1.4977-5.2179-0.49825-1.7178-2.7313-2.8836-3.8104-0.24557-0.55221 1.2498-0.75261 3.2793-1.3921 4.4683-0.45354 0.09492-0.79418 0.49706-0.79418 0.9788 0 0.5523 0.4477 1 1 1 0.77414 0 1.3844-0.52246 1.8137-1.5529 0.50969-1.1819 0.73444-2.9587 1.2241-4.138 0.07175 2e-5 0.14687 0.33291 0.23664 0.59492 0.20698 0.60425 0.39119 1.3477 0.58618 2.1349 0.2657 1.0724 0.54043 2.1814 0.90899 3.0557 0.87212 2.2985 3.1123 2.7586 4.0452 0.39202 0.55283-1.2608 0.75203-3.309 1.3936-4.5083 0.4522-0.0959 0.7915-0.49744 0.7915-0.97823 0-0.55229-0.4477-1-1-1-0.7755 0-1.3861 0.526-1.8148 1.5634z" fill="currentColor"></path><path d="m15.802 6.9697c-0.1557 0.1946-0.1882 0.58884 0.1331 0.60533 1.2616 0.02168 2.5193 0.48654 3.5913 1.2655 0.2705 0.19453 0.6808 0.05368 0.7176-0.30435 0.0793-0.76097 0.0572-1.5713-0.086-2.401-0.1456-0.82752-0.4109-1.6736-0.8018-2.5036-0.1536-0.34251-0.6624-0.55548-0.9204-0.23779l-0.7238 0.98277c-3.8989-2.9446-9.692-2.2836-12.827 1.4659-6.4518 7.8165 1.8281 18.818 11.123 14.783 1.8924-0.8564 3.4853-2.3528 4.4507-4.1927 0.0679-0.1218 0.1291-0.2481 0.1823-0.377 0.1017-0.2304 0.1549-0.518-0.0557-0.7052-0.1162-0.1043-0.2646-0.1628-0.4074-0.221-0.1475-0.0577-0.2953-0.116-0.4439-0.1706-0.2042-0.0713-0.4475-0.1531-0.6498-0.0358-0.0846 0.0496-0.1444 0.131-0.1982 0.2109-0.0747 0.1157-0.1266 0.2445-0.1952 0.3636-0.4837 0.9276-1.1717 1.74-1.9925 2.3831-0.8208 0.6431-1.7745 1.1169-2.7897 1.3673-7.0612 1.7198-12.182-6.5444-7.5021-12.107 2.4634-2.9539 7.0543-3.4782 10.119-1.154" fill="currentColor"></path></svg>'; // 填入 #t 对应的 SVG 图标
                            break;
                        case 'v':
                            icon = '<svg type="v" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m12.006 2.4861c8.295-0.034635 12.587 10.042 6.9396 15.995 0.302-0.0792 0.5884 0.106 0.8099 0.2931 0.1763 0.1517 0.337 0.3223 0.4938 0.4938 0.1806 0.1987 0.3602 0.3999 0.5393 0.6 0.158 0.1775 0.3162 0.3571 0.4573 0.5485 0.0932 0.127 0.1803 0.2635 0.2402 0.4098 0.0591 0.1432 0.0867 0.3066 0.0463 0.4586l-0.0182 0.058c-0.0546 0.1443-0.1606 0.2646-0.2695 0.3712-0.0972 0.0941-0.2013 0.1853-0.3018 0.2759-0.1104 0.0982-0.2212 0.201-0.3417 0.287-0.1188 0.0852-0.2583 0.1531-0.4066 0.159-0.2688 9e-3 -0.5043-0.1558-0.7006-0.3227-0.1407-0.1218-0.2719-0.2564-0.3983-0.3929-0.2101-0.2279-0.4164-0.4606-0.6233-0.6914-0.1578-0.1777-0.3167-0.3566-0.4572-0.5485-0.0869-0.1186-0.1682-0.2449-0.2272-0.3799-0.06-0.136-0.0946-0.2901-0.0688-0.4385l0.0117-0.0521 0.0161-0.0498c-1.7182 1.3134-3.966 2.0444-6.2474 1.9119-12.23-1.0527-11.717-18.608 0.50643-18.986zm-6.8e-4 2c-3.9794 3.5e-4 -7.2654 3.1166-7.4809 7.0946-0.30103 4.0208 3.0533 7.76 7.0834 7.8947 4.1153 0.2383 7.6845-2.9602 7.8946-7.0833 0.319-4.1746-3.3113-8.0014-7.4964-7.9059" fill="currentColor"></path><path d="m8.2769 7.8469c0.29326 0.69532 0.64074 1.1934 1.5 1.3397 0.4567-0.53241 1.0671-0.92645 1.7212-0.97652 0.65414-0.05007 1.1756 0.26304 1.2305 0.98096 0.10016 1.3082-2.47 2.532-1.899 4.9596 0.64656 0.38624 1.7475 0.36741 2.2073 0.03029-0.36861-2.09 2.575-3.1725 2.4052-5.3901-0.16975-2.2175-1.7734-3.0416-3.7676-2.8889-1.4358 0.10991-2.597 0.87279-3.3975 1.945z" fill="currentColor"></path><path d="m12.01 14.568c-0.99198 0-1.696 0.76802-1.696 1.7601 0 0.992 0.70406 1.776 1.696 1.776 0.97603 0 1.696-0.78404 1.696-1.776 0-0.99204-0.72002-1.7601-1.696-1.7601z" fill="currentColor"></path></svg>'; // 填入 #v 对应的 SVG 图标
                            break;
                        case 'a':
                            icon = '<svg type="a" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m15.45 7.35c-0.0022-1.4574-0.7043-2.0002-2.0001-2.0002-0.5281 0-1.0428 0.12066-1.6692 0.8986-1.2172 1.2052-3.5662 1.5773-6.4138 1.5566-0.92067 0.00495-1.8844 0.27586-2.521 0.97407-0.89662 0.97053-0.8534 2.1136-0.84541 3.3436-0.088935 2.0639 1.0163 3.5806 3.1554 3.6639 0.18073 0.9556 0.68251 3.671 0.86079 4.5885 0.11273 0.6047 0.44099 0.6361 0.97316 0.525 0.52124-0.1078 1.1127-0.1057 0.99809-0.819-0.14025-0.8342-0.63023-3.3751-0.78778-4.2434 2.2128 0.1862 3.6134 0.5907 4.5806 1.5138 0.63361 0.6782 1.2967 0.8987 1.6692 0.8987 1.2958-1e-4 2.0107-0.6194 2.0001-2.0002v-3.2681c0.2954-0.13425 0.725-0.23189 1.35-0.23189v-2c-0.625 0-1.0546-0.09763-1.35-0.23189v-3.1681zm-2 8.9q-1.45-2.45-7.4205-2.45c-1.4917 0.02186-2.072-0.06445-2.0295-1.7275 0.00524-1.5258-0.13158-2.3285 1.723-2.2725 5.5801 0.23384 7.964-2.492 7.727-2.45v8.9z" fill="currentColor"></path><path d="m22.024 11.62c0.00399-0.58801-0.05448-1.0153-0.74975-1.0361-0.41509-0.00662-0.82816 0.057395-1.2409 0.094325-0.33033 0.040455-0.73566 0.076976-1.0072 0.28268-0.28398 0.21724-0.23153 0.59429-0.23733 0.9112-0.0015854 0.30307-0.0045853 0.60983 0.27663 0.79666 0.23484 0.15349 0.52158 0.19534 0.7942 0.23343 0.23915 0.02956 0.48002 0.05101 0.71976 0.07523 0.48243 0.03148 1.2248 0.19557 1.394-0.41829 0.0757-0.30577 0.04467-0.627 0.05067-0.93912z" fill="currentColor"></path><path d="m17.348 5.7962c0.042171 0.25853 0.19707 0.48146 0.30883 0.71387 0.28865 0.62708 0.76754 0.52952 1.3216 0.33695 0.29707-0.1074 0.5898-0.22819 0.88354-0.34427 1.2431-0.47478 0.99431-0.8753 0.46485-1.8723-0.42612-0.90268-0.91649-0.67014-1.6207-0.2097-0.32028 0.21007-0.65168 0.40646-0.95187 0.64525-0.21815 0.17815-0.44959 0.42625-0.40623 0.73022z" fill="currentColor"></path><path d="m20.756 17.801c-0.08779-0.41834-0.59472-0.57-0.94009-0.72238-0.31748-0.12454-0.63252-0.2579-0.95618-0.36584-0.27393-0.083771-0.59373-0.17244-0.86319-0.031395-0.21247 0.11853-0.30992 0.35702-0.4191 0.56205-0.12688 0.25243-0.31107 0.53775-0.19892 0.82794 0.1101 0.27652 0.36419 0.46004 0.59732 0.62904 0.18414 0.12824 0.3747 0.24849 0.56281 0.37079 0.15333 0.0986 0.3065 0.19968 0.46418 0.29127 0.21755 0.12307 0.46707 0.25848 0.72501 0.21843 0.34543-0.06224 0.50617-0.44433 0.6571-0.72156 0.07714-0.15037 0.15704-0.30255 0.23064-0.4547 0.08692-0.18674 0.17446-0.39353 0.14043-0.60364z" fill="currentColor"></path></svg>'; // 填入 #a 对应的 SVG 图标
                            break;
                        case 'c':
                            icon = '<svg type="c" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m6.825 4.8749c1.8175-0.03033 2.3249 0.02869 2.25 2.0152 0.01496 1.139 0.01338 1.984-1.3875 1.9798-1.6108-0.01491-2.7285 0.30288-2.6124-1.796-0.019-1.5193-0.04171-2.2697 1.7499-2.1989zm0-2c-2.5847-0.10689-3.8882 1.4181-3.7496 3.8782-0.058825 1.6262 0.20934 2.9456 1.5713 3.7018 0.98591 0.49526 1.6843 0.40204 2.4713 0.42016 0.661-0.00557 1.2079 0.02014 1.9275-0.21866 1.051-0.35295 1.7794-1.2693 1.9533-2.3675 0.08948-0.54803 0.07327-0.95095 0.0762-1.3975-0.00196-0.42752 0.01114-0.8053-0.05632-1.306-0.24162-1.9408-1.9089-2.8188-3.6634-2.7097-0.17686-7.9441e-4 -0.35349-2.3937e-4 -0.53038-7.7934e-4z" fill="currentColor"></path><path d="m17.075 8.6749c1.8175-0.03034 2.3249 0.02868 2.25 2.0152 0.01495 1.139 0.01338 1.984-1.3875 1.9797-1.6108-0.01491-2.7285 0.30288-2.6124-1.796-0.01899-1.5193-0.04171-2.2697 1.7499-2.1989zm0-2c-2.5847-0.10689-3.8882 1.4181-3.7496 3.8782-0.05882 1.6262 0.20933 2.9457 1.5713 3.7017 0.98593 0.49528 1.6843 0.40205 2.4713 0.42017 0.66099-0.00556 1.2079 0.02015 1.9275-0.21865 1.051-0.35295 1.7794-1.2693 1.9533-2.3675 0.08949-0.54803 0.07328-0.95095 0.07621-1.3975-0.00197-0.42839 0.0112-0.80698-0.05673-1.3089-0.24288-1.9391-1.9097-2.8158-3.663-2.7068-0.17688-7.9346e-4 -0.35351-2.388e-4 -0.5304-7.7896e-4z" fill="currentColor"></path><path d="m8.4749 15.525c1.8175-0.03033 2.3249 0.02868 2.25 2.0152 0.01496 1.139 0.01338 1.984-1.3875 1.9797-1.6108-0.01491-2.7285 0.30288-2.6124-1.796-0.01899-1.5193-0.04172-2.2697 1.7499-2.1989zm0-2c-2.5847-0.10689-3.8882 1.4181-3.7496 3.8782-0.058825 1.6262 0.20934 2.9456 1.5713 3.7018 0.98591 0.49526 1.6843 0.40203 2.4713 0.42016 0.66099-0.00557 1.2079 0.02014 1.9276-0.21866 1.051-0.35294 1.7794-1.2693 1.9533-2.3675 0.08949-0.54803 0.07328-0.95095 0.07621-1.3975-0.00197-0.42753 0.01113-0.80529-0.05633-1.306-0.24162-1.9408-1.9089-2.8188-3.6634-2.7097-0.17688-7.9346e-4 -0.35351-2.4262e-4 -0.5304-7.8736e-4z" fill="currentColor"></path></svg>'; // 填入 #c 对应的 SVG 图标
                            break;
                    }
                    // 创建 <span> 包裹图标和附加信息
                    var iconSpan = $('<span>', { class: 'icon' }).html(`
                        <a href="#${id}" class: 'toc-link evoldown_toc_link'>
                            ${icon}
                            <p name="label">${id}</p>
                        </a>
                    `);

                    // 创建 <ol> 容器，设置与标题相同的缩进
                    var tocIconList = $('<ol>', { 
                        class: 'toc-list evoldown ', 
                        type: type,
                    });
                    tocIconList.append(iconSpan);
                    // 将 <ol> 添加到当前 TOC 项
                    tocListItem.append(tocIconList);
                }
            });
            

            // 点击箭头切换展开/隐藏
            tocItemWrapper.find('.arrow-icon').click(function (e) {
                e.stopPropagation(); // 阻止事件冒泡
                var $arrow = $(this);
                var $parentDiv = $arrow.closest('.toc-item-wrapper'); // 获取箭头所在的父级 <div>
                var $nextLists =  $parentDiv.siblings('ol.toc-list'); // 获取与父级 <div> 同级的 <ol>

                // 判断箭头当前的旋转状态
                if ($arrow.css('transform') === 'matrix(1, 0, 0, 1, 0, 0)') { // rotate(0deg) 表示箭头指向下
                    // 隐藏逻辑
                    $arrow.css('transform', 'rotate(90deg)'); // 将箭头旋转为向左
                    $nextLists.css('display', 'none'); // 隐藏内容
                } else {
                    // 展开逻辑
                    $arrow.css('transform', 'rotate(0deg)'); // 将箭头旋转为向下
                    $nextLists.css('display', 'block'); // 显示内容
                }
            });

            // 将 <li> 添加到 <ol>
            // tocList.append(tocListItem);

            // 将 TOC 项添加到 TOC 容器
            $('#toc-content').append(tocList);


        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>


<script src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script src="/libs/prism/prism.js" defer></script>
<script src="https://cdn.bootcdn.net/ajax/libs/prism/1.9.0/plugins/line-numbers/prism-line-numbers.js" defer></script>
<script>
    MathJax.Hub.Config({
        tex2jax: {inlineMath: [['$', '$'], ['\\(', '\\)']]}
    });
</script>



    
<footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="6638358192"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="/libs/aplayer/Meting.min.js"></script>

    

    <div class="container row center-align"
         style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2022-2025</span>
            
            <a href="/about" target="_blank">Hkini</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
                &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                        class="white-color">189.7k</span>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
                <span id="sitetime"> Loading ...</span>
                <script>
                    var calcSiteTime = function () {
                        var seconds = 1000;
                        var minutes = seconds * 60;
                        var hours = minutes * 60;
                        var days = hours * 24;
                        var years = days * 365;
                        var today = new Date();
                        var startYear = "2022";
                        var startMonth = "12";
                        var startDate = "25";
                        var startHour = "0";
                        var startMinute = "0";
                        var startSecond = "0";
                        var todayYear = today.getFullYear();
                        var todayMonth = today.getMonth() + 1;
                        var todayDate = today.getDate();
                        var todayHour = today.getHours();
                        var todayMinute = today.getMinutes();
                        var todaySecond = today.getSeconds();
                        var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                        var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                        var diff = t2 - t1;
                        var diffYears = Math.floor(diff / years);
                        var diffDays = Math.floor((diff / days) - diffYears * 365);

                        // 区分是否有年份.
                        var language = 'zh-CN';
                        if (startYear === String(todayYear)) {
                            document.getElementById("year").innerHTML = todayYear;
                            var daysTip = 'This site has been running for ' + diffDays + ' days';
                            if (language === 'zh-CN') {
                                daysTip = '本站已运行 ' + diffDays + ' 天';
                            } else if (language === 'zh-HK') {
                                daysTip = '本站已運行 ' + diffDays + ' 天';
                            }
                            document.getElementById("sitetime").innerHTML = daysTip;
                        } else {
                            document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                            var yearsAndDaysTip = 'This site has been running for ' + diffYears + ' years and '
                                + diffDays + ' days';
                            if (language === 'zh-CN') {
                                yearsAndDaysTip = '本站已运行 ' + diffYears + ' 年 ' + diffDays + ' 天';
                            } else if (language === 'zh-HK') {
                                yearsAndDaysTip = '本站已運行 ' + diffYears + ' 年 ' + diffDays + ' 天';
                            }
                            document.getElementById("sitetime").innerHTML = yearsAndDaysTip;
                        }
                    }

                    calcSiteTime();
                </script>
            
            <br>
            
                <span id="icp"><img src="/medias/icp.png"
                                    style="vertical-align: text-bottom;"/>
                <a href="https://beian.miit.gov.cn/" target="_blank">蜀ICP备2023000334号-1</a>
            </span>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/togetherhkl" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:hekailin@gmail.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1778267485" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1778267485" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>





    <a href="https://www.zhihu.com/people/wei-lai-ke-qi-49-69" class="tooltipped" target="_blank" data-tooltip="关注我的知乎: https://www.zhihu.com/people/wei-lai-ke-qi-49-69" data-position="top" data-delay="50">
        <i class="fab fa-zhihu1">知</i>
    </a>



    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 白天和黑夜主题 -->
<div class="stars-con">
    <div id="stars"></div>
    <div id="stars2"></div>
    <div id="stars3"></div>  
</div>

<script>
    function switchNightMode() {
        $('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($('body')),
        setTimeout(function () {
            $('body').hasClass('DarkMode') 
            ? ($('body').removeClass('DarkMode'), localStorage.setItem('isDark', '0'), $('#sum-moon-icon').removeClass("fa-sun").addClass('fa-moon')) 
            : ($('body').addClass('DarkMode'), localStorage.setItem('isDark', '1'), $('#sum-moon-icon').addClass("fa-sun").removeClass('fa-moon')),
            
            setTimeout(function () {
            $('.Cuteen_DarkSky').fadeOut(1e3, function () {
                $(this).remove()
            })
            }, 2e3)
        })
    }
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    
        <!-- <script src='https://unpkg.com/mermaid@latest/dist/mermaid.min.js'></script> -->
        <script src='/libs/mermaid/mermaid.min.js'></script>
        <script>
          if (window.mermaid) {
            mermaid.initialize({theme: 'forest'});
          }
        </script>
    

    

    <!-- 雪花特效 -->
    

    <!-- 鼠标星星特效 -->
    

     
        <script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
        <script src="/libs/others/TencentCaptcha.js"></script>
        <button id="TencentCaptcha" data-appid="195339201" data-cbfn="callback" type="button" hidden></button>
    

    <!-- Baidu Analytics -->

<script>
    var _hmt = _hmt || [];
    (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
