<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="天池人脸识别项目复现, Hkini, 学习, 生活, 工作, 记录">
    <meta name="description" content=" 1 项目背景

        
          
            
            概述
            项目的目的
          
        
      
图像分类是整个计算机视觉领域中最基础">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->

<script async src="https://www.googletagmanager.com/gtag/js?id="></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
        dataLayer.push(arguments);
    }

    gtag('js', new Date());
    gtag('config', '');
</script>


    <title>天池人脸识别项目复现 | Hkini</title>
    <link rel="icon" type="image/png" href="/medias/logo.png">
    <link rel="stylesheet" type="text/css" href="/libs/prism/prism.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.bootcdn.net/ajax/libs/prism/1.9.0/plugins/line-numbers/prism-line-numbers.css">
    
    <style>
        body{
            background-image: url(/medias/images/3.png);
            background-repeat:no-repeat;
            background-size: 100% 100%;
            background-attachment:fixed;
        }
    </style>



    <!-- bg-cover style     -->



<link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
<link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
<link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
<link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
<link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
<link rel="stylesheet" type="text/css" href="/css/matery.css">
<link rel="stylesheet" type="text/css" href="/css/my.css">
<link rel="stylesheet" type="text/css" href="/css/dark.css" media="none" onload="if(media!='all')media='all'">




    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
    <link rel="stylesheet" href="/css/post.css">




    
        <link rel="stylesheet" type="text/css" href="/css/reward.css">
    



    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>

<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="Hkini" type="application/atom+xml">
</head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper head-container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">Hkini</span>
                </a>
            </div>
            



<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  
    <li class="menu-level-1">
      <a href="/" class="waves-effect waves-light">
        
        <i class="fas fa-home moz-zoom" style="zoom: 0.6;"></i>
        
        <span>首页</span>
        
      </a>
      
    </li>
  
    <li class="menu-level-1">
      <a href="/" class="waves-effect waves-light">
        
        <i class="fas fa-graduation-cap moz-zoom" style="zoom: 0.6;"></i>
        
        <span>专业</span>
        
        <i class="fas fa-chevron-right moz-zoom" aria-hidden="true" style="zoom: 0.6;"></i>
        
      </a>
      
      <ul class="sub-nav menu-level-2 menus_item_child">
        
  
    <li class="menu-level-2">
      <a href="/categories/%E4%B8%93%E4%B8%9A/%E5%9F%BA%E7%A1%80%E7%90%86%E8%AE%BA" class="waves-effect waves-light">
        
        <i class="fas fa-book moz-zoom" style="zoom: 0.6;"></i>
        
        <span>01基础理论</span>
        
      </a>
      
    </li>
  
    <li class="menu-level-2">
      <a href="/categories/%E4%B8%93%E4%B8%9A/%E6%A1%86%E6%9E%B6" class="waves-effect waves-light">
        
        <i class="fas fa-cubes moz-zoom" style="zoom: 0.6;"></i>
        
        <span>02框架</span>
        
      </a>
      
    </li>
  
    <li class="menu-level-2">
      <a href="/categories/%E4%B8%93%E4%B8%9A/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80" class="waves-effect waves-light">
        
        <i class="fas fa-code moz-zoom" style="zoom: 0.6;"></i>
        
        <span>03编程语言</span>
        
      </a>
      
    </li>
  
    <li class="menu-level-2">
      <a href="/categories/%E4%B8%93%E4%B8%9A/%E5%AE%9E%E8%B7%B5%E9%A1%B9%E7%9B%AE" class="waves-effect waves-light">
        
        <i class="fas fa-project-diagram moz-zoom" style="zoom: 0.6;"></i>
        
        <span>04实践项目</span>
        
      </a>
      
    </li>
  
    <li class="menu-level-2">
      <a href="/categories/%E4%B8%93%E4%B8%9A/%E9%85%8D%E7%BD%AE%E8%AE%B0%E5%BD%95" class="waves-effect waves-light">
        
        <i class="fas fa-tools moz-zoom" style="zoom: 0.6;"></i>
        
        <span>05配置记录</span>
        
      </a>
      
    </li>
  

      </ul>
      
    </li>
  
    <li class="menu-level-1">
      <a href="/" class="waves-effect waves-light">
        
        <i class="fas fa-briefcase moz-zoom" style="zoom: 0.6;"></i>
        
        <span>工作</span>
        
        <i class="fas fa-chevron-right moz-zoom" aria-hidden="true" style="zoom: 0.6;"></i>
        
      </a>
      
      <ul class="sub-nav menu-level-2 menus_item_child">
        
  
    <li class="menu-level-2">
      <a href="/categories/%E5%B7%A5%E4%BD%9C/%E9%A1%B9%E7%9B%AE" class="waves-effect waves-light">
        
        <i class="fas fa-tasks moz-zoom" style="zoom: 0.6;"></i>
        
        <span>01项目</span>
        
      </a>
      
    </li>
  

      </ul>
      
    </li>
  
    <li class="menu-level-1">
      <a href="/" class="waves-effect waves-light">
        
        <i class="fas fa-icons moz-zoom" style="zoom: 0.6;"></i>
        
        <span>兴趣</span>
        
        <i class="fas fa-chevron-right moz-zoom" aria-hidden="true" style="zoom: 0.6;"></i>
        
      </a>
      
      <ul class="sub-nav menu-level-2 menus_item_child">
        
  
    <li class="menu-level-2">
      <a href="/categories/%E5%85%B4%E8%B6%A3/%E9%98%85%E8%AF%BB" class="waves-effect waves-light">
        
        <i class="fas fa-book-open moz-zoom" style="zoom: 0.6;"></i>
        
        <span>01阅读</span>
        
      </a>
      
    </li>
  
    <li class="menu-level-2">
      <a href="/categories/%E5%85%B4%E8%B6%A3/%E7%85%A7%E7%89%87" class="waves-effect waves-light">
        
        <i class="fas fa-image moz-zoom" style="zoom: 0.6;"></i>
        
        <span>02照片</span>
        
      </a>
      
    </li>
  

      </ul>
      
    </li>
  
    <li class="menu-level-1">
      <a href="/" class="waves-effect waves-light">
        
        <i class="fas fa-seedling moz-zoom" style="zoom: 0.6;"></i>
        
        <span>个人成长</span>
        
        <i class="fas fa-chevron-right moz-zoom" aria-hidden="true" style="zoom: 0.6;"></i>
        
      </a>
      
      <ul class="sub-nav menu-level-2 menus_item_child">
        
  
    <li class="menu-level-2">
      <a href="/categories/%E4%B8%AA%E4%BA%BA%E6%88%90%E9%95%BF/%E8%AE%A1%E5%88%92%E4%B8%8E%E6%80%BB%E7%BB%93" class="waves-effect waves-light">
        
        <i class="fas fa-tasks moz-zoom" style="zoom: 0.6;"></i>
        
        <span>01计划与总结</span>
        
      </a>
      
    </li>
  
    <li class="menu-level-2">
      <a href="/categories/%E4%B8%AA%E4%BA%BA%E6%88%90%E9%95%BF/%E6%84%9F%E6%82%9F" class="waves-effect waves-light">
        
        <i class="fas fa-lightbulb moz-zoom" style="zoom: 0.6;"></i>
        
        <span>02感悟</span>
        
      </a>
      
    </li>
  

      </ul>
      
    </li>
  
    <li class="menu-level-1">
      <a href="/" class="waves-effect waves-light">
        
        <i class="fas fa-list moz-zoom" style="zoom: 0.6;"></i>
        
        <span>整理</span>
        
        <i class="fas fa-chevron-right moz-zoom" aria-hidden="true" style="zoom: 0.6;"></i>
        
      </a>
      
      <ul class="sub-nav menu-level-2 menus_item_child">
        
  
    <li class="menu-level-2">
      <a href="/catstags" class="waves-effect waves-light">
        
        <i class="fas fa-bookmark moz-zoom" style="zoom: 0.6;"></i>
        
        <span>分类&标签</span>
        
      </a>
      
    </li>
  
    <li class="menu-level-2">
      <a href="/archives" class="waves-effect waves-light">
        
        <i class="fas fa-file-lines moz-zoom" style="zoom: 0.6;"></i>
        
        <span>归档</span>
        
      </a>
      
    </li>
  
    <li class="menu-level-2">
      <a href="/friends" class="waves-effect waves-light">
        
        <i class="fas fa-address-book moz-zoom" style="zoom: 0.6;"></i>
        
        <span>友链</span>
        
      </a>
      
    </li>
  
    <li class="menu-level-2">
      <a href="/contact" class="waves-effect waves-light">
        
        <i class="fas fa-comments moz-zoom" style="zoom: 0.6;"></i>
        
        <span>留言</span>
        
      </a>
      
    </li>
  
    <li class="menu-level-2">
      <a href="/about" class="waves-effect waves-light">
        
        <i class="fas fa-chart-bar moz-zoom" style="zoom: 0.6;"></i>
        
        <span>统计</span>
        
      </a>
      
    </li>
  

      </ul>
      
    </li>
  
    <li class="menu-level-1">
      <a href="/about" class="waves-effect waves-light">
        
        <i class="fas fa-user-circle moz-zoom" style="zoom: 0.6;"></i>
        
        <span>关于我</span>
        
      </a>
      
    </li>
  

  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search " title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">Hkini</div>
        <div class="logo-desc">
            
            一个记录生活、学习和工作的地方。记录生活中的点滴，分享学习的经验和工作中的思考。
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="javascript:;">
			
				<i class="fa-fw fas fa-graduation-cap"></i>
			
			专业
			<span class="m-icon"><i class="fas fa-chevron-right"></i></span>
		</a>
            <ul  style="background:  ;" >
              
                <li>

                  <a href="/categories/%E4%B8%93%E4%B8%9A/%E5%9F%BA%E7%A1%80%E7%90%86%E8%AE%BA " style="margin-left:75px">
				  
				   <i class="fa fas fa-book" style="position: absolute;left:50px" ></i>
			      
		          <span>01基础理论</span>
                  </a>
                </li>
              
                <li>

                  <a href="/categories/%E4%B8%93%E4%B8%9A/%E6%A1%86%E6%9E%B6 " style="margin-left:75px">
				  
				   <i class="fa fas fa-cubes" style="position: absolute;left:50px" ></i>
			      
		          <span>02框架</span>
                  </a>
                </li>
              
                <li>

                  <a href="/categories/%E4%B8%93%E4%B8%9A/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80 " style="margin-left:75px">
				  
				   <i class="fa fas fa-code" style="position: absolute;left:50px" ></i>
			      
		          <span>03编程语言</span>
                  </a>
                </li>
              
                <li>

                  <a href="/categories/%E4%B8%93%E4%B8%9A/%E5%AE%9E%E8%B7%B5%E9%A1%B9%E7%9B%AE " style="margin-left:75px">
				  
				   <i class="fa fas fa-project-diagram" style="position: absolute;left:50px" ></i>
			      
		          <span>04实践项目</span>
                  </a>
                </li>
              
                <li>

                  <a href="/categories/%E4%B8%93%E4%B8%9A/%E9%85%8D%E7%BD%AE%E8%AE%B0%E5%BD%95 " style="margin-left:75px">
				  
				   <i class="fa fas fa-tools" style="position: absolute;left:50px" ></i>
			      
		          <span>05配置记录</span>
                  </a>
                </li>
              
            </ul>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="javascript:;">
			
				<i class="fa-fw fas fa-briefcase"></i>
			
			工作
			<span class="m-icon"><i class="fas fa-chevron-right"></i></span>
		</a>
            <ul  style="background:  ;" >
              
                <li>

                  <a href="/categories/%E5%B7%A5%E4%BD%9C/%E9%A1%B9%E7%9B%AE " style="margin-left:75px">
				  
				   <i class="fa fas fa-tasks" style="position: absolute;left:50px" ></i>
			      
		          <span>01项目</span>
                  </a>
                </li>
              
            </ul>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="javascript:;">
			
				<i class="fa-fw fas fa-icons"></i>
			
			兴趣
			<span class="m-icon"><i class="fas fa-chevron-right"></i></span>
		</a>
            <ul  style="background:  ;" >
              
                <li>

                  <a href="/categories/%E5%85%B4%E8%B6%A3/%E9%98%85%E8%AF%BB " style="margin-left:75px">
				  
				   <i class="fa fas fa-book-open" style="position: absolute;left:50px" ></i>
			      
		          <span>01阅读</span>
                  </a>
                </li>
              
                <li>

                  <a href="/categories/%E5%85%B4%E8%B6%A3/%E7%85%A7%E7%89%87 " style="margin-left:75px">
				  
				   <i class="fa fas fa-image" style="position: absolute;left:50px" ></i>
			      
		          <span>02照片</span>
                  </a>
                </li>
              
            </ul>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="javascript:;">
			
				<i class="fa-fw fas fa-seedling"></i>
			
			个人成长
			<span class="m-icon"><i class="fas fa-chevron-right"></i></span>
		</a>
            <ul  style="background:  ;" >
              
                <li>

                  <a href="/categories/%E4%B8%AA%E4%BA%BA%E6%88%90%E9%95%BF/%E8%AE%A1%E5%88%92%E4%B8%8E%E6%80%BB%E7%BB%93 " style="margin-left:75px">
				  
				   <i class="fa fas fa-tasks" style="position: absolute;left:50px" ></i>
			      
		          <span>01计划与总结</span>
                  </a>
                </li>
              
                <li>

                  <a href="/categories/%E4%B8%AA%E4%BA%BA%E6%88%90%E9%95%BF/%E6%84%9F%E6%82%9F " style="margin-left:75px">
				  
				   <i class="fa fas fa-lightbulb" style="position: absolute;left:50px" ></i>
			      
		          <span>02感悟</span>
                  </a>
                </li>
              
            </ul>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="javascript:;">
			
				<i class="fa-fw fas fa-list"></i>
			
			整理
			<span class="m-icon"><i class="fas fa-chevron-right"></i></span>
		</a>
            <ul  style="background:  ;" >
              
                <li>

                  <a href="/catstags " style="margin-left:75px">
				  
				   <i class="fa fas fa-bookmark" style="position: absolute;left:50px" ></i>
			      
		          <span>分类&标签</span>
                  </a>
                </li>
              
                <li>

                  <a href="/archives " style="margin-left:75px">
				  
				   <i class="fa fas fa-file-lines" style="position: absolute;left:50px" ></i>
			      
		          <span>归档</span>
                  </a>
                </li>
              
                <li>

                  <a href="/friends " style="margin-left:75px">
				  
				   <i class="fa fas fa-address-book" style="position: absolute;left:50px" ></i>
			      
		          <span>友链</span>
                  </a>
                </li>
              
                <li>

                  <a href="/contact " style="margin-left:75px">
				  
				   <i class="fa fas fa-comments" style="position: absolute;left:50px" ></i>
			      
		          <span>留言</span>
                  </a>
                </li>
              
                <li>

                  <a href="/about " style="margin-left:75px">
				  
				   <i class="fa fas fa-chart-bar" style="position: absolute;left:50px" ></i>
			      
		          <span>统计</span>
                  </a>
                </li>
              
            </ul>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于我
		</a>
          
        </li>
        
        
    </ul>
</div>


        </div>

        
    </nav>

</header>

    
<script src="/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('请输入访问本文章的密码')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/0.png')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">天池人脸识别项目复现</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/Python/">
                                <span class="chip bg-color">Python</span>
                            </a>
                        
                            <a href="/tags/%E4%BA%BA%E8%84%B8%E8%AF%86%E5%88%AB/">
                                <span class="chip bg-color">人脸识别</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/%E4%B8%93%E4%B8%9A/" class="post-category">
                                专业
                            </a>
                        
                            <a href="/categories/%E4%B8%93%E4%B8%9A/%E5%AE%9E%E8%B7%B5%E9%A1%B9%E7%9B%AE/" class="post-category">
                                实践项目
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2024-06-20
                </div>

                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2025-05-02
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    13.2k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    52 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        

        
        <!-- 代码块折行 -->
        <style type="text/css">
            code[class*="language-"], pre[class*="language-"] { white-space: pre-wrap !important; }
        </style>
        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <html><head></head><body><h1 id="1-项目背景"><a class="markdownIt-Anchor" href="#1-项目背景"></a> 1 项目背景</h1>

        <div class="evoldown" id="项目的目的" type="c">
          <span class="icon">
            <svg type="c" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m6.825 4.8749c1.8175-0.03033 2.3249 0.02869 2.25 2.0152 0.01496 1.139 0.01338 1.984-1.3875 1.9798-1.6108-0.01491-2.7285 0.30288-2.6124-1.796-0.019-1.5193-0.04171-2.2697 1.7499-2.1989zm0-2c-2.5847-0.10689-3.8882 1.4181-3.7496 3.8782-0.058825 1.6262 0.20934 2.9456 1.5713 3.7018 0.98591 0.49526 1.6843 0.40204 2.4713 0.42016 0.661-0.00557 1.2079 0.02014 1.9275-0.21866 1.051-0.35295 1.7794-1.2693 1.9533-2.3675 0.08948-0.54803 0.07327-0.95095 0.0762-1.3975-0.00196-0.42752 0.01114-0.8053-0.05632-1.306-0.24162-1.9408-1.9089-2.8188-3.6634-2.7097-0.17686-7.9441e-4 -0.35349-2.3937e-4 -0.53038-7.7934e-4z" fill="currentColor"></path><path d="m17.075 8.6749c1.8175-0.03034 2.3249 0.02868 2.25 2.0152 0.01495 1.139 0.01338 1.984-1.3875 1.9797-1.6108-0.01491-2.7285 0.30288-2.6124-1.796-0.01899-1.5193-0.04171-2.2697 1.7499-2.1989zm0-2c-2.5847-0.10689-3.8882 1.4181-3.7496 3.8782-0.05882 1.6262 0.20933 2.9457 1.5713 3.7017 0.98593 0.49528 1.6843 0.40205 2.4713 0.42017 0.66099-0.00556 1.2079 0.02015 1.9275-0.21865 1.051-0.35295 1.7794-1.2693 1.9533-2.3675 0.08949-0.54803 0.07328-0.95095 0.07621-1.3975-0.00197-0.42839 0.0112-0.80698-0.05673-1.3089-0.24288-1.9391-1.9097-2.8158-3.663-2.7068-0.17688-7.9346e-4 -0.35351-2.388e-4 -0.5304-7.7896e-4z" fill="currentColor"></path><path d="m8.4749 15.525c1.8175-0.03033 2.3249 0.02868 2.25 2.0152 0.01496 1.139 0.01338 1.984-1.3875 1.9797-1.6108-0.01491-2.7285 0.30288-2.6124-1.796-0.01899-1.5193-0.04172-2.2697 1.7499-2.1989zm0-2c-2.5847-0.10689-3.8882 1.4181-3.7496 3.8782-0.058825 1.6262 0.20934 2.9456 1.5713 3.7018 0.98591 0.49526 1.6843 0.40203 2.4713 0.42016 0.66099-0.00557 1.2079 0.02014 1.9276-0.21866 1.051-0.35294 1.7794-1.2693 1.9533-2.3675 0.08949-0.54803 0.07328-0.95095 0.07621-1.3975-0.00197-0.42753 0.01113-0.80529-0.05633-1.306-0.24162-1.9408-1.9089-2.8188-3.6634-2.7097-0.17688-7.9346e-4 -0.35351-2.4262e-4 -0.5304-7.8736e-4z" fill="currentColor"></path></svg>
            <p name="label">概述</p>
            <p name="id">项目的目的</p>
          </span>
        </div>
      
<p>图像分类是整个计算机视觉领域中最基础的任务，也是最重要的任务之⼀，最适合拿来进⾏学习实践。为了让新⼿们能够⼀次性体验⼀个<strong>⼯业级别的图像分类任务的完整流程</strong>，本次我们选择带领⼤家完成⼀个对<strong>图片中⼈脸进⾏表情识别的任务</strong>。<strong>本任务只对嘴唇部分的表情进⾏识别，所以我们的目标就是获取人脸嘴唇区域的图像，然后进行分类</strong>。</p>

        <div class="evoldown" id="项目的应用前景" type="c">
          <span class="icon">
            <svg type="c" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m6.825 4.8749c1.8175-0.03033 2.3249 0.02869 2.25 2.0152 0.01496 1.139 0.01338 1.984-1.3875 1.9798-1.6108-0.01491-2.7285 0.30288-2.6124-1.796-0.019-1.5193-0.04171-2.2697 1.7499-2.1989zm0-2c-2.5847-0.10689-3.8882 1.4181-3.7496 3.8782-0.058825 1.6262 0.20934 2.9456 1.5713 3.7018 0.98591 0.49526 1.6843 0.40204 2.4713 0.42016 0.661-0.00557 1.2079 0.02014 1.9275-0.21866 1.051-0.35295 1.7794-1.2693 1.9533-2.3675 0.08948-0.54803 0.07327-0.95095 0.0762-1.3975-0.00196-0.42752 0.01114-0.8053-0.05632-1.306-0.24162-1.9408-1.9089-2.8188-3.6634-2.7097-0.17686-7.9441e-4 -0.35349-2.3937e-4 -0.53038-7.7934e-4z" fill="currentColor"></path><path d="m17.075 8.6749c1.8175-0.03034 2.3249 0.02868 2.25 2.0152 0.01495 1.139 0.01338 1.984-1.3875 1.9797-1.6108-0.01491-2.7285 0.30288-2.6124-1.796-0.01899-1.5193-0.04171-2.2697 1.7499-2.1989zm0-2c-2.5847-0.10689-3.8882 1.4181-3.7496 3.8782-0.05882 1.6262 0.20933 2.9457 1.5713 3.7017 0.98593 0.49528 1.6843 0.40205 2.4713 0.42017 0.66099-0.00556 1.2079 0.02015 1.9275-0.21865 1.051-0.35295 1.7794-1.2693 1.9533-2.3675 0.08949-0.54803 0.07328-0.95095 0.07621-1.3975-0.00197-0.42839 0.0112-0.80698-0.05673-1.3089-0.24288-1.9391-1.9097-2.8158-3.663-2.7068-0.17688-7.9346e-4 -0.35351-2.388e-4 -0.5304-7.7896e-4z" fill="currentColor"></path><path d="m8.4749 15.525c1.8175-0.03033 2.3249 0.02868 2.25 2.0152 0.01496 1.139 0.01338 1.984-1.3875 1.9797-1.6108-0.01491-2.7285 0.30288-2.6124-1.796-0.01899-1.5193-0.04172-2.2697 1.7499-2.1989zm0-2c-2.5847-0.10689-3.8882 1.4181-3.7496 3.8782-0.058825 1.6262 0.20934 2.9456 1.5713 3.7018 0.98591 0.49526 1.6843 0.40203 2.4713 0.42016 0.66099-0.00557 1.2079 0.02014 1.9276-0.21866 1.051-0.35294 1.7794-1.2693 1.9533-2.3675 0.08949-0.54803 0.07328-0.95095 0.07621-1.3975-0.00197-0.42753 0.01113-0.80529-0.05633-1.306-0.24162-1.9408-1.9089-2.8188-3.6634-2.7097-0.17688-7.9346e-4 -0.35351-2.4262e-4 -0.5304-7.8736e-4z" fill="currentColor"></path></svg>
            <p name="label">前景</p>
            <p name="id">项目的应用前景</p>
          </span>
        </div>
      
<p>⼈脸表情识别(facial expression recognition, FER)作为⼈脸识别技术中的⼀个重要组成部分，近年来在⼈机交互、安全、机器⼈制造、⾃动化、医疗、通信和驾驶领域得到了⼴泛的关注，成为学术界和⼯业界的研究热点，是⼈脸属性分析的重点。</p>

        <div class="evoldown" id="项目总结" type="c">
          <span class="icon">
            <svg type="c" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m6.825 4.8749c1.8175-0.03033 2.3249 0.02869 2.25 2.0152 0.01496 1.139 0.01338 1.984-1.3875 1.9798-1.6108-0.01491-2.7285 0.30288-2.6124-1.796-0.019-1.5193-0.04171-2.2697 1.7499-2.1989zm0-2c-2.5847-0.10689-3.8882 1.4181-3.7496 3.8782-0.058825 1.6262 0.20934 2.9456 1.5713 3.7018 0.98591 0.49526 1.6843 0.40204 2.4713 0.42016 0.661-0.00557 1.2079 0.02014 1.9275-0.21866 1.051-0.35295 1.7794-1.2693 1.9533-2.3675 0.08948-0.54803 0.07327-0.95095 0.0762-1.3975-0.00196-0.42752 0.01114-0.8053-0.05632-1.306-0.24162-1.9408-1.9089-2.8188-3.6634-2.7097-0.17686-7.9441e-4 -0.35349-2.3937e-4 -0.53038-7.7934e-4z" fill="currentColor"></path><path d="m17.075 8.6749c1.8175-0.03034 2.3249 0.02868 2.25 2.0152 0.01495 1.139 0.01338 1.984-1.3875 1.9797-1.6108-0.01491-2.7285 0.30288-2.6124-1.796-0.01899-1.5193-0.04171-2.2697 1.7499-2.1989zm0-2c-2.5847-0.10689-3.8882 1.4181-3.7496 3.8782-0.05882 1.6262 0.20933 2.9457 1.5713 3.7017 0.98593 0.49528 1.6843 0.40205 2.4713 0.42017 0.66099-0.00556 1.2079 0.02015 1.9275-0.21865 1.051-0.35295 1.7794-1.2693 1.9533-2.3675 0.08949-0.54803 0.07328-0.95095 0.07621-1.3975-0.00197-0.42839 0.0112-0.80698-0.05673-1.3089-0.24288-1.9391-1.9097-2.8158-3.663-2.7068-0.17688-7.9346e-4 -0.35351-2.388e-4 -0.5304-7.7896e-4z" fill="currentColor"></path><path d="m8.4749 15.525c1.8175-0.03033 2.3249 0.02868 2.25 2.0152 0.01496 1.139 0.01338 1.984-1.3875 1.9797-1.6108-0.01491-2.7285 0.30288-2.6124-1.796-0.01899-1.5193-0.04172-2.2697 1.7499-2.1989zm0-2c-2.5847-0.10689-3.8882 1.4181-3.7496 3.8782-0.058825 1.6262 0.20934 2.9456 1.5713 3.7018 0.98591 0.49526 1.6843 0.40203 2.4713 0.42016 0.66099-0.00557 1.2079 0.02014 1.9276-0.21866 1.051-0.35294 1.7794-1.2693 1.9533-2.3675 0.08949-0.54803 0.07328-0.95095 0.07621-1.3975-0.00197-0.42753 0.01113-0.80529-0.05633-1.306-0.24162-1.9408-1.9089-2.8188-3.6634-2.7097-0.17688-7.9346e-4 -0.35351-2.4262e-4 -0.5304-7.8736e-4z" fill="currentColor"></path></svg>
            <p name="label">总结</p>
            <p name="id">项目总结</p>
          </span>
        </div>
      
<p><strong>训练步骤</strong><br>
通过该项目，初步对「深度学习」有了实践经验。整个学习的流程有四个步骤，分别是</p>
<ol>
<li>
<p>「数据收集」，收集需要的数据，可以通过爬虫的方式去收集自己想要的数据，相关资料<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/75QDjRTDCKzuM68L4fg5Lg">【杂谈】深度学习必备，各路免费爬虫一举拿下</a>。</p>
</li>
<li>
<p>「数据处理」把收集到的数据处理成需要的格式，筛选掉不合格的数据和相关的脏数据。或者进一步提取数据。</p>
</li>
<li>
<p>「模型训练」搭建寻训练的模型，准备模型的数据接口，然后进行模型的训练。</p>
</li>
<li>
<p>「模型测试」对训练好额模型进行测试。</p>
</li>
</ol>
<p><strong>相关知识</strong><br>
在实践过程当中，学习一些相关的概念知识，整理到了第五点中。有「级联选择器」，「字典推导式」，「损失函数」，「优化器」，「学习率调度器」。</p>
<p><strong>需继续学习的技术</strong><br>
需要继续深入学习「深度学习理论」，「Numpy」，「matplotlib」，「OpenCV」，「Pytorch」。</p>
<h1 id="2-数据获取"><a class="markdownIt-Anchor" href="#2-数据获取"></a> 2 数据获取</h1>

        <div class="evoldown" id="爬取数据的方法" type="e">
          <span class="icon">
            <svg type="e" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path fill="currentColor" d="m21.9 15.621c0.1248-1.8535-0.6087-3.4099-2.6058-3.8292-0.7712-0.15744-1.3921-0.13977-2.1113-0.14543-0.6323 0.0048-1.1718-0.01567-1.8401 0.03203 1.5356-0.8078 1.6998-2.205 1.6567-3.546 0.1272-2.3708-1.4685-3.666-3.7727-3.673-2.2427-0.04024-5.0463-0.27229-5.9443 1.9172-0.28083 0.6692-0.27606 1.2179-0.28202 1.6587-0.08527 1.4303 0.20687 2.9224 1.662 3.6429-2.3051-0.05275-5.3273-0.39212-6.28 1.8983-0.28073 0.66862-0.27595 1.2174-0.282 1.6572-0.10329 1.6061 0.3059 3.171 2.0252 3.8067 1.2061 0.4187 2.2175 0.2869 3.3945 0.3134 2.0524 0.0901 4.0448-0.4637 4.4796-2.4982 0.609 2.5638 3.2086 2.5463 5.3204 2.4982 2.7823 0.1278 4.7024-0.9368 4.5798-3.7329zm-12.899-7.6287c-0.14889-1.8665 1.8839-1.4921 3.1358-1.546 0.8939 0.05358 2.4743-0.21158 2.8003 0.88445 0.2729 2.4494-0.0297 2.8555-2.5242 2.8232-0.94713-0.07259-2.869 0.28949-3.3134-0.77077-0.14881-0.44557-0.08538-0.92893-0.09846-1.3909zm0.2606 9.2128c-0.56638 0.162-1.1652 0.1412-1.7487 0.1488-0.59786-0.0036-1.1977 0.0131-1.7948-0.0233-0.93407-0.0365-1.6776-0.3579-1.6157-1.4217 0.01574-0.5119-0.06845-1.0551 0.11822-1.5436 0.4432-0.84155 1.5978-0.6728 2.4032-0.7191 0.81712 0.01614 1.6464-0.05154 2.4536 0.10154 0.99382 0.17537 1.0564 0.91742 1.0227 1.7752-6.1e-4 0.7729 0.04085 1.416-0.83867 1.6821zm2.9212-3.6286c-0.0836 0.19457-0.14194 0.3848-0.18279 0.56614-0.18535-0.87758-0.76293-1.6189-1.5605-2.02 1.0871 0.04933 2.0387 0.04959 3.1216-8e-5 -0.7672 0.39034-1.1687 0.96486-1.3783 1.4539zm6.8788 3.6286c-0.5664 0.162-1.1652 0.1412-1.7488 0.1488-0.5978-0.0036-1.1977 0.0131-1.7947-0.0233-0.9341-0.0365-1.6776-0.3579-1.6157-1.4217 0.0157-0.5119-0.0685-1.0551 0.1182-1.5436 0.4432-0.84155 1.5978-0.6728 2.4033-0.7191 0.8171 0.01614 1.6464-0.05154 2.4536 0.10154 0.9938 0.17537 1.0563 0.91742 1.0227 1.7752-6e-4 0.7729 0.0409 1.416-0.8386 1.6821z"></path></svg>
            <p name="id">爬取数据的方法</p>
          </span>
        </div>
      
<p>使用爬虫工具获取图片的数据<br>
本项目使用的爬虫项目是：<a target="_blank" rel="noopener" href="https://github.com/sczhengyabin/Image-Downloader">https://github.com/sczhengyabin/Image-Downloader</a>&nbsp;，可以按要求爬取百度、Bing、Google 上的图片。</p>

        <div class="evoldown" id="问题与解决方法" type="c">
          <span class="icon">
            <svg type="c" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m6.825 4.8749c1.8175-0.03033 2.3249 0.02869 2.25 2.0152 0.01496 1.139 0.01338 1.984-1.3875 1.9798-1.6108-0.01491-2.7285 0.30288-2.6124-1.796-0.019-1.5193-0.04171-2.2697 1.7499-2.1989zm0-2c-2.5847-0.10689-3.8882 1.4181-3.7496 3.8782-0.058825 1.6262 0.20934 2.9456 1.5713 3.7018 0.98591 0.49526 1.6843 0.40204 2.4713 0.42016 0.661-0.00557 1.2079 0.02014 1.9275-0.21866 1.051-0.35295 1.7794-1.2693 1.9533-2.3675 0.08948-0.54803 0.07327-0.95095 0.0762-1.3975-0.00196-0.42752 0.01114-0.8053-0.05632-1.306-0.24162-1.9408-1.9089-2.8188-3.6634-2.7097-0.17686-7.9441e-4 -0.35349-2.3937e-4 -0.53038-7.7934e-4z" fill="currentColor"></path><path d="m17.075 8.6749c1.8175-0.03034 2.3249 0.02868 2.25 2.0152 0.01495 1.139 0.01338 1.984-1.3875 1.9797-1.6108-0.01491-2.7285 0.30288-2.6124-1.796-0.01899-1.5193-0.04171-2.2697 1.7499-2.1989zm0-2c-2.5847-0.10689-3.8882 1.4181-3.7496 3.8782-0.05882 1.6262 0.20933 2.9457 1.5713 3.7017 0.98593 0.49528 1.6843 0.40205 2.4713 0.42017 0.66099-0.00556 1.2079 0.02015 1.9275-0.21865 1.051-0.35295 1.7794-1.2693 1.9533-2.3675 0.08949-0.54803 0.07328-0.95095 0.07621-1.3975-0.00197-0.42839 0.0112-0.80698-0.05673-1.3089-0.24288-1.9391-1.9097-2.8158-3.663-2.7068-0.17688-7.9346e-4 -0.35351-2.388e-4 -0.5304-7.7896e-4z" fill="currentColor"></path><path d="m8.4749 15.525c1.8175-0.03033 2.3249 0.02868 2.25 2.0152 0.01496 1.139 0.01338 1.984-1.3875 1.9797-1.6108-0.01491-2.7285 0.30288-2.6124-1.796-0.01899-1.5193-0.04172-2.2697 1.7499-2.1989zm0-2c-2.5847-0.10689-3.8882 1.4181-3.7496 3.8782-0.058825 1.6262 0.20934 2.9456 1.5713 3.7018 0.98591 0.49526 1.6843 0.40203 2.4713 0.42016 0.66099-0.00557 1.2079 0.02014 1.9276-0.21866 1.051-0.35294 1.7794-1.2693 1.9533-2.3675 0.08949-0.54803 0.07328-0.95095 0.07621-1.3975-0.00197-0.42753 0.01113-0.80529-0.05633-1.306-0.24162-1.9408-1.9089-2.8188-3.6634-2.7097-0.17688-7.9346e-4 -0.35351-2.4262e-4 -0.5304-7.8736e-4z" fill="currentColor"></path></svg>
            <p name="label">问题</p>
            <p name="id">问题与解决方法</p>
          </span>
        </div>
      
<ol>
<li>Ubuntu中出现xcd的问题？<br>
尝试了网上的各种方法，最后改用windows上进行</li>
</ol>
<h1 id="3-数据处理"><a class="markdownIt-Anchor" href="#3-数据处理"></a> 3 数据处理</h1>

        <div class="evoldown" id="数据处理的重要性" type="c">
          <span class="icon">
            <svg type="c" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m6.825 4.8749c1.8175-0.03033 2.3249 0.02869 2.25 2.0152 0.01496 1.139 0.01338 1.984-1.3875 1.9798-1.6108-0.01491-2.7285 0.30288-2.6124-1.796-0.019-1.5193-0.04171-2.2697 1.7499-2.1989zm0-2c-2.5847-0.10689-3.8882 1.4181-3.7496 3.8782-0.058825 1.6262 0.20934 2.9456 1.5713 3.7018 0.98591 0.49526 1.6843 0.40204 2.4713 0.42016 0.661-0.00557 1.2079 0.02014 1.9275-0.21866 1.051-0.35295 1.7794-1.2693 1.9533-2.3675 0.08948-0.54803 0.07327-0.95095 0.0762-1.3975-0.00196-0.42752 0.01114-0.8053-0.05632-1.306-0.24162-1.9408-1.9089-2.8188-3.6634-2.7097-0.17686-7.9441e-4 -0.35349-2.3937e-4 -0.53038-7.7934e-4z" fill="currentColor"></path><path d="m17.075 8.6749c1.8175-0.03034 2.3249 0.02868 2.25 2.0152 0.01495 1.139 0.01338 1.984-1.3875 1.9797-1.6108-0.01491-2.7285 0.30288-2.6124-1.796-0.01899-1.5193-0.04171-2.2697 1.7499-2.1989zm0-2c-2.5847-0.10689-3.8882 1.4181-3.7496 3.8782-0.05882 1.6262 0.20933 2.9457 1.5713 3.7017 0.98593 0.49528 1.6843 0.40205 2.4713 0.42017 0.66099-0.00556 1.2079 0.02015 1.9275-0.21865 1.051-0.35295 1.7794-1.2693 1.9533-2.3675 0.08949-0.54803 0.07328-0.95095 0.07621-1.3975-0.00197-0.42839 0.0112-0.80698-0.05673-1.3089-0.24288-1.9391-1.9097-2.8158-3.663-2.7068-0.17688-7.9346e-4 -0.35351-2.388e-4 -0.5304-7.7896e-4z" fill="currentColor"></path><path d="m8.4749 15.525c1.8175-0.03033 2.3249 0.02868 2.25 2.0152 0.01496 1.139 0.01338 1.984-1.3875 1.9797-1.6108-0.01491-2.7285 0.30288-2.6124-1.796-0.01899-1.5193-0.04172-2.2697 1.7499-2.1989zm0-2c-2.5847-0.10689-3.8882 1.4181-3.7496 3.8782-0.058825 1.6262 0.20934 2.9456 1.5713 3.7018 0.98591 0.49526 1.6843 0.40203 2.4713 0.42016 0.66099-0.00557 1.2079 0.02014 1.9276-0.21866 1.051-0.35294 1.7794-1.2693 1.9533-2.3675 0.08949-0.54803 0.07328-0.95095 0.07621-1.3975-0.00197-0.42753 0.01113-0.80529-0.05633-1.306-0.24162-1.9408-1.9089-2.8188-3.6634-2.7097-0.17688-7.9346e-4 -0.35351-2.4262e-4 -0.5304-7.8736e-4z" fill="currentColor"></path></svg>
            <p name="label">解释</p>
            <p name="id">数据处理的重要性</p>
          </span>
        </div>
      
<p>爬取得到的数据是⽐较脏的，需要进⾏整理，主要包括统⼀图⽚后缀和重命名。统⼀后缀格式可以减少以后写数据 API 时的压⼒，也可以测试图⽚是不是可以正常的读取，及时防⽌未知问题的出现，这很重要。</p>
<h2 id="31-图片格式统一"><a class="markdownIt-Anchor" href="#31-图片格式统一"></a> 3.1 图片格式统一</h2>

        <div class="evoldown" id="数据处理的代码" type="e">
          <span class="icon">
            <svg type="e" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path fill="currentColor" d="m21.9 15.621c0.1248-1.8535-0.6087-3.4099-2.6058-3.8292-0.7712-0.15744-1.3921-0.13977-2.1113-0.14543-0.6323 0.0048-1.1718-0.01567-1.8401 0.03203 1.5356-0.8078 1.6998-2.205 1.6567-3.546 0.1272-2.3708-1.4685-3.666-3.7727-3.673-2.2427-0.04024-5.0463-0.27229-5.9443 1.9172-0.28083 0.6692-0.27606 1.2179-0.28202 1.6587-0.08527 1.4303 0.20687 2.9224 1.662 3.6429-2.3051-0.05275-5.3273-0.39212-6.28 1.8983-0.28073 0.66862-0.27595 1.2174-0.282 1.6572-0.10329 1.6061 0.3059 3.171 2.0252 3.8067 1.2061 0.4187 2.2175 0.2869 3.3945 0.3134 2.0524 0.0901 4.0448-0.4637 4.4796-2.4982 0.609 2.5638 3.2086 2.5463 5.3204 2.4982 2.7823 0.1278 4.7024-0.9368 4.5798-3.7329zm-12.899-7.6287c-0.14889-1.8665 1.8839-1.4921 3.1358-1.546 0.8939 0.05358 2.4743-0.21158 2.8003 0.88445 0.2729 2.4494-0.0297 2.8555-2.5242 2.8232-0.94713-0.07259-2.869 0.28949-3.3134-0.77077-0.14881-0.44557-0.08538-0.92893-0.09846-1.3909zm0.2606 9.2128c-0.56638 0.162-1.1652 0.1412-1.7487 0.1488-0.59786-0.0036-1.1977 0.0131-1.7948-0.0233-0.93407-0.0365-1.6776-0.3579-1.6157-1.4217 0.01574-0.5119-0.06845-1.0551 0.11822-1.5436 0.4432-0.84155 1.5978-0.6728 2.4032-0.7191 0.81712 0.01614 1.6464-0.05154 2.4536 0.10154 0.99382 0.17537 1.0564 0.91742 1.0227 1.7752-6.1e-4 0.7729 0.04085 1.416-0.83867 1.6821zm2.9212-3.6286c-0.0836 0.19457-0.14194 0.3848-0.18279 0.56614-0.18535-0.87758-0.76293-1.6189-1.5605-2.02 1.0871 0.04933 2.0387 0.04959 3.1216-8e-5 -0.7672 0.39034-1.1687 0.96486-1.3783 1.4539zm6.8788 3.6286c-0.5664 0.162-1.1652 0.1412-1.7488 0.1488-0.5978-0.0036-1.1977 0.0131-1.7947-0.0233-0.9341-0.0365-1.6776-0.3579-1.6157-1.4217 0.0157-0.5119-0.0685-1.0551 0.1182-1.5436 0.4432-0.84155 1.5978-0.6728 2.4033-0.7191 0.8171 0.01614 1.6464-0.05154 2.4536 0.10154 0.9938 0.17537 1.0563 0.91742 1.0227 1.7752-6e-4 0.7729 0.0409 1.416-0.8386 1.6821z"></path></svg>
            <p name="id">数据处理的代码</p>
          </span>
        </div>
      
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token triple-quoted-string string">'''
该py文件用一个函数listfiles于将指定目录下的所有图片文件转换为jpg格式的图片文件并删除原图片文件。
参数：rootDir，表示要转换的图片文件所在的目录
返回值：无
总结：
1.使用os.walk()函数遍历指定目录下的所有文件和子目录。
2.使用cv2.imread()函数读取图片文件。
3.使用cv2.imwrite()函数保存图片文件。
4.使用os.remove()函数删除原图片文件。
'''</span>

<span class="token keyword">import</span> os
<span class="token keyword">import</span> cv2
<span class="token keyword">def</span> <span class="token function">listfiles</span><span class="token punctuation">(</span>rootDir<span class="token punctuation">)</span><span class="token punctuation">:</span>
    list_dirs <span class="token operator">=</span> os<span class="token punctuation">.</span>walk<span class="token punctuation">(</span>rootDir<span class="token punctuation">)</span>
    <span class="token triple-quoted-string string">'''
    用于生成文件夹中的文件名通过在目录树中游走。
    这个函数返回一个「三元组」(dirpath, dirnames, filenames)。
    dirpath是一个字符串，表示当前正在遍历的目录的路径。
    dirnames是一个列表，包含了dirpath下所有子目录的名字。
    filenames是一个列表，包含了非目录文件的名字。
    这行代码中的list_dirs将会是一个「迭代器」，每次迭代返回上述的三元组，
    表示rootDir目录及其所有子目录中的文件和目录信息。
    '''</span>
    <span class="token keyword">for</span> root<span class="token punctuation">,</span> dirs<span class="token punctuation">,</span> files <span class="token keyword">in</span> list_dirs<span class="token punctuation">:</span>
        <span class="token keyword">for</span> d <span class="token keyword">in</span> dirs<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>root<span class="token punctuation">,</span> d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#打印目录</span>
        <span class="token keyword">for</span> f <span class="token keyword">in</span> files<span class="token punctuation">:</span>
            fileid <span class="token operator">=</span> f<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token comment">#获取文件名</span>
            filepath <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>root<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token comment">#获取文件路径</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>filepath<span class="token punctuation">)</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span><span class="token comment">#异常处理，确保程序不会因为读取图片出错而中断</span>
                src <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span>filepath<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token comment">#读取图片</span>
                <span class="token triple-quoted-string string">'''
                cv2.imread()函数读取图片，接收两个参数
                第一个参数是图片路径，第二个参数是读取图片的方式（1表示读取彩色图片，参数0表示读取灰度图片）
                返回值是一个numpy数组，表示图片的像素矩阵。
                '''</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"src="</span><span class="token punctuation">,</span>filepath<span class="token punctuation">,</span>src<span class="token punctuation">.</span>shape<span class="token punctuation">)</span><span class="token comment">#src.shape是图片的尺寸</span>
                os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>filepath<span class="token punctuation">)</span><span class="token comment">#删除原图片</span>
                cv2<span class="token punctuation">.</span>imwrite<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>root<span class="token punctuation">,</span>fileid<span class="token operator">+</span><span class="token string">".jpg"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>src<span class="token punctuation">)</span><span class="token comment">#保存图片</span>
                <span class="token triple-quoted-string string">'''
                cv2.imwrite()函数保存图片，接收两个参数
                第一个参数是保存图片的路径，第二个参数是图片的像素矩阵
                返回值是一个布尔值，表示是否保存成功
                '''</span>
            <span class="token keyword">except</span><span class="token punctuation">:</span>
                os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>filepath<span class="token punctuation">)</span>
                <span class="token keyword">continue</span>
path <span class="token operator">=</span> <span class="token string">"./opencv_facetest"</span>
listfiles<span class="token punctuation">(</span>path<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="32-数据清洗"><a class="markdownIt-Anchor" href="#32-数据清洗"></a> 3.2 数据清洗</h2>

        <div class="evoldown" id="为何清洗数据" type="c">
          <span class="icon">
            <svg type="c" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m6.825 4.8749c1.8175-0.03033 2.3249 0.02869 2.25 2.0152 0.01496 1.139 0.01338 1.984-1.3875 1.9798-1.6108-0.01491-2.7285 0.30288-2.6124-1.796-0.019-1.5193-0.04171-2.2697 1.7499-2.1989zm0-2c-2.5847-0.10689-3.8882 1.4181-3.7496 3.8782-0.058825 1.6262 0.20934 2.9456 1.5713 3.7018 0.98591 0.49526 1.6843 0.40204 2.4713 0.42016 0.661-0.00557 1.2079 0.02014 1.9275-0.21866 1.051-0.35295 1.7794-1.2693 1.9533-2.3675 0.08948-0.54803 0.07327-0.95095 0.0762-1.3975-0.00196-0.42752 0.01114-0.8053-0.05632-1.306-0.24162-1.9408-1.9089-2.8188-3.6634-2.7097-0.17686-7.9441e-4 -0.35349-2.3937e-4 -0.53038-7.7934e-4z" fill="currentColor"></path><path d="m17.075 8.6749c1.8175-0.03034 2.3249 0.02868 2.25 2.0152 0.01495 1.139 0.01338 1.984-1.3875 1.9797-1.6108-0.01491-2.7285 0.30288-2.6124-1.796-0.01899-1.5193-0.04171-2.2697 1.7499-2.1989zm0-2c-2.5847-0.10689-3.8882 1.4181-3.7496 3.8782-0.05882 1.6262 0.20933 2.9457 1.5713 3.7017 0.98593 0.49528 1.6843 0.40205 2.4713 0.42017 0.66099-0.00556 1.2079 0.02015 1.9275-0.21865 1.051-0.35295 1.7794-1.2693 1.9533-2.3675 0.08949-0.54803 0.07328-0.95095 0.07621-1.3975-0.00197-0.42839 0.0112-0.80698-0.05673-1.3089-0.24288-1.9391-1.9097-2.8158-3.663-2.7068-0.17688-7.9346e-4 -0.35351-2.388e-4 -0.5304-7.7896e-4z" fill="currentColor"></path><path d="m8.4749 15.525c1.8175-0.03033 2.3249 0.02868 2.25 2.0152 0.01496 1.139 0.01338 1.984-1.3875 1.9797-1.6108-0.01491-2.7285 0.30288-2.6124-1.796-0.01899-1.5193-0.04172-2.2697 1.7499-2.1989zm0-2c-2.5847-0.10689-3.8882 1.4181-3.7496 3.8782-0.058825 1.6262 0.20934 2.9456 1.5713 3.7018 0.98591 0.49526 1.6843 0.40203 2.4713 0.42016 0.66099-0.00557 1.2079 0.02014 1.9276-0.21866 1.051-0.35294 1.7794-1.2693 1.9533-2.3675 0.08949-0.54803 0.07328-0.95095 0.07621-1.3975-0.00197-0.42753 0.01113-0.80529-0.05633-1.306-0.24162-1.9408-1.9089-2.8188-3.6634-2.7097-0.17688-7.9346e-4 -0.35351-2.4262e-4 -0.5304-7.8736e-4z" fill="currentColor"></path></svg>
            <p name="label">解释</p>
            <p name="id">为何清洗数据</p>
          </span>
        </div>
      
<p>利⽤搜索引擎爬取得到的图⽚肯定有「不符合要求」的，数据清洗主要是「删除不合适」的图⽚，即⾮⼈脸的照⽚。如果利⽤「⼈脸检测算法」仍然⽆法清除⼲净样本，则需要⼿动筛选。当然如果你使⽤多个关键词或者使⽤不同的搜索引擎同样的关键词，或者从视频中提取图⽚，那么爬取回来的图⽚很可能有重复或者⾮常的相似，这样的数据集需要「去重」。</p>

        <div class="evoldown" id="人脸检测算法" type="e">
          <span class="icon">
            <svg type="e" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path fill="currentColor" d="m21.9 15.621c0.1248-1.8535-0.6087-3.4099-2.6058-3.8292-0.7712-0.15744-1.3921-0.13977-2.1113-0.14543-0.6323 0.0048-1.1718-0.01567-1.8401 0.03203 1.5356-0.8078 1.6998-2.205 1.6567-3.546 0.1272-2.3708-1.4685-3.666-3.7727-3.673-2.2427-0.04024-5.0463-0.27229-5.9443 1.9172-0.28083 0.6692-0.27606 1.2179-0.28202 1.6587-0.08527 1.4303 0.20687 2.9224 1.662 3.6429-2.3051-0.05275-5.3273-0.39212-6.28 1.8983-0.28073 0.66862-0.27595 1.2174-0.282 1.6572-0.10329 1.6061 0.3059 3.171 2.0252 3.8067 1.2061 0.4187 2.2175 0.2869 3.3945 0.3134 2.0524 0.0901 4.0448-0.4637 4.4796-2.4982 0.609 2.5638 3.2086 2.5463 5.3204 2.4982 2.7823 0.1278 4.7024-0.9368 4.5798-3.7329zm-12.899-7.6287c-0.14889-1.8665 1.8839-1.4921 3.1358-1.546 0.8939 0.05358 2.4743-0.21158 2.8003 0.88445 0.2729 2.4494-0.0297 2.8555-2.5242 2.8232-0.94713-0.07259-2.869 0.28949-3.3134-0.77077-0.14881-0.44557-0.08538-0.92893-0.09846-1.3909zm0.2606 9.2128c-0.56638 0.162-1.1652 0.1412-1.7487 0.1488-0.59786-0.0036-1.1977 0.0131-1.7948-0.0233-0.93407-0.0365-1.6776-0.3579-1.6157-1.4217 0.01574-0.5119-0.06845-1.0551 0.11822-1.5436 0.4432-0.84155 1.5978-0.6728 2.4032-0.7191 0.81712 0.01614 1.6464-0.05154 2.4536 0.10154 0.99382 0.17537 1.0564 0.91742 1.0227 1.7752-6.1e-4 0.7729 0.04085 1.416-0.83867 1.6821zm2.9212-3.6286c-0.0836 0.19457-0.14194 0.3848-0.18279 0.56614-0.18535-0.87758-0.76293-1.6189-1.5605-2.02 1.0871 0.04933 2.0387 0.04959 3.1216-8e-5 -0.7672 0.39034-1.1687 0.96486-1.3783 1.4539zm6.8788 3.6286c-0.5664 0.162-1.1652 0.1412-1.7488 0.1488-0.5978-0.0036-1.1977 0.0131-1.7947-0.0233-0.9341-0.0365-1.6776-0.3579-1.6157-1.4217 0.0157-0.5119-0.0685-1.0551 0.1182-1.5436 0.4432-0.84155 1.5978-0.6728 2.4033-0.7191 0.8171 0.01614 1.6464-0.05154 2.4536 0.10154 0.9938 0.17537 1.0563 0.91742 1.0227 1.7752-6e-4 0.7729 0.0409 1.416-0.8386 1.6821z"></path></svg>
            <p name="id">人脸检测算法</p>
          </span>
        </div>
      
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token triple-quoted-string string">'''
使用OpenCV检测图片中的人脸，并显示出来，删除没有人脸的图片
使用到的知识：
1. OpenCV 的人脸检测接口
2. os.listdir() 方法，用于返回指定的文件夹包含的文件或文件夹的名字的列表
3. os.remove() 方法，用于删除文件
4. plt.imshow() 方法，用于显示图片
5. plt.show() 方法，用于显示图片
6. CascadeClassifier.detectMultiScale() 方法，用于检测图片中的人脸
'''</span>

<span class="token keyword">import</span> cv2
<span class="token keyword">import</span> os
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

<span class="token comment"># 人脸检测的接口，这个是 OpenCV 中自带的</span>
cascade_path <span class="token operator">=</span> <span class="token string">'./Emotion_Recognition_File/face_detect_model/haarcascade_frontalface_default.xml'</span>
cascade <span class="token operator">=</span> cv2<span class="token punctuation">.</span>CascadeClassifier<span class="token punctuation">(</span>cascade_path<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">'''
xml文件是OpenCV中的一个训练好的分类器，也就是一个训练好的模型，包含了所有必要的参数和特征，用于快速准确地检测图像中的面部。
'''</span>
<span class="token comment"># img_path = "./Emotion_Recognition_File/face_det_img/" # 测试图片路径</span>
img_path <span class="token operator">=</span> <span class="token string">"./opencv_facetest"</span> <span class="token comment"># </span>

<span class="token keyword">def</span> <span class="token function">DelNoneFaceImage</span><span class="token punctuation">(</span>img_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    删除没有人脸的图片
    """</span>
    images <span class="token operator">=</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>img_path<span class="token punctuation">)</span>
    <span class="token triple-quoted-string string">'''
    os.listdir() 方法用于返回指定的文件夹包含的文件或文件夹的名字的列表。
    这个列表以字母顺序。 它不包括 '.' 和'..' 即使它在文件夹中。
    参数：path，表示要列出的目录
    返回值：返回指定路径下的文件和文件夹列表
    '''</span>
    <span class="token keyword">for</span> image <span class="token keyword">in</span> images<span class="token punctuation">:</span>
        im <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>img_path<span class="token punctuation">,</span> image<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment"># 读取图片</span>
        rects <span class="token operator">=</span> cascade<span class="token punctuation">.</span>detectMultiScale<span class="token punctuation">(</span>im<span class="token punctuation">,</span> <span class="token number">1.3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>  <span class="token comment"># 人脸检测函数</span>
        <span class="token triple-quoted-string string">'''
        cascade.detectMultiScale()函数是OpenCV中的一个人脸检测函数，用于检测图片中的人脸。
        它接收三个参数：
          im：待检测的图像，通常是灰度图像，因为Haar特征基于灰度值计算。
          1.3：scaleFactor参数，指定在图像尺寸减小时，搜索窗口的缩放比例。
                值越大，检测速度越快，但可能错过一些小的或者是距离较远的面部。
          5：minNeighbors参数，指定每个候选矩形应该保留的邻近矩形的最小数量。
            这个参数控制着检测的质量，较高的值会减少检测到的假阳性，但也可能错过一些真正的对象。
        返回值是一个矩形列表，每个矩形表示一个检测到的人脸。
        '''</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"检测到人脸的数量"</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>rects<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>rects<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>  <span class="token comment"># len(rects) 是检测人脸的数量，如果没有检测到人脸的话，会显示出图片，适合本地调试使用，在服务器上可能不会显示</span>
            os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>img_path<span class="token punctuation">,</span> image<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># </span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"删除图片："</span><span class="token punctuation">,</span> image<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"删除完成"</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span>

<span class="token keyword">def</span> <span class="token function">DetcFaceImage</span><span class="token punctuation">(</span>img_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    检测图片中的人脸，并显示出来
    """</span>
    images <span class="token operator">=</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>img_path<span class="token punctuation">)</span>
    <span class="token keyword">for</span> image <span class="token keyword">in</span> images<span class="token punctuation">:</span>
        im <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>img_path<span class="token punctuation">,</span> image<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment"># 读取图片</span>
        rects <span class="token operator">=</span> cascade<span class="token punctuation">.</span>detectMultiScale<span class="token punctuation">(</span>im<span class="token punctuation">,</span> <span class="token number">1.3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>  <span class="token comment"># 人脸检测函数</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"检测到人脸的数量"</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>rects<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>rects<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>  <span class="token comment"># len(rects) 是检测人脸的数量，如果没有检测到人脸的话，会显示出图片，适合本地调试使用，在服务器上可能不会显示</span>
            <span class="token keyword">pass</span>
        plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>im<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># 显示</span>
        <span class="token triple-quoted-string string">'''
        plt.imshow()函数用于显示图片，接收一个参数，即要显示的图片。
        由于OpenCV读取的图片是BGR格式，而matplotlib显示的图片是RGB格式，所以需要将BGR格式转换为RGB格式。
        [:, :, ::-1]表示将图片的第三个维度（颜色通道）反转，即将BGR转换为RGB。
        '''</span>
        plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># DelNoneFaceImage(img_path)</span>
DetcFaceImage<span class="token punctuation">(</span>img_path<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="33-提取嘴唇区域"><a class="markdownIt-Anchor" href="#33-提取嘴唇区域"></a> 3.3 提取嘴唇区域</h2>
<p><strong>本任务只对嘴唇部分的表情进⾏识别，所以我们的目标就是获取人脸嘴唇区域的图像，然后进行分类</strong>。我们利⽤ Opencv+Dlib 算法提取嘴唇区域， Dlib 算法会得到⾯部的 68 个关键点，我们从中得到嘴唇区域，并适当扩⼤。<br>
人脸 68 点位置图如下：<br>
<img src="http://tianchi-media.oss-cn-beijing.aliyuncs.com/dragonball/DL/other/img/%E4%BA%BA%E8%84%B868%E7%82%B9%E4%BD%8D%E7%BD%AE.jpg" alt=""></p>

        <div class="evoldown" id="dlib安装问题" type="c">
          <span class="icon">
            <svg type="c" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m6.825 4.8749c1.8175-0.03033 2.3249 0.02869 2.25 2.0152 0.01496 1.139 0.01338 1.984-1.3875 1.9798-1.6108-0.01491-2.7285 0.30288-2.6124-1.796-0.019-1.5193-0.04171-2.2697 1.7499-2.1989zm0-2c-2.5847-0.10689-3.8882 1.4181-3.7496 3.8782-0.058825 1.6262 0.20934 2.9456 1.5713 3.7018 0.98591 0.49526 1.6843 0.40204 2.4713 0.42016 0.661-0.00557 1.2079 0.02014 1.9275-0.21866 1.051-0.35295 1.7794-1.2693 1.9533-2.3675 0.08948-0.54803 0.07327-0.95095 0.0762-1.3975-0.00196-0.42752 0.01114-0.8053-0.05632-1.306-0.24162-1.9408-1.9089-2.8188-3.6634-2.7097-0.17686-7.9441e-4 -0.35349-2.3937e-4 -0.53038-7.7934e-4z" fill="currentColor"></path><path d="m17.075 8.6749c1.8175-0.03034 2.3249 0.02868 2.25 2.0152 0.01495 1.139 0.01338 1.984-1.3875 1.9797-1.6108-0.01491-2.7285 0.30288-2.6124-1.796-0.01899-1.5193-0.04171-2.2697 1.7499-2.1989zm0-2c-2.5847-0.10689-3.8882 1.4181-3.7496 3.8782-0.05882 1.6262 0.20933 2.9457 1.5713 3.7017 0.98593 0.49528 1.6843 0.40205 2.4713 0.42017 0.66099-0.00556 1.2079 0.02015 1.9275-0.21865 1.051-0.35295 1.7794-1.2693 1.9533-2.3675 0.08949-0.54803 0.07328-0.95095 0.07621-1.3975-0.00197-0.42839 0.0112-0.80698-0.05673-1.3089-0.24288-1.9391-1.9097-2.8158-3.663-2.7068-0.17688-7.9346e-4 -0.35351-2.388e-4 -0.5304-7.7896e-4z" fill="currentColor"></path><path d="m8.4749 15.525c1.8175-0.03033 2.3249 0.02868 2.25 2.0152 0.01496 1.139 0.01338 1.984-1.3875 1.9797-1.6108-0.01491-2.7285 0.30288-2.6124-1.796-0.01899-1.5193-0.04172-2.2697 1.7499-2.1989zm0-2c-2.5847-0.10689-3.8882 1.4181-3.7496 3.8782-0.058825 1.6262 0.20934 2.9456 1.5713 3.7018 0.98591 0.49526 1.6843 0.40203 2.4713 0.42016 0.66099-0.00557 1.2079 0.02014 1.9276-0.21866 1.051-0.35294 1.7794-1.2693 1.9533-2.3675 0.08949-0.54803 0.07328-0.95095 0.07621-1.3975-0.00197-0.42753 0.01113-0.80529-0.05633-1.306-0.24162-1.9408-1.9089-2.8188-3.6634-2.7097-0.17688-7.9346e-4 -0.35351-2.4262e-4 -0.5304-7.8736e-4z" fill="currentColor"></path></svg>
            <p name="label">问题</p>
            <p name="id">dlib安装问题</p>
          </span>
        </div>
      
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">PS E:<span class="token punctuation">\</span>Projects<span class="token punctuation">\</span>Emotion_Recognition<span class="token operator">&gt;</span> pip <span class="token function">install</span> dlib
  × Building wheel <span class="token keyword">for</span> dlib <span class="token punctuation">(</span>pyproject.toml<span class="token punctuation">)</span> did not run successfully.
  │ <span class="token builtin class-name">exit</span> code: <span class="token number">1</span>
  ╰─<span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token number">13</span> lines of output<span class="token punctuation">]</span>
      running bdist_wheel
      running build
      running build_ext
      Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span>:
      ModuleNotFoundError: No module named <span class="token string">'cmake'</span>
      ERROR: CMake must be installed to build dlib
      <span class="token punctuation">[</span>end of output<span class="token punctuation">]</span>
  note: This error originates from a subprocess, and is likely not a problem with pip.
  ERROR: Failed building wheel <span class="token keyword">for</span> dlib
Failed to build dlib
ERROR: Could not build wheels <span class="token keyword">for</span> dlib, <span class="token function">which</span> is required to <span class="token function">install</span> pyproject.toml-based projects<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>解决方法，安装cmake<code>pip install cmake</code> ,然后指定dlib的版本<code>pip install dlib==19.24.2</code></p>

        <div class="evoldown" id="提取的代码" type="e">
          <span class="icon">
            <svg type="e" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path fill="currentColor" d="m21.9 15.621c0.1248-1.8535-0.6087-3.4099-2.6058-3.8292-0.7712-0.15744-1.3921-0.13977-2.1113-0.14543-0.6323 0.0048-1.1718-0.01567-1.8401 0.03203 1.5356-0.8078 1.6998-2.205 1.6567-3.546 0.1272-2.3708-1.4685-3.666-3.7727-3.673-2.2427-0.04024-5.0463-0.27229-5.9443 1.9172-0.28083 0.6692-0.27606 1.2179-0.28202 1.6587-0.08527 1.4303 0.20687 2.9224 1.662 3.6429-2.3051-0.05275-5.3273-0.39212-6.28 1.8983-0.28073 0.66862-0.27595 1.2174-0.282 1.6572-0.10329 1.6061 0.3059 3.171 2.0252 3.8067 1.2061 0.4187 2.2175 0.2869 3.3945 0.3134 2.0524 0.0901 4.0448-0.4637 4.4796-2.4982 0.609 2.5638 3.2086 2.5463 5.3204 2.4982 2.7823 0.1278 4.7024-0.9368 4.5798-3.7329zm-12.899-7.6287c-0.14889-1.8665 1.8839-1.4921 3.1358-1.546 0.8939 0.05358 2.4743-0.21158 2.8003 0.88445 0.2729 2.4494-0.0297 2.8555-2.5242 2.8232-0.94713-0.07259-2.869 0.28949-3.3134-0.77077-0.14881-0.44557-0.08538-0.92893-0.09846-1.3909zm0.2606 9.2128c-0.56638 0.162-1.1652 0.1412-1.7487 0.1488-0.59786-0.0036-1.1977 0.0131-1.7948-0.0233-0.93407-0.0365-1.6776-0.3579-1.6157-1.4217 0.01574-0.5119-0.06845-1.0551 0.11822-1.5436 0.4432-0.84155 1.5978-0.6728 2.4032-0.7191 0.81712 0.01614 1.6464-0.05154 2.4536 0.10154 0.99382 0.17537 1.0564 0.91742 1.0227 1.7752-6.1e-4 0.7729 0.04085 1.416-0.83867 1.6821zm2.9212-3.6286c-0.0836 0.19457-0.14194 0.3848-0.18279 0.56614-0.18535-0.87758-0.76293-1.6189-1.5605-2.02 1.0871 0.04933 2.0387 0.04959 3.1216-8e-5 -0.7672 0.39034-1.1687 0.96486-1.3783 1.4539zm6.8788 3.6286c-0.5664 0.162-1.1652 0.1412-1.7488 0.1488-0.5978-0.0036-1.1977 0.0131-1.7947-0.0233-0.9341-0.0365-1.6776-0.3579-1.6157-1.4217 0.0157-0.5119-0.0685-1.0551 0.1182-1.5436 0.4432-0.84155 1.5978-0.6728 2.4033-0.7191 0.8171 0.01614 1.6464-0.05154 2.4536 0.10154 0.9938 0.17537 1.0563 0.91742 1.0227 1.7752-6e-4 0.7729 0.0409 1.416-0.8386 1.6821z"></path></svg>
            <p name="id">提取的代码</p>
          </span>
        </div>
      
<p>下面的代码可以对图片进行人脸检测，检测到人脸后，会将嘴巴区域分割出来，形成数据集。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token triple-quoted-string string">'''
该py文件用于获取人脸关键点，并根据关键点获取嘴唇区域。
思路：
1.使用Dlib库加载预训练的人脸关键点检测模型。
2.使用OpenCV加载人脸检测器。
3.遍历指定目录下的所有图片文件。
4.使用OpenCV读取图片。
5.使用Dlib检测人脸关键点。
6.根据关键点获取嘴唇区域。
7.保存嘴唇区域。
'''</span>
<span class="token keyword">import</span> cv2
<span class="token keyword">import</span> dlib
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> os
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

<span class="token comment"># 配置 Dlib 关键点检测路径</span>
<span class="token comment"># 文件可以从 http://dlib.net/files/ 下载</span>
PREDICTOR_PATH <span class="token operator">=</span> <span class="token string">"./Emotion_Recognition_File/face_detect_model/shape_predictor_68_face_landmarks.dat"</span>
<span class="token triple-quoted-string string">'''
预训练的人脸关键点检测模型，用于检测人脸的关键点。
'''</span>
predictor <span class="token operator">=</span> dlib<span class="token punctuation">.</span>shape_predictor<span class="token punctuation">(</span>PREDICTOR_PATH<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">'''
dlib.shape_predictor()函数用于加载一个预训练的人脸关键点检测模型。
这个函数接收一个参数，表示模型文件的路径。
'''</span>
<span class="token comment"># 配置人脸检测器路径</span>
cascade_path <span class="token operator">=</span> <span class="token string">'./Emotion_Recognition_File/face_detect_model/haarcascade_frontalface_default.xml'</span>
cascade <span class="token operator">=</span> cv2<span class="token punctuation">.</span>CascadeClassifier<span class="token punctuation">(</span>cascade_path<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">get_landmarks</span><span class="token punctuation">(</span>im<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    函数：获取人脸关键点
    参数：im，表示输入的图片
    返回值：返回一个矩阵，表示人脸关键点的坐标
    '''</span>
    rects <span class="token operator">=</span> cascade<span class="token punctuation">.</span>detectMultiScale<span class="token punctuation">(</span>im<span class="token punctuation">,</span> <span class="token number">1.3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token comment"># 人脸检测</span>
    x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> w<span class="token punctuation">,</span> h <span class="token operator">=</span> rects<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>  <span class="token comment"># 获取人脸的四个属性值，左上角坐标 x,y 、高宽 w、h</span>
    <span class="token comment">#array([[209, 156, 289, 289]])</span>
    <span class="token comment">#print(x, y, w, h)</span>
    rect <span class="token operator">=</span> dlib<span class="token punctuation">.</span>rectangle<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>x <span class="token operator">+</span> w<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>y <span class="token operator">+</span> h<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token triple-quoted-string string">'''
    目的：将人脸检测的结果转换为dlib的矩形对象
    dlib.rectangle()函数用于创建一个矩形对象，表示一个矩形区域。
    这个函数接收四个参数，分别是矩形的左上角和右下角的坐标。
    '''</span> 
    <span class="token keyword">return</span> np<span class="token punctuation">.</span>matrix<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span>p<span class="token punctuation">.</span>x<span class="token punctuation">,</span> p<span class="token punctuation">.</span>y<span class="token punctuation">]</span> <span class="token keyword">for</span> p <span class="token keyword">in</span> predictor<span class="token punctuation">(</span>im<span class="token punctuation">,</span> rect<span class="token punctuation">)</span><span class="token punctuation">.</span>parts<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token triple-quoted-string string">'''
    np.matrix()函数用于将列表转换为矩阵。
    predictor(im, rect)：这个函数调用使用predictor对象（之前通过dlib.shape_predictor加载的面部关键点检测器）
                        在图像im中的指定区域rect（一个矩形，通常是通过面部检测得到的）上检测面部关键点。
                        predictor函数返回一个包含检测到的面部关键点的对象。
    .parts()：这个方法被调用来获取检测到的所有面部关键点。它返回一个包含多个点的对象，每个点代表一个关键点的位置。
    [p.x, p.y for p in ...]：这是一个列表推导式，用于遍历parts()返回的所有关键点p，
                             并为每个关键点创建一个包含其x和y坐标的列表。
    np.matrix([...])：这将上一步得到的坐标列表转换成一个NumPy矩阵。NumPy矩阵是一个二维数组，
                     这里每一行代表一个关键点的x和y坐标
    '''</span>


<span class="token keyword">def</span> <span class="token function">annotate_landmarks</span><span class="token punctuation">(</span>im<span class="token punctuation">,</span> landmarks<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    目的：在图片上标记关键点
    参数：im，表示输入的图片
          landmarks，表示关键点坐标
    '''</span>
    im <span class="token operator">=</span> im<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># 复制图片</span>
    <span class="token keyword">for</span> idx<span class="token punctuation">,</span> point <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>landmarks<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment">#enumerate()函数用于将一个可遍历的数据对象组合为一个索引序列，同时列出数据和数据下标</span>
        pos <span class="token operator">=</span> <span class="token punctuation">(</span>point<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> point<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        cv2<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>im<span class="token punctuation">,</span>
                    <span class="token builtin">str</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment"># 文本内容</span>
                    pos<span class="token punctuation">,</span><span class="token comment"># 位置</span>
                    fontFace<span class="token operator">=</span>cv2<span class="token punctuation">.</span>FONT_HERSHEY_SCRIPT_SIMPLEX<span class="token punctuation">,</span><span class="token comment"># 字体</span>
                    fontScale<span class="token operator">=</span><span class="token number">0.4</span><span class="token punctuation">,</span><span class="token comment"># 字体大小</span>
                    color<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># 颜色</span>
        cv2<span class="token punctuation">.</span>circle<span class="token punctuation">(</span>im<span class="token punctuation">,</span> pos<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># 画圆</span>
    <span class="token keyword">return</span> im


<span class="token keyword">def</span> <span class="token function">getlipfromimage</span><span class="token punctuation">(</span>im<span class="token punctuation">,</span> landmarks<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    功能：获取嘴唇区域
    参数：im，表示输入的图片
          landmarks，表示关键点坐标
    返回值：返回一个矩形区域，表示嘴唇区域
    '''</span>
    xmin <span class="token operator">=</span> <span class="token number">10000</span>
    xmax <span class="token operator">=</span> <span class="token number">0</span>
    ymin <span class="token operator">=</span> <span class="token number">10000</span>
    ymax <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token comment"># 根据最外围的关键点获取包围嘴唇的最小矩形框</span>
    <span class="token comment"># 68 个关键点是从</span>
    <span class="token comment"># 左耳朵0 -下巴-右耳朵16-左眉毛（17-21）-右眉毛（22-26）-左眼睛（36-41）</span>
    <span class="token comment"># 右眼睛（42-47）-鼻子从上到下（27-30）-鼻孔（31-35）</span>
    <span class="token comment"># 嘴巴外轮廓（48-59）嘴巴内轮廓（60-67）</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">67</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">'''
        for循环遍历关键点，找到嘴唇区域的最小矩形框
        '''</span>
        x <span class="token operator">=</span> landmarks<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span>
        y <span class="token operator">=</span> landmarks<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>
        <span class="token keyword">if</span> x <span class="token operator">&lt;</span> xmin<span class="token punctuation">:</span>
            xmin <span class="token operator">=</span> x
        <span class="token keyword">if</span> x <span class="token operator">&gt;</span> xmax<span class="token punctuation">:</span>
            xmax <span class="token operator">=</span> x
        <span class="token keyword">if</span> y <span class="token operator">&lt;</span> ymin<span class="token punctuation">:</span>
            ymin <span class="token operator">=</span> y
        <span class="token keyword">if</span> y <span class="token operator">&gt;</span> ymax<span class="token punctuation">:</span>
            ymax <span class="token operator">=</span> y

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"xmin="</span><span class="token punctuation">,</span> xmin<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"xmax="</span><span class="token punctuation">,</span> xmax<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"ymin="</span><span class="token punctuation">,</span> ymin<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"ymax="</span><span class="token punctuation">,</span> ymax<span class="token punctuation">)</span>

    roiwidth <span class="token operator">=</span> xmax <span class="token operator">-</span> xmin<span class="token comment"># 嘴唇区域的宽度</span>
    roiheight <span class="token operator">=</span> ymax <span class="token operator">-</span> ymin<span class="token comment"># 嘴唇区域的高度</span>

    roi <span class="token operator">=</span> im<span class="token punctuation">[</span>ymin<span class="token punctuation">:</span>ymax<span class="token punctuation">,</span> xmin<span class="token punctuation">:</span>xmax<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span>
    <span class="token triple-quoted-string string">'''
    im[ymin:ymax, xmin:xmax, 0:3]：这是一个NumPy数组切片操作，用于从原始图像中提取嘴唇区域。
    它接收三个参数，分别是ymin:ymax、xmin:xmax和0:3。
    ymin:ymax和xmin:xmax表示切片的范围，0:3表示提取所有的通道（RGB）。
    该操作返回一个包含嘴唇区域的NumPy数组。
    '''</span>

    <span class="token comment"># 将嘴唇区域扩大1.5倍</span>
    <span class="token keyword">if</span> roiwidth <span class="token operator">&gt;</span> roiheight<span class="token punctuation">:</span>
        dstlen <span class="token operator">=</span> <span class="token number">1.5</span> <span class="token operator">*</span> roiwidth
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        dstlen <span class="token operator">=</span> <span class="token number">1.5</span> <span class="token operator">*</span> roiheight
    <span class="token comment"># 计算嘴唇区域的中心点</span>
    diff_xlen <span class="token operator">=</span> dstlen <span class="token operator">-</span> roiwidth
    diff_ylen <span class="token operator">=</span> dstlen <span class="token operator">-</span> roiheight

    newx <span class="token operator">=</span> xmin
    newy <span class="token operator">=</span> ymin

    imagerows<span class="token punctuation">,</span> imagecols<span class="token punctuation">,</span> channel <span class="token operator">=</span> im<span class="token punctuation">.</span>shape
    <span class="token triple-quoted-string string">'''
    im.shape是一个元组，包含三个元素，分别是图像的行数、列数和通道数。
    '''</span>
    <span class="token keyword">if</span> newx <span class="token operator">&gt;=</span> diff_xlen <span class="token operator">/</span> <span class="token number">2</span> <span class="token keyword">and</span> newx <span class="token operator">+</span> roiwidth <span class="token operator">+</span> diff_xlen <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">&lt;</span> imagecols<span class="token punctuation">:</span>
        newx <span class="token operator">=</span> newx <span class="token operator">-</span> diff_xlen <span class="token operator">/</span> <span class="token number">2</span>
        
    <span class="token keyword">elif</span> newx <span class="token operator">&lt;</span> diff_xlen <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">:</span>
        newx <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        newx <span class="token operator">=</span> imagecols <span class="token operator">-</span> dstlen

    <span class="token keyword">if</span> newy <span class="token operator">&gt;=</span> diff_ylen <span class="token operator">/</span> <span class="token number">2</span> <span class="token keyword">and</span> newy <span class="token operator">+</span> roiheight <span class="token operator">+</span> diff_ylen <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">&lt;</span> imagerows<span class="token punctuation">:</span>
        newy <span class="token operator">=</span> newy <span class="token operator">-</span> diff_ylen <span class="token operator">/</span> <span class="token number">2</span>
    <span class="token keyword">elif</span> newy <span class="token operator">&lt;</span> diff_ylen <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">:</span>
        newy <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        newy <span class="token operator">=</span> imagerows <span class="token operator">-</span> dstlen
    <span class="token triple-quoted-string string">'''
    上述代码：通过智能调整ROI的位置，确保ROI始终位于图像的有效区域内，
    既不会超出图像边界，也尽可能保持其原始尺寸和形状。
    这在进行图像处理和分析时非常重要，特别是在需要精确操作图像特定区域的应用中
    '''</span>
    roi <span class="token operator">=</span> im<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>newy<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token builtin">int</span><span class="token punctuation">(</span>newy <span class="token operator">+</span> dstlen<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>newx<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token builtin">int</span><span class="token punctuation">(</span>newx <span class="token operator">+</span> dstlen<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span>
    <span class="token triple-quoted-string string">'''
    使用了Python的切片语法来从图像中提取ROI。
    int(newy):int(newy + dstlen)和int(newx):int(newx + dstlen)分别定义了ROI在y方向和x方向上的范围。
    0:3指定了颜色通道的范围，对于一个标准的BGR颜色图像，这意味着选择所有三个颜色通道（蓝色、绿色、红色）
    '''</span>
    <span class="token keyword">return</span> roi

<span class="token keyword">def</span> <span class="token function">listfiles</span><span class="token punctuation">(</span>rootDir<span class="token punctuation">)</span><span class="token punctuation">:</span>
    list_dirs <span class="token operator">=</span> os<span class="token punctuation">.</span>walk<span class="token punctuation">(</span>rootDir<span class="token punctuation">)</span>
    <span class="token keyword">for</span> root<span class="token punctuation">,</span> dirs<span class="token punctuation">,</span> files <span class="token keyword">in</span> list_dirs<span class="token punctuation">:</span>
        <span class="token keyword">for</span> d <span class="token keyword">in</span> dirs<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>root<span class="token punctuation">,</span> d<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> f <span class="token keyword">in</span> files<span class="token punctuation">:</span>
            fileid <span class="token operator">=</span> f<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

            filepath <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>root<span class="token punctuation">,</span> f<span class="token punctuation">)</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                im <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span>filepath<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
                landmarks <span class="token operator">=</span> get_landmarks<span class="token punctuation">(</span>im<span class="token punctuation">)</span><span class="token comment"># 获取关键点</span>
                roi <span class="token operator">=</span> getlipfromimage<span class="token punctuation">(</span>im<span class="token punctuation">,</span> landmarks<span class="token punctuation">)</span><span class="token comment"># 获取嘴唇区域</span>
                roipath <span class="token operator">=</span> filepath<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'.jpg'</span><span class="token punctuation">,</span> <span class="token string">'_mouth.png'</span><span class="token punctuation">)</span><span class="token comment"># 保存嘴唇区域</span>
<span class="token comment">#                 cv2.imwrite(roipath, roi)</span>
                plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>roi<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">except</span><span class="token punctuation">:</span>
<span class="token comment">#                 print("error")</span>
                <span class="token keyword">continue</span>

listfiles<span class="token punctuation">(</span><span class="token string">"./Emotion_Recognition_File/face_det_img/"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="4-模型搭建训练与测试"><a class="markdownIt-Anchor" href="#4-模型搭建训练与测试"></a> 4 模型搭建训练与测试</h1>
<h2 id="41-数据接口准备"><a class="markdownIt-Anchor" href="#41-数据接口准备"></a> 4.1 数据接口准备</h2>

        <div class="evoldown" id="数据接口准备" type="c">
          <span class="icon">
            <svg type="c" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m6.825 4.8749c1.8175-0.03033 2.3249 0.02869 2.25 2.0152 0.01496 1.139 0.01338 1.984-1.3875 1.9798-1.6108-0.01491-2.7285 0.30288-2.6124-1.796-0.019-1.5193-0.04171-2.2697 1.7499-2.1989zm0-2c-2.5847-0.10689-3.8882 1.4181-3.7496 3.8782-0.058825 1.6262 0.20934 2.9456 1.5713 3.7018 0.98591 0.49526 1.6843 0.40204 2.4713 0.42016 0.661-0.00557 1.2079 0.02014 1.9275-0.21866 1.051-0.35295 1.7794-1.2693 1.9533-2.3675 0.08948-0.54803 0.07327-0.95095 0.0762-1.3975-0.00196-0.42752 0.01114-0.8053-0.05632-1.306-0.24162-1.9408-1.9089-2.8188-3.6634-2.7097-0.17686-7.9441e-4 -0.35349-2.3937e-4 -0.53038-7.7934e-4z" fill="currentColor"></path><path d="m17.075 8.6749c1.8175-0.03034 2.3249 0.02868 2.25 2.0152 0.01495 1.139 0.01338 1.984-1.3875 1.9797-1.6108-0.01491-2.7285 0.30288-2.6124-1.796-0.01899-1.5193-0.04171-2.2697 1.7499-2.1989zm0-2c-2.5847-0.10689-3.8882 1.4181-3.7496 3.8782-0.05882 1.6262 0.20933 2.9457 1.5713 3.7017 0.98593 0.49528 1.6843 0.40205 2.4713 0.42017 0.66099-0.00556 1.2079 0.02015 1.9275-0.21865 1.051-0.35295 1.7794-1.2693 1.9533-2.3675 0.08949-0.54803 0.07328-0.95095 0.07621-1.3975-0.00197-0.42839 0.0112-0.80698-0.05673-1.3089-0.24288-1.9391-1.9097-2.8158-3.663-2.7068-0.17688-7.9346e-4 -0.35351-2.388e-4 -0.5304-7.7896e-4z" fill="currentColor"></path><path d="m8.4749 15.525c1.8175-0.03033 2.3249 0.02868 2.25 2.0152 0.01496 1.139 0.01338 1.984-1.3875 1.9797-1.6108-0.01491-2.7285 0.30288-2.6124-1.796-0.01899-1.5193-0.04172-2.2697 1.7499-2.1989zm0-2c-2.5847-0.10689-3.8882 1.4181-3.7496 3.8782-0.058825 1.6262 0.20934 2.9456 1.5713 3.7018 0.98591 0.49526 1.6843 0.40203 2.4713 0.42016 0.66099-0.00557 1.2079 0.02014 1.9276-0.21866 1.051-0.35294 1.7794-1.2693 1.9533-2.3675 0.08949-0.54803 0.07328-0.95095 0.07621-1.3975-0.00197-0.42753 0.01113-0.80529-0.05633-1.306-0.24162-1.9408-1.9089-2.8188-3.6634-2.7097-0.17688-7.9346e-4 -0.35351-2.4262e-4 -0.5304-7.8736e-4z" fill="currentColor"></path></svg>
            <p name="label">说明</p>
            <p name="id">数据接口准备</p>
          </span>
        </div>
      
<p>直接利用文件夹作为输入，只需要把不同类的数据放到不同的文件夹中。输入一个文件夹，输出图片路径以及标签，在开始训练之前需要将数据集进行拆分，拆分成训练集(train)和验证集(val)，训练集和测试集的比例为<code>9:1</code>，<code>train_val_data</code>文件结构如下所示，其中 0 代表 none、 1 代表pouting、2 代表 smile、3 代表 openmouth：</p>

        <div class="evoldown" id="准备的代码" type="e">
          <span class="icon">
            <svg type="e" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path fill="currentColor" d="m21.9 15.621c0.1248-1.8535-0.6087-3.4099-2.6058-3.8292-0.7712-0.15744-1.3921-0.13977-2.1113-0.14543-0.6323 0.0048-1.1718-0.01567-1.8401 0.03203 1.5356-0.8078 1.6998-2.205 1.6567-3.546 0.1272-2.3708-1.4685-3.666-3.7727-3.673-2.2427-0.04024-5.0463-0.27229-5.9443 1.9172-0.28083 0.6692-0.27606 1.2179-0.28202 1.6587-0.08527 1.4303 0.20687 2.9224 1.662 3.6429-2.3051-0.05275-5.3273-0.39212-6.28 1.8983-0.28073 0.66862-0.27595 1.2174-0.282 1.6572-0.10329 1.6061 0.3059 3.171 2.0252 3.8067 1.2061 0.4187 2.2175 0.2869 3.3945 0.3134 2.0524 0.0901 4.0448-0.4637 4.4796-2.4982 0.609 2.5638 3.2086 2.5463 5.3204 2.4982 2.7823 0.1278 4.7024-0.9368 4.5798-3.7329zm-12.899-7.6287c-0.14889-1.8665 1.8839-1.4921 3.1358-1.546 0.8939 0.05358 2.4743-0.21158 2.8003 0.88445 0.2729 2.4494-0.0297 2.8555-2.5242 2.8232-0.94713-0.07259-2.869 0.28949-3.3134-0.77077-0.14881-0.44557-0.08538-0.92893-0.09846-1.3909zm0.2606 9.2128c-0.56638 0.162-1.1652 0.1412-1.7487 0.1488-0.59786-0.0036-1.1977 0.0131-1.7948-0.0233-0.93407-0.0365-1.6776-0.3579-1.6157-1.4217 0.01574-0.5119-0.06845-1.0551 0.11822-1.5436 0.4432-0.84155 1.5978-0.6728 2.4032-0.7191 0.81712 0.01614 1.6464-0.05154 2.4536 0.10154 0.99382 0.17537 1.0564 0.91742 1.0227 1.7752-6.1e-4 0.7729 0.04085 1.416-0.83867 1.6821zm2.9212-3.6286c-0.0836 0.19457-0.14194 0.3848-0.18279 0.56614-0.18535-0.87758-0.76293-1.6189-1.5605-2.02 1.0871 0.04933 2.0387 0.04959 3.1216-8e-5 -0.7672 0.39034-1.1687 0.96486-1.3783 1.4539zm6.8788 3.6286c-0.5664 0.162-1.1652 0.1412-1.7488 0.1488-0.5978-0.0036-1.1977 0.0131-1.7947-0.0233-0.9341-0.0365-1.6776-0.3579-1.6157-1.4217 0.0157-0.5119-0.0685-1.0551 0.1182-1.5436 0.4432-0.84155 1.5978-0.6728 2.4033-0.7191 0.8171 0.01614 1.6464-0.05154 2.4536 0.10154 0.9938 0.17537 1.0563 0.91742 1.0227 1.7752-6e-4 0.7729 0.0409 1.416-0.8386 1.6821z"></path></svg>
            <p name="id">准备的代码</p>
          </span>
          <span class="link-icon ml-[0.5em] mr-[0.25em]">
            <svg xmlns="http://www.w3.org/2000/svg" width="0.9411764705882353em" height="0.9411764705882353em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class="untouchable"><path d="m9.5652 14.45 0.72891-2.0026c-0.651 0.00713-1.3027 0.00104-1.9532 0.00179-1.0991-0.02908-3.0336 0.08306-3.605-1.0524-0.28828-0.61588-0.2054-1.3226-0.22136-1.9833 0.00663-0.74044-0.05553-1.6362 0.5758-2.1558 0.70637-0.5555 1.7411-0.56129 2.6027-0.59834 0.743-0.015 1.4884-0.00764 2.2315-0.00868 0.68471 0.01536 1.6274-0.01783 2.4184 0.16762l0.68711-1.8879c-0.0146-0.003965-0.0287-0.00841-0.0435-0.01227-0.94653-0.24905-1.9355-0.25901-2.9083-0.26688-0.78352-1.3008e-4 -1.5692-0.0063751-2.3527 0.006805-1.2709 0.027555-2.6299 0.13739-3.6978 0.89566-1.6654 1.2031-1.53 2.9573-1.5068 4.79-0.0012251 1.7732 0.89765 3.2159 2.626 3.7562 0.80589 0.26191 1.6615 0.32018 2.5036 0.34101 0.6376 0.01106 1.2763 0.01096 1.9146 0.00915z" fill="currentColor"></path><path d="m14.589 9.125h1.3099c0.02865-0.88714-0.11774-1.6826-0.45594-2.3461l-0.85392 2.3461z" fill="currentColor"></path><path d="m15.587 12.025h-2.0527l-0.80604 2.2146c1.2326-0.27362 2.3169-0.88582 2.8588-2.2146z" fill="currentColor"></path><path d="m8.394 12.025h2.0538l0.82406-2.2641c-1.2457 0.2734-2.3327 0.8901-2.8779 2.2641z" fill="currentColor"></path><path d="m8.5566 17.221 0.83571-2.2961h-1.2914c-0.025394 0.86685 0.12295 1.645 0.45565 2.2961z" fill="currentColor"></path><path d="m21.485 14.399c7e-4 -0.67593 0.0063-1.3662-0.1779-2.0223-0.58881-2.115-2.5706-2.7532-4.5608-2.8041-0.76964-0.031175-1.5416-0.02264-2.3121-0.022365l-0.72832 2.0011c0.38557-0.00297 0.77131 7.6e-4 1.1559-0.00173 1.1244 0.02284 2.8396-0.10221 3.8152 0.44616 0.82512 0.45526 0.81194 1.4036 0.80798 2.2308-0.01538 0.64171 0.05949 1.3145-0.1601 1.93-0.39418 1.0145-1.651 1.1102-2.5915 1.1694-0.7426 0.03331-1.4884 0.0209-2.2315 0.02365-0.81334-0.01641-1.9395 0.04306-2.8448-0.16914l-0.68792 1.89c0.014845 0.00401 0.02915 0.0085 0.044115 0.0124 0.94522 0.24688 1.9316 0.25913 2.9027 0.2657 0.83456-2.2e-4 1.6713 0.00786 2.5057-0.00999 2.0286-0.02122 4.1491-0.51576 4.8438-2.6752 0.2358-0.7292 0.22-1.5067 0.2196-2.2644z" fill="currentColor"></path><path d="m14.979 6.7378c0.17824-0.52033 0.90905-2.4486 1.0626-2.9514 0.05601-0.19527 0.10768-0.39984 0.08232-0.60408-0.03096-0.33264-0.36035-0.4603-0.63671-0.55464-0.20794-0.070665-0.41593-0.17228-0.63943-0.174-0.33751 0.005805-0.52152 0.33878-0.64452 0.61072-1.4256 3.8005-4.7612 13.07-6.1617 16.891-0.10636 0.34-0.29285 0.7891-0.06874 1.1109 0.1296 0.1673 0.34386 0.232 0.53431 0.3042 0.30778 0.1107 0.70325 0.3075 0.98251 0.0365 0.14514-0.1339 0.23561-0.315 0.31595-0.4926 0.10005-0.2274 0.1811-0.4632 0.26694-0.6962 0.4854-1.3337 4.3257-11.885 4.9065-13.481z" fill="currentColor"></path></svg>
          </span>
          
          <span class="icon">
            <svg type="c" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m6.825 4.8749c1.8175-0.03033 2.3249 0.02869 2.25 2.0152 0.01496 1.139 0.01338 1.984-1.3875 1.9798-1.6108-0.01491-2.7285 0.30288-2.6124-1.796-0.019-1.5193-0.04171-2.2697 1.7499-2.1989zm0-2c-2.5847-0.10689-3.8882 1.4181-3.7496 3.8782-0.058825 1.6262 0.20934 2.9456 1.5713 3.7018 0.98591 0.49526 1.6843 0.40204 2.4713 0.42016 0.661-0.00557 1.2079 0.02014 1.9275-0.21866 1.051-0.35295 1.7794-1.2693 1.9533-2.3675 0.08948-0.54803 0.07327-0.95095 0.0762-1.3975-0.00196-0.42752 0.01114-0.8053-0.05632-1.306-0.24162-1.9408-1.9089-2.8188-3.6634-2.7097-0.17686-7.9441e-4 -0.35349-2.3937e-4 -0.53038-7.7934e-4z" fill="currentColor"></path><path d="m17.075 8.6749c1.8175-0.03034 2.3249 0.02868 2.25 2.0152 0.01495 1.139 0.01338 1.984-1.3875 1.9797-1.6108-0.01491-2.7285 0.30288-2.6124-1.796-0.01899-1.5193-0.04171-2.2697 1.7499-2.1989zm0-2c-2.5847-0.10689-3.8882 1.4181-3.7496 3.8782-0.05882 1.6262 0.20933 2.9457 1.5713 3.7017 0.98593 0.49528 1.6843 0.40205 2.4713 0.42017 0.66099-0.00556 1.2079 0.02015 1.9275-0.21865 1.051-0.35295 1.7794-1.2693 1.9533-2.3675 0.08949-0.54803 0.07328-0.95095 0.07621-1.3975-0.00197-0.42839 0.0112-0.80698-0.05673-1.3089-0.24288-1.9391-1.9097-2.8158-3.663-2.7068-0.17688-7.9346e-4 -0.35351-2.388e-4 -0.5304-7.7896e-4z" fill="currentColor"></path><path d="m8.4749 15.525c1.8175-0.03033 2.3249 0.02868 2.25 2.0152 0.01496 1.139 0.01338 1.984-1.3875 1.9797-1.6108-0.01491-2.7285 0.30288-2.6124-1.796-0.01899-1.5193-0.04172-2.2697 1.7499-2.1989zm0-2c-2.5847-0.10689-3.8882 1.4181-3.7496 3.8782-0.058825 1.6262 0.20934 2.9456 1.5713 3.7018 0.98591 0.49526 1.6843 0.40203 2.4713 0.42016 0.66099-0.00557 1.2079 0.02014 1.9276-0.21866 1.051-0.35294 1.7794-1.2693 1.9533-2.3675 0.08949-0.54803 0.07328-0.95095 0.07621-1.3975-0.00197-0.42753 0.01113-0.80529-0.05633-1.306-0.24162-1.9408-1.9089-2.8188-3.6634-2.7097-0.17688-7.9346e-4 -0.35351-2.4262e-4 -0.5304-7.8736e-4z" fill="currentColor"></path></svg>
            <p name="id">数据接口准备</p>
          </span>
        </div>
      
<pre class="line-numbers language-python" data-language="python"><code class="language-python">data_transforms <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">'train'</span><span class="token punctuation">:</span> transforms<span class="token punctuation">.</span>Compose<span class="token punctuation">(</span><span class="token punctuation">[</span>
            transforms<span class="token punctuation">.</span>RandomResizedCrop<span class="token punctuation">(</span><span class="token number">48</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment"># 随机裁剪，调整为48*48像素大小，增强泛化</span>
            transforms<span class="token punctuation">.</span>RandomHorizontalFlip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment"># 随机水平翻转，增强泛化</span>
            transforms<span class="token punctuation">.</span>ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment"># 转换为张量</span>
            transforms<span class="token punctuation">.</span>Normalize<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment"># 标准化</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">'val'</span><span class="token punctuation">:</span> transforms<span class="token punctuation">.</span>Compose<span class="token punctuation">(</span><span class="token punctuation">[</span>
            transforms<span class="token punctuation">.</span>Resize<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment"># 调整为64*64像素大小</span>
            transforms<span class="token punctuation">.</span>CenterCrop<span class="token punctuation">(</span><span class="token number">48</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment"># 中心裁剪，调整为48*48像素大小</span>
            transforms<span class="token punctuation">.</span>ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment"># 转换为张量</span>
            transforms<span class="token punctuation">.</span>Normalize<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment"># 标准化</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>

    data_dir <span class="token operator">=</span> <span class="token string">'./Emotion_Recognition_File/train_val_data/'</span> <span class="token comment"># 数据集所在的位置</span>
    <span class="token comment">#创建图像数据集</span>
    image_datasets <span class="token operator">=</span> <span class="token punctuation">{</span>x<span class="token punctuation">:</span> datasets<span class="token punctuation">.</span>ImageFolder<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>data_dir<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">,</span>
                                              data_transforms<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'train'</span><span class="token punctuation">,</span> <span class="token string">'val'</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
    <span class="token comment">#创建数据加载器</span>
    dataloders <span class="token operator">=</span> <span class="token punctuation">{</span>x<span class="token punctuation">:</span> torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>data<span class="token punctuation">.</span>DataLoader<span class="token punctuation">(</span>image_datasets<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token comment"># 数据集</span>
                                                 batch_size<span class="token operator">=</span><span class="token number">64</span><span class="token punctuation">,</span><span class="token comment"># 每个批次加载64个样本</span>
                                                 shuffle<span class="token operator">=</span><span class="token boolean">True</span> <span class="token keyword">if</span> x<span class="token operator">==</span><span class="token string">"train"</span> <span class="token keyword">else</span> <span class="token boolean">False</span><span class="token punctuation">,</span><span class="token comment"># 训练集打乱，验证集不打乱</span>
                                                 num_workers<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'train'</span><span class="token punctuation">,</span> <span class="token string">'val'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token comment"># 使用8个子进程加载数据</span>

    dataset_sizes <span class="token operator">=</span> <span class="token punctuation">{</span>x<span class="token punctuation">:</span> <span class="token builtin">len</span><span class="token punctuation">(</span>image_datasets<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'train'</span><span class="token punctuation">,</span> <span class="token string">'val'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token comment"># 数据集大小</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="42-模型定义"><a class="markdownIt-Anchor" href="#42-模型定义"></a> 4.2 模型定义</h2>

        <div class="evoldown" id="模型定义" type="c">
          <span class="icon">
            <svg type="c" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m6.825 4.8749c1.8175-0.03033 2.3249 0.02869 2.25 2.0152 0.01496 1.139 0.01338 1.984-1.3875 1.9798-1.6108-0.01491-2.7285 0.30288-2.6124-1.796-0.019-1.5193-0.04171-2.2697 1.7499-2.1989zm0-2c-2.5847-0.10689-3.8882 1.4181-3.7496 3.8782-0.058825 1.6262 0.20934 2.9456 1.5713 3.7018 0.98591 0.49526 1.6843 0.40204 2.4713 0.42016 0.661-0.00557 1.2079 0.02014 1.9275-0.21866 1.051-0.35295 1.7794-1.2693 1.9533-2.3675 0.08948-0.54803 0.07327-0.95095 0.0762-1.3975-0.00196-0.42752 0.01114-0.8053-0.05632-1.306-0.24162-1.9408-1.9089-2.8188-3.6634-2.7097-0.17686-7.9441e-4 -0.35349-2.3937e-4 -0.53038-7.7934e-4z" fill="currentColor"></path><path d="m17.075 8.6749c1.8175-0.03034 2.3249 0.02868 2.25 2.0152 0.01495 1.139 0.01338 1.984-1.3875 1.9797-1.6108-0.01491-2.7285 0.30288-2.6124-1.796-0.01899-1.5193-0.04171-2.2697 1.7499-2.1989zm0-2c-2.5847-0.10689-3.8882 1.4181-3.7496 3.8782-0.05882 1.6262 0.20933 2.9457 1.5713 3.7017 0.98593 0.49528 1.6843 0.40205 2.4713 0.42017 0.66099-0.00556 1.2079 0.02015 1.9275-0.21865 1.051-0.35295 1.7794-1.2693 1.9533-2.3675 0.08949-0.54803 0.07328-0.95095 0.07621-1.3975-0.00197-0.42839 0.0112-0.80698-0.05673-1.3089-0.24288-1.9391-1.9097-2.8158-3.663-2.7068-0.17688-7.9346e-4 -0.35351-2.388e-4 -0.5304-7.7896e-4z" fill="currentColor"></path><path d="m8.4749 15.525c1.8175-0.03033 2.3249 0.02868 2.25 2.0152 0.01496 1.139 0.01338 1.984-1.3875 1.9797-1.6108-0.01491-2.7285 0.30288-2.6124-1.796-0.01899-1.5193-0.04172-2.2697 1.7499-2.1989zm0-2c-2.5847-0.10689-3.8882 1.4181-3.7496 3.8782-0.058825 1.6262 0.20934 2.9456 1.5713 3.7018 0.98591 0.49526 1.6843 0.40203 2.4713 0.42016 0.66099-0.00557 1.2079 0.02014 1.9276-0.21866 1.051-0.35294 1.7794-1.2693 1.9533-2.3675 0.08949-0.54803 0.07328-0.95095 0.07621-1.3975-0.00197-0.42753 0.01113-0.80529-0.05633-1.306-0.24162-1.9408-1.9089-2.8188-3.6634-2.7097-0.17688-7.9346e-4 -0.35351-2.4262e-4 -0.5304-7.8736e-4z" fill="currentColor"></path></svg>
            <p name="label">说明</p>
            <p name="id">模型定义</p>
          </span>
        </div>
      
<p>创建数据接⼝后，开始定义⼀个⽹络 simpleconv3。一个简单的 3 层卷积。在 torch.nn 下，有各种网络层，这里就用到了 nn.Conv2d，nn.BatchNorm2d 和 nn.Linear，分别是卷积层，BN 层和全连接层。我们以一个卷积层为例：</p>
<pre class="line-numbers language-none"><code class="language-none">conv1 = nn.Conv2d(in_channels=3, out_channels=12, kernel_size=3, stride=2)
bn1 = nn.BatchNorm2d(num_features=12)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ul>
<li>in_channels：输入通道数</li>
<li>out_channels：输出通道数</li>
<li>kernel_size：卷积核的大小</li>
<li>stride：卷积核的移动步长</li>
</ul>

        <div class="evoldown" id="模型定义的代码" type="e">
          <span class="icon">
            <svg type="e" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path fill="currentColor" d="m21.9 15.621c0.1248-1.8535-0.6087-3.4099-2.6058-3.8292-0.7712-0.15744-1.3921-0.13977-2.1113-0.14543-0.6323 0.0048-1.1718-0.01567-1.8401 0.03203 1.5356-0.8078 1.6998-2.205 1.6567-3.546 0.1272-2.3708-1.4685-3.666-3.7727-3.673-2.2427-0.04024-5.0463-0.27229-5.9443 1.9172-0.28083 0.6692-0.27606 1.2179-0.28202 1.6587-0.08527 1.4303 0.20687 2.9224 1.662 3.6429-2.3051-0.05275-5.3273-0.39212-6.28 1.8983-0.28073 0.66862-0.27595 1.2174-0.282 1.6572-0.10329 1.6061 0.3059 3.171 2.0252 3.8067 1.2061 0.4187 2.2175 0.2869 3.3945 0.3134 2.0524 0.0901 4.0448-0.4637 4.4796-2.4982 0.609 2.5638 3.2086 2.5463 5.3204 2.4982 2.7823 0.1278 4.7024-0.9368 4.5798-3.7329zm-12.899-7.6287c-0.14889-1.8665 1.8839-1.4921 3.1358-1.546 0.8939 0.05358 2.4743-0.21158 2.8003 0.88445 0.2729 2.4494-0.0297 2.8555-2.5242 2.8232-0.94713-0.07259-2.869 0.28949-3.3134-0.77077-0.14881-0.44557-0.08538-0.92893-0.09846-1.3909zm0.2606 9.2128c-0.56638 0.162-1.1652 0.1412-1.7487 0.1488-0.59786-0.0036-1.1977 0.0131-1.7948-0.0233-0.93407-0.0365-1.6776-0.3579-1.6157-1.4217 0.01574-0.5119-0.06845-1.0551 0.11822-1.5436 0.4432-0.84155 1.5978-0.6728 2.4032-0.7191 0.81712 0.01614 1.6464-0.05154 2.4536 0.10154 0.99382 0.17537 1.0564 0.91742 1.0227 1.7752-6.1e-4 0.7729 0.04085 1.416-0.83867 1.6821zm2.9212-3.6286c-0.0836 0.19457-0.14194 0.3848-0.18279 0.56614-0.18535-0.87758-0.76293-1.6189-1.5605-2.02 1.0871 0.04933 2.0387 0.04959 3.1216-8e-5 -0.7672 0.39034-1.1687 0.96486-1.3783 1.4539zm6.8788 3.6286c-0.5664 0.162-1.1652 0.1412-1.7488 0.1488-0.5978-0.0036-1.1977 0.0131-1.7947-0.0233-0.9341-0.0365-1.6776-0.3579-1.6157-1.4217 0.0157-0.5119-0.0685-1.0551 0.1182-1.5436 0.4432-0.84155 1.5978-0.6728 2.4033-0.7191 0.8171 0.01614 1.6464-0.05154 2.4536 0.10154 0.9938 0.17537 1.0563 0.91742 1.0227 1.7752-6e-4 0.7729 0.0409 1.416-0.8386 1.6821z"></path></svg>
            <p name="id">模型定义的代码</p>
          </span>
          <span class="link-icon ml-[0.5em] mr-[0.25em]">
            <svg xmlns="http://www.w3.org/2000/svg" width="0.9411764705882353em" height="0.9411764705882353em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class="untouchable"><path d="m9.5652 14.45 0.72891-2.0026c-0.651 0.00713-1.3027 0.00104-1.9532 0.00179-1.0991-0.02908-3.0336 0.08306-3.605-1.0524-0.28828-0.61588-0.2054-1.3226-0.22136-1.9833 0.00663-0.74044-0.05553-1.6362 0.5758-2.1558 0.70637-0.5555 1.7411-0.56129 2.6027-0.59834 0.743-0.015 1.4884-0.00764 2.2315-0.00868 0.68471 0.01536 1.6274-0.01783 2.4184 0.16762l0.68711-1.8879c-0.0146-0.003965-0.0287-0.00841-0.0435-0.01227-0.94653-0.24905-1.9355-0.25901-2.9083-0.26688-0.78352-1.3008e-4 -1.5692-0.0063751-2.3527 0.006805-1.2709 0.027555-2.6299 0.13739-3.6978 0.89566-1.6654 1.2031-1.53 2.9573-1.5068 4.79-0.0012251 1.7732 0.89765 3.2159 2.626 3.7562 0.80589 0.26191 1.6615 0.32018 2.5036 0.34101 0.6376 0.01106 1.2763 0.01096 1.9146 0.00915z" fill="currentColor"></path><path d="m14.589 9.125h1.3099c0.02865-0.88714-0.11774-1.6826-0.45594-2.3461l-0.85392 2.3461z" fill="currentColor"></path><path d="m15.587 12.025h-2.0527l-0.80604 2.2146c1.2326-0.27362 2.3169-0.88582 2.8588-2.2146z" fill="currentColor"></path><path d="m8.394 12.025h2.0538l0.82406-2.2641c-1.2457 0.2734-2.3327 0.8901-2.8779 2.2641z" fill="currentColor"></path><path d="m8.5566 17.221 0.83571-2.2961h-1.2914c-0.025394 0.86685 0.12295 1.645 0.45565 2.2961z" fill="currentColor"></path><path d="m21.485 14.399c7e-4 -0.67593 0.0063-1.3662-0.1779-2.0223-0.58881-2.115-2.5706-2.7532-4.5608-2.8041-0.76964-0.031175-1.5416-0.02264-2.3121-0.022365l-0.72832 2.0011c0.38557-0.00297 0.77131 7.6e-4 1.1559-0.00173 1.1244 0.02284 2.8396-0.10221 3.8152 0.44616 0.82512 0.45526 0.81194 1.4036 0.80798 2.2308-0.01538 0.64171 0.05949 1.3145-0.1601 1.93-0.39418 1.0145-1.651 1.1102-2.5915 1.1694-0.7426 0.03331-1.4884 0.0209-2.2315 0.02365-0.81334-0.01641-1.9395 0.04306-2.8448-0.16914l-0.68792 1.89c0.014845 0.00401 0.02915 0.0085 0.044115 0.0124 0.94522 0.24688 1.9316 0.25913 2.9027 0.2657 0.83456-2.2e-4 1.6713 0.00786 2.5057-0.00999 2.0286-0.02122 4.1491-0.51576 4.8438-2.6752 0.2358-0.7292 0.22-1.5067 0.2196-2.2644z" fill="currentColor"></path><path d="m14.979 6.7378c0.17824-0.52033 0.90905-2.4486 1.0626-2.9514 0.05601-0.19527 0.10768-0.39984 0.08232-0.60408-0.03096-0.33264-0.36035-0.4603-0.63671-0.55464-0.20794-0.070665-0.41593-0.17228-0.63943-0.174-0.33751 0.005805-0.52152 0.33878-0.64452 0.61072-1.4256 3.8005-4.7612 13.07-6.1617 16.891-0.10636 0.34-0.29285 0.7891-0.06874 1.1109 0.1296 0.1673 0.34386 0.232 0.53431 0.3042 0.30778 0.1107 0.70325 0.3075 0.98251 0.0365 0.14514-0.1339 0.23561-0.315 0.31595-0.4926 0.10005-0.2274 0.1811-0.4632 0.26694-0.6962 0.4854-1.3337 4.3257-11.885 4.9065-13.481z" fill="currentColor"></path></svg>
          </span>
          
          <span class="icon">
            <svg type="c" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m6.825 4.8749c1.8175-0.03033 2.3249 0.02869 2.25 2.0152 0.01496 1.139 0.01338 1.984-1.3875 1.9798-1.6108-0.01491-2.7285 0.30288-2.6124-1.796-0.019-1.5193-0.04171-2.2697 1.7499-2.1989zm0-2c-2.5847-0.10689-3.8882 1.4181-3.7496 3.8782-0.058825 1.6262 0.20934 2.9456 1.5713 3.7018 0.98591 0.49526 1.6843 0.40204 2.4713 0.42016 0.661-0.00557 1.2079 0.02014 1.9275-0.21866 1.051-0.35295 1.7794-1.2693 1.9533-2.3675 0.08948-0.54803 0.07327-0.95095 0.0762-1.3975-0.00196-0.42752 0.01114-0.8053-0.05632-1.306-0.24162-1.9408-1.9089-2.8188-3.6634-2.7097-0.17686-7.9441e-4 -0.35349-2.3937e-4 -0.53038-7.7934e-4z" fill="currentColor"></path><path d="m17.075 8.6749c1.8175-0.03034 2.3249 0.02868 2.25 2.0152 0.01495 1.139 0.01338 1.984-1.3875 1.9797-1.6108-0.01491-2.7285 0.30288-2.6124-1.796-0.01899-1.5193-0.04171-2.2697 1.7499-2.1989zm0-2c-2.5847-0.10689-3.8882 1.4181-3.7496 3.8782-0.05882 1.6262 0.20933 2.9457 1.5713 3.7017 0.98593 0.49528 1.6843 0.40205 2.4713 0.42017 0.66099-0.00556 1.2079 0.02015 1.9275-0.21865 1.051-0.35295 1.7794-1.2693 1.9533-2.3675 0.08949-0.54803 0.07328-0.95095 0.07621-1.3975-0.00197-0.42839 0.0112-0.80698-0.05673-1.3089-0.24288-1.9391-1.9097-2.8158-3.663-2.7068-0.17688-7.9346e-4 -0.35351-2.388e-4 -0.5304-7.7896e-4z" fill="currentColor"></path><path d="m8.4749 15.525c1.8175-0.03033 2.3249 0.02868 2.25 2.0152 0.01496 1.139 0.01338 1.984-1.3875 1.9797-1.6108-0.01491-2.7285 0.30288-2.6124-1.796-0.01899-1.5193-0.04172-2.2697 1.7499-2.1989zm0-2c-2.5847-0.10689-3.8882 1.4181-3.7496 3.8782-0.058825 1.6262 0.20934 2.9456 1.5713 3.7018 0.98591 0.49526 1.6843 0.40203 2.4713 0.42016 0.66099-0.00557 1.2079 0.02014 1.9276-0.21866 1.051-0.35294 1.7794-1.2693 1.9533-2.3675 0.08949-0.54803 0.07328-0.95095 0.07621-1.3975-0.00197-0.42753 0.01113-0.80529-0.05633-1.306-0.24162-1.9408-1.9089-2.8188-3.6634-2.7097-0.17688-7.9346e-4 -0.35351-2.4262e-4 -0.5304-7.8736e-4z" fill="currentColor"></path></svg>
            <p name="id">模型定义</p>
          </span>
        </div>
      
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 定义一个简单的卷积神经网络</span>
<span class="token keyword">class</span> <span class="token class-name">simpleconv3</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>simpleconv3<span class="token punctuation">,</span>self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#调用父类的构造函数</span>
        self<span class="token punctuation">.</span>conv1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token comment">#定义第一个卷积层</span>
        self<span class="token punctuation">.</span>bn1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>BatchNorm2d<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token comment">#定义第一个批标准化层</span>
        self<span class="token punctuation">.</span>conv2 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token comment">#定义第二个卷积层</span>
        self<span class="token punctuation">.</span>bn2 <span class="token operator">=</span> nn<span class="token punctuation">.</span>BatchNorm2d<span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">)</span><span class="token comment">#定义第二个批标准化层</span>
        self<span class="token punctuation">.</span>conv3 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token comment">#定义第三个卷积层</span>
        self<span class="token punctuation">.</span>bn3 <span class="token operator">=</span> nn<span class="token punctuation">.</span>BatchNorm2d<span class="token punctuation">(</span><span class="token number">48</span><span class="token punctuation">)</span><span class="token comment">#定义第三个批标准化层</span>
        self<span class="token punctuation">.</span>fc1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">48</span> <span class="token operator">*</span> <span class="token number">5</span> <span class="token operator">*</span> <span class="token number">5</span> <span class="token punctuation">,</span> <span class="token number">1200</span><span class="token punctuation">)</span><span class="token comment">#定义第一个全连接层</span>
        self<span class="token punctuation">.</span>fc2 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">1200</span> <span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">)</span><span class="token comment">#定义第二个全连接层</span>
        self<span class="token punctuation">.</span>fc3 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">128</span> <span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token comment">#定义第三个全连接层</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self <span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment">#前向传播</span>
        x <span class="token operator">=</span> F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>bn1<span class="token punctuation">(</span>self<span class="token punctuation">.</span>conv1<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#卷积层-&gt;批标准化层-&gt;激活函数</span>
        <span class="token comment">#print "bn1 shape",x.shape</span>
        x <span class="token operator">=</span> F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>bn2<span class="token punctuation">(</span>self<span class="token punctuation">.</span>conv2<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#卷积层-&gt;批标准化层-&gt;激活函数</span>
        x <span class="token operator">=</span> F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>bn3<span class="token punctuation">(</span>self<span class="token punctuation">.</span>conv3<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        x <span class="token operator">=</span> x<span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">,</span> <span class="token number">48</span> <span class="token operator">*</span> <span class="token number">5</span> <span class="token operator">*</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token comment">#reshape操作</span>
        x <span class="token operator">=</span> F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>fc1<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#全连接层-&gt;激活函数</span>
        x <span class="token operator">=</span> F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>fc2<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
        x <span class="token operator">=</span> self<span class="token punctuation">.</span>fc3<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token comment">#全连接层</span>
        <span class="token keyword">return</span> x<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="43-模型训练"><a class="markdownIt-Anchor" href="#43-模型训练"></a> 4.3 模型训练</h2>

        <div class="evoldown" id="测试的意义" type="c">
          <span class="icon">
            <svg type="c" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m6.825 4.8749c1.8175-0.03033 2.3249 0.02869 2.25 2.0152 0.01496 1.139 0.01338 1.984-1.3875 1.9798-1.6108-0.01491-2.7285 0.30288-2.6124-1.796-0.019-1.5193-0.04171-2.2697 1.7499-2.1989zm0-2c-2.5847-0.10689-3.8882 1.4181-3.7496 3.8782-0.058825 1.6262 0.20934 2.9456 1.5713 3.7018 0.98591 0.49526 1.6843 0.40204 2.4713 0.42016 0.661-0.00557 1.2079 0.02014 1.9275-0.21866 1.051-0.35295 1.7794-1.2693 1.9533-2.3675 0.08948-0.54803 0.07327-0.95095 0.0762-1.3975-0.00196-0.42752 0.01114-0.8053-0.05632-1.306-0.24162-1.9408-1.9089-2.8188-3.6634-2.7097-0.17686-7.9441e-4 -0.35349-2.3937e-4 -0.53038-7.7934e-4z" fill="currentColor"></path><path d="m17.075 8.6749c1.8175-0.03034 2.3249 0.02868 2.25 2.0152 0.01495 1.139 0.01338 1.984-1.3875 1.9797-1.6108-0.01491-2.7285 0.30288-2.6124-1.796-0.01899-1.5193-0.04171-2.2697 1.7499-2.1989zm0-2c-2.5847-0.10689-3.8882 1.4181-3.7496 3.8782-0.05882 1.6262 0.20933 2.9457 1.5713 3.7017 0.98593 0.49528 1.6843 0.40205 2.4713 0.42017 0.66099-0.00556 1.2079 0.02015 1.9275-0.21865 1.051-0.35295 1.7794-1.2693 1.9533-2.3675 0.08949-0.54803 0.07328-0.95095 0.07621-1.3975-0.00197-0.42839 0.0112-0.80698-0.05673-1.3089-0.24288-1.9391-1.9097-2.8158-3.663-2.7068-0.17688-7.9346e-4 -0.35351-2.388e-4 -0.5304-7.7896e-4z" fill="currentColor"></path><path d="m8.4749 15.525c1.8175-0.03033 2.3249 0.02868 2.25 2.0152 0.01496 1.139 0.01338 1.984-1.3875 1.9797-1.6108-0.01491-2.7285 0.30288-2.6124-1.796-0.01899-1.5193-0.04172-2.2697 1.7499-2.1989zm0-2c-2.5847-0.10689-3.8882 1.4181-3.7496 3.8782-0.058825 1.6262 0.20934 2.9456 1.5713 3.7018 0.98591 0.49526 1.6843 0.40203 2.4713 0.42016 0.66099-0.00557 1.2079 0.02014 1.9276-0.21866 1.051-0.35294 1.7794-1.2693 1.9533-2.3675 0.08949-0.54803 0.07328-0.95095 0.07621-1.3975-0.00197-0.42753 0.01113-0.80529-0.05633-1.306-0.24162-1.9408-1.9089-2.8188-3.6634-2.7097-0.17688-7.9346e-4 -0.35351-2.4262e-4 -0.5304-7.8736e-4z" fill="currentColor"></path></svg>
            <p name="label">说明</p>
            <p name="id">测试的意义</p>
          </span>
        </div>
      
<ol>
<li><strong>验证模型准确性</strong>：通过测试可以验证模型的预测结果是否符合预期，确保模型的准确性和可靠性。</li>
<li><strong>性能评估</strong>：测试可以评估模型在不同条件下的性能，包括处理速度、资源消耗等，以确保模型在实际应用中的效率。</li>
<li><strong>发现问题</strong>：通过对模型进行系统的测试，可以发现模型设计或实现过程中的问题，如过拟合、欠拟合等。</li>
<li><strong>模型优化</strong>：测试结果可以为模型的进一步优化提供依据，帮助开发者调整模型参数，改进模型结构。</li>
</ol>

        <div class="evoldown" id="训练代码" type="e">
          <span class="icon">
            <svg type="e" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path fill="currentColor" d="m21.9 15.621c0.1248-1.8535-0.6087-3.4099-2.6058-3.8292-0.7712-0.15744-1.3921-0.13977-2.1113-0.14543-0.6323 0.0048-1.1718-0.01567-1.8401 0.03203 1.5356-0.8078 1.6998-2.205 1.6567-3.546 0.1272-2.3708-1.4685-3.666-3.7727-3.673-2.2427-0.04024-5.0463-0.27229-5.9443 1.9172-0.28083 0.6692-0.27606 1.2179-0.28202 1.6587-0.08527 1.4303 0.20687 2.9224 1.662 3.6429-2.3051-0.05275-5.3273-0.39212-6.28 1.8983-0.28073 0.66862-0.27595 1.2174-0.282 1.6572-0.10329 1.6061 0.3059 3.171 2.0252 3.8067 1.2061 0.4187 2.2175 0.2869 3.3945 0.3134 2.0524 0.0901 4.0448-0.4637 4.4796-2.4982 0.609 2.5638 3.2086 2.5463 5.3204 2.4982 2.7823 0.1278 4.7024-0.9368 4.5798-3.7329zm-12.899-7.6287c-0.14889-1.8665 1.8839-1.4921 3.1358-1.546 0.8939 0.05358 2.4743-0.21158 2.8003 0.88445 0.2729 2.4494-0.0297 2.8555-2.5242 2.8232-0.94713-0.07259-2.869 0.28949-3.3134-0.77077-0.14881-0.44557-0.08538-0.92893-0.09846-1.3909zm0.2606 9.2128c-0.56638 0.162-1.1652 0.1412-1.7487 0.1488-0.59786-0.0036-1.1977 0.0131-1.7948-0.0233-0.93407-0.0365-1.6776-0.3579-1.6157-1.4217 0.01574-0.5119-0.06845-1.0551 0.11822-1.5436 0.4432-0.84155 1.5978-0.6728 2.4032-0.7191 0.81712 0.01614 1.6464-0.05154 2.4536 0.10154 0.99382 0.17537 1.0564 0.91742 1.0227 1.7752-6.1e-4 0.7729 0.04085 1.416-0.83867 1.6821zm2.9212-3.6286c-0.0836 0.19457-0.14194 0.3848-0.18279 0.56614-0.18535-0.87758-0.76293-1.6189-1.5605-2.02 1.0871 0.04933 2.0387 0.04959 3.1216-8e-5 -0.7672 0.39034-1.1687 0.96486-1.3783 1.4539zm6.8788 3.6286c-0.5664 0.162-1.1652 0.1412-1.7488 0.1488-0.5978-0.0036-1.1977 0.0131-1.7947-0.0233-0.9341-0.0365-1.6776-0.3579-1.6157-1.4217 0.0157-0.5119-0.0685-1.0551 0.1182-1.5436 0.4432-0.84155 1.5978-0.6728 2.4033-0.7191 0.8171 0.01614 1.6464-0.05154 2.4536 0.10154 0.9938 0.17537 1.0563 0.91742 1.0227 1.7752-6e-4 0.7729 0.0409 1.416-0.8386 1.6821z"></path></svg>
            <p name="id">训练代码</p>
          </span>
        </div>
      
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> __future__ <span class="token keyword">import</span> print_function<span class="token punctuation">,</span> division

<span class="token keyword">import</span> torch
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">as</span> nn
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>optim <span class="token keyword">as</span> optim
<span class="token keyword">from</span> torch<span class="token punctuation">.</span>optim <span class="token keyword">import</span> lr_scheduler
<span class="token keyword">from</span> torch<span class="token punctuation">.</span>autograd <span class="token keyword">import</span> Variable
<span class="token keyword">import</span> torchvision
<span class="token keyword">from</span> torchvision <span class="token keyword">import</span> datasets<span class="token punctuation">,</span> models<span class="token punctuation">,</span> transforms
<span class="token keyword">import</span> time
<span class="token keyword">import</span> os
<span class="token keyword">from</span> tensorboardX <span class="token keyword">import</span> SummaryWriter
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>functional <span class="token keyword">as</span> F
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

<span class="token keyword">import</span> warnings

<span class="token comment"># 定义一个简单的卷积神经网络</span>
<span class="token keyword">class</span> <span class="token class-name">simpleconv3</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>simpleconv3<span class="token punctuation">,</span>self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#调用父类的构造函数</span>
        self<span class="token punctuation">.</span>conv1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token comment">#定义第一个卷积层</span>
        self<span class="token punctuation">.</span>bn1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>BatchNorm2d<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token comment">#定义第一个批标准化层</span>
        self<span class="token punctuation">.</span>conv2 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token comment">#定义第二个卷积层</span>
        self<span class="token punctuation">.</span>bn2 <span class="token operator">=</span> nn<span class="token punctuation">.</span>BatchNorm2d<span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">)</span><span class="token comment">#定义第二个批标准化层</span>
        self<span class="token punctuation">.</span>conv3 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token comment">#定义第三个卷积层</span>
        self<span class="token punctuation">.</span>bn3 <span class="token operator">=</span> nn<span class="token punctuation">.</span>BatchNorm2d<span class="token punctuation">(</span><span class="token number">48</span><span class="token punctuation">)</span><span class="token comment">#定义第三个批标准化层</span>
        self<span class="token punctuation">.</span>fc1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">48</span> <span class="token operator">*</span> <span class="token number">5</span> <span class="token operator">*</span> <span class="token number">5</span> <span class="token punctuation">,</span> <span class="token number">1200</span><span class="token punctuation">)</span><span class="token comment">#定义第一个全连接层</span>
        self<span class="token punctuation">.</span>fc2 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">1200</span> <span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">)</span><span class="token comment">#定义第二个全连接层</span>
        self<span class="token punctuation">.</span>fc3 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">128</span> <span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token comment">#定义第三个全连接层</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self <span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment">#前向传播</span>
        x <span class="token operator">=</span> F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>bn1<span class="token punctuation">(</span>self<span class="token punctuation">.</span>conv1<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#卷积层-&gt;批标准化层-&gt;激活函数</span>
        <span class="token comment">#print "bn1 shape",x.shape</span>
        x <span class="token operator">=</span> F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>bn2<span class="token punctuation">(</span>self<span class="token punctuation">.</span>conv2<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#卷积层-&gt;批标准化层-&gt;激活函数</span>
        x <span class="token operator">=</span> F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>bn3<span class="token punctuation">(</span>self<span class="token punctuation">.</span>conv3<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        x <span class="token operator">=</span> x<span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">,</span> <span class="token number">48</span> <span class="token operator">*</span> <span class="token number">5</span> <span class="token operator">*</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token comment">#reshape操作</span>
        x <span class="token operator">=</span> F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>fc1<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#全连接层-&gt;激活函数</span>
        x <span class="token operator">=</span> F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>fc2<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
        x <span class="token operator">=</span> self<span class="token punctuation">.</span>fc3<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token comment">#全连接层</span>
        <span class="token keyword">return</span> x

warnings<span class="token punctuation">.</span>filterwarnings<span class="token punctuation">(</span><span class="token string">'ignore'</span><span class="token punctuation">)</span><span class="token comment">#忽略警告</span>

writer <span class="token operator">=</span> SummaryWriter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#创建一个SummaryWriter对象，用于记录训练过程中的损失和准确率</span>

<span class="token keyword">def</span> <span class="token function">train_model</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> criterion<span class="token punctuation">,</span> optimizer<span class="token punctuation">,</span> scheduler<span class="token punctuation">,</span> num_epochs<span class="token operator">=</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    功能：训练神经网络
    参数：  model，表示要训练的神经网络
            criterion，表示损失函数
            optimizer，表示优化器
            scheduler，表示学习率调度器
            num_epochs，表示训练的轮次
    返回值：model，表示训练好的神经网络
    '''</span>
    <span class="token keyword">for</span> epoch <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num_epochs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Epoch {}/{}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>epoch<span class="token punctuation">,</span> num_epochs <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># 打印训练次数</span>
        <span class="token keyword">for</span> phase <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'train'</span><span class="token punctuation">,</span> <span class="token string">'val'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token comment">#训练和验证</span>
            <span class="token keyword">if</span> phase <span class="token operator">==</span> <span class="token string">'train'</span><span class="token punctuation">:</span><span class="token comment">#训练阶段</span>
                scheduler<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#学习率调度器更新学习率</span>
                model<span class="token punctuation">.</span>train<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>  <span class="token comment"># Set model to training mode</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                model<span class="token punctuation">.</span>train<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>  <span class="token comment"># Set model to evaluate mode</span>

            running_loss <span class="token operator">=</span> <span class="token number">0.0</span><span class="token comment">#累计当前阶段的总损失，有助于计算平均损失</span>
            running_corrects <span class="token operator">=</span> <span class="token number">0.0</span><span class="token comment">#累计当前阶段的总准确率，有助于计算平均准确率</span>

            <span class="token keyword">for</span> data <span class="token keyword">in</span> dataloders<span class="token punctuation">[</span>phase<span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token comment">#遍历数据加载器</span>
                inputs<span class="token punctuation">,</span> labels <span class="token operator">=</span> data<span class="token comment">#获取输入数据和标签</span>
                <span class="token keyword">if</span> use_gpu<span class="token punctuation">:</span><span class="token comment">#使用GPU</span>
                    inputs <span class="token operator">=</span> Variable<span class="token punctuation">(</span>inputs<span class="token punctuation">.</span>cuda<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#将输入数据转换为Variable类型</span>
                    labels <span class="token operator">=</span> Variable<span class="token punctuation">(</span>labels<span class="token punctuation">.</span>cuda<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#将标签转换为Variable类型</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    inputs<span class="token punctuation">,</span> labels <span class="token operator">=</span> Variable<span class="token punctuation">(</span>inputs<span class="token punctuation">)</span><span class="token punctuation">,</span> Variable<span class="token punctuation">(</span>labels<span class="token punctuation">)</span>

                optimizer<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#进行一次前向传播之前，清零之前的梯度，以防止梯度累积</span>
                outputs <span class="token operator">=</span> model<span class="token punctuation">(</span>inputs<span class="token punctuation">)</span><span class="token comment">#将输入数据喂给模型，进行一次前向传播，得到模型的输出。</span>
                _<span class="token punctuation">,</span> preds <span class="token operator">=</span> torch<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span>outputs<span class="token punctuation">.</span>data<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token comment">#从模型输出中找到每个样本预测概率最高的类别作为预测结果。</span>
                loss <span class="token operator">=</span> criterion<span class="token punctuation">(</span>outputs<span class="token punctuation">,</span> labels<span class="token punctuation">)</span><span class="token comment">#计算模型输出和标签之间的损失</span>
                <span class="token keyword">if</span> phase <span class="token operator">==</span> <span class="token string">'train'</span><span class="token punctuation">:</span><span class="token comment">#训练阶段</span>
                    loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#进行一次反向传播，计算梯度</span>
                    optimizer<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#更新模型参数</span>

                running_loss <span class="token operator">+=</span> loss<span class="token punctuation">.</span>data<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#累计当前阶段的总损失</span>
                running_corrects <span class="token operator">+=</span> torch<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>preds <span class="token operator">==</span> labels<span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#累计当前阶段的总准确率</span>

            epoch_loss <span class="token operator">=</span> running_loss <span class="token operator">/</span> dataset_sizes<span class="token punctuation">[</span>phase<span class="token punctuation">]</span><span class="token comment">#计算平均损失</span>
            epoch_acc <span class="token operator">=</span> running_corrects <span class="token operator">/</span> dataset_sizes<span class="token punctuation">[</span>phase<span class="token punctuation">]</span><span class="token comment">#计算平均准确率</span>
           
            <span class="token keyword">if</span> phase <span class="token operator">==</span> <span class="token string">'train'</span><span class="token punctuation">:</span>
                writer<span class="token punctuation">.</span>add_scalar<span class="token punctuation">(</span><span class="token string">'data/trainloss'</span><span class="token punctuation">,</span> epoch_loss<span class="token punctuation">,</span> epoch<span class="token punctuation">)</span><span class="token comment">#记录训练阶段的平均损失</span>
                writer<span class="token punctuation">.</span>add_scalar<span class="token punctuation">(</span><span class="token string">'data/trainacc'</span><span class="token punctuation">,</span> epoch_acc<span class="token punctuation">,</span> epoch<span class="token punctuation">)</span><span class="token comment">#记录训练阶段的平均准确率</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                writer<span class="token punctuation">.</span>add_scalar<span class="token punctuation">(</span><span class="token string">'data/valloss'</span><span class="token punctuation">,</span> epoch_loss<span class="token punctuation">,</span> epoch<span class="token punctuation">)</span><span class="token comment">#记录验证阶段的平均损失</span>
                writer<span class="token punctuation">.</span>add_scalar<span class="token punctuation">(</span><span class="token string">'data/valacc'</span><span class="token punctuation">,</span> epoch_acc<span class="token punctuation">,</span> epoch<span class="token punctuation">)</span><span class="token comment">#记录验证阶段的平均准确率</span>

            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'{} Loss: {:.4f} Acc: {:.4f}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>
                phase<span class="token punctuation">,</span> epoch_loss<span class="token punctuation">,</span> epoch_acc<span class="token punctuation">)</span><span class="token punctuation">)</span>

    writer<span class="token punctuation">.</span>export_scalars_to_json<span class="token punctuation">(</span><span class="token string">"./all_scalars.json"</span><span class="token punctuation">)</span><span class="token comment">#将记录的数据保存为json文件</span>
    writer<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#关闭SummaryWriter对象</span>
    <span class="token keyword">return</span> model

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>

    data_transforms <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">'train'</span><span class="token punctuation">:</span> transforms<span class="token punctuation">.</span>Compose<span class="token punctuation">(</span><span class="token punctuation">[</span>
            transforms<span class="token punctuation">.</span>RandomResizedCrop<span class="token punctuation">(</span><span class="token number">48</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment"># 随机裁剪，调整为48*48像素大小，增强泛化</span>
            transforms<span class="token punctuation">.</span>RandomHorizontalFlip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment"># 随机水平翻转，增强泛化</span>
            transforms<span class="token punctuation">.</span>ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment"># 转换为张量</span>
            transforms<span class="token punctuation">.</span>Normalize<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment"># 标准化</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">'val'</span><span class="token punctuation">:</span> transforms<span class="token punctuation">.</span>Compose<span class="token punctuation">(</span><span class="token punctuation">[</span>
            transforms<span class="token punctuation">.</span>Resize<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment"># 调整为64*64像素大小</span>
            transforms<span class="token punctuation">.</span>CenterCrop<span class="token punctuation">(</span><span class="token number">48</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment"># 中心裁剪，调整为48*48像素大小</span>
            transforms<span class="token punctuation">.</span>ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment"># 转换为张量</span>
            transforms<span class="token punctuation">.</span>Normalize<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment"># 标准化</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>

    data_dir <span class="token operator">=</span> <span class="token string">'./Emotion_Recognition_File/train_val_data/'</span> <span class="token comment"># 数据集所在的位置</span>
    <span class="token comment">#创建图像数据集</span>
    image_datasets <span class="token operator">=</span> <span class="token punctuation">{</span>x<span class="token punctuation">:</span> datasets<span class="token punctuation">.</span>ImageFolder<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>data_dir<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">,</span>
                                              data_transforms<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'train'</span><span class="token punctuation">,</span> <span class="token string">'val'</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
    <span class="token comment">#创建数据加载器</span>
    dataloders <span class="token operator">=</span> <span class="token punctuation">{</span>x<span class="token punctuation">:</span> torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>data<span class="token punctuation">.</span>DataLoader<span class="token punctuation">(</span>image_datasets<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token comment"># 数据集</span>
                                                 batch_size<span class="token operator">=</span><span class="token number">64</span><span class="token punctuation">,</span><span class="token comment"># 每个批次加载64个样本</span>
                                                 shuffle<span class="token operator">=</span><span class="token boolean">True</span> <span class="token keyword">if</span> x<span class="token operator">==</span><span class="token string">"train"</span> <span class="token keyword">else</span> <span class="token boolean">False</span><span class="token punctuation">,</span><span class="token comment"># 训练集打乱，验证集不打乱</span>
                                                 num_workers<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'train'</span><span class="token punctuation">,</span> <span class="token string">'val'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token comment"># 使用8个子进程加载数据</span>

    dataset_sizes <span class="token operator">=</span> <span class="token punctuation">{</span>x<span class="token punctuation">:</span> <span class="token builtin">len</span><span class="token punctuation">(</span>image_datasets<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'train'</span><span class="token punctuation">,</span> <span class="token string">'val'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token comment"># 数据集大小</span>

    use_gpu <span class="token operator">=</span> torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>is_available<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># 是否使用GPU</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"是否使用 GPU"</span><span class="token punctuation">,</span> use_gpu<span class="token punctuation">)</span>
    modelclc <span class="token operator">=</span> simpleconv3<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># 创建模型</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>modelclc<span class="token punctuation">)</span>
    <span class="token keyword">if</span> use_gpu<span class="token punctuation">:</span>
        modelclc <span class="token operator">=</span> modelclc<span class="token punctuation">.</span>cuda<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># 使用GPU</span>

    <span class="token comment">#配置神经网络训练过程中的损失函数、优化器和学习率调度器的。</span>
    criterion <span class="token operator">=</span> nn<span class="token punctuation">.</span>CrossEntropyLoss<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#选择交叉熵损失函数</span>
    optimizer_ft <span class="token operator">=</span> optim<span class="token punctuation">.</span>SGD<span class="token punctuation">(</span>modelclc<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">,</span> momentum<span class="token operator">=</span><span class="token number">0.9</span><span class="token punctuation">)</span>
    <span class="token triple-quoted-string string">'''
    随机梯度下降（SGD）优化器，用于更新模型的权重。
    modelclc.parameters() 提供了模型中所有可训练的参数。
    lr=0.1 设置了学习率为 0.1，这是在训练过程中每次参数更新的步长。
    momentum=0.9 设置了动量为 0.9，这有助于加速优化器在相关方向上的速度，并减少震荡。
    '''</span>
    exp_lr_scheduler <span class="token operator">=</span> lr_scheduler<span class="token punctuation">.</span>StepLR<span class="token punctuation">(</span>optimizer_ft<span class="token punctuation">,</span> step_size<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> gamma<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">)</span>
    <span class="token triple-quoted-string string">'''
    这行代码定义了一个学习率调度器，它会在每过 step_size（这里是100个）训练轮次后，
    将学习率乘以 gamma（这里是0.1）。这意味着每100个训练轮次，学习率会减少到原来的10%。
    这种方法有助于模型在训练早期快速收敛，并在训练后期通过减小学习率来细化模型参数，以避免过拟合
    '''</span>
    modelclc <span class="token operator">=</span> train_model<span class="token punctuation">(</span>model<span class="token operator">=</span>modelclc<span class="token punctuation">,</span><span class="token comment"># 模型</span>
                           criterion<span class="token operator">=</span>criterion<span class="token punctuation">,</span><span class="token comment"># 损失函数</span>
                           optimizer<span class="token operator">=</span>optimizer_ft<span class="token punctuation">,</span><span class="token comment"># 优化器</span>
                           scheduler<span class="token operator">=</span>exp_lr_scheduler<span class="token punctuation">,</span><span class="token comment"># 学习率调度器</span>
                           num_epochs<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>  <span class="token comment"># 这里可以调节训练的轮次</span>
    <span class="token comment">#保存模型</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span><span class="token string">"models"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        os<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span><span class="token string">'models'</span><span class="token punctuation">)</span>

    torch<span class="token punctuation">.</span>save<span class="token punctuation">(</span>modelclc<span class="token punctuation">.</span>state_dict<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'models/model.ckpt'</span><span class="token punctuation">)</span><span class="token comment"># 保存模型参数</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="44-模型测试"><a class="markdownIt-Anchor" href="#44-模型测试"></a> 4.4 模型测试</h2>

        <div class="evoldown" id="测试代码" type="e">
          <span class="icon">
            <svg type="e" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path fill="currentColor" d="m21.9 15.621c0.1248-1.8535-0.6087-3.4099-2.6058-3.8292-0.7712-0.15744-1.3921-0.13977-2.1113-0.14543-0.6323 0.0048-1.1718-0.01567-1.8401 0.03203 1.5356-0.8078 1.6998-2.205 1.6567-3.546 0.1272-2.3708-1.4685-3.666-3.7727-3.673-2.2427-0.04024-5.0463-0.27229-5.9443 1.9172-0.28083 0.6692-0.27606 1.2179-0.28202 1.6587-0.08527 1.4303 0.20687 2.9224 1.662 3.6429-2.3051-0.05275-5.3273-0.39212-6.28 1.8983-0.28073 0.66862-0.27595 1.2174-0.282 1.6572-0.10329 1.6061 0.3059 3.171 2.0252 3.8067 1.2061 0.4187 2.2175 0.2869 3.3945 0.3134 2.0524 0.0901 4.0448-0.4637 4.4796-2.4982 0.609 2.5638 3.2086 2.5463 5.3204 2.4982 2.7823 0.1278 4.7024-0.9368 4.5798-3.7329zm-12.899-7.6287c-0.14889-1.8665 1.8839-1.4921 3.1358-1.546 0.8939 0.05358 2.4743-0.21158 2.8003 0.88445 0.2729 2.4494-0.0297 2.8555-2.5242 2.8232-0.94713-0.07259-2.869 0.28949-3.3134-0.77077-0.14881-0.44557-0.08538-0.92893-0.09846-1.3909zm0.2606 9.2128c-0.56638 0.162-1.1652 0.1412-1.7487 0.1488-0.59786-0.0036-1.1977 0.0131-1.7948-0.0233-0.93407-0.0365-1.6776-0.3579-1.6157-1.4217 0.01574-0.5119-0.06845-1.0551 0.11822-1.5436 0.4432-0.84155 1.5978-0.6728 2.4032-0.7191 0.81712 0.01614 1.6464-0.05154 2.4536 0.10154 0.99382 0.17537 1.0564 0.91742 1.0227 1.7752-6.1e-4 0.7729 0.04085 1.416-0.83867 1.6821zm2.9212-3.6286c-0.0836 0.19457-0.14194 0.3848-0.18279 0.56614-0.18535-0.87758-0.76293-1.6189-1.5605-2.02 1.0871 0.04933 2.0387 0.04959 3.1216-8e-5 -0.7672 0.39034-1.1687 0.96486-1.3783 1.4539zm6.8788 3.6286c-0.5664 0.162-1.1652 0.1412-1.7488 0.1488-0.5978-0.0036-1.1977 0.0131-1.7947-0.0233-0.9341-0.0365-1.6776-0.3579-1.6157-1.4217 0.0157-0.5119-0.0685-1.0551 0.1182-1.5436 0.4432-0.84155 1.5978-0.6728 2.4033-0.7191 0.8171 0.01614 1.6464-0.05154 2.4536 0.10154 0.9938 0.17537 1.0563 0.91742 1.0227 1.7752-6e-4 0.7729 0.0409 1.416-0.8386 1.6821z"></path></svg>
            <p name="id">测试代码</p>
          </span>
        </div>
      
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> sys
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> cv2
<span class="token keyword">import</span> os
<span class="token keyword">import</span> dlib

<span class="token keyword">import</span> torch
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">as</span> nn
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>optim <span class="token keyword">as</span> optim
<span class="token keyword">from</span> torch<span class="token punctuation">.</span>optim <span class="token keyword">import</span> lr_scheduler
<span class="token keyword">from</span> torch<span class="token punctuation">.</span>autograd <span class="token keyword">import</span> Variable
<span class="token keyword">import</span> torchvision
<span class="token keyword">from</span> torchvision <span class="token keyword">import</span> datasets<span class="token punctuation">,</span> models<span class="token punctuation">,</span> transforms
<span class="token keyword">import</span> time
<span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>functional <span class="token keyword">as</span> F

<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> warnings

warnings<span class="token punctuation">.</span>filterwarnings<span class="token punctuation">(</span><span class="token string">'ignore'</span><span class="token punctuation">)</span><span class="token comment">#忽略警告</span>
<span class="token keyword">class</span> <span class="token class-name">simpleconv3</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment">#定义一个简单的三层卷积神经网络</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>simpleconv3<span class="token punctuation">,</span>self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#复制并使用simpleconv3的父类的初始化方法，即先运行nn.Module的初始化函数</span>
        self<span class="token punctuation">.</span>conv1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token comment">#定义conv1函数的是图像卷积层：输入是3个feature，输出是6个feature，kernel是3*3，步长为2</span>
        self<span class="token punctuation">.</span>bn1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>BatchNorm2d<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv2 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>bn2 <span class="token operator">=</span> nn<span class="token punctuation">.</span>BatchNorm2d<span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv3 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>bn3 <span class="token operator">=</span> nn<span class="token punctuation">.</span>BatchNorm2d<span class="token punctuation">(</span><span class="token number">48</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>fc1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">48</span> <span class="token operator">*</span> <span class="token number">5</span> <span class="token operator">*</span> <span class="token number">5</span> <span class="token punctuation">,</span> <span class="token number">1200</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>fc2 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">1200</span> <span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>fc3 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">128</span> <span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self <span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        x <span class="token operator">=</span> F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>bn1<span class="token punctuation">(</span>self<span class="token punctuation">.</span>conv1<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment">#print "bn1 shape",x.shape</span>
        x <span class="token operator">=</span> F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>bn2<span class="token punctuation">(</span>self<span class="token punctuation">.</span>conv2<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        x <span class="token operator">=</span> F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>bn3<span class="token punctuation">(</span>self<span class="token punctuation">.</span>conv3<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        x <span class="token operator">=</span> x<span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">,</span> <span class="token number">48</span> <span class="token operator">*</span> <span class="token number">5</span> <span class="token operator">*</span> <span class="token number">5</span><span class="token punctuation">)</span> 
        x <span class="token operator">=</span> F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>fc1<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
        x <span class="token operator">=</span> F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>fc2<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
        x <span class="token operator">=</span> self<span class="token punctuation">.</span>fc3<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        <span class="token keyword">return</span> x

PREDICTOR_PATH <span class="token operator">=</span> <span class="token string">"./Emotion_Recognition_File/face_detect_model/shape_predictor_68_face_landmarks.dat"</span>
predictor <span class="token operator">=</span> dlib<span class="token punctuation">.</span>shape_predictor<span class="token punctuation">(</span>PREDICTOR_PATH<span class="token punctuation">)</span><span class="token comment">#加载人脸关键点检测模型</span>
cascade_path <span class="token operator">=</span> <span class="token string">'./Emotion_Recognition_File/face_detect_model/haarcascade_frontalface_default.xml'</span>
cascade <span class="token operator">=</span> cv2<span class="token punctuation">.</span>CascadeClassifier<span class="token punctuation">(</span>cascade_path<span class="token punctuation">)</span><span class="token comment">#加载人脸检测器</span>

<span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span><span class="token string">"results"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    os<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span><span class="token string">"results"</span><span class="token punctuation">)</span>
    

<span class="token keyword">def</span> <span class="token function">standardization</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    功能：标准化数据
    参数：data：数据
    返回：标准化后的数据
    '''</span>
    mu <span class="token operator">=</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>data<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">#计算每一列的均值，axis=0表示列，axis=1表示行</span>
    sigma <span class="token operator">=</span> np<span class="token punctuation">.</span>std<span class="token punctuation">(</span>data<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">#计算每一列的标准差，axis表示方向</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>data <span class="token operator">-</span> mu<span class="token punctuation">)</span> <span class="token operator">/</span> sigma
    <span class="token triple-quoted-string string">'''
    数据按列减去其平均值后，再除以其标准差。
    这一步是标准化的核心，目的是让处理后的数据每一列的平均值为0，标准差为1。
    这样处理后的数据符合标准正态分布，有利于后续的数据处理和分析。
    '''</span>


<span class="token keyword">def</span> <span class="token function">get_landmarks</span><span class="token punctuation">(</span>im<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    功能：获取人脸关键点
    参数：im：图像
    返回：人脸关键点
    '''</span>
    rects <span class="token operator">=</span> cascade<span class="token punctuation">.</span>detectMultiScale<span class="token punctuation">(</span>im<span class="token punctuation">,</span> <span class="token number">1.3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token comment">#检测人脸</span>
    x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> w<span class="token punctuation">,</span> h <span class="token operator">=</span> rects<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token comment">#获取人脸区域</span>
    rect <span class="token operator">=</span> dlib<span class="token punctuation">.</span>rectangle<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>x <span class="token operator">+</span> w<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>y <span class="token operator">+</span> h<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#转换为dlib格式的人脸区域</span>
    <span class="token keyword">return</span> np<span class="token punctuation">.</span>matrix<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span>p<span class="token punctuation">.</span>x<span class="token punctuation">,</span> p<span class="token punctuation">.</span>y<span class="token punctuation">]</span> <span class="token keyword">for</span> p <span class="token keyword">in</span> predictor<span class="token punctuation">(</span>im<span class="token punctuation">,</span> rect<span class="token punctuation">)</span><span class="token punctuation">.</span>parts<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment">#获取人脸关键点</span>


<span class="token keyword">def</span> <span class="token function">annotate_landmarks</span><span class="token punctuation">(</span>im<span class="token punctuation">,</span> landmarks<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    功能：标注人脸关键点
    参数：im：图像
          landmarks：人脸关键点
    返回：标注后的图像
    '''</span>
    im <span class="token operator">=</span> im<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> idx<span class="token punctuation">,</span> point <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>landmarks<span class="token punctuation">)</span><span class="token punctuation">:</span>
        pos <span class="token operator">=</span> <span class="token punctuation">(</span>point<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> point<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        cv2<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>im<span class="token punctuation">,</span>
                    <span class="token builtin">str</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    pos<span class="token punctuation">,</span>
                    fontFace<span class="token operator">=</span>cv2<span class="token punctuation">.</span>FONT_HERSHEY_SCRIPT_SIMPLEX<span class="token punctuation">,</span>
                    fontScale<span class="token operator">=</span><span class="token number">0.4</span><span class="token punctuation">,</span>
                    color<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        cv2<span class="token punctuation">.</span>circle<span class="token punctuation">(</span>im<span class="token punctuation">,</span> pos<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> im


testsize <span class="token operator">=</span> <span class="token number">48</span>  <span class="token comment"># 测试图大小</span>

data_transforms <span class="token operator">=</span> transforms<span class="token punctuation">.</span>Compose<span class="token punctuation">(</span><span class="token punctuation">[</span>
    transforms<span class="token punctuation">.</span>ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    transforms<span class="token punctuation">.</span>Normalize<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
net <span class="token operator">=</span> simpleconv3<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#创建模型实例</span>
net<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#评估模式</span>
modelpath <span class="token operator">=</span> <span class="token string">"./models/model.ckpt"</span>  <span class="token comment"># 模型路径</span>
net<span class="token punctuation">.</span>load_state_dict<span class="token punctuation">(</span><span class="token comment">#加载模型保存的模型权重</span>
    torch<span class="token punctuation">.</span>load<span class="token punctuation">(</span>modelpath<span class="token punctuation">,</span> map_location<span class="token operator">=</span><span class="token keyword">lambda</span> storage<span class="token punctuation">,</span> loc<span class="token punctuation">:</span> storage<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">'''
    map_location参数用于指定加载模型的设备位置。
    这里使用了一个lambda函数lambda storage, loc: storage，
    这意味着无论模型权重文件是在哪个设备上保存的（例如GPU或CPU），
    都将其加载到当前设备上。这对于跨设备加载模型非常有用，特别是当原始训练环境与当前环境不同时。
    lambda语法：lambda 参数:表达式
    '''</span>

<span class="token comment"># 一次测试一个文件</span>
img_path <span class="token operator">=</span> <span class="token string">"./Emotion_Recognition_File/test_img/"</span>
imagepaths <span class="token operator">=</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>img_path<span class="token punctuation">)</span>  <span class="token comment"># 图像文件夹</span>
<span class="token keyword">for</span> imagepath <span class="token keyword">in</span> imagepaths<span class="token punctuation">:</span>
    im <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>img_path<span class="token punctuation">,</span> imagepath<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        rects <span class="token operator">=</span> cascade<span class="token punctuation">.</span>detectMultiScale<span class="token punctuation">(</span>im<span class="token punctuation">,</span> <span class="token number">1.3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token comment">#检测人脸</span>
        x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> w<span class="token punctuation">,</span> h <span class="token operator">=</span> rects<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        rect <span class="token operator">=</span> dlib<span class="token punctuation">.</span>rectangle<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>x <span class="token operator">+</span> w<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>y <span class="token operator">+</span> h<span class="token punctuation">)</span><span class="token punctuation">)</span>
        landmarks <span class="token operator">=</span> np<span class="token punctuation">.</span>matrix<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span>p<span class="token punctuation">.</span>x<span class="token punctuation">,</span> p<span class="token punctuation">.</span>y<span class="token punctuation">]</span>
                               <span class="token keyword">for</span> p <span class="token keyword">in</span> predictor<span class="token punctuation">(</span>im<span class="token punctuation">,</span> rect<span class="token punctuation">)</span><span class="token punctuation">.</span>parts<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span><span class="token punctuation">:</span>
<span class="token comment">#         print("没有检测到人脸")</span>
        <span class="token keyword">continue</span>  <span class="token comment"># 没有检测到人脸</span>

    xmin <span class="token operator">=</span> <span class="token number">10000</span>
    xmax <span class="token operator">=</span> <span class="token number">0</span>
    ymin <span class="token operator">=</span> <span class="token number">10000</span>
    ymax <span class="token operator">=</span> <span class="token number">0</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">67</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        x <span class="token operator">=</span> landmarks<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span>
        y <span class="token operator">=</span> landmarks<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>
        <span class="token keyword">if</span> x <span class="token operator">&lt;</span> xmin<span class="token punctuation">:</span>
            xmin <span class="token operator">=</span> x
        <span class="token keyword">if</span> x <span class="token operator">&gt;</span> xmax<span class="token punctuation">:</span>
            xmax <span class="token operator">=</span> x
        <span class="token keyword">if</span> y <span class="token operator">&lt;</span> ymin<span class="token punctuation">:</span>
            ymin <span class="token operator">=</span> y
        <span class="token keyword">if</span> y <span class="token operator">&gt;</span> ymax<span class="token punctuation">:</span>
            ymax <span class="token operator">=</span> y

    roiwidth <span class="token operator">=</span> xmax <span class="token operator">-</span> xmin
    roiheight <span class="token operator">=</span> ymax <span class="token operator">-</span> ymin

    roi <span class="token operator">=</span> im<span class="token punctuation">[</span>ymin<span class="token punctuation">:</span>ymax<span class="token punctuation">,</span> xmin<span class="token punctuation">:</span>xmax<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span>

    <span class="token keyword">if</span> roiwidth <span class="token operator">&gt;</span> roiheight<span class="token punctuation">:</span>
        dstlen <span class="token operator">=</span> <span class="token number">1.5</span> <span class="token operator">*</span> roiwidth
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        dstlen <span class="token operator">=</span> <span class="token number">1.5</span> <span class="token operator">*</span> roiheight

    diff_xlen <span class="token operator">=</span> dstlen <span class="token operator">-</span> roiwidth
    diff_ylen <span class="token operator">=</span> dstlen <span class="token operator">-</span> roiheight

    newx <span class="token operator">=</span> xmin
    newy <span class="token operator">=</span> ymin

    imagerows<span class="token punctuation">,</span> imagecols<span class="token punctuation">,</span> channel <span class="token operator">=</span> im<span class="token punctuation">.</span>shape
    <span class="token keyword">if</span> newx <span class="token operator">&gt;=</span> diff_xlen <span class="token operator">/</span> <span class="token number">2</span> <span class="token keyword">and</span> newx <span class="token operator">+</span> roiwidth <span class="token operator">+</span> diff_xlen <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">&lt;</span> imagecols<span class="token punctuation">:</span>
        newx <span class="token operator">=</span> newx <span class="token operator">-</span> diff_xlen <span class="token operator">/</span> <span class="token number">2</span>
    <span class="token keyword">elif</span> newx <span class="token operator">&lt;</span> diff_xlen <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">:</span>
        newx <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        newx <span class="token operator">=</span> imagecols <span class="token operator">-</span> dstlen

    <span class="token keyword">if</span> newy <span class="token operator">&gt;=</span> diff_ylen <span class="token operator">/</span> <span class="token number">2</span> <span class="token keyword">and</span> newy <span class="token operator">+</span> roiheight <span class="token operator">+</span> diff_ylen <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">&lt;</span> imagerows<span class="token punctuation">:</span>
        newy <span class="token operator">=</span> newy <span class="token operator">-</span> diff_ylen <span class="token operator">/</span> <span class="token number">2</span>
    <span class="token keyword">elif</span> newy <span class="token operator">&lt;</span> diff_ylen <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">:</span>
        newy <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        newy <span class="token operator">=</span> imagecols <span class="token operator">-</span> dstlen

    roi <span class="token operator">=</span> im<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>newy<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token builtin">int</span><span class="token punctuation">(</span>newy <span class="token operator">+</span> dstlen<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>newx<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token builtin">int</span><span class="token punctuation">(</span>newx <span class="token operator">+</span> dstlen<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token comment">#裁剪图像</span>
    roi <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>roi<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2RGB<span class="token punctuation">)</span><span class="token comment">#转换颜色空间将BGR转为RGB</span>
    roiresized <span class="token operator">=</span> cv2<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>roi<span class="token punctuation">,</span><span class="token comment">#调整图像大小</span>
                            <span class="token punctuation">(</span>testsize<span class="token punctuation">,</span> testsize<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span>np<span class="token punctuation">.</span>float32<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">255.0</span>
    imgblob <span class="token operator">=</span> data_transforms<span class="token punctuation">(</span>roiresized<span class="token punctuation">)</span><span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">#转换数据格式</span>
    imgblob<span class="token punctuation">.</span>requires_grad <span class="token operator">=</span> <span class="token boolean">False</span><span class="token comment">#不需要梯度，因为是验证阶段而不是训练阶段</span>
    imgblob <span class="token operator">=</span> Variable<span class="token punctuation">(</span>imgblob<span class="token punctuation">)</span><span class="token comment">#转换数据格式</span>
    torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#通过上下文管理器禁用梯度计算</span>
    predict <span class="token operator">=</span> F<span class="token punctuation">.</span>softmax<span class="token punctuation">(</span>net<span class="token punctuation">(</span>imgblob<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#net(imgblob)是模型的输出，F.softmax()是softmax函数，用于多分类问题</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>predict<span class="token punctuation">)</span>
    index <span class="token operator">=</span> np<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>predict<span class="token punctuation">.</span>detach<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#获取预测结果，np.argmax()返回概率最大的类别</span>

    im_show <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>img_path<span class="token punctuation">,</span> imagepath<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    im_h<span class="token punctuation">,</span> im_w<span class="token punctuation">,</span> im_c <span class="token operator">=</span> im_show<span class="token punctuation">.</span>shape<span class="token comment">#获取图像的高、宽、通道数</span>
    pos_x <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>newx <span class="token operator">+</span> dstlen<span class="token punctuation">)</span>
    pos_y <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>newy <span class="token operator">+</span> dstlen<span class="token punctuation">)</span>
    font <span class="token operator">=</span> cv2<span class="token punctuation">.</span>FONT_HERSHEY_SIMPLEX<span class="token comment">#设置字体样式</span>
    cv2<span class="token punctuation">.</span>rectangle<span class="token punctuation">(</span>im_show<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>newx<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>newy<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">#画矩形框</span>
                  <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>newx <span class="token operator">+</span> dstlen<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>newy <span class="token operator">+</span> dstlen<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> index <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        cv2<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>im_show<span class="token punctuation">,</span> <span class="token string">'none'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>pos_x<span class="token punctuation">,</span> pos_y<span class="token punctuation">)</span><span class="token punctuation">,</span> font<span class="token punctuation">,</span> <span class="token number">1.5</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> index <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
        cv2<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>im_show<span class="token punctuation">,</span> <span class="token string">'pout'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>pos_x<span class="token punctuation">,</span> pos_y<span class="token punctuation">)</span><span class="token punctuation">,</span> font<span class="token punctuation">,</span> <span class="token number">1.5</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> index <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">:</span>
        cv2<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>im_show<span class="token punctuation">,</span> <span class="token string">'smile'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>pos_x<span class="token punctuation">,</span> pos_y<span class="token punctuation">)</span><span class="token punctuation">,</span> font<span class="token punctuation">,</span> <span class="token number">1.5</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> index <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">:</span>
        cv2<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>im_show<span class="token punctuation">,</span> <span class="token string">'open'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>pos_x<span class="token punctuation">,</span> pos_y<span class="token punctuation">)</span><span class="token punctuation">,</span> font<span class="token punctuation">,</span> <span class="token number">1.5</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token comment">#     cv2.namedWindow('result', 0)</span>
<span class="token comment">#     cv2.imshow('result', im_show)</span>
    cv2<span class="token punctuation">.</span>imwrite<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string">'results'</span><span class="token punctuation">,</span> imagepath<span class="token punctuation">)</span><span class="token punctuation">,</span> im_show<span class="token punctuation">)</span>
<span class="token comment">#     print(os.path.join('results', imagepath))</span>
    plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>im_show<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># 这里需要交换通道，因为 matplotlib 保存图片的通道顺序是 RGB，而在 OpenCV 中是 BGR</span>
    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#     cv2.waitKey(0)</span>
<span class="token comment"># cv2.destroyAllWindows()</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="5-相关概念"><a class="markdownIt-Anchor" href="#5-相关概念"></a> 5 相关概念</h1>

        <div class="evoldown" id="级联选择器" type="d">
          <span class="icon">
            <svg type="d" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m21.15 6.85c0-2.2056-1.7944-4-4-4-4.1765-0.01989-5.4993 5.7322-1.8147 7.5629-0.263 0.63631-0.4627 1.4421-0.6559 2.2215-0.1397 0.56337-0.2841 1.1459-0.4405 1.6084-0.0728 0.2155-0.1286 0.4813-0.1891 0.4813-0.5072-0.7362-0.8126-2.2507-1.0979-3.3161-0.47879-1.5358-0.72936-4.4237-2.8018-4.558-0.77422 7e-5 -1.3844 0.52253-1.8138 1.553-0.55019 1.254-0.75064 3.2421-1.3784 4.4472-0.39648 3e-4 -0.79576 0.0045-1.1877 0.0703-0.67978 0.1073-1.3339 0.4195-1.798 0.9347-0.39707 0.4315-0.6427 0.9874-0.74275 1.5623-0.063545 0.351-0.07691 0.7094-0.07883 1.0654 0.001935 0.4718-0.01324 0.9457 0.027745 1.4163 0.09435 1.151 0.65732 2.1308 1.7281 2.6237 0.43467 0.1975 0.91053 0.2877 1.3854 0.3129 0.40096 0.0215 0.80345 0.0129 1.2048 0.0139 0.6491 2e-4 1.2891-0.0515 1.888-0.3229 0.90042-0.4067 1.4845-1.2039 1.6712-2.1666 0.0761-0.3779 0.09179-0.7654 0.09344-1.15 7.7e-4 -0.2699 0.00148-0.5413-7.8e-4 -0.8111-0.00379-0.4854-0.04143-0.9771-0.19121-1.4414-0.28748-0.9172-0.98053-1.616-1.8964-1.909 0.43984-1.1576 0.66815-2.7594 1.1268-3.8895 0.3537 0.72804 0.57113 1.7669 0.82283 2.7298 0.26567 1.0724 0.5404 2.1814 0.90896 3.0557 0.87204 2.2985 3.1124 2.7586 4.0452 0.392 0.5508-1.2642 0.7508-3.279 1.3828-4.4916 2.1142-0.10339 3.8024-1.8557 3.8024-3.995zm-12.073 8.8023c0.05605 0.2275 0.06623 0.465 0.07092 0.6983 0.00363 0.2444 0.00195 0.4906 0.00214 0.735-0.0063 0.408 0.01486 0.882-0.18359 1.2496-0.24573 0.4539-0.8026 0.501-1.2651 0.5114-0.33714 0.0058-0.67525 0.0041-1.0124 0.0018-0.46455-0.0092-1.0361-0.0245-1.3192-0.4545-0.16612-0.2552-0.19733-0.5702-0.21202-0.8673-0.01004-0.2443-0.00683-0.4906-0.0075-0.735 5.9e-4 -0.2322-0.00201-0.4664 0.01171-0.6983 0.01886-0.2936 0.06332-0.6069 0.24969-0.8453 0.34185-0.4331 1.0226-0.3889 1.5228-0.3979 0.38828 0.0035 0.77905-0.0131 1.1658 0.0285 0.49865 0.0566 0.85211 0.2621 0.97684 0.7737zm8.0732-6.8023c-2.6379-0.06696-2.6373-3.9334 0-4 2.6378 0.06697 2.6373 3.9334 0 4z" fill="currentColor"></path></svg>
            <p name="id">级联选择器</p>
          </span>
        </div>
      
<p>级联分类器（Cascade Classifier）是一种基于机器学习的对象检测技术，它能够在图像中快速识别出目标对象（如人脸、行人等）。这个概念主要用于解决对象检测问题，特别是在实时应用中，如视频监控、人脸识别等场景。</p>
<p>解决的问题：</p>
<ol>
<li><strong>速度与准确性的平衡</strong>：级联分类器通过一系列的简单到复杂的分类阶段（称为“级联”）来检测对象，每个阶段使用不同的特征集。这种方法可以快速排除背景区域，仅在可能包含目标对象的区域使用更复杂的特征，从而实现高效率和较高准确性的平衡。</li>
<li><strong>实时检测</strong>：由于其高效性，级联分类器特别适合于需要实时处理的应用，如实时视频分析。</li>
</ol>
<p>没有这个概念的影响：</p>
<ol>
<li><strong>检测速度下降</strong>：没有级联分类器，我们可能需要在整个图像上运行复杂的检测算法，这会大大增加计算量，降低检测速度，尤其是在处理高分辨率视频或实时应用时。</li>
<li><strong>准确性和效率的挑战</strong>：缺乏有效的筛选机制可能导致算法在背景区域浪费大量计算资源，同时也可能降低检测的准确性，因为算法需要在更广泛的区域中寻找目标对象。</li>
<li><strong>实时应用受限</strong>：在没有高效检测算法的情况下，很多需要实时反馈的应用（如动态人脸识别系统、实时监控系统）可能难以实现或者性能大打折扣。</li>
</ol>

        <div class="evoldown" id="视频流中识别人脸" type="e">
          <span class="icon">
            <svg type="e" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path fill="currentColor" d="m21.9 15.621c0.1248-1.8535-0.6087-3.4099-2.6058-3.8292-0.7712-0.15744-1.3921-0.13977-2.1113-0.14543-0.6323 0.0048-1.1718-0.01567-1.8401 0.03203 1.5356-0.8078 1.6998-2.205 1.6567-3.546 0.1272-2.3708-1.4685-3.666-3.7727-3.673-2.2427-0.04024-5.0463-0.27229-5.9443 1.9172-0.28083 0.6692-0.27606 1.2179-0.28202 1.6587-0.08527 1.4303 0.20687 2.9224 1.662 3.6429-2.3051-0.05275-5.3273-0.39212-6.28 1.8983-0.28073 0.66862-0.27595 1.2174-0.282 1.6572-0.10329 1.6061 0.3059 3.171 2.0252 3.8067 1.2061 0.4187 2.2175 0.2869 3.3945 0.3134 2.0524 0.0901 4.0448-0.4637 4.4796-2.4982 0.609 2.5638 3.2086 2.5463 5.3204 2.4982 2.7823 0.1278 4.7024-0.9368 4.5798-3.7329zm-12.899-7.6287c-0.14889-1.8665 1.8839-1.4921 3.1358-1.546 0.8939 0.05358 2.4743-0.21158 2.8003 0.88445 0.2729 2.4494-0.0297 2.8555-2.5242 2.8232-0.94713-0.07259-2.869 0.28949-3.3134-0.77077-0.14881-0.44557-0.08538-0.92893-0.09846-1.3909zm0.2606 9.2128c-0.56638 0.162-1.1652 0.1412-1.7487 0.1488-0.59786-0.0036-1.1977 0.0131-1.7948-0.0233-0.93407-0.0365-1.6776-0.3579-1.6157-1.4217 0.01574-0.5119-0.06845-1.0551 0.11822-1.5436 0.4432-0.84155 1.5978-0.6728 2.4032-0.7191 0.81712 0.01614 1.6464-0.05154 2.4536 0.10154 0.99382 0.17537 1.0564 0.91742 1.0227 1.7752-6.1e-4 0.7729 0.04085 1.416-0.83867 1.6821zm2.9212-3.6286c-0.0836 0.19457-0.14194 0.3848-0.18279 0.56614-0.18535-0.87758-0.76293-1.6189-1.5605-2.02 1.0871 0.04933 2.0387 0.04959 3.1216-8e-5 -0.7672 0.39034-1.1687 0.96486-1.3783 1.4539zm6.8788 3.6286c-0.5664 0.162-1.1652 0.1412-1.7488 0.1488-0.5978-0.0036-1.1977 0.0131-1.7947-0.0233-0.9341-0.0365-1.6776-0.3579-1.6157-1.4217 0.0157-0.5119-0.0685-1.0551 0.1182-1.5436 0.4432-0.84155 1.5978-0.6728 2.4033-0.7191 0.8171 0.01614 1.6464-0.05154 2.4536 0.10154 0.9938 0.17537 1.0563 0.91742 1.0227 1.7752-6e-4 0.7729 0.0409 1.416-0.8386 1.6821z"></path></svg>
            <p name="id">视频流中识别人脸</p>
          </span>
          <span class="link-icon ml-[0.5em] mr-[0.25em]">
            <svg xmlns="http://www.w3.org/2000/svg" width="0.9411764705882353em" height="0.9411764705882353em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class="untouchable"><path d="m9.5652 14.45 0.72891-2.0026c-0.651 0.00713-1.3027 0.00104-1.9532 0.00179-1.0991-0.02908-3.0336 0.08306-3.605-1.0524-0.28828-0.61588-0.2054-1.3226-0.22136-1.9833 0.00663-0.74044-0.05553-1.6362 0.5758-2.1558 0.70637-0.5555 1.7411-0.56129 2.6027-0.59834 0.743-0.015 1.4884-0.00764 2.2315-0.00868 0.68471 0.01536 1.6274-0.01783 2.4184 0.16762l0.68711-1.8879c-0.0146-0.003965-0.0287-0.00841-0.0435-0.01227-0.94653-0.24905-1.9355-0.25901-2.9083-0.26688-0.78352-1.3008e-4 -1.5692-0.0063751-2.3527 0.006805-1.2709 0.027555-2.6299 0.13739-3.6978 0.89566-1.6654 1.2031-1.53 2.9573-1.5068 4.79-0.0012251 1.7732 0.89765 3.2159 2.626 3.7562 0.80589 0.26191 1.6615 0.32018 2.5036 0.34101 0.6376 0.01106 1.2763 0.01096 1.9146 0.00915z" fill="currentColor"></path><path d="m14.589 9.125h1.3099c0.02865-0.88714-0.11774-1.6826-0.45594-2.3461l-0.85392 2.3461z" fill="currentColor"></path><path d="m15.587 12.025h-2.0527l-0.80604 2.2146c1.2326-0.27362 2.3169-0.88582 2.8588-2.2146z" fill="currentColor"></path><path d="m8.394 12.025h2.0538l0.82406-2.2641c-1.2457 0.2734-2.3327 0.8901-2.8779 2.2641z" fill="currentColor"></path><path d="m8.5566 17.221 0.83571-2.2961h-1.2914c-0.025394 0.86685 0.12295 1.645 0.45565 2.2961z" fill="currentColor"></path><path d="m21.485 14.399c7e-4 -0.67593 0.0063-1.3662-0.1779-2.0223-0.58881-2.115-2.5706-2.7532-4.5608-2.8041-0.76964-0.031175-1.5416-0.02264-2.3121-0.022365l-0.72832 2.0011c0.38557-0.00297 0.77131 7.6e-4 1.1559-0.00173 1.1244 0.02284 2.8396-0.10221 3.8152 0.44616 0.82512 0.45526 0.81194 1.4036 0.80798 2.2308-0.01538 0.64171 0.05949 1.3145-0.1601 1.93-0.39418 1.0145-1.651 1.1102-2.5915 1.1694-0.7426 0.03331-1.4884 0.0209-2.2315 0.02365-0.81334-0.01641-1.9395 0.04306-2.8448-0.16914l-0.68792 1.89c0.014845 0.00401 0.02915 0.0085 0.044115 0.0124 0.94522 0.24688 1.9316 0.25913 2.9027 0.2657 0.83456-2.2e-4 1.6713 0.00786 2.5057-0.00999 2.0286-0.02122 4.1491-0.51576 4.8438-2.6752 0.2358-0.7292 0.22-1.5067 0.2196-2.2644z" fill="currentColor"></path><path d="m14.979 6.7378c0.17824-0.52033 0.90905-2.4486 1.0626-2.9514 0.05601-0.19527 0.10768-0.39984 0.08232-0.60408-0.03096-0.33264-0.36035-0.4603-0.63671-0.55464-0.20794-0.070665-0.41593-0.17228-0.63943-0.174-0.33751 0.005805-0.52152 0.33878-0.64452 0.61072-1.4256 3.8005-4.7612 13.07-6.1617 16.891-0.10636 0.34-0.29285 0.7891-0.06874 1.1109 0.1296 0.1673 0.34386 0.232 0.53431 0.3042 0.30778 0.1107 0.70325 0.3075 0.98251 0.0365 0.14514-0.1339 0.23561-0.315 0.31595-0.4926 0.10005-0.2274 0.1811-0.4632 0.26694-0.6962 0.4854-1.3337 4.3257-11.885 4.9065-13.481z" fill="currentColor"></path></svg>
          </span>
          
          <span class="icon">
            <svg type="d" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m21.15 6.85c0-2.2056-1.7944-4-4-4-4.1765-0.01989-5.4993 5.7322-1.8147 7.5629-0.263 0.63631-0.4627 1.4421-0.6559 2.2215-0.1397 0.56337-0.2841 1.1459-0.4405 1.6084-0.0728 0.2155-0.1286 0.4813-0.1891 0.4813-0.5072-0.7362-0.8126-2.2507-1.0979-3.3161-0.47879-1.5358-0.72936-4.4237-2.8018-4.558-0.77422 7e-5 -1.3844 0.52253-1.8138 1.553-0.55019 1.254-0.75064 3.2421-1.3784 4.4472-0.39648 3e-4 -0.79576 0.0045-1.1877 0.0703-0.67978 0.1073-1.3339 0.4195-1.798 0.9347-0.39707 0.4315-0.6427 0.9874-0.74275 1.5623-0.063545 0.351-0.07691 0.7094-0.07883 1.0654 0.001935 0.4718-0.01324 0.9457 0.027745 1.4163 0.09435 1.151 0.65732 2.1308 1.7281 2.6237 0.43467 0.1975 0.91053 0.2877 1.3854 0.3129 0.40096 0.0215 0.80345 0.0129 1.2048 0.0139 0.6491 2e-4 1.2891-0.0515 1.888-0.3229 0.90042-0.4067 1.4845-1.2039 1.6712-2.1666 0.0761-0.3779 0.09179-0.7654 0.09344-1.15 7.7e-4 -0.2699 0.00148-0.5413-7.8e-4 -0.8111-0.00379-0.4854-0.04143-0.9771-0.19121-1.4414-0.28748-0.9172-0.98053-1.616-1.8964-1.909 0.43984-1.1576 0.66815-2.7594 1.1268-3.8895 0.3537 0.72804 0.57113 1.7669 0.82283 2.7298 0.26567 1.0724 0.5404 2.1814 0.90896 3.0557 0.87204 2.2985 3.1124 2.7586 4.0452 0.392 0.5508-1.2642 0.7508-3.279 1.3828-4.4916 2.1142-0.10339 3.8024-1.8557 3.8024-3.995zm-12.073 8.8023c0.05605 0.2275 0.06623 0.465 0.07092 0.6983 0.00363 0.2444 0.00195 0.4906 0.00214 0.735-0.0063 0.408 0.01486 0.882-0.18359 1.2496-0.24573 0.4539-0.8026 0.501-1.2651 0.5114-0.33714 0.0058-0.67525 0.0041-1.0124 0.0018-0.46455-0.0092-1.0361-0.0245-1.3192-0.4545-0.16612-0.2552-0.19733-0.5702-0.21202-0.8673-0.01004-0.2443-0.00683-0.4906-0.0075-0.735 5.9e-4 -0.2322-0.00201-0.4664 0.01171-0.6983 0.01886-0.2936 0.06332-0.6069 0.24969-0.8453 0.34185-0.4331 1.0226-0.3889 1.5228-0.3979 0.38828 0.0035 0.77905-0.0131 1.1658 0.0285 0.49865 0.0566 0.85211 0.2621 0.97684 0.7737zm8.0732-6.8023c-2.6379-0.06696-2.6373-3.9334 0-4 2.6378 0.06697 2.6373 3.9334 0 4z" fill="currentColor"></path></svg>
            <p name="id">级联选择器</p>
          </span>
        </div>
      
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> cv2
<span class="token comment"># 加载预训练的Haar级联分类器</span>
cascade_path <span class="token operator">=</span> <span class="token string">'./haarcascade_frontalface_default.xml'</span>
face_cascade <span class="token operator">=</span> cv2<span class="token punctuation">.</span>CascadeClassifier<span class="token punctuation">(</span>cascade_path<span class="token punctuation">)</span><span class="token comment">#级联选择器</span>

<span class="token comment"># 打开摄像头</span>
cap <span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoCapture<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    <span class="token comment"># 读取一帧图像</span>
    ret<span class="token punctuation">,</span> frame <span class="token operator">=</span> cap<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> ret<span class="token punctuation">:</span>
        <span class="token keyword">break</span>
    <span class="token comment"># 将图像转换为灰度图，因为Haar分类器需要灰度图</span>
    gray <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2GRAY<span class="token punctuation">)</span>
    <span class="token comment"># 使用级联分类器检测图像中的人脸</span>
    faces <span class="token operator">=</span> face_cascade<span class="token punctuation">.</span>detectMultiScale<span class="token punctuation">(</span>gray<span class="token punctuation">,</span> scaleFactor<span class="token operator">=</span><span class="token number">1.1</span><span class="token punctuation">,</span> minNeighbors<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> minSize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># 为每个检测到的人脸画一个矩形框</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> w<span class="token punctuation">,</span> h<span class="token punctuation">)</span> <span class="token keyword">in</span> faces<span class="token punctuation">:</span>
        cv2<span class="token punctuation">.</span>rectangle<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token operator">+</span>w<span class="token punctuation">,</span> y<span class="token operator">+</span>h<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token comment"># 显示结果图像</span>
    cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'Face Detection'</span><span class="token punctuation">,</span> frame<span class="token punctuation">)</span>
    <span class="token comment"># 按'q'退出循环</span>
    <span class="token keyword">if</span> cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span> <span class="token operator">==</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'q'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span>
<span class="token comment"># 释放摄像头并关闭窗口</span>
cap<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

        <div class="evoldown" id="公园里找朋友" type="e">
          <span class="icon">
            <svg type="e" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path fill="currentColor" d="m21.9 15.621c0.1248-1.8535-0.6087-3.4099-2.6058-3.8292-0.7712-0.15744-1.3921-0.13977-2.1113-0.14543-0.6323 0.0048-1.1718-0.01567-1.8401 0.03203 1.5356-0.8078 1.6998-2.205 1.6567-3.546 0.1272-2.3708-1.4685-3.666-3.7727-3.673-2.2427-0.04024-5.0463-0.27229-5.9443 1.9172-0.28083 0.6692-0.27606 1.2179-0.28202 1.6587-0.08527 1.4303 0.20687 2.9224 1.662 3.6429-2.3051-0.05275-5.3273-0.39212-6.28 1.8983-0.28073 0.66862-0.27595 1.2174-0.282 1.6572-0.10329 1.6061 0.3059 3.171 2.0252 3.8067 1.2061 0.4187 2.2175 0.2869 3.3945 0.3134 2.0524 0.0901 4.0448-0.4637 4.4796-2.4982 0.609 2.5638 3.2086 2.5463 5.3204 2.4982 2.7823 0.1278 4.7024-0.9368 4.5798-3.7329zm-12.899-7.6287c-0.14889-1.8665 1.8839-1.4921 3.1358-1.546 0.8939 0.05358 2.4743-0.21158 2.8003 0.88445 0.2729 2.4494-0.0297 2.8555-2.5242 2.8232-0.94713-0.07259-2.869 0.28949-3.3134-0.77077-0.14881-0.44557-0.08538-0.92893-0.09846-1.3909zm0.2606 9.2128c-0.56638 0.162-1.1652 0.1412-1.7487 0.1488-0.59786-0.0036-1.1977 0.0131-1.7948-0.0233-0.93407-0.0365-1.6776-0.3579-1.6157-1.4217 0.01574-0.5119-0.06845-1.0551 0.11822-1.5436 0.4432-0.84155 1.5978-0.6728 2.4032-0.7191 0.81712 0.01614 1.6464-0.05154 2.4536 0.10154 0.99382 0.17537 1.0564 0.91742 1.0227 1.7752-6.1e-4 0.7729 0.04085 1.416-0.83867 1.6821zm2.9212-3.6286c-0.0836 0.19457-0.14194 0.3848-0.18279 0.56614-0.18535-0.87758-0.76293-1.6189-1.5605-2.02 1.0871 0.04933 2.0387 0.04959 3.1216-8e-5 -0.7672 0.39034-1.1687 0.96486-1.3783 1.4539zm6.8788 3.6286c-0.5664 0.162-1.1652 0.1412-1.7488 0.1488-0.5978-0.0036-1.1977 0.0131-1.7947-0.0233-0.9341-0.0365-1.6776-0.3579-1.6157-1.4217 0.0157-0.5119-0.0685-1.0551 0.1182-1.5436 0.4432-0.84155 1.5978-0.6728 2.4033-0.7191 0.8171 0.01614 1.6464-0.05154 2.4536 0.10154 0.9938 0.17537 1.0563 0.91742 1.0227 1.7752-6e-4 0.7729 0.0409 1.416-0.8386 1.6821z"></path></svg>
            <p name="id">公园里找朋友</p>
          </span>
          <span class="link-icon ml-[0.5em] mr-[0.25em]">
            <svg xmlns="http://www.w3.org/2000/svg" width="0.9411764705882353em" height="0.9411764705882353em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class="untouchable"><path d="m9.5652 14.45 0.72891-2.0026c-0.651 0.00713-1.3027 0.00104-1.9532 0.00179-1.0991-0.02908-3.0336 0.08306-3.605-1.0524-0.28828-0.61588-0.2054-1.3226-0.22136-1.9833 0.00663-0.74044-0.05553-1.6362 0.5758-2.1558 0.70637-0.5555 1.7411-0.56129 2.6027-0.59834 0.743-0.015 1.4884-0.00764 2.2315-0.00868 0.68471 0.01536 1.6274-0.01783 2.4184 0.16762l0.68711-1.8879c-0.0146-0.003965-0.0287-0.00841-0.0435-0.01227-0.94653-0.24905-1.9355-0.25901-2.9083-0.26688-0.78352-1.3008e-4 -1.5692-0.0063751-2.3527 0.006805-1.2709 0.027555-2.6299 0.13739-3.6978 0.89566-1.6654 1.2031-1.53 2.9573-1.5068 4.79-0.0012251 1.7732 0.89765 3.2159 2.626 3.7562 0.80589 0.26191 1.6615 0.32018 2.5036 0.34101 0.6376 0.01106 1.2763 0.01096 1.9146 0.00915z" fill="currentColor"></path><path d="m14.589 9.125h1.3099c0.02865-0.88714-0.11774-1.6826-0.45594-2.3461l-0.85392 2.3461z" fill="currentColor"></path><path d="m15.587 12.025h-2.0527l-0.80604 2.2146c1.2326-0.27362 2.3169-0.88582 2.8588-2.2146z" fill="currentColor"></path><path d="m8.394 12.025h2.0538l0.82406-2.2641c-1.2457 0.2734-2.3327 0.8901-2.8779 2.2641z" fill="currentColor"></path><path d="m8.5566 17.221 0.83571-2.2961h-1.2914c-0.025394 0.86685 0.12295 1.645 0.45565 2.2961z" fill="currentColor"></path><path d="m21.485 14.399c7e-4 -0.67593 0.0063-1.3662-0.1779-2.0223-0.58881-2.115-2.5706-2.7532-4.5608-2.8041-0.76964-0.031175-1.5416-0.02264-2.3121-0.022365l-0.72832 2.0011c0.38557-0.00297 0.77131 7.6e-4 1.1559-0.00173 1.1244 0.02284 2.8396-0.10221 3.8152 0.44616 0.82512 0.45526 0.81194 1.4036 0.80798 2.2308-0.01538 0.64171 0.05949 1.3145-0.1601 1.93-0.39418 1.0145-1.651 1.1102-2.5915 1.1694-0.7426 0.03331-1.4884 0.0209-2.2315 0.02365-0.81334-0.01641-1.9395 0.04306-2.8448-0.16914l-0.68792 1.89c0.014845 0.00401 0.02915 0.0085 0.044115 0.0124 0.94522 0.24688 1.9316 0.25913 2.9027 0.2657 0.83456-2.2e-4 1.6713 0.00786 2.5057-0.00999 2.0286-0.02122 4.1491-0.51576 4.8438-2.6752 0.2358-0.7292 0.22-1.5067 0.2196-2.2644z" fill="currentColor"></path><path d="m14.979 6.7378c0.17824-0.52033 0.90905-2.4486 1.0626-2.9514 0.05601-0.19527 0.10768-0.39984 0.08232-0.60408-0.03096-0.33264-0.36035-0.4603-0.63671-0.55464-0.20794-0.070665-0.41593-0.17228-0.63943-0.174-0.33751 0.005805-0.52152 0.33878-0.64452 0.61072-1.4256 3.8005-4.7612 13.07-6.1617 16.891-0.10636 0.34-0.29285 0.7891-0.06874 1.1109 0.1296 0.1673 0.34386 0.232 0.53431 0.3042 0.30778 0.1107 0.70325 0.3075 0.98251 0.0365 0.14514-0.1339 0.23561-0.315 0.31595-0.4926 0.10005-0.2274 0.1811-0.4632 0.26694-0.6962 0.4854-1.3337 4.3257-11.885 4.9065-13.481z" fill="currentColor"></path></svg>
          </span>
          
          <span class="icon">
            <svg type="d" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m21.15 6.85c0-2.2056-1.7944-4-4-4-4.1765-0.01989-5.4993 5.7322-1.8147 7.5629-0.263 0.63631-0.4627 1.4421-0.6559 2.2215-0.1397 0.56337-0.2841 1.1459-0.4405 1.6084-0.0728 0.2155-0.1286 0.4813-0.1891 0.4813-0.5072-0.7362-0.8126-2.2507-1.0979-3.3161-0.47879-1.5358-0.72936-4.4237-2.8018-4.558-0.77422 7e-5 -1.3844 0.52253-1.8138 1.553-0.55019 1.254-0.75064 3.2421-1.3784 4.4472-0.39648 3e-4 -0.79576 0.0045-1.1877 0.0703-0.67978 0.1073-1.3339 0.4195-1.798 0.9347-0.39707 0.4315-0.6427 0.9874-0.74275 1.5623-0.063545 0.351-0.07691 0.7094-0.07883 1.0654 0.001935 0.4718-0.01324 0.9457 0.027745 1.4163 0.09435 1.151 0.65732 2.1308 1.7281 2.6237 0.43467 0.1975 0.91053 0.2877 1.3854 0.3129 0.40096 0.0215 0.80345 0.0129 1.2048 0.0139 0.6491 2e-4 1.2891-0.0515 1.888-0.3229 0.90042-0.4067 1.4845-1.2039 1.6712-2.1666 0.0761-0.3779 0.09179-0.7654 0.09344-1.15 7.7e-4 -0.2699 0.00148-0.5413-7.8e-4 -0.8111-0.00379-0.4854-0.04143-0.9771-0.19121-1.4414-0.28748-0.9172-0.98053-1.616-1.8964-1.909 0.43984-1.1576 0.66815-2.7594 1.1268-3.8895 0.3537 0.72804 0.57113 1.7669 0.82283 2.7298 0.26567 1.0724 0.5404 2.1814 0.90896 3.0557 0.87204 2.2985 3.1124 2.7586 4.0452 0.392 0.5508-1.2642 0.7508-3.279 1.3828-4.4916 2.1142-0.10339 3.8024-1.8557 3.8024-3.995zm-12.073 8.8023c0.05605 0.2275 0.06623 0.465 0.07092 0.6983 0.00363 0.2444 0.00195 0.4906 0.00214 0.735-0.0063 0.408 0.01486 0.882-0.18359 1.2496-0.24573 0.4539-0.8026 0.501-1.2651 0.5114-0.33714 0.0058-0.67525 0.0041-1.0124 0.0018-0.46455-0.0092-1.0361-0.0245-1.3192-0.4545-0.16612-0.2552-0.19733-0.5702-0.21202-0.8673-0.01004-0.2443-0.00683-0.4906-0.0075-0.735 5.9e-4 -0.2322-0.00201-0.4664 0.01171-0.6983 0.01886-0.2936 0.06332-0.6069 0.24969-0.8453 0.34185-0.4331 1.0226-0.3889 1.5228-0.3979 0.38828 0.0035 0.77905-0.0131 1.1658 0.0285 0.49865 0.0566 0.85211 0.2621 0.97684 0.7737zm8.0732-6.8023c-2.6379-0.06696-2.6373-3.9334 0-4 2.6378 0.06697 2.6373 3.9334 0 4z" fill="currentColor"></path></svg>
            <p name="id">级联选择器</p>
          </span>
        </div>
      
<p>想象一下你在一个拥挤的公园里寻找你的朋友。你不能一次性仔细观察每一个人，这样做效率太低。相反，你可以采用类似级联分类器的策略：</p>
<ol>
<li><strong>远距离快速扫描</strong>：首先，你从远处开始，快速扫视人群，排除那些明显不符合你朋友特征（比如身高、衣着颜色）的人。</li>
<li><strong>中距离筛选</strong>：接着，对于剩下可能符合的人群，你走近一些，关注更多细节，比如发型或者是特定的配饰，进一步缩小范围。</li>
<li><strong>近距离确认</strong>：最后，对于少数几个高度匹配的目标，你可以走到很近的地方，确认是否是你的朋友。</li>
</ol>
<p>这个过程就像是一个级联的过滤器，每一步都排除了大量不符合条件的目标，最终快速而准确地找到了你的朋友。</p>

        <div class="evoldown" id="字典推导式" type="d">
          <span class="icon">
            <svg type="d" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m21.15 6.85c0-2.2056-1.7944-4-4-4-4.1765-0.01989-5.4993 5.7322-1.8147 7.5629-0.263 0.63631-0.4627 1.4421-0.6559 2.2215-0.1397 0.56337-0.2841 1.1459-0.4405 1.6084-0.0728 0.2155-0.1286 0.4813-0.1891 0.4813-0.5072-0.7362-0.8126-2.2507-1.0979-3.3161-0.47879-1.5358-0.72936-4.4237-2.8018-4.558-0.77422 7e-5 -1.3844 0.52253-1.8138 1.553-0.55019 1.254-0.75064 3.2421-1.3784 4.4472-0.39648 3e-4 -0.79576 0.0045-1.1877 0.0703-0.67978 0.1073-1.3339 0.4195-1.798 0.9347-0.39707 0.4315-0.6427 0.9874-0.74275 1.5623-0.063545 0.351-0.07691 0.7094-0.07883 1.0654 0.001935 0.4718-0.01324 0.9457 0.027745 1.4163 0.09435 1.151 0.65732 2.1308 1.7281 2.6237 0.43467 0.1975 0.91053 0.2877 1.3854 0.3129 0.40096 0.0215 0.80345 0.0129 1.2048 0.0139 0.6491 2e-4 1.2891-0.0515 1.888-0.3229 0.90042-0.4067 1.4845-1.2039 1.6712-2.1666 0.0761-0.3779 0.09179-0.7654 0.09344-1.15 7.7e-4 -0.2699 0.00148-0.5413-7.8e-4 -0.8111-0.00379-0.4854-0.04143-0.9771-0.19121-1.4414-0.28748-0.9172-0.98053-1.616-1.8964-1.909 0.43984-1.1576 0.66815-2.7594 1.1268-3.8895 0.3537 0.72804 0.57113 1.7669 0.82283 2.7298 0.26567 1.0724 0.5404 2.1814 0.90896 3.0557 0.87204 2.2985 3.1124 2.7586 4.0452 0.392 0.5508-1.2642 0.7508-3.279 1.3828-4.4916 2.1142-0.10339 3.8024-1.8557 3.8024-3.995zm-12.073 8.8023c0.05605 0.2275 0.06623 0.465 0.07092 0.6983 0.00363 0.2444 0.00195 0.4906 0.00214 0.735-0.0063 0.408 0.01486 0.882-0.18359 1.2496-0.24573 0.4539-0.8026 0.501-1.2651 0.5114-0.33714 0.0058-0.67525 0.0041-1.0124 0.0018-0.46455-0.0092-1.0361-0.0245-1.3192-0.4545-0.16612-0.2552-0.19733-0.5702-0.21202-0.8673-0.01004-0.2443-0.00683-0.4906-0.0075-0.735 5.9e-4 -0.2322-0.00201-0.4664 0.01171-0.6983 0.01886-0.2936 0.06332-0.6069 0.24969-0.8453 0.34185-0.4331 1.0226-0.3889 1.5228-0.3979 0.38828 0.0035 0.77905-0.0131 1.1658 0.0285 0.49865 0.0566 0.85211 0.2621 0.97684 0.7737zm8.0732-6.8023c-2.6379-0.06696-2.6373-3.9334 0-4 2.6378 0.06697 2.6373 3.9334 0 4z" fill="currentColor"></path></svg>
            <p name="id">字典推导式</p>
          </span>
        </div>
      
<p>字典推导式是一种简洁的构建字典的方法，它可以通过一个表达式来创建一个字典，其中包含了键值对（key-value pairs）。这个概念主要是为了解决在创建字典时需要通过循环和条件语句来添加键值对的复杂性问题。</p>
<p>没有字典推导式的影响：</p>
<ol>
<li><strong>代码冗长</strong>：在没有字典推导式的情况下，你可能需要使用循环和条件语句来构建字典，这会使代码变得更长、更复杂。</li>
<li><strong>效率低下</strong>：手动通过循环添加键值对可能会比使用字典推导式慢，特别是在处理大量数据时。</li>
<li><strong>可读性差</strong>：字典推导式提供了一种更清晰、更直观的方式来表达如何从一个序列或者其他数据结构中构建字典，没有它，代码可能会更难理解。</li>
</ol>
<p>字典推导式对以下概念起作用：</p>
<ol>
<li><strong>简洁的代码</strong>：它提供了一种更简洁的方法来创建字典。</li>
<li><strong>数据转换</strong>：它可以用来轻松地从一个数据结构（如列表、元组列表等）转换为字典。</li>
<li><strong>条件过滤</strong>：在字典推导式中，可以使用if语句来过滤掉不符合条件的元素，从而只包含满足特定条件的键值对。</li>
<li><strong>自动化处理</strong>：它可以用于自动化地处理数据集合，将其转换为字典形式，特别是在数据预处理和数据分析中非常有用。</li>
</ol>
<p>总的来说，字典推导式是一种非常有用的工具，它可以使代码更加简洁、高效，并且提高代码的可读性。</p>

        <div class="evoldown" id="字符串转字典" type="e">
          <span class="icon">
            <svg type="e" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path fill="currentColor" d="m21.9 15.621c0.1248-1.8535-0.6087-3.4099-2.6058-3.8292-0.7712-0.15744-1.3921-0.13977-2.1113-0.14543-0.6323 0.0048-1.1718-0.01567-1.8401 0.03203 1.5356-0.8078 1.6998-2.205 1.6567-3.546 0.1272-2.3708-1.4685-3.666-3.7727-3.673-2.2427-0.04024-5.0463-0.27229-5.9443 1.9172-0.28083 0.6692-0.27606 1.2179-0.28202 1.6587-0.08527 1.4303 0.20687 2.9224 1.662 3.6429-2.3051-0.05275-5.3273-0.39212-6.28 1.8983-0.28073 0.66862-0.27595 1.2174-0.282 1.6572-0.10329 1.6061 0.3059 3.171 2.0252 3.8067 1.2061 0.4187 2.2175 0.2869 3.3945 0.3134 2.0524 0.0901 4.0448-0.4637 4.4796-2.4982 0.609 2.5638 3.2086 2.5463 5.3204 2.4982 2.7823 0.1278 4.7024-0.9368 4.5798-3.7329zm-12.899-7.6287c-0.14889-1.8665 1.8839-1.4921 3.1358-1.546 0.8939 0.05358 2.4743-0.21158 2.8003 0.88445 0.2729 2.4494-0.0297 2.8555-2.5242 2.8232-0.94713-0.07259-2.869 0.28949-3.3134-0.77077-0.14881-0.44557-0.08538-0.92893-0.09846-1.3909zm0.2606 9.2128c-0.56638 0.162-1.1652 0.1412-1.7487 0.1488-0.59786-0.0036-1.1977 0.0131-1.7948-0.0233-0.93407-0.0365-1.6776-0.3579-1.6157-1.4217 0.01574-0.5119-0.06845-1.0551 0.11822-1.5436 0.4432-0.84155 1.5978-0.6728 2.4032-0.7191 0.81712 0.01614 1.6464-0.05154 2.4536 0.10154 0.99382 0.17537 1.0564 0.91742 1.0227 1.7752-6.1e-4 0.7729 0.04085 1.416-0.83867 1.6821zm2.9212-3.6286c-0.0836 0.19457-0.14194 0.3848-0.18279 0.56614-0.18535-0.87758-0.76293-1.6189-1.5605-2.02 1.0871 0.04933 2.0387 0.04959 3.1216-8e-5 -0.7672 0.39034-1.1687 0.96486-1.3783 1.4539zm6.8788 3.6286c-0.5664 0.162-1.1652 0.1412-1.7488 0.1488-0.5978-0.0036-1.1977 0.0131-1.7947-0.0233-0.9341-0.0365-1.6776-0.3579-1.6157-1.4217 0.0157-0.5119-0.0685-1.0551 0.1182-1.5436 0.4432-0.84155 1.5978-0.6728 2.4033-0.7191 0.8171 0.01614 1.6464-0.05154 2.4536 0.10154 0.9938 0.17537 1.0563 0.91742 1.0227 1.7752-6e-4 0.7729 0.0409 1.416-0.8386 1.6821z"></path></svg>
            <p name="id">字符串转字典</p>
          </span>
          <span class="link-icon ml-[0.5em] mr-[0.25em]">
            <svg xmlns="http://www.w3.org/2000/svg" width="0.9411764705882353em" height="0.9411764705882353em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class="untouchable"><path d="m9.5652 14.45 0.72891-2.0026c-0.651 0.00713-1.3027 0.00104-1.9532 0.00179-1.0991-0.02908-3.0336 0.08306-3.605-1.0524-0.28828-0.61588-0.2054-1.3226-0.22136-1.9833 0.00663-0.74044-0.05553-1.6362 0.5758-2.1558 0.70637-0.5555 1.7411-0.56129 2.6027-0.59834 0.743-0.015 1.4884-0.00764 2.2315-0.00868 0.68471 0.01536 1.6274-0.01783 2.4184 0.16762l0.68711-1.8879c-0.0146-0.003965-0.0287-0.00841-0.0435-0.01227-0.94653-0.24905-1.9355-0.25901-2.9083-0.26688-0.78352-1.3008e-4 -1.5692-0.0063751-2.3527 0.006805-1.2709 0.027555-2.6299 0.13739-3.6978 0.89566-1.6654 1.2031-1.53 2.9573-1.5068 4.79-0.0012251 1.7732 0.89765 3.2159 2.626 3.7562 0.80589 0.26191 1.6615 0.32018 2.5036 0.34101 0.6376 0.01106 1.2763 0.01096 1.9146 0.00915z" fill="currentColor"></path><path d="m14.589 9.125h1.3099c0.02865-0.88714-0.11774-1.6826-0.45594-2.3461l-0.85392 2.3461z" fill="currentColor"></path><path d="m15.587 12.025h-2.0527l-0.80604 2.2146c1.2326-0.27362 2.3169-0.88582 2.8588-2.2146z" fill="currentColor"></path><path d="m8.394 12.025h2.0538l0.82406-2.2641c-1.2457 0.2734-2.3327 0.8901-2.8779 2.2641z" fill="currentColor"></path><path d="m8.5566 17.221 0.83571-2.2961h-1.2914c-0.025394 0.86685 0.12295 1.645 0.45565 2.2961z" fill="currentColor"></path><path d="m21.485 14.399c7e-4 -0.67593 0.0063-1.3662-0.1779-2.0223-0.58881-2.115-2.5706-2.7532-4.5608-2.8041-0.76964-0.031175-1.5416-0.02264-2.3121-0.022365l-0.72832 2.0011c0.38557-0.00297 0.77131 7.6e-4 1.1559-0.00173 1.1244 0.02284 2.8396-0.10221 3.8152 0.44616 0.82512 0.45526 0.81194 1.4036 0.80798 2.2308-0.01538 0.64171 0.05949 1.3145-0.1601 1.93-0.39418 1.0145-1.651 1.1102-2.5915 1.1694-0.7426 0.03331-1.4884 0.0209-2.2315 0.02365-0.81334-0.01641-1.9395 0.04306-2.8448-0.16914l-0.68792 1.89c0.014845 0.00401 0.02915 0.0085 0.044115 0.0124 0.94522 0.24688 1.9316 0.25913 2.9027 0.2657 0.83456-2.2e-4 1.6713 0.00786 2.5057-0.00999 2.0286-0.02122 4.1491-0.51576 4.8438-2.6752 0.2358-0.7292 0.22-1.5067 0.2196-2.2644z" fill="currentColor"></path><path d="m14.979 6.7378c0.17824-0.52033 0.90905-2.4486 1.0626-2.9514 0.05601-0.19527 0.10768-0.39984 0.08232-0.60408-0.03096-0.33264-0.36035-0.4603-0.63671-0.55464-0.20794-0.070665-0.41593-0.17228-0.63943-0.174-0.33751 0.005805-0.52152 0.33878-0.64452 0.61072-1.4256 3.8005-4.7612 13.07-6.1617 16.891-0.10636 0.34-0.29285 0.7891-0.06874 1.1109 0.1296 0.1673 0.34386 0.232 0.53431 0.3042 0.30778 0.1107 0.70325 0.3075 0.98251 0.0365 0.14514-0.1339 0.23561-0.315 0.31595-0.4926 0.10005-0.2274 0.1811-0.4632 0.26694-0.6962 0.4854-1.3337 4.3257-11.885 4.9065-13.481z" fill="currentColor"></path></svg>
          </span>
          
          <span class="icon">
            <svg type="d" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m21.15 6.85c0-2.2056-1.7944-4-4-4-4.1765-0.01989-5.4993 5.7322-1.8147 7.5629-0.263 0.63631-0.4627 1.4421-0.6559 2.2215-0.1397 0.56337-0.2841 1.1459-0.4405 1.6084-0.0728 0.2155-0.1286 0.4813-0.1891 0.4813-0.5072-0.7362-0.8126-2.2507-1.0979-3.3161-0.47879-1.5358-0.72936-4.4237-2.8018-4.558-0.77422 7e-5 -1.3844 0.52253-1.8138 1.553-0.55019 1.254-0.75064 3.2421-1.3784 4.4472-0.39648 3e-4 -0.79576 0.0045-1.1877 0.0703-0.67978 0.1073-1.3339 0.4195-1.798 0.9347-0.39707 0.4315-0.6427 0.9874-0.74275 1.5623-0.063545 0.351-0.07691 0.7094-0.07883 1.0654 0.001935 0.4718-0.01324 0.9457 0.027745 1.4163 0.09435 1.151 0.65732 2.1308 1.7281 2.6237 0.43467 0.1975 0.91053 0.2877 1.3854 0.3129 0.40096 0.0215 0.80345 0.0129 1.2048 0.0139 0.6491 2e-4 1.2891-0.0515 1.888-0.3229 0.90042-0.4067 1.4845-1.2039 1.6712-2.1666 0.0761-0.3779 0.09179-0.7654 0.09344-1.15 7.7e-4 -0.2699 0.00148-0.5413-7.8e-4 -0.8111-0.00379-0.4854-0.04143-0.9771-0.19121-1.4414-0.28748-0.9172-0.98053-1.616-1.8964-1.909 0.43984-1.1576 0.66815-2.7594 1.1268-3.8895 0.3537 0.72804 0.57113 1.7669 0.82283 2.7298 0.26567 1.0724 0.5404 2.1814 0.90896 3.0557 0.87204 2.2985 3.1124 2.7586 4.0452 0.392 0.5508-1.2642 0.7508-3.279 1.3828-4.4916 2.1142-0.10339 3.8024-1.8557 3.8024-3.995zm-12.073 8.8023c0.05605 0.2275 0.06623 0.465 0.07092 0.6983 0.00363 0.2444 0.00195 0.4906 0.00214 0.735-0.0063 0.408 0.01486 0.882-0.18359 1.2496-0.24573 0.4539-0.8026 0.501-1.2651 0.5114-0.33714 0.0058-0.67525 0.0041-1.0124 0.0018-0.46455-0.0092-1.0361-0.0245-1.3192-0.4545-0.16612-0.2552-0.19733-0.5702-0.21202-0.8673-0.01004-0.2443-0.00683-0.4906-0.0075-0.735 5.9e-4 -0.2322-0.00201-0.4664 0.01171-0.6983 0.01886-0.2936 0.06332-0.6069 0.24969-0.8453 0.34185-0.4331 1.0226-0.3889 1.5228-0.3979 0.38828 0.0035 0.77905-0.0131 1.1658 0.0285 0.49865 0.0566 0.85211 0.2621 0.97684 0.7737zm8.0732-6.8023c-2.6379-0.06696-2.6373-3.9334 0-4 2.6378 0.06697 2.6373 3.9334 0 4z" fill="currentColor"></path></svg>
            <p name="id">字典推导式</p>
          </span>
        </div>
      
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 字符串列表</span>
words <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'apple'</span><span class="token punctuation">,</span> <span class="token string">'banana'</span><span class="token punctuation">,</span> <span class="token string">'cherry'</span><span class="token punctuation">]</span>
<span class="token comment"># 使用字典推导式创建一个字典，其中键是列表中的字符串，值是对应字符串的长度</span>
word_lengths <span class="token operator">=</span> <span class="token punctuation">{</span>word<span class="token punctuation">:</span> <span class="token builtin">len</span><span class="token punctuation">(</span>word<span class="token punctuation">)</span> <span class="token keyword">for</span> word <span class="token keyword">in</span> words<span class="token punctuation">}</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>word_lengths<span class="token punctuation">)</span>
<span class="token comment"># 输出{'apple': 5, 'banana': 6, 'cherry': 6}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

        <div class="evoldown" id="损失函数" type="d">
          <span class="icon">
            <svg type="d" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m21.15 6.85c0-2.2056-1.7944-4-4-4-4.1765-0.01989-5.4993 5.7322-1.8147 7.5629-0.263 0.63631-0.4627 1.4421-0.6559 2.2215-0.1397 0.56337-0.2841 1.1459-0.4405 1.6084-0.0728 0.2155-0.1286 0.4813-0.1891 0.4813-0.5072-0.7362-0.8126-2.2507-1.0979-3.3161-0.47879-1.5358-0.72936-4.4237-2.8018-4.558-0.77422 7e-5 -1.3844 0.52253-1.8138 1.553-0.55019 1.254-0.75064 3.2421-1.3784 4.4472-0.39648 3e-4 -0.79576 0.0045-1.1877 0.0703-0.67978 0.1073-1.3339 0.4195-1.798 0.9347-0.39707 0.4315-0.6427 0.9874-0.74275 1.5623-0.063545 0.351-0.07691 0.7094-0.07883 1.0654 0.001935 0.4718-0.01324 0.9457 0.027745 1.4163 0.09435 1.151 0.65732 2.1308 1.7281 2.6237 0.43467 0.1975 0.91053 0.2877 1.3854 0.3129 0.40096 0.0215 0.80345 0.0129 1.2048 0.0139 0.6491 2e-4 1.2891-0.0515 1.888-0.3229 0.90042-0.4067 1.4845-1.2039 1.6712-2.1666 0.0761-0.3779 0.09179-0.7654 0.09344-1.15 7.7e-4 -0.2699 0.00148-0.5413-7.8e-4 -0.8111-0.00379-0.4854-0.04143-0.9771-0.19121-1.4414-0.28748-0.9172-0.98053-1.616-1.8964-1.909 0.43984-1.1576 0.66815-2.7594 1.1268-3.8895 0.3537 0.72804 0.57113 1.7669 0.82283 2.7298 0.26567 1.0724 0.5404 2.1814 0.90896 3.0557 0.87204 2.2985 3.1124 2.7586 4.0452 0.392 0.5508-1.2642 0.7508-3.279 1.3828-4.4916 2.1142-0.10339 3.8024-1.8557 3.8024-3.995zm-12.073 8.8023c0.05605 0.2275 0.06623 0.465 0.07092 0.6983 0.00363 0.2444 0.00195 0.4906 0.00214 0.735-0.0063 0.408 0.01486 0.882-0.18359 1.2496-0.24573 0.4539-0.8026 0.501-1.2651 0.5114-0.33714 0.0058-0.67525 0.0041-1.0124 0.0018-0.46455-0.0092-1.0361-0.0245-1.3192-0.4545-0.16612-0.2552-0.19733-0.5702-0.21202-0.8673-0.01004-0.2443-0.00683-0.4906-0.0075-0.735 5.9e-4 -0.2322-0.00201-0.4664 0.01171-0.6983 0.01886-0.2936 0.06332-0.6069 0.24969-0.8453 0.34185-0.4331 1.0226-0.3889 1.5228-0.3979 0.38828 0.0035 0.77905-0.0131 1.1658 0.0285 0.49865 0.0566 0.85211 0.2621 0.97684 0.7737zm8.0732-6.8023c-2.6379-0.06696-2.6373-3.9334 0-4 2.6378 0.06697 2.6373 3.9334 0 4z" fill="currentColor"></path></svg>
            <p name="id">损失函数</p>
          </span>
        </div>
      
<p>损失函数（Loss Function）是机器学习和深度学习中的一个核心概念，用于衡量模型预测值与真实值之间的差异。其主要目的是指导模型学习，通过最小化损失函数来优化模型参数，使模型的预测更加准确。损失函数是机器学习和深度学习中不可或缺的一部分，它为模型训练提供了方向和目标，是实现模型优化和提高预测准确性的关键。 ^0b27b2</p>
<p><strong>解决的问题：</strong></p>
<ol>
<li><strong>提供反馈信号</strong>：损失函数为模型训练提供了反馈信号，指示模型当前的表现如何，以及如何调整参数以改进性能。</li>
<li><strong>优化目标</strong>：它定义了一个明确的优化目标。在训练过程中，通过最小化损失函数，模型能够学习到数据的内在规律和模式。</li>
<li><strong>适应不同问题</strong>：不同的问题可以通过选择合适的损失函数来更好地优化，例如分类问题常用交叉熵损失，回归问题常用均方误差损失。</li>
</ol>
<p><strong>没有损失函数会导致的结果：</strong></p>
<ol>
<li><strong>无法衡量性能</strong>：没有损失函数，我们将无法量化模型预测的好坏，也就无法判断模型是否在学习或进步。</li>
<li><strong>缺乏优化方向</strong>：模型训练需要一个明确的目标或标准来进行参数的调整和优化。没有损失函数，模型就没有明确的优化方向，无法进行有效的参数更新。</li>
<li><strong>无法适应不同问题</strong>：不同类型的问题需要不同的优化策略。没有损失函数，就无法为不同的问题设计和选择最合适的优化目标，从而降低模型的适用性和准确性。</li>
</ol>
<p>线性回归是一种预测连续值的算法。假设我们有一组数据点，我们想要找到一条直线，这条直线能够尽可能地接近所有的数据点。这里，损失函数的作用就是衡量这条直线与实际数据点之间的差距。</p>

        <div class="evoldown" id="均方误差（MSE）" type="e">
          <span class="icon">
            <svg type="e" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path fill="currentColor" d="m21.9 15.621c0.1248-1.8535-0.6087-3.4099-2.6058-3.8292-0.7712-0.15744-1.3921-0.13977-2.1113-0.14543-0.6323 0.0048-1.1718-0.01567-1.8401 0.03203 1.5356-0.8078 1.6998-2.205 1.6567-3.546 0.1272-2.3708-1.4685-3.666-3.7727-3.673-2.2427-0.04024-5.0463-0.27229-5.9443 1.9172-0.28083 0.6692-0.27606 1.2179-0.28202 1.6587-0.08527 1.4303 0.20687 2.9224 1.662 3.6429-2.3051-0.05275-5.3273-0.39212-6.28 1.8983-0.28073 0.66862-0.27595 1.2174-0.282 1.6572-0.10329 1.6061 0.3059 3.171 2.0252 3.8067 1.2061 0.4187 2.2175 0.2869 3.3945 0.3134 2.0524 0.0901 4.0448-0.4637 4.4796-2.4982 0.609 2.5638 3.2086 2.5463 5.3204 2.4982 2.7823 0.1278 4.7024-0.9368 4.5798-3.7329zm-12.899-7.6287c-0.14889-1.8665 1.8839-1.4921 3.1358-1.546 0.8939 0.05358 2.4743-0.21158 2.8003 0.88445 0.2729 2.4494-0.0297 2.8555-2.5242 2.8232-0.94713-0.07259-2.869 0.28949-3.3134-0.77077-0.14881-0.44557-0.08538-0.92893-0.09846-1.3909zm0.2606 9.2128c-0.56638 0.162-1.1652 0.1412-1.7487 0.1488-0.59786-0.0036-1.1977 0.0131-1.7948-0.0233-0.93407-0.0365-1.6776-0.3579-1.6157-1.4217 0.01574-0.5119-0.06845-1.0551 0.11822-1.5436 0.4432-0.84155 1.5978-0.6728 2.4032-0.7191 0.81712 0.01614 1.6464-0.05154 2.4536 0.10154 0.99382 0.17537 1.0564 0.91742 1.0227 1.7752-6.1e-4 0.7729 0.04085 1.416-0.83867 1.6821zm2.9212-3.6286c-0.0836 0.19457-0.14194 0.3848-0.18279 0.56614-0.18535-0.87758-0.76293-1.6189-1.5605-2.02 1.0871 0.04933 2.0387 0.04959 3.1216-8e-5 -0.7672 0.39034-1.1687 0.96486-1.3783 1.4539zm6.8788 3.6286c-0.5664 0.162-1.1652 0.1412-1.7488 0.1488-0.5978-0.0036-1.1977 0.0131-1.7947-0.0233-0.9341-0.0365-1.6776-0.3579-1.6157-1.4217 0.0157-0.5119-0.0685-1.0551 0.1182-1.5436 0.4432-0.84155 1.5978-0.6728 2.4033-0.7191 0.8171 0.01614 1.6464-0.05154 2.4536 0.10154 0.9938 0.17537 1.0563 0.91742 1.0227 1.7752-6e-4 0.7729 0.0409 1.416-0.8386 1.6821z"></path></svg>
            <p name="id">均方误差（MSE）</p>
          </span>
          <span class="link-icon ml-[0.5em] mr-[0.25em]">
            <svg xmlns="http://www.w3.org/2000/svg" width="0.9411764705882353em" height="0.9411764705882353em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class="untouchable"><path d="m9.5652 14.45 0.72891-2.0026c-0.651 0.00713-1.3027 0.00104-1.9532 0.00179-1.0991-0.02908-3.0336 0.08306-3.605-1.0524-0.28828-0.61588-0.2054-1.3226-0.22136-1.9833 0.00663-0.74044-0.05553-1.6362 0.5758-2.1558 0.70637-0.5555 1.7411-0.56129 2.6027-0.59834 0.743-0.015 1.4884-0.00764 2.2315-0.00868 0.68471 0.01536 1.6274-0.01783 2.4184 0.16762l0.68711-1.8879c-0.0146-0.003965-0.0287-0.00841-0.0435-0.01227-0.94653-0.24905-1.9355-0.25901-2.9083-0.26688-0.78352-1.3008e-4 -1.5692-0.0063751-2.3527 0.006805-1.2709 0.027555-2.6299 0.13739-3.6978 0.89566-1.6654 1.2031-1.53 2.9573-1.5068 4.79-0.0012251 1.7732 0.89765 3.2159 2.626 3.7562 0.80589 0.26191 1.6615 0.32018 2.5036 0.34101 0.6376 0.01106 1.2763 0.01096 1.9146 0.00915z" fill="currentColor"></path><path d="m14.589 9.125h1.3099c0.02865-0.88714-0.11774-1.6826-0.45594-2.3461l-0.85392 2.3461z" fill="currentColor"></path><path d="m15.587 12.025h-2.0527l-0.80604 2.2146c1.2326-0.27362 2.3169-0.88582 2.8588-2.2146z" fill="currentColor"></path><path d="m8.394 12.025h2.0538l0.82406-2.2641c-1.2457 0.2734-2.3327 0.8901-2.8779 2.2641z" fill="currentColor"></path><path d="m8.5566 17.221 0.83571-2.2961h-1.2914c-0.025394 0.86685 0.12295 1.645 0.45565 2.2961z" fill="currentColor"></path><path d="m21.485 14.399c7e-4 -0.67593 0.0063-1.3662-0.1779-2.0223-0.58881-2.115-2.5706-2.7532-4.5608-2.8041-0.76964-0.031175-1.5416-0.02264-2.3121-0.022365l-0.72832 2.0011c0.38557-0.00297 0.77131 7.6e-4 1.1559-0.00173 1.1244 0.02284 2.8396-0.10221 3.8152 0.44616 0.82512 0.45526 0.81194 1.4036 0.80798 2.2308-0.01538 0.64171 0.05949 1.3145-0.1601 1.93-0.39418 1.0145-1.651 1.1102-2.5915 1.1694-0.7426 0.03331-1.4884 0.0209-2.2315 0.02365-0.81334-0.01641-1.9395 0.04306-2.8448-0.16914l-0.68792 1.89c0.014845 0.00401 0.02915 0.0085 0.044115 0.0124 0.94522 0.24688 1.9316 0.25913 2.9027 0.2657 0.83456-2.2e-4 1.6713 0.00786 2.5057-0.00999 2.0286-0.02122 4.1491-0.51576 4.8438-2.6752 0.2358-0.7292 0.22-1.5067 0.2196-2.2644z" fill="currentColor"></path><path d="m14.979 6.7378c0.17824-0.52033 0.90905-2.4486 1.0626-2.9514 0.05601-0.19527 0.10768-0.39984 0.08232-0.60408-0.03096-0.33264-0.36035-0.4603-0.63671-0.55464-0.20794-0.070665-0.41593-0.17228-0.63943-0.174-0.33751 0.005805-0.52152 0.33878-0.64452 0.61072-1.4256 3.8005-4.7612 13.07-6.1617 16.891-0.10636 0.34-0.29285 0.7891-0.06874 1.1109 0.1296 0.1673 0.34386 0.232 0.53431 0.3042 0.30778 0.1107 0.70325 0.3075 0.98251 0.0365 0.14514-0.1339 0.23561-0.315 0.31595-0.4926 0.10005-0.2274 0.1811-0.4632 0.26694-0.6962 0.4854-1.3337 4.3257-11.885 4.9065-13.481z" fill="currentColor"></path></svg>
          </span>
          
          <span class="icon">
            <svg type="d" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m21.15 6.85c0-2.2056-1.7944-4-4-4-4.1765-0.01989-5.4993 5.7322-1.8147 7.5629-0.263 0.63631-0.4627 1.4421-0.6559 2.2215-0.1397 0.56337-0.2841 1.1459-0.4405 1.6084-0.0728 0.2155-0.1286 0.4813-0.1891 0.4813-0.5072-0.7362-0.8126-2.2507-1.0979-3.3161-0.47879-1.5358-0.72936-4.4237-2.8018-4.558-0.77422 7e-5 -1.3844 0.52253-1.8138 1.553-0.55019 1.254-0.75064 3.2421-1.3784 4.4472-0.39648 3e-4 -0.79576 0.0045-1.1877 0.0703-0.67978 0.1073-1.3339 0.4195-1.798 0.9347-0.39707 0.4315-0.6427 0.9874-0.74275 1.5623-0.063545 0.351-0.07691 0.7094-0.07883 1.0654 0.001935 0.4718-0.01324 0.9457 0.027745 1.4163 0.09435 1.151 0.65732 2.1308 1.7281 2.6237 0.43467 0.1975 0.91053 0.2877 1.3854 0.3129 0.40096 0.0215 0.80345 0.0129 1.2048 0.0139 0.6491 2e-4 1.2891-0.0515 1.888-0.3229 0.90042-0.4067 1.4845-1.2039 1.6712-2.1666 0.0761-0.3779 0.09179-0.7654 0.09344-1.15 7.7e-4 -0.2699 0.00148-0.5413-7.8e-4 -0.8111-0.00379-0.4854-0.04143-0.9771-0.19121-1.4414-0.28748-0.9172-0.98053-1.616-1.8964-1.909 0.43984-1.1576 0.66815-2.7594 1.1268-3.8895 0.3537 0.72804 0.57113 1.7669 0.82283 2.7298 0.26567 1.0724 0.5404 2.1814 0.90896 3.0557 0.87204 2.2985 3.1124 2.7586 4.0452 0.392 0.5508-1.2642 0.7508-3.279 1.3828-4.4916 2.1142-0.10339 3.8024-1.8557 3.8024-3.995zm-12.073 8.8023c0.05605 0.2275 0.06623 0.465 0.07092 0.6983 0.00363 0.2444 0.00195 0.4906 0.00214 0.735-0.0063 0.408 0.01486 0.882-0.18359 1.2496-0.24573 0.4539-0.8026 0.501-1.2651 0.5114-0.33714 0.0058-0.67525 0.0041-1.0124 0.0018-0.46455-0.0092-1.0361-0.0245-1.3192-0.4545-0.16612-0.2552-0.19733-0.5702-0.21202-0.8673-0.01004-0.2443-0.00683-0.4906-0.0075-0.735 5.9e-4 -0.2322-0.00201-0.4664 0.01171-0.6983 0.01886-0.2936 0.06332-0.6069 0.24969-0.8453 0.34185-0.4331 1.0226-0.3889 1.5228-0.3979 0.38828 0.0035 0.77905-0.0131 1.1658 0.0285 0.49865 0.0566 0.85211 0.2621 0.97684 0.7737zm8.0732-6.8023c-2.6379-0.06696-2.6373-3.9334 0-4 2.6378 0.06697 2.6373 3.9334 0 4z" fill="currentColor"></path></svg>
            <p name="id">损失函数</p>
          </span>
        </div>
      
<p>假设我们的直线方程为&nbsp;<code>y = wx + b</code>，其中&nbsp;<code>w</code>&nbsp;是权重，<code>b</code>&nbsp;是偏置。对于每个数据点&nbsp;<code>(x_i, y_i)</code>，直线给出的预测值是&nbsp;<code>ŷ_i = wx_i + b</code>。均方误差（MSE）损失函数计算所有数据点的真实值&nbsp;<code>y_i</code>&nbsp;与预测值&nbsp;<code>ŷ_i</code>&nbsp;之间差值的平方和的平均值：</p>
<p>MSE&nbsp;=&nbsp;(1/n)&nbsp;*&nbsp;Σ(y_i&nbsp;-&nbsp;ŷ_i)^2</p>
<p>其中&nbsp;<code>n</code>&nbsp;是数据点的总数，<code>Σ</code>&nbsp;表示求和。通过最小化这个损失函数，我们可以找到最佳的&nbsp;<code>w</code>&nbsp;和&nbsp;<code>b</code>，使得直线尽可能地接近所有的数据点。</p>

        <div class="evoldown" id="减肥" type="e">
          <span class="icon">
            <svg type="e" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path fill="currentColor" d="m21.9 15.621c0.1248-1.8535-0.6087-3.4099-2.6058-3.8292-0.7712-0.15744-1.3921-0.13977-2.1113-0.14543-0.6323 0.0048-1.1718-0.01567-1.8401 0.03203 1.5356-0.8078 1.6998-2.205 1.6567-3.546 0.1272-2.3708-1.4685-3.666-3.7727-3.673-2.2427-0.04024-5.0463-0.27229-5.9443 1.9172-0.28083 0.6692-0.27606 1.2179-0.28202 1.6587-0.08527 1.4303 0.20687 2.9224 1.662 3.6429-2.3051-0.05275-5.3273-0.39212-6.28 1.8983-0.28073 0.66862-0.27595 1.2174-0.282 1.6572-0.10329 1.6061 0.3059 3.171 2.0252 3.8067 1.2061 0.4187 2.2175 0.2869 3.3945 0.3134 2.0524 0.0901 4.0448-0.4637 4.4796-2.4982 0.609 2.5638 3.2086 2.5463 5.3204 2.4982 2.7823 0.1278 4.7024-0.9368 4.5798-3.7329zm-12.899-7.6287c-0.14889-1.8665 1.8839-1.4921 3.1358-1.546 0.8939 0.05358 2.4743-0.21158 2.8003 0.88445 0.2729 2.4494-0.0297 2.8555-2.5242 2.8232-0.94713-0.07259-2.869 0.28949-3.3134-0.77077-0.14881-0.44557-0.08538-0.92893-0.09846-1.3909zm0.2606 9.2128c-0.56638 0.162-1.1652 0.1412-1.7487 0.1488-0.59786-0.0036-1.1977 0.0131-1.7948-0.0233-0.93407-0.0365-1.6776-0.3579-1.6157-1.4217 0.01574-0.5119-0.06845-1.0551 0.11822-1.5436 0.4432-0.84155 1.5978-0.6728 2.4032-0.7191 0.81712 0.01614 1.6464-0.05154 2.4536 0.10154 0.99382 0.17537 1.0564 0.91742 1.0227 1.7752-6.1e-4 0.7729 0.04085 1.416-0.83867 1.6821zm2.9212-3.6286c-0.0836 0.19457-0.14194 0.3848-0.18279 0.56614-0.18535-0.87758-0.76293-1.6189-1.5605-2.02 1.0871 0.04933 2.0387 0.04959 3.1216-8e-5 -0.7672 0.39034-1.1687 0.96486-1.3783 1.4539zm6.8788 3.6286c-0.5664 0.162-1.1652 0.1412-1.7488 0.1488-0.5978-0.0036-1.1977 0.0131-1.7947-0.0233-0.9341-0.0365-1.6776-0.3579-1.6157-1.4217 0.0157-0.5119-0.0685-1.0551 0.1182-1.5436 0.4432-0.84155 1.5978-0.6728 2.4033-0.7191 0.8171 0.01614 1.6464-0.05154 2.4536 0.10154 0.9938 0.17537 1.0563 0.91742 1.0227 1.7752-6e-4 0.7729 0.0409 1.416-0.8386 1.6821z"></path></svg>
            <p name="id">减肥</p>
          </span>
          <span class="link-icon ml-[0.5em] mr-[0.25em]">
            <svg xmlns="http://www.w3.org/2000/svg" width="0.9411764705882353em" height="0.9411764705882353em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class="untouchable"><path d="m9.5652 14.45 0.72891-2.0026c-0.651 0.00713-1.3027 0.00104-1.9532 0.00179-1.0991-0.02908-3.0336 0.08306-3.605-1.0524-0.28828-0.61588-0.2054-1.3226-0.22136-1.9833 0.00663-0.74044-0.05553-1.6362 0.5758-2.1558 0.70637-0.5555 1.7411-0.56129 2.6027-0.59834 0.743-0.015 1.4884-0.00764 2.2315-0.00868 0.68471 0.01536 1.6274-0.01783 2.4184 0.16762l0.68711-1.8879c-0.0146-0.003965-0.0287-0.00841-0.0435-0.01227-0.94653-0.24905-1.9355-0.25901-2.9083-0.26688-0.78352-1.3008e-4 -1.5692-0.0063751-2.3527 0.006805-1.2709 0.027555-2.6299 0.13739-3.6978 0.89566-1.6654 1.2031-1.53 2.9573-1.5068 4.79-0.0012251 1.7732 0.89765 3.2159 2.626 3.7562 0.80589 0.26191 1.6615 0.32018 2.5036 0.34101 0.6376 0.01106 1.2763 0.01096 1.9146 0.00915z" fill="currentColor"></path><path d="m14.589 9.125h1.3099c0.02865-0.88714-0.11774-1.6826-0.45594-2.3461l-0.85392 2.3461z" fill="currentColor"></path><path d="m15.587 12.025h-2.0527l-0.80604 2.2146c1.2326-0.27362 2.3169-0.88582 2.8588-2.2146z" fill="currentColor"></path><path d="m8.394 12.025h2.0538l0.82406-2.2641c-1.2457 0.2734-2.3327 0.8901-2.8779 2.2641z" fill="currentColor"></path><path d="m8.5566 17.221 0.83571-2.2961h-1.2914c-0.025394 0.86685 0.12295 1.645 0.45565 2.2961z" fill="currentColor"></path><path d="m21.485 14.399c7e-4 -0.67593 0.0063-1.3662-0.1779-2.0223-0.58881-2.115-2.5706-2.7532-4.5608-2.8041-0.76964-0.031175-1.5416-0.02264-2.3121-0.022365l-0.72832 2.0011c0.38557-0.00297 0.77131 7.6e-4 1.1559-0.00173 1.1244 0.02284 2.8396-0.10221 3.8152 0.44616 0.82512 0.45526 0.81194 1.4036 0.80798 2.2308-0.01538 0.64171 0.05949 1.3145-0.1601 1.93-0.39418 1.0145-1.651 1.1102-2.5915 1.1694-0.7426 0.03331-1.4884 0.0209-2.2315 0.02365-0.81334-0.01641-1.9395 0.04306-2.8448-0.16914l-0.68792 1.89c0.014845 0.00401 0.02915 0.0085 0.044115 0.0124 0.94522 0.24688 1.9316 0.25913 2.9027 0.2657 0.83456-2.2e-4 1.6713 0.00786 2.5057-0.00999 2.0286-0.02122 4.1491-0.51576 4.8438-2.6752 0.2358-0.7292 0.22-1.5067 0.2196-2.2644z" fill="currentColor"></path><path d="m14.979 6.7378c0.17824-0.52033 0.90905-2.4486 1.0626-2.9514 0.05601-0.19527 0.10768-0.39984 0.08232-0.60408-0.03096-0.33264-0.36035-0.4603-0.63671-0.55464-0.20794-0.070665-0.41593-0.17228-0.63943-0.174-0.33751 0.005805-0.52152 0.33878-0.64452 0.61072-1.4256 3.8005-4.7612 13.07-6.1617 16.891-0.10636 0.34-0.29285 0.7891-0.06874 1.1109 0.1296 0.1673 0.34386 0.232 0.53431 0.3042 0.30778 0.1107 0.70325 0.3075 0.98251 0.0365 0.14514-0.1339 0.23561-0.315 0.31595-0.4926 0.10005-0.2274 0.1811-0.4632 0.26694-0.6962 0.4854-1.3337 4.3257-11.885 4.9065-13.481z" fill="currentColor"></path></svg>
          </span>
          
          <span class="icon">
            <svg type="d" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m21.15 6.85c0-2.2056-1.7944-4-4-4-4.1765-0.01989-5.4993 5.7322-1.8147 7.5629-0.263 0.63631-0.4627 1.4421-0.6559 2.2215-0.1397 0.56337-0.2841 1.1459-0.4405 1.6084-0.0728 0.2155-0.1286 0.4813-0.1891 0.4813-0.5072-0.7362-0.8126-2.2507-1.0979-3.3161-0.47879-1.5358-0.72936-4.4237-2.8018-4.558-0.77422 7e-5 -1.3844 0.52253-1.8138 1.553-0.55019 1.254-0.75064 3.2421-1.3784 4.4472-0.39648 3e-4 -0.79576 0.0045-1.1877 0.0703-0.67978 0.1073-1.3339 0.4195-1.798 0.9347-0.39707 0.4315-0.6427 0.9874-0.74275 1.5623-0.063545 0.351-0.07691 0.7094-0.07883 1.0654 0.001935 0.4718-0.01324 0.9457 0.027745 1.4163 0.09435 1.151 0.65732 2.1308 1.7281 2.6237 0.43467 0.1975 0.91053 0.2877 1.3854 0.3129 0.40096 0.0215 0.80345 0.0129 1.2048 0.0139 0.6491 2e-4 1.2891-0.0515 1.888-0.3229 0.90042-0.4067 1.4845-1.2039 1.6712-2.1666 0.0761-0.3779 0.09179-0.7654 0.09344-1.15 7.7e-4 -0.2699 0.00148-0.5413-7.8e-4 -0.8111-0.00379-0.4854-0.04143-0.9771-0.19121-1.4414-0.28748-0.9172-0.98053-1.616-1.8964-1.909 0.43984-1.1576 0.66815-2.7594 1.1268-3.8895 0.3537 0.72804 0.57113 1.7669 0.82283 2.7298 0.26567 1.0724 0.5404 2.1814 0.90896 3.0557 0.87204 2.2985 3.1124 2.7586 4.0452 0.392 0.5508-1.2642 0.7508-3.279 1.3828-4.4916 2.1142-0.10339 3.8024-1.8557 3.8024-3.995zm-12.073 8.8023c0.05605 0.2275 0.06623 0.465 0.07092 0.6983 0.00363 0.2444 0.00195 0.4906 0.00214 0.735-0.0063 0.408 0.01486 0.882-0.18359 1.2496-0.24573 0.4539-0.8026 0.501-1.2651 0.5114-0.33714 0.0058-0.67525 0.0041-1.0124 0.0018-0.46455-0.0092-1.0361-0.0245-1.3192-0.4545-0.16612-0.2552-0.19733-0.5702-0.21202-0.8673-0.01004-0.2443-0.00683-0.4906-0.0075-0.735 5.9e-4 -0.2322-0.00201-0.4664 0.01171-0.6983 0.01886-0.2936 0.06332-0.6069 0.24969-0.8453 0.34185-0.4331 1.0226-0.3889 1.5228-0.3979 0.38828 0.0035 0.77905-0.0131 1.1658 0.0285 0.49865 0.0566 0.85211 0.2621 0.97684 0.7737zm8.0732-6.8023c-2.6379-0.06696-2.6373-3.9334 0-4 2.6378 0.06697 2.6373 3.9334 0 4z" fill="currentColor"></path></svg>
            <p name="id">损失函数</p>
          </span>
        </div>
      
<p>假设你想要减肥，你设定了一个目标：在接下来的三个月内减掉10公斤。在这个过程中，你每周都会称一次体重，记录下来，并与你的目标进行比较。</p>
<p>在这个例子中，你的“损失函数”可以看作是每次称重时与目标体重差距的大小。如果这个差距在减小，说明你的减肥计划正在取得进展；如果这个差距在增大或不变，说明你需要调整你的饮食或运动计划。</p>
<p>就像在机器学习中通过调整模型参数来最小化损失函数一样，你也可以通过调整你的饮食习惯和运动计划来“最小化”你的体重差距，更接近你的减肥目标。</p>

        <div class="evoldown" id="相关概念" type="c">
          <span class="icon">
            <svg type="c" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m6.825 4.8749c1.8175-0.03033 2.3249 0.02869 2.25 2.0152 0.01496 1.139 0.01338 1.984-1.3875 1.9798-1.6108-0.01491-2.7285 0.30288-2.6124-1.796-0.019-1.5193-0.04171-2.2697 1.7499-2.1989zm0-2c-2.5847-0.10689-3.8882 1.4181-3.7496 3.8782-0.058825 1.6262 0.20934 2.9456 1.5713 3.7018 0.98591 0.49526 1.6843 0.40204 2.4713 0.42016 0.661-0.00557 1.2079 0.02014 1.9275-0.21866 1.051-0.35295 1.7794-1.2693 1.9533-2.3675 0.08948-0.54803 0.07327-0.95095 0.0762-1.3975-0.00196-0.42752 0.01114-0.8053-0.05632-1.306-0.24162-1.9408-1.9089-2.8188-3.6634-2.7097-0.17686-7.9441e-4 -0.35349-2.3937e-4 -0.53038-7.7934e-4z" fill="currentColor"></path><path d="m17.075 8.6749c1.8175-0.03034 2.3249 0.02868 2.25 2.0152 0.01495 1.139 0.01338 1.984-1.3875 1.9797-1.6108-0.01491-2.7285 0.30288-2.6124-1.796-0.01899-1.5193-0.04171-2.2697 1.7499-2.1989zm0-2c-2.5847-0.10689-3.8882 1.4181-3.7496 3.8782-0.05882 1.6262 0.20933 2.9457 1.5713 3.7017 0.98593 0.49528 1.6843 0.40205 2.4713 0.42017 0.66099-0.00556 1.2079 0.02015 1.9275-0.21865 1.051-0.35295 1.7794-1.2693 1.9533-2.3675 0.08949-0.54803 0.07328-0.95095 0.07621-1.3975-0.00197-0.42839 0.0112-0.80698-0.05673-1.3089-0.24288-1.9391-1.9097-2.8158-3.663-2.7068-0.17688-7.9346e-4 -0.35351-2.388e-4 -0.5304-7.7896e-4z" fill="currentColor"></path><path d="m8.4749 15.525c1.8175-0.03033 2.3249 0.02868 2.25 2.0152 0.01496 1.139 0.01338 1.984-1.3875 1.9797-1.6108-0.01491-2.7285 0.30288-2.6124-1.796-0.01899-1.5193-0.04172-2.2697 1.7499-2.1989zm0-2c-2.5847-0.10689-3.8882 1.4181-3.7496 3.8782-0.058825 1.6262 0.20934 2.9456 1.5713 3.7018 0.98591 0.49526 1.6843 0.40203 2.4713 0.42016 0.66099-0.00557 1.2079 0.02014 1.9276-0.21866 1.051-0.35294 1.7794-1.2693 1.9533-2.3675 0.08949-0.54803 0.07328-0.95095 0.07621-1.3975-0.00197-0.42753 0.01113-0.80529-0.05633-1.306-0.24162-1.9408-1.9089-2.8188-3.6634-2.7097-0.17688-7.9346e-4 -0.35351-2.4262e-4 -0.5304-7.8736e-4z" fill="currentColor"></path></svg>
            <p name="label">补充</p>
            <p name="id">相关概念</p>
          </span>
        </div>
      
<p><strong>损失函数会影响的概念：</strong></p>
<ol>
<li><strong>优化器（Optimizer）</strong>：优化器使用损失函数的梯度来更新模型的参数，以减少损失。不同的优化器（如SGD、Adam）可能会对损失函数的下降速度和稳定性产生不同的影响。</li>
<li><strong>正则化（Regularization）</strong>：正则化项可以添加到损失函数中，以防止模型过拟合。正则化如L1、L2会影响损失函数的形式和模型的最终性能。</li>
<li><strong>学习率（Learning Rate）</strong>：学习率决定了在优化过程中参数更新的步长大小。它直接影响损失函数下降的速度和是否能够收敛到最小值。</li>
</ol>
<p><strong>影响损失函数的概念：</strong></p>
<ol>
<li><strong>模型复杂度（Model Complexity）</strong>：模型的复杂度决定了其拟合数据的能力。过于复杂的模型可能导致过拟合，这时即使损失函数在训练集上很低，也可能在测试集上表现不佳。</li>
<li><strong>数据预处理（Data Preprocessing）</strong>：数据的预处理方式（如标准化、归一化）会影响模型的学习过程，进而影响损失函数的表现。不同的数据分布可能需要不同的损失函数。</li>
<li><strong>特征工程（Feature Engineering）</strong>：有效的特征工程可以提高模型的性能，减少损失。选择和构造与预测任务高度相关的特征可以使损失函数更有效地指导模型学习。</li>
</ol>

        <div class="evoldown" id="优化器" type="d">
          <span class="icon">
            <svg type="d" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m21.15 6.85c0-2.2056-1.7944-4-4-4-4.1765-0.01989-5.4993 5.7322-1.8147 7.5629-0.263 0.63631-0.4627 1.4421-0.6559 2.2215-0.1397 0.56337-0.2841 1.1459-0.4405 1.6084-0.0728 0.2155-0.1286 0.4813-0.1891 0.4813-0.5072-0.7362-0.8126-2.2507-1.0979-3.3161-0.47879-1.5358-0.72936-4.4237-2.8018-4.558-0.77422 7e-5 -1.3844 0.52253-1.8138 1.553-0.55019 1.254-0.75064 3.2421-1.3784 4.4472-0.39648 3e-4 -0.79576 0.0045-1.1877 0.0703-0.67978 0.1073-1.3339 0.4195-1.798 0.9347-0.39707 0.4315-0.6427 0.9874-0.74275 1.5623-0.063545 0.351-0.07691 0.7094-0.07883 1.0654 0.001935 0.4718-0.01324 0.9457 0.027745 1.4163 0.09435 1.151 0.65732 2.1308 1.7281 2.6237 0.43467 0.1975 0.91053 0.2877 1.3854 0.3129 0.40096 0.0215 0.80345 0.0129 1.2048 0.0139 0.6491 2e-4 1.2891-0.0515 1.888-0.3229 0.90042-0.4067 1.4845-1.2039 1.6712-2.1666 0.0761-0.3779 0.09179-0.7654 0.09344-1.15 7.7e-4 -0.2699 0.00148-0.5413-7.8e-4 -0.8111-0.00379-0.4854-0.04143-0.9771-0.19121-1.4414-0.28748-0.9172-0.98053-1.616-1.8964-1.909 0.43984-1.1576 0.66815-2.7594 1.1268-3.8895 0.3537 0.72804 0.57113 1.7669 0.82283 2.7298 0.26567 1.0724 0.5404 2.1814 0.90896 3.0557 0.87204 2.2985 3.1124 2.7586 4.0452 0.392 0.5508-1.2642 0.7508-3.279 1.3828-4.4916 2.1142-0.10339 3.8024-1.8557 3.8024-3.995zm-12.073 8.8023c0.05605 0.2275 0.06623 0.465 0.07092 0.6983 0.00363 0.2444 0.00195 0.4906 0.00214 0.735-0.0063 0.408 0.01486 0.882-0.18359 1.2496-0.24573 0.4539-0.8026 0.501-1.2651 0.5114-0.33714 0.0058-0.67525 0.0041-1.0124 0.0018-0.46455-0.0092-1.0361-0.0245-1.3192-0.4545-0.16612-0.2552-0.19733-0.5702-0.21202-0.8673-0.01004-0.2443-0.00683-0.4906-0.0075-0.735 5.9e-4 -0.2322-0.00201-0.4664 0.01171-0.6983 0.01886-0.2936 0.06332-0.6069 0.24969-0.8453 0.34185-0.4331 1.0226-0.3889 1.5228-0.3979 0.38828 0.0035 0.77905-0.0131 1.1658 0.0285 0.49865 0.0566 0.85211 0.2621 0.97684 0.7737zm8.0732-6.8023c-2.6379-0.06696-2.6373-3.9334 0-4 2.6378 0.06697 2.6373 3.9334 0 4z" fill="currentColor"></path></svg>
            <p name="id">优化器</p>
          </span>
        </div>
      
<p>优化器（Optimizer）是机器学习和深度学习中用于更新和调整模型参数（如权重和偏置），以最小化损失函数的算法。优化器的目的是找到损失函数的最小值，从而提高模型的预测准确性。</p>
<p><strong>创造优化器解决的问题：</strong></p>
<ol>
<li><strong>参数更新</strong>：在模型训练过程中，需要一种方法来决定如何更新模型的参数，以便于模型能够学习到数据的特征和规律。优化器提供了这样一种方法。</li>
<li><strong>收敛速度</strong>：不同的优化算法会影响模型训练的速度。一些优化器能够加快模型收敛的速度，使训练过程更高效。</li>
<li><strong>避免局部最小值</strong>：在复杂的损失函数中，可能存在多个局部最小值。优化器的设计旨在帮助模型避免陷入局部最小值，寻找到全局最小值或较好的局部最小值。</li>
</ol>
<p><strong>没有优化器会导致的结果：</strong></p>
<ol>
<li><strong>无法有效更新模型参数</strong>：没有优化器，我们将缺乏一种系统性的方法来调整模型参数，这将导致模型无法从训练数据中学习。</li>
<li><strong>训练效率低下</strong>：即使可以手动调整模型参数，但这种方法效率极低，且难以找到损失函数的最小值，导致训练时间长，效果差。</li>
<li><strong>模型性能不佳</strong>：缺乏有效的优化策略，模型可能无法达到较好的性能，特别是在处理复杂任务和大规模数据集时</li>
</ol>

        <div class="evoldown" id="深度学习中优化器" type="e">
          <span class="icon">
            <svg type="e" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path fill="currentColor" d="m21.9 15.621c0.1248-1.8535-0.6087-3.4099-2.6058-3.8292-0.7712-0.15744-1.3921-0.13977-2.1113-0.14543-0.6323 0.0048-1.1718-0.01567-1.8401 0.03203 1.5356-0.8078 1.6998-2.205 1.6567-3.546 0.1272-2.3708-1.4685-3.666-3.7727-3.673-2.2427-0.04024-5.0463-0.27229-5.9443 1.9172-0.28083 0.6692-0.27606 1.2179-0.28202 1.6587-0.08527 1.4303 0.20687 2.9224 1.662 3.6429-2.3051-0.05275-5.3273-0.39212-6.28 1.8983-0.28073 0.66862-0.27595 1.2174-0.282 1.6572-0.10329 1.6061 0.3059 3.171 2.0252 3.8067 1.2061 0.4187 2.2175 0.2869 3.3945 0.3134 2.0524 0.0901 4.0448-0.4637 4.4796-2.4982 0.609 2.5638 3.2086 2.5463 5.3204 2.4982 2.7823 0.1278 4.7024-0.9368 4.5798-3.7329zm-12.899-7.6287c-0.14889-1.8665 1.8839-1.4921 3.1358-1.546 0.8939 0.05358 2.4743-0.21158 2.8003 0.88445 0.2729 2.4494-0.0297 2.8555-2.5242 2.8232-0.94713-0.07259-2.869 0.28949-3.3134-0.77077-0.14881-0.44557-0.08538-0.92893-0.09846-1.3909zm0.2606 9.2128c-0.56638 0.162-1.1652 0.1412-1.7487 0.1488-0.59786-0.0036-1.1977 0.0131-1.7948-0.0233-0.93407-0.0365-1.6776-0.3579-1.6157-1.4217 0.01574-0.5119-0.06845-1.0551 0.11822-1.5436 0.4432-0.84155 1.5978-0.6728 2.4032-0.7191 0.81712 0.01614 1.6464-0.05154 2.4536 0.10154 0.99382 0.17537 1.0564 0.91742 1.0227 1.7752-6.1e-4 0.7729 0.04085 1.416-0.83867 1.6821zm2.9212-3.6286c-0.0836 0.19457-0.14194 0.3848-0.18279 0.56614-0.18535-0.87758-0.76293-1.6189-1.5605-2.02 1.0871 0.04933 2.0387 0.04959 3.1216-8e-5 -0.7672 0.39034-1.1687 0.96486-1.3783 1.4539zm6.8788 3.6286c-0.5664 0.162-1.1652 0.1412-1.7488 0.1488-0.5978-0.0036-1.1977 0.0131-1.7947-0.0233-0.9341-0.0365-1.6776-0.3579-1.6157-1.4217 0.0157-0.5119-0.0685-1.0551 0.1182-1.5436 0.4432-0.84155 1.5978-0.6728 2.4033-0.7191 0.8171 0.01614 1.6464-0.05154 2.4536 0.10154 0.9938 0.17537 1.0563 0.91742 1.0227 1.7752-6e-4 0.7729 0.0409 1.416-0.8386 1.6821z"></path></svg>
            <p name="id">深度学习中优化器</p>
          </span>
          <span class="link-icon ml-[0.5em] mr-[0.25em]">
            <svg xmlns="http://www.w3.org/2000/svg" width="0.9411764705882353em" height="0.9411764705882353em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class="untouchable"><path d="m9.5652 14.45 0.72891-2.0026c-0.651 0.00713-1.3027 0.00104-1.9532 0.00179-1.0991-0.02908-3.0336 0.08306-3.605-1.0524-0.28828-0.61588-0.2054-1.3226-0.22136-1.9833 0.00663-0.74044-0.05553-1.6362 0.5758-2.1558 0.70637-0.5555 1.7411-0.56129 2.6027-0.59834 0.743-0.015 1.4884-0.00764 2.2315-0.00868 0.68471 0.01536 1.6274-0.01783 2.4184 0.16762l0.68711-1.8879c-0.0146-0.003965-0.0287-0.00841-0.0435-0.01227-0.94653-0.24905-1.9355-0.25901-2.9083-0.26688-0.78352-1.3008e-4 -1.5692-0.0063751-2.3527 0.006805-1.2709 0.027555-2.6299 0.13739-3.6978 0.89566-1.6654 1.2031-1.53 2.9573-1.5068 4.79-0.0012251 1.7732 0.89765 3.2159 2.626 3.7562 0.80589 0.26191 1.6615 0.32018 2.5036 0.34101 0.6376 0.01106 1.2763 0.01096 1.9146 0.00915z" fill="currentColor"></path><path d="m14.589 9.125h1.3099c0.02865-0.88714-0.11774-1.6826-0.45594-2.3461l-0.85392 2.3461z" fill="currentColor"></path><path d="m15.587 12.025h-2.0527l-0.80604 2.2146c1.2326-0.27362 2.3169-0.88582 2.8588-2.2146z" fill="currentColor"></path><path d="m8.394 12.025h2.0538l0.82406-2.2641c-1.2457 0.2734-2.3327 0.8901-2.8779 2.2641z" fill="currentColor"></path><path d="m8.5566 17.221 0.83571-2.2961h-1.2914c-0.025394 0.86685 0.12295 1.645 0.45565 2.2961z" fill="currentColor"></path><path d="m21.485 14.399c7e-4 -0.67593 0.0063-1.3662-0.1779-2.0223-0.58881-2.115-2.5706-2.7532-4.5608-2.8041-0.76964-0.031175-1.5416-0.02264-2.3121-0.022365l-0.72832 2.0011c0.38557-0.00297 0.77131 7.6e-4 1.1559-0.00173 1.1244 0.02284 2.8396-0.10221 3.8152 0.44616 0.82512 0.45526 0.81194 1.4036 0.80798 2.2308-0.01538 0.64171 0.05949 1.3145-0.1601 1.93-0.39418 1.0145-1.651 1.1102-2.5915 1.1694-0.7426 0.03331-1.4884 0.0209-2.2315 0.02365-0.81334-0.01641-1.9395 0.04306-2.8448-0.16914l-0.68792 1.89c0.014845 0.00401 0.02915 0.0085 0.044115 0.0124 0.94522 0.24688 1.9316 0.25913 2.9027 0.2657 0.83456-2.2e-4 1.6713 0.00786 2.5057-0.00999 2.0286-0.02122 4.1491-0.51576 4.8438-2.6752 0.2358-0.7292 0.22-1.5067 0.2196-2.2644z" fill="currentColor"></path><path d="m14.979 6.7378c0.17824-0.52033 0.90905-2.4486 1.0626-2.9514 0.05601-0.19527 0.10768-0.39984 0.08232-0.60408-0.03096-0.33264-0.36035-0.4603-0.63671-0.55464-0.20794-0.070665-0.41593-0.17228-0.63943-0.174-0.33751 0.005805-0.52152 0.33878-0.64452 0.61072-1.4256 3.8005-4.7612 13.07-6.1617 16.891-0.10636 0.34-0.29285 0.7891-0.06874 1.1109 0.1296 0.1673 0.34386 0.232 0.53431 0.3042 0.30778 0.1107 0.70325 0.3075 0.98251 0.0365 0.14514-0.1339 0.23561-0.315 0.31595-0.4926 0.10005-0.2274 0.1811-0.4632 0.26694-0.6962 0.4854-1.3337 4.3257-11.885 4.9065-13.481z" fill="currentColor"></path></svg>
          </span>
          
          <span class="icon">
            <svg type="d" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m21.15 6.85c0-2.2056-1.7944-4-4-4-4.1765-0.01989-5.4993 5.7322-1.8147 7.5629-0.263 0.63631-0.4627 1.4421-0.6559 2.2215-0.1397 0.56337-0.2841 1.1459-0.4405 1.6084-0.0728 0.2155-0.1286 0.4813-0.1891 0.4813-0.5072-0.7362-0.8126-2.2507-1.0979-3.3161-0.47879-1.5358-0.72936-4.4237-2.8018-4.558-0.77422 7e-5 -1.3844 0.52253-1.8138 1.553-0.55019 1.254-0.75064 3.2421-1.3784 4.4472-0.39648 3e-4 -0.79576 0.0045-1.1877 0.0703-0.67978 0.1073-1.3339 0.4195-1.798 0.9347-0.39707 0.4315-0.6427 0.9874-0.74275 1.5623-0.063545 0.351-0.07691 0.7094-0.07883 1.0654 0.001935 0.4718-0.01324 0.9457 0.027745 1.4163 0.09435 1.151 0.65732 2.1308 1.7281 2.6237 0.43467 0.1975 0.91053 0.2877 1.3854 0.3129 0.40096 0.0215 0.80345 0.0129 1.2048 0.0139 0.6491 2e-4 1.2891-0.0515 1.888-0.3229 0.90042-0.4067 1.4845-1.2039 1.6712-2.1666 0.0761-0.3779 0.09179-0.7654 0.09344-1.15 7.7e-4 -0.2699 0.00148-0.5413-7.8e-4 -0.8111-0.00379-0.4854-0.04143-0.9771-0.19121-1.4414-0.28748-0.9172-0.98053-1.616-1.8964-1.909 0.43984-1.1576 0.66815-2.7594 1.1268-3.8895 0.3537 0.72804 0.57113 1.7669 0.82283 2.7298 0.26567 1.0724 0.5404 2.1814 0.90896 3.0557 0.87204 2.2985 3.1124 2.7586 4.0452 0.392 0.5508-1.2642 0.7508-3.279 1.3828-4.4916 2.1142-0.10339 3.8024-1.8557 3.8024-3.995zm-12.073 8.8023c0.05605 0.2275 0.06623 0.465 0.07092 0.6983 0.00363 0.2444 0.00195 0.4906 0.00214 0.735-0.0063 0.408 0.01486 0.882-0.18359 1.2496-0.24573 0.4539-0.8026 0.501-1.2651 0.5114-0.33714 0.0058-0.67525 0.0041-1.0124 0.0018-0.46455-0.0092-1.0361-0.0245-1.3192-0.4545-0.16612-0.2552-0.19733-0.5702-0.21202-0.8673-0.01004-0.2443-0.00683-0.4906-0.0075-0.735 5.9e-4 -0.2322-0.00201-0.4664 0.01171-0.6983 0.01886-0.2936 0.06332-0.6069 0.24969-0.8453 0.34185-0.4331 1.0226-0.3889 1.5228-0.3979 0.38828 0.0035 0.77905-0.0131 1.1658 0.0285 0.49865 0.0566 0.85211 0.2621 0.97684 0.7737zm8.0732-6.8023c-2.6379-0.06696-2.6373-3.9334 0-4 2.6378 0.06697 2.6373 3.9334 0 4z" fill="currentColor"></path></svg>
            <p name="id">优化器</p>
          </span>
        </div>
      
<p>在深度学习模型训练过程中，优化器负责调整模型的权重，以最小化损失函数。假设我们正在训练一个用于图像分类的卷积神经网络（CNN）。我们选择Adam优化器，因为它结合了动量（Momentum）和自适应学习率（AdaGrad）的优点，适合处理大规模数据和参数的优化问题。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torch
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">as</span> nn
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>optim <span class="token keyword">as</span> optim

model <span class="token operator">=</span> MyCNN<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 假设MyCNN是我们定义的卷积神经网络</span>
criterion <span class="token operator">=</span> nn<span class="token punctuation">.</span>CrossEntropyLoss<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 选择交叉熵损失函数</span>
optimizer <span class="token operator">=</span> optim<span class="token punctuation">.</span>Adam<span class="token punctuation">(</span>model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span><span class="token number">0.001</span><span class="token punctuation">)</span>  <span class="token comment"># 使用Adam优化器，学习率设置为0.001</span>

<span class="token comment"># 训练模型的简化代码</span>
<span class="token keyword">for</span> epoch <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num_epochs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> inputs<span class="token punctuation">,</span> labels <span class="token keyword">in</span> dataloader<span class="token punctuation">:</span>
        optimizer<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 清空之前的梯度</span>
        outputs <span class="token operator">=</span> model<span class="token punctuation">(</span>inputs<span class="token punctuation">)</span>  <span class="token comment"># 前向传播</span>
        loss <span class="token operator">=</span> criterion<span class="token punctuation">(</span>outputs<span class="token punctuation">,</span> labels<span class="token punctuation">)</span>  <span class="token comment"># 计算损失</span>
        loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 反向传播，计算梯度</span>
        optimizer<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 更新权重</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>优化器<code>Adam</code>负责在每次迭代中更新模型的权重，以减少损失函数的值，从而提高模型在图像分类任务上的准确率。</p>

        <div class="evoldown" id="减肥计划" type="e">
          <span class="icon">
            <svg type="e" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path fill="currentColor" d="m21.9 15.621c0.1248-1.8535-0.6087-3.4099-2.6058-3.8292-0.7712-0.15744-1.3921-0.13977-2.1113-0.14543-0.6323 0.0048-1.1718-0.01567-1.8401 0.03203 1.5356-0.8078 1.6998-2.205 1.6567-3.546 0.1272-2.3708-1.4685-3.666-3.7727-3.673-2.2427-0.04024-5.0463-0.27229-5.9443 1.9172-0.28083 0.6692-0.27606 1.2179-0.28202 1.6587-0.08527 1.4303 0.20687 2.9224 1.662 3.6429-2.3051-0.05275-5.3273-0.39212-6.28 1.8983-0.28073 0.66862-0.27595 1.2174-0.282 1.6572-0.10329 1.6061 0.3059 3.171 2.0252 3.8067 1.2061 0.4187 2.2175 0.2869 3.3945 0.3134 2.0524 0.0901 4.0448-0.4637 4.4796-2.4982 0.609 2.5638 3.2086 2.5463 5.3204 2.4982 2.7823 0.1278 4.7024-0.9368 4.5798-3.7329zm-12.899-7.6287c-0.14889-1.8665 1.8839-1.4921 3.1358-1.546 0.8939 0.05358 2.4743-0.21158 2.8003 0.88445 0.2729 2.4494-0.0297 2.8555-2.5242 2.8232-0.94713-0.07259-2.869 0.28949-3.3134-0.77077-0.14881-0.44557-0.08538-0.92893-0.09846-1.3909zm0.2606 9.2128c-0.56638 0.162-1.1652 0.1412-1.7487 0.1488-0.59786-0.0036-1.1977 0.0131-1.7948-0.0233-0.93407-0.0365-1.6776-0.3579-1.6157-1.4217 0.01574-0.5119-0.06845-1.0551 0.11822-1.5436 0.4432-0.84155 1.5978-0.6728 2.4032-0.7191 0.81712 0.01614 1.6464-0.05154 2.4536 0.10154 0.99382 0.17537 1.0564 0.91742 1.0227 1.7752-6.1e-4 0.7729 0.04085 1.416-0.83867 1.6821zm2.9212-3.6286c-0.0836 0.19457-0.14194 0.3848-0.18279 0.56614-0.18535-0.87758-0.76293-1.6189-1.5605-2.02 1.0871 0.04933 2.0387 0.04959 3.1216-8e-5 -0.7672 0.39034-1.1687 0.96486-1.3783 1.4539zm6.8788 3.6286c-0.5664 0.162-1.1652 0.1412-1.7488 0.1488-0.5978-0.0036-1.1977 0.0131-1.7947-0.0233-0.9341-0.0365-1.6776-0.3579-1.6157-1.4217 0.0157-0.5119-0.0685-1.0551 0.1182-1.5436 0.4432-0.84155 1.5978-0.6728 2.4033-0.7191 0.8171 0.01614 1.6464-0.05154 2.4536 0.10154 0.9938 0.17537 1.0563 0.91742 1.0227 1.7752-6e-4 0.7729 0.0409 1.416-0.8386 1.6821z"></path></svg>
            <p name="id">减肥计划</p>
          </span>
          <span class="link-icon ml-[0.5em] mr-[0.25em]">
            <svg xmlns="http://www.w3.org/2000/svg" width="0.9411764705882353em" height="0.9411764705882353em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class="untouchable"><path d="m9.5652 14.45 0.72891-2.0026c-0.651 0.00713-1.3027 0.00104-1.9532 0.00179-1.0991-0.02908-3.0336 0.08306-3.605-1.0524-0.28828-0.61588-0.2054-1.3226-0.22136-1.9833 0.00663-0.74044-0.05553-1.6362 0.5758-2.1558 0.70637-0.5555 1.7411-0.56129 2.6027-0.59834 0.743-0.015 1.4884-0.00764 2.2315-0.00868 0.68471 0.01536 1.6274-0.01783 2.4184 0.16762l0.68711-1.8879c-0.0146-0.003965-0.0287-0.00841-0.0435-0.01227-0.94653-0.24905-1.9355-0.25901-2.9083-0.26688-0.78352-1.3008e-4 -1.5692-0.0063751-2.3527 0.006805-1.2709 0.027555-2.6299 0.13739-3.6978 0.89566-1.6654 1.2031-1.53 2.9573-1.5068 4.79-0.0012251 1.7732 0.89765 3.2159 2.626 3.7562 0.80589 0.26191 1.6615 0.32018 2.5036 0.34101 0.6376 0.01106 1.2763 0.01096 1.9146 0.00915z" fill="currentColor"></path><path d="m14.589 9.125h1.3099c0.02865-0.88714-0.11774-1.6826-0.45594-2.3461l-0.85392 2.3461z" fill="currentColor"></path><path d="m15.587 12.025h-2.0527l-0.80604 2.2146c1.2326-0.27362 2.3169-0.88582 2.8588-2.2146z" fill="currentColor"></path><path d="m8.394 12.025h2.0538l0.82406-2.2641c-1.2457 0.2734-2.3327 0.8901-2.8779 2.2641z" fill="currentColor"></path><path d="m8.5566 17.221 0.83571-2.2961h-1.2914c-0.025394 0.86685 0.12295 1.645 0.45565 2.2961z" fill="currentColor"></path><path d="m21.485 14.399c7e-4 -0.67593 0.0063-1.3662-0.1779-2.0223-0.58881-2.115-2.5706-2.7532-4.5608-2.8041-0.76964-0.031175-1.5416-0.02264-2.3121-0.022365l-0.72832 2.0011c0.38557-0.00297 0.77131 7.6e-4 1.1559-0.00173 1.1244 0.02284 2.8396-0.10221 3.8152 0.44616 0.82512 0.45526 0.81194 1.4036 0.80798 2.2308-0.01538 0.64171 0.05949 1.3145-0.1601 1.93-0.39418 1.0145-1.651 1.1102-2.5915 1.1694-0.7426 0.03331-1.4884 0.0209-2.2315 0.02365-0.81334-0.01641-1.9395 0.04306-2.8448-0.16914l-0.68792 1.89c0.014845 0.00401 0.02915 0.0085 0.044115 0.0124 0.94522 0.24688 1.9316 0.25913 2.9027 0.2657 0.83456-2.2e-4 1.6713 0.00786 2.5057-0.00999 2.0286-0.02122 4.1491-0.51576 4.8438-2.6752 0.2358-0.7292 0.22-1.5067 0.2196-2.2644z" fill="currentColor"></path><path d="m14.979 6.7378c0.17824-0.52033 0.90905-2.4486 1.0626-2.9514 0.05601-0.19527 0.10768-0.39984 0.08232-0.60408-0.03096-0.33264-0.36035-0.4603-0.63671-0.55464-0.20794-0.070665-0.41593-0.17228-0.63943-0.174-0.33751 0.005805-0.52152 0.33878-0.64452 0.61072-1.4256 3.8005-4.7612 13.07-6.1617 16.891-0.10636 0.34-0.29285 0.7891-0.06874 1.1109 0.1296 0.1673 0.34386 0.232 0.53431 0.3042 0.30778 0.1107 0.70325 0.3075 0.98251 0.0365 0.14514-0.1339 0.23561-0.315 0.31595-0.4926 0.10005-0.2274 0.1811-0.4632 0.26694-0.6962 0.4854-1.3337 4.3257-11.885 4.9065-13.481z" fill="currentColor"></path></svg>
          </span>
          
          <span class="icon">
            <svg type="d" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m21.15 6.85c0-2.2056-1.7944-4-4-4-4.1765-0.01989-5.4993 5.7322-1.8147 7.5629-0.263 0.63631-0.4627 1.4421-0.6559 2.2215-0.1397 0.56337-0.2841 1.1459-0.4405 1.6084-0.0728 0.2155-0.1286 0.4813-0.1891 0.4813-0.5072-0.7362-0.8126-2.2507-1.0979-3.3161-0.47879-1.5358-0.72936-4.4237-2.8018-4.558-0.77422 7e-5 -1.3844 0.52253-1.8138 1.553-0.55019 1.254-0.75064 3.2421-1.3784 4.4472-0.39648 3e-4 -0.79576 0.0045-1.1877 0.0703-0.67978 0.1073-1.3339 0.4195-1.798 0.9347-0.39707 0.4315-0.6427 0.9874-0.74275 1.5623-0.063545 0.351-0.07691 0.7094-0.07883 1.0654 0.001935 0.4718-0.01324 0.9457 0.027745 1.4163 0.09435 1.151 0.65732 2.1308 1.7281 2.6237 0.43467 0.1975 0.91053 0.2877 1.3854 0.3129 0.40096 0.0215 0.80345 0.0129 1.2048 0.0139 0.6491 2e-4 1.2891-0.0515 1.888-0.3229 0.90042-0.4067 1.4845-1.2039 1.6712-2.1666 0.0761-0.3779 0.09179-0.7654 0.09344-1.15 7.7e-4 -0.2699 0.00148-0.5413-7.8e-4 -0.8111-0.00379-0.4854-0.04143-0.9771-0.19121-1.4414-0.28748-0.9172-0.98053-1.616-1.8964-1.909 0.43984-1.1576 0.66815-2.7594 1.1268-3.8895 0.3537 0.72804 0.57113 1.7669 0.82283 2.7298 0.26567 1.0724 0.5404 2.1814 0.90896 3.0557 0.87204 2.2985 3.1124 2.7586 4.0452 0.392 0.5508-1.2642 0.7508-3.279 1.3828-4.4916 2.1142-0.10339 3.8024-1.8557 3.8024-3.995zm-12.073 8.8023c0.05605 0.2275 0.06623 0.465 0.07092 0.6983 0.00363 0.2444 0.00195 0.4906 0.00214 0.735-0.0063 0.408 0.01486 0.882-0.18359 1.2496-0.24573 0.4539-0.8026 0.501-1.2651 0.5114-0.33714 0.0058-0.67525 0.0041-1.0124 0.0018-0.46455-0.0092-1.0361-0.0245-1.3192-0.4545-0.16612-0.2552-0.19733-0.5702-0.21202-0.8673-0.01004-0.2443-0.00683-0.4906-0.0075-0.735 5.9e-4 -0.2322-0.00201-0.4664 0.01171-0.6983 0.01886-0.2936 0.06332-0.6069 0.24969-0.8453 0.34185-0.4331 1.0226-0.3889 1.5228-0.3979 0.38828 0.0035 0.77905-0.0131 1.1658 0.0285 0.49865 0.0566 0.85211 0.2621 0.97684 0.7737zm8.0732-6.8023c-2.6379-0.06696-2.6373-3.9334 0-4 2.6378 0.06697 2.6373 3.9334 0 4z" fill="currentColor"></path></svg>
            <p name="id">优化器</p>
          </span>
        </div>
      
<p>假设你正在尝试减肥，并设定了一个目标：在三个月内减重8公斤。你的“优化器”就是你制定的减肥计划，包括饮食控制和运动计划。</p>
<ul>
<li><strong>初始计划</strong>：你开始时决定每天跑步30分钟，每周五天，同时减少碳水化合物的摄入。</li>
<li><strong>调整策略</strong>：两周后，你发现体重下降速度不如预期，于是你决定增加运动量，改为每天跑步45分钟，并且加入两天的力量训练。</li>
<li><strong>反馈调整</strong>：每周通过称重来评估减肥效果，根据体重变化调整饮食和运动计划。</li>
</ul>
<p>在这个过程中，你不断地根据体重变化（相当于“损失函数”）调整你的减肥计划（“优化器”），以期达到减重的目标。这个过程类似于在机器学习中使用优化器调整模型参数，以最小化损失函数。</p>

        <div class="evoldown" id="相关概念" type="c">
          <span class="icon">
            <svg type="c" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m6.825 4.8749c1.8175-0.03033 2.3249 0.02869 2.25 2.0152 0.01496 1.139 0.01338 1.984-1.3875 1.9798-1.6108-0.01491-2.7285 0.30288-2.6124-1.796-0.019-1.5193-0.04171-2.2697 1.7499-2.1989zm0-2c-2.5847-0.10689-3.8882 1.4181-3.7496 3.8782-0.058825 1.6262 0.20934 2.9456 1.5713 3.7018 0.98591 0.49526 1.6843 0.40204 2.4713 0.42016 0.661-0.00557 1.2079 0.02014 1.9275-0.21866 1.051-0.35295 1.7794-1.2693 1.9533-2.3675 0.08948-0.54803 0.07327-0.95095 0.0762-1.3975-0.00196-0.42752 0.01114-0.8053-0.05632-1.306-0.24162-1.9408-1.9089-2.8188-3.6634-2.7097-0.17686-7.9441e-4 -0.35349-2.3937e-4 -0.53038-7.7934e-4z" fill="currentColor"></path><path d="m17.075 8.6749c1.8175-0.03034 2.3249 0.02868 2.25 2.0152 0.01495 1.139 0.01338 1.984-1.3875 1.9797-1.6108-0.01491-2.7285 0.30288-2.6124-1.796-0.01899-1.5193-0.04171-2.2697 1.7499-2.1989zm0-2c-2.5847-0.10689-3.8882 1.4181-3.7496 3.8782-0.05882 1.6262 0.20933 2.9457 1.5713 3.7017 0.98593 0.49528 1.6843 0.40205 2.4713 0.42017 0.66099-0.00556 1.2079 0.02015 1.9275-0.21865 1.051-0.35295 1.7794-1.2693 1.9533-2.3675 0.08949-0.54803 0.07328-0.95095 0.07621-1.3975-0.00197-0.42839 0.0112-0.80698-0.05673-1.3089-0.24288-1.9391-1.9097-2.8158-3.663-2.7068-0.17688-7.9346e-4 -0.35351-2.388e-4 -0.5304-7.7896e-4z" fill="currentColor"></path><path d="m8.4749 15.525c1.8175-0.03033 2.3249 0.02868 2.25 2.0152 0.01496 1.139 0.01338 1.984-1.3875 1.9797-1.6108-0.01491-2.7285 0.30288-2.6124-1.796-0.01899-1.5193-0.04172-2.2697 1.7499-2.1989zm0-2c-2.5847-0.10689-3.8882 1.4181-3.7496 3.8782-0.058825 1.6262 0.20934 2.9456 1.5713 3.7018 0.98591 0.49526 1.6843 0.40203 2.4713 0.42016 0.66099-0.00557 1.2079 0.02014 1.9276-0.21866 1.051-0.35294 1.7794-1.2693 1.9533-2.3675 0.08949-0.54803 0.07328-0.95095 0.07621-1.3975-0.00197-0.42753 0.01113-0.80529-0.05633-1.306-0.24162-1.9408-1.9089-2.8188-3.6634-2.7097-0.17688-7.9346e-4 -0.35351-2.4262e-4 -0.5304-7.8736e-4z" fill="currentColor"></path></svg>
            <p name="label">关联</p>
            <p name="id">相关概念</p>
          </span>
        </div>
      
<p><strong>「优化器」影响的概念：</strong></p>
<ol>
<li><strong>学习率（Learning Rate）</strong>：优化器通过学习率控制参数更新的步长。学习率太高可能导致训练不稳定，太低则训练速度缓慢。</li>
<li><strong>动量（Momentum）</strong>：动量帮助优化器在正确的方向上加速，减少震荡，从而更快地收敛。</li>
<li><strong>正则化（Regularization）</strong>：虽然正则化通常定义在损失函数中，但它也影响优化器的行为，因为优化器需要考虑正则化项来更新参数，以防止过拟合。</li>
<li><strong>学习率调度器（Learning Rate Scheduler）</strong>：调度器根据预设策略调整学习率，优化器需要根据这些调整来更新参数。这有助于在训练的不同阶段采取不同的学习策略。</li>
</ol>
<p><strong>影响「优化器」的概念：</strong></p>
<ol>
<li><strong>损失函数（Loss Function）</strong>：优化器的目标是最小化损失函数。不同的损失函数可能会导致优化器的行为差异，因为损失函数的形状直接影响梯度的计算。</li>
<li><strong>模型复杂度（Model Complexity）</strong>：模型的复杂度决定了优化过程的难度。复杂模型可能有更多的局部最小值，这对优化器的选择和配置提出了挑战。</li>
<li><strong>数据预处理（Data Preprocessing）</strong>：数据的规模和分布会影响梯度的计算，进而影响优化器的效率和策略。例如，未经归一化的数据可能导致训练过程不稳定。</li>
<li><strong>参数初始化（Parameter Initialization）</strong>：模型参数的初始值可以影响优化器的收敛速度和是否能够达到全局最小值。不同的初始化方法可能会导致训练过程中的不同表现。</li>
</ol>

        <div class="evoldown" id="学习率调度器" type="d">
          <span class="icon">
            <svg type="d" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m21.15 6.85c0-2.2056-1.7944-4-4-4-4.1765-0.01989-5.4993 5.7322-1.8147 7.5629-0.263 0.63631-0.4627 1.4421-0.6559 2.2215-0.1397 0.56337-0.2841 1.1459-0.4405 1.6084-0.0728 0.2155-0.1286 0.4813-0.1891 0.4813-0.5072-0.7362-0.8126-2.2507-1.0979-3.3161-0.47879-1.5358-0.72936-4.4237-2.8018-4.558-0.77422 7e-5 -1.3844 0.52253-1.8138 1.553-0.55019 1.254-0.75064 3.2421-1.3784 4.4472-0.39648 3e-4 -0.79576 0.0045-1.1877 0.0703-0.67978 0.1073-1.3339 0.4195-1.798 0.9347-0.39707 0.4315-0.6427 0.9874-0.74275 1.5623-0.063545 0.351-0.07691 0.7094-0.07883 1.0654 0.001935 0.4718-0.01324 0.9457 0.027745 1.4163 0.09435 1.151 0.65732 2.1308 1.7281 2.6237 0.43467 0.1975 0.91053 0.2877 1.3854 0.3129 0.40096 0.0215 0.80345 0.0129 1.2048 0.0139 0.6491 2e-4 1.2891-0.0515 1.888-0.3229 0.90042-0.4067 1.4845-1.2039 1.6712-2.1666 0.0761-0.3779 0.09179-0.7654 0.09344-1.15 7.7e-4 -0.2699 0.00148-0.5413-7.8e-4 -0.8111-0.00379-0.4854-0.04143-0.9771-0.19121-1.4414-0.28748-0.9172-0.98053-1.616-1.8964-1.909 0.43984-1.1576 0.66815-2.7594 1.1268-3.8895 0.3537 0.72804 0.57113 1.7669 0.82283 2.7298 0.26567 1.0724 0.5404 2.1814 0.90896 3.0557 0.87204 2.2985 3.1124 2.7586 4.0452 0.392 0.5508-1.2642 0.7508-3.279 1.3828-4.4916 2.1142-0.10339 3.8024-1.8557 3.8024-3.995zm-12.073 8.8023c0.05605 0.2275 0.06623 0.465 0.07092 0.6983 0.00363 0.2444 0.00195 0.4906 0.00214 0.735-0.0063 0.408 0.01486 0.882-0.18359 1.2496-0.24573 0.4539-0.8026 0.501-1.2651 0.5114-0.33714 0.0058-0.67525 0.0041-1.0124 0.0018-0.46455-0.0092-1.0361-0.0245-1.3192-0.4545-0.16612-0.2552-0.19733-0.5702-0.21202-0.8673-0.01004-0.2443-0.00683-0.4906-0.0075-0.735 5.9e-4 -0.2322-0.00201-0.4664 0.01171-0.6983 0.01886-0.2936 0.06332-0.6069 0.24969-0.8453 0.34185-0.4331 1.0226-0.3889 1.5228-0.3979 0.38828 0.0035 0.77905-0.0131 1.1658 0.0285 0.49865 0.0566 0.85211 0.2621 0.97684 0.7737zm8.0732-6.8023c-2.6379-0.06696-2.6373-3.9334 0-4 2.6378 0.06697 2.6373 3.9334 0 4z" fill="currentColor"></path></svg>
            <p name="id">学习率调度器</p>
          </span>
        </div>
      
<p>学习率调度器（Learning Rate Scheduler）是一种在训练过程中动态调整学习率的策略。它根据预定的规则或实时的训练指标，逐步调整学习率的大小，以提高模型训练的效率和效果。学习率调度器通过在训练过程中动态调整学习率，帮助模型更有效地学习，提高训练的稳定性和效率，最终获得更好的性能。</p>
<p><strong>创造学习率调度器解决的问题：</strong></p>
<ol>
<li><strong>避免学习率过高</strong>：如果学习率设置得过高，可能会导致模型参数更新过猛，从而使得「损失函数值」振荡甚至发散，影响模型的稳定性和「收敛速度」。</li>
<li><strong>避免学习率过低</strong>：在训练后期，如果学习率过低，模型参数的更新将非常缓慢，这可能导致训练过程陷入「局部最小值」，或者需要更长的时间来收敛。</li>
<li><strong>适应训练阶段</strong>：不同的训练阶段可能需要不同的学习率。在初期可能需要较高的学习率以快速下降，在接近最优解时则需要较低的学习率以细致调整，避免过度震荡。</li>
</ol>
<p><strong>没有学习率调度器会导致的结果：</strong></p>
<ol>
<li><strong>训练效率低下</strong>：固定的学习率可能无法同时满足训练初期和后期的需求，导致训练效率不是最优，甚至需要更多的训练周期才能达到相同的效果。</li>
<li><strong>模型性能不佳</strong>：如果学习率始终过高或过低，模型可能无法收敛到最佳状态，导致最终的模型性能不佳。</li>
<li><strong>调参困难</strong>：没有学习率调度器，开发者可能需要手动多次尝试不同的学习率设置，以找到最佳的学习率，这个过程既耗时又低效。</li>
</ol>

        <div class="evoldown" id="StepLR调度器" type="e">
          <span class="icon">
            <svg type="e" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path fill="currentColor" d="m21.9 15.621c0.1248-1.8535-0.6087-3.4099-2.6058-3.8292-0.7712-0.15744-1.3921-0.13977-2.1113-0.14543-0.6323 0.0048-1.1718-0.01567-1.8401 0.03203 1.5356-0.8078 1.6998-2.205 1.6567-3.546 0.1272-2.3708-1.4685-3.666-3.7727-3.673-2.2427-0.04024-5.0463-0.27229-5.9443 1.9172-0.28083 0.6692-0.27606 1.2179-0.28202 1.6587-0.08527 1.4303 0.20687 2.9224 1.662 3.6429-2.3051-0.05275-5.3273-0.39212-6.28 1.8983-0.28073 0.66862-0.27595 1.2174-0.282 1.6572-0.10329 1.6061 0.3059 3.171 2.0252 3.8067 1.2061 0.4187 2.2175 0.2869 3.3945 0.3134 2.0524 0.0901 4.0448-0.4637 4.4796-2.4982 0.609 2.5638 3.2086 2.5463 5.3204 2.4982 2.7823 0.1278 4.7024-0.9368 4.5798-3.7329zm-12.899-7.6287c-0.14889-1.8665 1.8839-1.4921 3.1358-1.546 0.8939 0.05358 2.4743-0.21158 2.8003 0.88445 0.2729 2.4494-0.0297 2.8555-2.5242 2.8232-0.94713-0.07259-2.869 0.28949-3.3134-0.77077-0.14881-0.44557-0.08538-0.92893-0.09846-1.3909zm0.2606 9.2128c-0.56638 0.162-1.1652 0.1412-1.7487 0.1488-0.59786-0.0036-1.1977 0.0131-1.7948-0.0233-0.93407-0.0365-1.6776-0.3579-1.6157-1.4217 0.01574-0.5119-0.06845-1.0551 0.11822-1.5436 0.4432-0.84155 1.5978-0.6728 2.4032-0.7191 0.81712 0.01614 1.6464-0.05154 2.4536 0.10154 0.99382 0.17537 1.0564 0.91742 1.0227 1.7752-6.1e-4 0.7729 0.04085 1.416-0.83867 1.6821zm2.9212-3.6286c-0.0836 0.19457-0.14194 0.3848-0.18279 0.56614-0.18535-0.87758-0.76293-1.6189-1.5605-2.02 1.0871 0.04933 2.0387 0.04959 3.1216-8e-5 -0.7672 0.39034-1.1687 0.96486-1.3783 1.4539zm6.8788 3.6286c-0.5664 0.162-1.1652 0.1412-1.7488 0.1488-0.5978-0.0036-1.1977 0.0131-1.7947-0.0233-0.9341-0.0365-1.6776-0.3579-1.6157-1.4217 0.0157-0.5119-0.0685-1.0551 0.1182-1.5436 0.4432-0.84155 1.5978-0.6728 2.4033-0.7191 0.8171 0.01614 1.6464-0.05154 2.4536 0.10154 0.9938 0.17537 1.0563 0.91742 1.0227 1.7752-6e-4 0.7729 0.0409 1.416-0.8386 1.6821z"></path></svg>
            <p name="id">StepLR调度器</p>
          </span>
          <span class="link-icon ml-[0.5em] mr-[0.25em]">
            <svg xmlns="http://www.w3.org/2000/svg" width="0.9411764705882353em" height="0.9411764705882353em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class="untouchable"><path d="m9.5652 14.45 0.72891-2.0026c-0.651 0.00713-1.3027 0.00104-1.9532 0.00179-1.0991-0.02908-3.0336 0.08306-3.605-1.0524-0.28828-0.61588-0.2054-1.3226-0.22136-1.9833 0.00663-0.74044-0.05553-1.6362 0.5758-2.1558 0.70637-0.5555 1.7411-0.56129 2.6027-0.59834 0.743-0.015 1.4884-0.00764 2.2315-0.00868 0.68471 0.01536 1.6274-0.01783 2.4184 0.16762l0.68711-1.8879c-0.0146-0.003965-0.0287-0.00841-0.0435-0.01227-0.94653-0.24905-1.9355-0.25901-2.9083-0.26688-0.78352-1.3008e-4 -1.5692-0.0063751-2.3527 0.006805-1.2709 0.027555-2.6299 0.13739-3.6978 0.89566-1.6654 1.2031-1.53 2.9573-1.5068 4.79-0.0012251 1.7732 0.89765 3.2159 2.626 3.7562 0.80589 0.26191 1.6615 0.32018 2.5036 0.34101 0.6376 0.01106 1.2763 0.01096 1.9146 0.00915z" fill="currentColor"></path><path d="m14.589 9.125h1.3099c0.02865-0.88714-0.11774-1.6826-0.45594-2.3461l-0.85392 2.3461z" fill="currentColor"></path><path d="m15.587 12.025h-2.0527l-0.80604 2.2146c1.2326-0.27362 2.3169-0.88582 2.8588-2.2146z" fill="currentColor"></path><path d="m8.394 12.025h2.0538l0.82406-2.2641c-1.2457 0.2734-2.3327 0.8901-2.8779 2.2641z" fill="currentColor"></path><path d="m8.5566 17.221 0.83571-2.2961h-1.2914c-0.025394 0.86685 0.12295 1.645 0.45565 2.2961z" fill="currentColor"></path><path d="m21.485 14.399c7e-4 -0.67593 0.0063-1.3662-0.1779-2.0223-0.58881-2.115-2.5706-2.7532-4.5608-2.8041-0.76964-0.031175-1.5416-0.02264-2.3121-0.022365l-0.72832 2.0011c0.38557-0.00297 0.77131 7.6e-4 1.1559-0.00173 1.1244 0.02284 2.8396-0.10221 3.8152 0.44616 0.82512 0.45526 0.81194 1.4036 0.80798 2.2308-0.01538 0.64171 0.05949 1.3145-0.1601 1.93-0.39418 1.0145-1.651 1.1102-2.5915 1.1694-0.7426 0.03331-1.4884 0.0209-2.2315 0.02365-0.81334-0.01641-1.9395 0.04306-2.8448-0.16914l-0.68792 1.89c0.014845 0.00401 0.02915 0.0085 0.044115 0.0124 0.94522 0.24688 1.9316 0.25913 2.9027 0.2657 0.83456-2.2e-4 1.6713 0.00786 2.5057-0.00999 2.0286-0.02122 4.1491-0.51576 4.8438-2.6752 0.2358-0.7292 0.22-1.5067 0.2196-2.2644z" fill="currentColor"></path><path d="m14.979 6.7378c0.17824-0.52033 0.90905-2.4486 1.0626-2.9514 0.05601-0.19527 0.10768-0.39984 0.08232-0.60408-0.03096-0.33264-0.36035-0.4603-0.63671-0.55464-0.20794-0.070665-0.41593-0.17228-0.63943-0.174-0.33751 0.005805-0.52152 0.33878-0.64452 0.61072-1.4256 3.8005-4.7612 13.07-6.1617 16.891-0.10636 0.34-0.29285 0.7891-0.06874 1.1109 0.1296 0.1673 0.34386 0.232 0.53431 0.3042 0.30778 0.1107 0.70325 0.3075 0.98251 0.0365 0.14514-0.1339 0.23561-0.315 0.31595-0.4926 0.10005-0.2274 0.1811-0.4632 0.26694-0.6962 0.4854-1.3337 4.3257-11.885 4.9065-13.481z" fill="currentColor"></path></svg>
          </span>
          
          <span class="icon">
            <svg type="d" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m21.15 6.85c0-2.2056-1.7944-4-4-4-4.1765-0.01989-5.4993 5.7322-1.8147 7.5629-0.263 0.63631-0.4627 1.4421-0.6559 2.2215-0.1397 0.56337-0.2841 1.1459-0.4405 1.6084-0.0728 0.2155-0.1286 0.4813-0.1891 0.4813-0.5072-0.7362-0.8126-2.2507-1.0979-3.3161-0.47879-1.5358-0.72936-4.4237-2.8018-4.558-0.77422 7e-5 -1.3844 0.52253-1.8138 1.553-0.55019 1.254-0.75064 3.2421-1.3784 4.4472-0.39648 3e-4 -0.79576 0.0045-1.1877 0.0703-0.67978 0.1073-1.3339 0.4195-1.798 0.9347-0.39707 0.4315-0.6427 0.9874-0.74275 1.5623-0.063545 0.351-0.07691 0.7094-0.07883 1.0654 0.001935 0.4718-0.01324 0.9457 0.027745 1.4163 0.09435 1.151 0.65732 2.1308 1.7281 2.6237 0.43467 0.1975 0.91053 0.2877 1.3854 0.3129 0.40096 0.0215 0.80345 0.0129 1.2048 0.0139 0.6491 2e-4 1.2891-0.0515 1.888-0.3229 0.90042-0.4067 1.4845-1.2039 1.6712-2.1666 0.0761-0.3779 0.09179-0.7654 0.09344-1.15 7.7e-4 -0.2699 0.00148-0.5413-7.8e-4 -0.8111-0.00379-0.4854-0.04143-0.9771-0.19121-1.4414-0.28748-0.9172-0.98053-1.616-1.8964-1.909 0.43984-1.1576 0.66815-2.7594 1.1268-3.8895 0.3537 0.72804 0.57113 1.7669 0.82283 2.7298 0.26567 1.0724 0.5404 2.1814 0.90896 3.0557 0.87204 2.2985 3.1124 2.7586 4.0452 0.392 0.5508-1.2642 0.7508-3.279 1.3828-4.4916 2.1142-0.10339 3.8024-1.8557 3.8024-3.995zm-12.073 8.8023c0.05605 0.2275 0.06623 0.465 0.07092 0.6983 0.00363 0.2444 0.00195 0.4906 0.00214 0.735-0.0063 0.408 0.01486 0.882-0.18359 1.2496-0.24573 0.4539-0.8026 0.501-1.2651 0.5114-0.33714 0.0058-0.67525 0.0041-1.0124 0.0018-0.46455-0.0092-1.0361-0.0245-1.3192-0.4545-0.16612-0.2552-0.19733-0.5702-0.21202-0.8673-0.01004-0.2443-0.00683-0.4906-0.0075-0.735 5.9e-4 -0.2322-0.00201-0.4664 0.01171-0.6983 0.01886-0.2936 0.06332-0.6069 0.24969-0.8453 0.34185-0.4331 1.0226-0.3889 1.5228-0.3979 0.38828 0.0035 0.77905-0.0131 1.1658 0.0285 0.49865 0.0566 0.85211 0.2621 0.97684 0.7737zm8.0732-6.8023c-2.6379-0.06696-2.6373-3.9334 0-4 2.6378 0.06697 2.6373 3.9334 0 4z" fill="currentColor"></path></svg>
            <p name="id">学习率调度器</p>
          </span>
        </div>
      
<p>在PyTorch中，学习率调度器用于根据预定策略动态调整学习率。以下是一个使用<code>StepLR</code>调度器的简单例子，它在每过<code>step_size</code>个epoch后，将学习率乘以<code>gamma</code>来减小学习率。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torch
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>optim <span class="token keyword">as</span> optim

<span class="token comment"># 定义一个简单的模型</span>
model <span class="token operator">=</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
optimizer <span class="token operator">=</span> optim<span class="token punctuation">.</span>SGD<span class="token punctuation">(</span>model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">)</span>

<span class="token comment"># 使用StepLR学习率调度器</span>
scheduler <span class="token operator">=</span> torch<span class="token punctuation">.</span>optim<span class="token punctuation">.</span>lr_scheduler<span class="token punctuation">.</span>StepLR<span class="token punctuation">(</span>optimizer<span class="token punctuation">,</span> step_size<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">,</span> gamma<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> epoch <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 训练模型的代码...</span>
    
    <span class="token comment"># 每个epoch结束后更新学习率</span>
    scheduler<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

        <div class="evoldown" id="马拉松训练" type="e">
          <span class="icon">
            <svg type="e" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path fill="currentColor" d="m21.9 15.621c0.1248-1.8535-0.6087-3.4099-2.6058-3.8292-0.7712-0.15744-1.3921-0.13977-2.1113-0.14543-0.6323 0.0048-1.1718-0.01567-1.8401 0.03203 1.5356-0.8078 1.6998-2.205 1.6567-3.546 0.1272-2.3708-1.4685-3.666-3.7727-3.673-2.2427-0.04024-5.0463-0.27229-5.9443 1.9172-0.28083 0.6692-0.27606 1.2179-0.28202 1.6587-0.08527 1.4303 0.20687 2.9224 1.662 3.6429-2.3051-0.05275-5.3273-0.39212-6.28 1.8983-0.28073 0.66862-0.27595 1.2174-0.282 1.6572-0.10329 1.6061 0.3059 3.171 2.0252 3.8067 1.2061 0.4187 2.2175 0.2869 3.3945 0.3134 2.0524 0.0901 4.0448-0.4637 4.4796-2.4982 0.609 2.5638 3.2086 2.5463 5.3204 2.4982 2.7823 0.1278 4.7024-0.9368 4.5798-3.7329zm-12.899-7.6287c-0.14889-1.8665 1.8839-1.4921 3.1358-1.546 0.8939 0.05358 2.4743-0.21158 2.8003 0.88445 0.2729 2.4494-0.0297 2.8555-2.5242 2.8232-0.94713-0.07259-2.869 0.28949-3.3134-0.77077-0.14881-0.44557-0.08538-0.92893-0.09846-1.3909zm0.2606 9.2128c-0.56638 0.162-1.1652 0.1412-1.7487 0.1488-0.59786-0.0036-1.1977 0.0131-1.7948-0.0233-0.93407-0.0365-1.6776-0.3579-1.6157-1.4217 0.01574-0.5119-0.06845-1.0551 0.11822-1.5436 0.4432-0.84155 1.5978-0.6728 2.4032-0.7191 0.81712 0.01614 1.6464-0.05154 2.4536 0.10154 0.99382 0.17537 1.0564 0.91742 1.0227 1.7752-6.1e-4 0.7729 0.04085 1.416-0.83867 1.6821zm2.9212-3.6286c-0.0836 0.19457-0.14194 0.3848-0.18279 0.56614-0.18535-0.87758-0.76293-1.6189-1.5605-2.02 1.0871 0.04933 2.0387 0.04959 3.1216-8e-5 -0.7672 0.39034-1.1687 0.96486-1.3783 1.4539zm6.8788 3.6286c-0.5664 0.162-1.1652 0.1412-1.7488 0.1488-0.5978-0.0036-1.1977 0.0131-1.7947-0.0233-0.9341-0.0365-1.6776-0.3579-1.6157-1.4217 0.0157-0.5119-0.0685-1.0551 0.1182-1.5436 0.4432-0.84155 1.5978-0.6728 2.4033-0.7191 0.8171 0.01614 1.6464-0.05154 2.4536 0.10154 0.9938 0.17537 1.0563 0.91742 1.0227 1.7752-6e-4 0.7729 0.0409 1.416-0.8386 1.6821z"></path></svg>
            <p name="id">马拉松训练</p>
          </span>
          <span class="link-icon ml-[0.5em] mr-[0.25em]">
            <svg xmlns="http://www.w3.org/2000/svg" width="0.9411764705882353em" height="0.9411764705882353em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class="untouchable"><path d="m9.5652 14.45 0.72891-2.0026c-0.651 0.00713-1.3027 0.00104-1.9532 0.00179-1.0991-0.02908-3.0336 0.08306-3.605-1.0524-0.28828-0.61588-0.2054-1.3226-0.22136-1.9833 0.00663-0.74044-0.05553-1.6362 0.5758-2.1558 0.70637-0.5555 1.7411-0.56129 2.6027-0.59834 0.743-0.015 1.4884-0.00764 2.2315-0.00868 0.68471 0.01536 1.6274-0.01783 2.4184 0.16762l0.68711-1.8879c-0.0146-0.003965-0.0287-0.00841-0.0435-0.01227-0.94653-0.24905-1.9355-0.25901-2.9083-0.26688-0.78352-1.3008e-4 -1.5692-0.0063751-2.3527 0.006805-1.2709 0.027555-2.6299 0.13739-3.6978 0.89566-1.6654 1.2031-1.53 2.9573-1.5068 4.79-0.0012251 1.7732 0.89765 3.2159 2.626 3.7562 0.80589 0.26191 1.6615 0.32018 2.5036 0.34101 0.6376 0.01106 1.2763 0.01096 1.9146 0.00915z" fill="currentColor"></path><path d="m14.589 9.125h1.3099c0.02865-0.88714-0.11774-1.6826-0.45594-2.3461l-0.85392 2.3461z" fill="currentColor"></path><path d="m15.587 12.025h-2.0527l-0.80604 2.2146c1.2326-0.27362 2.3169-0.88582 2.8588-2.2146z" fill="currentColor"></path><path d="m8.394 12.025h2.0538l0.82406-2.2641c-1.2457 0.2734-2.3327 0.8901-2.8779 2.2641z" fill="currentColor"></path><path d="m8.5566 17.221 0.83571-2.2961h-1.2914c-0.025394 0.86685 0.12295 1.645 0.45565 2.2961z" fill="currentColor"></path><path d="m21.485 14.399c7e-4 -0.67593 0.0063-1.3662-0.1779-2.0223-0.58881-2.115-2.5706-2.7532-4.5608-2.8041-0.76964-0.031175-1.5416-0.02264-2.3121-0.022365l-0.72832 2.0011c0.38557-0.00297 0.77131 7.6e-4 1.1559-0.00173 1.1244 0.02284 2.8396-0.10221 3.8152 0.44616 0.82512 0.45526 0.81194 1.4036 0.80798 2.2308-0.01538 0.64171 0.05949 1.3145-0.1601 1.93-0.39418 1.0145-1.651 1.1102-2.5915 1.1694-0.7426 0.03331-1.4884 0.0209-2.2315 0.02365-0.81334-0.01641-1.9395 0.04306-2.8448-0.16914l-0.68792 1.89c0.014845 0.00401 0.02915 0.0085 0.044115 0.0124 0.94522 0.24688 1.9316 0.25913 2.9027 0.2657 0.83456-2.2e-4 1.6713 0.00786 2.5057-0.00999 2.0286-0.02122 4.1491-0.51576 4.8438-2.6752 0.2358-0.7292 0.22-1.5067 0.2196-2.2644z" fill="currentColor"></path><path d="m14.979 6.7378c0.17824-0.52033 0.90905-2.4486 1.0626-2.9514 0.05601-0.19527 0.10768-0.39984 0.08232-0.60408-0.03096-0.33264-0.36035-0.4603-0.63671-0.55464-0.20794-0.070665-0.41593-0.17228-0.63943-0.174-0.33751 0.005805-0.52152 0.33878-0.64452 0.61072-1.4256 3.8005-4.7612 13.07-6.1617 16.891-0.10636 0.34-0.29285 0.7891-0.06874 1.1109 0.1296 0.1673 0.34386 0.232 0.53431 0.3042 0.30778 0.1107 0.70325 0.3075 0.98251 0.0365 0.14514-0.1339 0.23561-0.315 0.31595-0.4926 0.10005-0.2274 0.1811-0.4632 0.26694-0.6962 0.4854-1.3337 4.3257-11.885 4.9065-13.481z" fill="currentColor"></path></svg>
          </span>
          
          <span class="icon">
            <svg type="d" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m21.15 6.85c0-2.2056-1.7944-4-4-4-4.1765-0.01989-5.4993 5.7322-1.8147 7.5629-0.263 0.63631-0.4627 1.4421-0.6559 2.2215-0.1397 0.56337-0.2841 1.1459-0.4405 1.6084-0.0728 0.2155-0.1286 0.4813-0.1891 0.4813-0.5072-0.7362-0.8126-2.2507-1.0979-3.3161-0.47879-1.5358-0.72936-4.4237-2.8018-4.558-0.77422 7e-5 -1.3844 0.52253-1.8138 1.553-0.55019 1.254-0.75064 3.2421-1.3784 4.4472-0.39648 3e-4 -0.79576 0.0045-1.1877 0.0703-0.67978 0.1073-1.3339 0.4195-1.798 0.9347-0.39707 0.4315-0.6427 0.9874-0.74275 1.5623-0.063545 0.351-0.07691 0.7094-0.07883 1.0654 0.001935 0.4718-0.01324 0.9457 0.027745 1.4163 0.09435 1.151 0.65732 2.1308 1.7281 2.6237 0.43467 0.1975 0.91053 0.2877 1.3854 0.3129 0.40096 0.0215 0.80345 0.0129 1.2048 0.0139 0.6491 2e-4 1.2891-0.0515 1.888-0.3229 0.90042-0.4067 1.4845-1.2039 1.6712-2.1666 0.0761-0.3779 0.09179-0.7654 0.09344-1.15 7.7e-4 -0.2699 0.00148-0.5413-7.8e-4 -0.8111-0.00379-0.4854-0.04143-0.9771-0.19121-1.4414-0.28748-0.9172-0.98053-1.616-1.8964-1.909 0.43984-1.1576 0.66815-2.7594 1.1268-3.8895 0.3537 0.72804 0.57113 1.7669 0.82283 2.7298 0.26567 1.0724 0.5404 2.1814 0.90896 3.0557 0.87204 2.2985 3.1124 2.7586 4.0452 0.392 0.5508-1.2642 0.7508-3.279 1.3828-4.4916 2.1142-0.10339 3.8024-1.8557 3.8024-3.995zm-12.073 8.8023c0.05605 0.2275 0.06623 0.465 0.07092 0.6983 0.00363 0.2444 0.00195 0.4906 0.00214 0.735-0.0063 0.408 0.01486 0.882-0.18359 1.2496-0.24573 0.4539-0.8026 0.501-1.2651 0.5114-0.33714 0.0058-0.67525 0.0041-1.0124 0.0018-0.46455-0.0092-1.0361-0.0245-1.3192-0.4545-0.16612-0.2552-0.19733-0.5702-0.21202-0.8673-0.01004-0.2443-0.00683-0.4906-0.0075-0.735 5.9e-4 -0.2322-0.00201-0.4664 0.01171-0.6983 0.01886-0.2936 0.06332-0.6069 0.24969-0.8453 0.34185-0.4331 1.0226-0.3889 1.5228-0.3979 0.38828 0.0035 0.77905-0.0131 1.1658 0.0285 0.49865 0.0566 0.85211 0.2621 0.97684 0.7737zm8.0732-6.8023c-2.6379-0.06696-2.6373-3.9334 0-4 2.6378 0.06697 2.6373 3.9334 0 4z" fill="currentColor"></path></svg>
            <p name="id">学习率调度器</p>
          </span>
        </div>
      
<p>想象你正在为一场马拉松比赛训练。在训练初期，你可能会选择较高的强度（相当于高学习率），以快速提升你的体能和耐力。随着比赛日的临近（接近最优解），你可能会逐渐减少训练强度（降低学习率），进行更多的恢复性训练和技术细节的调整，以避免受伤并确保在比赛日能有最佳表现。</p>
<p>这个过程类似于使用学习率调度器来动态调整训练强度，确保在不同阶段采取最合适的训练策略，以达到最佳的训练效果。</p>

        <div class="evoldown" id="相关概念" type="c">
          <span class="icon">
            <svg type="c" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m6.825 4.8749c1.8175-0.03033 2.3249 0.02869 2.25 2.0152 0.01496 1.139 0.01338 1.984-1.3875 1.9798-1.6108-0.01491-2.7285 0.30288-2.6124-1.796-0.019-1.5193-0.04171-2.2697 1.7499-2.1989zm0-2c-2.5847-0.10689-3.8882 1.4181-3.7496 3.8782-0.058825 1.6262 0.20934 2.9456 1.5713 3.7018 0.98591 0.49526 1.6843 0.40204 2.4713 0.42016 0.661-0.00557 1.2079 0.02014 1.9275-0.21866 1.051-0.35295 1.7794-1.2693 1.9533-2.3675 0.08948-0.54803 0.07327-0.95095 0.0762-1.3975-0.00196-0.42752 0.01114-0.8053-0.05632-1.306-0.24162-1.9408-1.9089-2.8188-3.6634-2.7097-0.17686-7.9441e-4 -0.35349-2.3937e-4 -0.53038-7.7934e-4z" fill="currentColor"></path><path d="m17.075 8.6749c1.8175-0.03034 2.3249 0.02868 2.25 2.0152 0.01495 1.139 0.01338 1.984-1.3875 1.9797-1.6108-0.01491-2.7285 0.30288-2.6124-1.796-0.01899-1.5193-0.04171-2.2697 1.7499-2.1989zm0-2c-2.5847-0.10689-3.8882 1.4181-3.7496 3.8782-0.05882 1.6262 0.20933 2.9457 1.5713 3.7017 0.98593 0.49528 1.6843 0.40205 2.4713 0.42017 0.66099-0.00556 1.2079 0.02015 1.9275-0.21865 1.051-0.35295 1.7794-1.2693 1.9533-2.3675 0.08949-0.54803 0.07328-0.95095 0.07621-1.3975-0.00197-0.42839 0.0112-0.80698-0.05673-1.3089-0.24288-1.9391-1.9097-2.8158-3.663-2.7068-0.17688-7.9346e-4 -0.35351-2.388e-4 -0.5304-7.7896e-4z" fill="currentColor"></path><path d="m8.4749 15.525c1.8175-0.03033 2.3249 0.02868 2.25 2.0152 0.01496 1.139 0.01338 1.984-1.3875 1.9797-1.6108-0.01491-2.7285 0.30288-2.6124-1.796-0.01899-1.5193-0.04172-2.2697 1.7499-2.1989zm0-2c-2.5847-0.10689-3.8882 1.4181-3.7496 3.8782-0.058825 1.6262 0.20934 2.9456 1.5713 3.7018 0.98591 0.49526 1.6843 0.40203 2.4713 0.42016 0.66099-0.00557 1.2079 0.02014 1.9276-0.21866 1.051-0.35294 1.7794-1.2693 1.9533-2.3675 0.08949-0.54803 0.07328-0.95095 0.07621-1.3975-0.00197-0.42753 0.01113-0.80529-0.05633-1.306-0.24162-1.9408-1.9089-2.8188-3.6634-2.7097-0.17688-7.9346e-4 -0.35351-2.4262e-4 -0.5304-7.8736e-4z" fill="currentColor"></path></svg>
            <p name="label">关联</p>
            <p name="id">相关概念</p>
          </span>
        </div>
      
<p>学习率调度器的作用和受影响的概念：</p>
<p><strong>会影响的概念：</strong></p>
<ol>
<li><strong>模型收敛速度</strong>：通过适时调整学习率，学习率调度器可以加快模型的收敛速度，特别是在训练初期通过使用较高的学习率。</li>
<li><strong>模型性能</strong>：适当减小学习率可以帮助模型更细致地适应训练数据，避免「过拟合」，从而提高模型的泛化能力和最终性能。</li>
<li><strong>训练稳定性</strong>：通过避免学习率过高导致的参数更新过猛，学习率调度器有助于保持训练过程的稳定性，减少损失函数的振荡。</li>
</ol>
<p><strong>影响学习率调度器的概念：</strong></p>
<ol>
<li><strong>优化器（Optimizer）</strong>：学习率调度器直接作用于优化器，调整其学习率参数。不同的优化器（如SGD、Adam等）可能对学习率的调整有不同的敏感度和效果。</li>
<li><strong>训练策略</strong>：训练过程中的策略，如批大小（batch size）、训练轮次（epochs）等，会影响学习率调度器的设置。例如，较大的批大小可能需要不同的学习率调整策略。</li>
<li><strong>模型复杂度和数据集</strong>：模型的复杂度和数据集的特性也会影响学习率调度器的选择和配置。复杂模型或难以拟合的数据集可能需要更精细的学习率调整策略。</li>
</ol>
</body></html>
                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">HKini</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://www.hkini.top/posts/47206.html">https://www.hkini.top/posts/47206.html</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">HKini</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/Python/">
                                    <span class="chip bg-color">Python</span>
                                </a>
                            
                                <a href="/tags/%E4%BA%BA%E8%84%B8%E8%AF%86%E5%88%AB/">
                                    <span class="chip bg-color">人脸识别</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="qq,qzone,wechat,weibo,douban" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    
    <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid="></script>
    <div class="addthis_inline_share_toolbox"></div>
    

</div>

                </div>
            </div>
            
                <div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    
        <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }

    #vcomments textarea {
        box-sizing: border-box;
        background: url("/medias/comment_bg.png") 100% 100% no-repeat;
    }

    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #4cbf30;
        font-weight: 500;
        text-decoration: none;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; padding-left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="vcomments" class="card-content" style="display: grid">
    </div>
</div>

<script src="/libs/valine/av-min.js"></script>
<script src="/libs/valine/Valine.min.js"></script>
<script>
    new Valine({
        el: '#vcomments',
        appId: 'AcWiopK3pHt4imczk7wvUFZZ-gzGzoHsz',
        appKey: 'UxlKcVndM3aSrEzt9vM0ul6L',
        serverURLs: 'https://acwiopk3.lc-cn-n1-shared.com',
        notify: 'false' === 'true',
        verify: 'false' === 'true',
        visitor: 'true' === 'true',
        avatar: 'mm',
        pageSize: '10',
        lang: 'zh-cn',
        placeholder: '欢迎评论'
    });
</script>

<!--酷Q推送-->


    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/posts/51272.html">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/28.png" class="responsive-img" alt="PyTorch（一）模型训练过程">
                        
                        <span class="card-title">PyTorch（一）模型训练过程</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2024-06-21
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E4%B8%93%E4%B8%9A/" class="post-category">
                                    专业
                                </a>
                            
                            <a href="/categories/%E4%B8%93%E4%B8%9A/%E6%A1%86%E6%9E%B6/" class="post-category">
                                    框架
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/">
                        <span class="chip bg-color">人工智能</span>
                    </a>
                    
                    <a href="/tags/Pytorch/">
                        <span class="chip bg-color">Pytorch</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/posts/4270.html">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/10.png" class="responsive-img" alt="Python：数据库配置与迁移">
                        
                        <span class="card-title">Python：数据库配置与迁移</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2024-01-07
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E4%B8%93%E4%B8%9A/" class="post-category">
                                    专业
                                </a>
                            
                            <a href="/categories/%E4%B8%93%E4%B8%9A/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" class="post-category">
                                    编程语言
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Python/">
                        <span class="chip bg-color">Python</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('120')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE' || selection.getRangeAt(0).commonAncestorContainer.nodeName === 'CODE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + '来源: Hkini<br />'
            + '文章作者: Hkini<br />'
            + '文章链接: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者所有，任何形式的转载都请注明出处。';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>


<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>



<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>



    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('2'),
            // headingSelector: 'h1, h2, h3, h4, h5, h6'
            headingSelector: 'none',
        });
        var tocList = $('<ol>', { class: 'toc-list' }); // 创建顶层 <ol> 容器
        var currentLevel = 1; // 当前层级
        var parentStack = [tocList]; // 用于存储父级 <ol> 的栈

        $('#articleContent').find('h1, h2, h3, h4, h5, h6').each(function () {
            var $heading = $(this);
            var headingText = $heading.text();
            var level = parseInt($heading[0].tagName[1], 10); // 获取当前标题的层级，例如 h1 -> 1, h2 -> 2
            
            // var tocList = $('<ol>', { class: 'toc-list ' }); // 创建 <ol> 容器
            var tocListItem = $('<li>', { class: 'toc-list-item' }); // 创建 <li> 容器

            var tocItem = $('<a>', { 
                href: '#' + $heading.attr('id'), 
                class: 'toc-link' // 添加 class="toc-link"
            }).text(headingText); // 创建 <a> 标签

            // 创建箭头 SVG
            var arrowSvg = `<svg class="arrow-icon" xmlns="http://www.w3.org/2000/svg" fill="none" version="1.1" viewBox="0 0 24 24" class="h-[0.96em] w-[0.96em] text-foreground" style="transition: transform 233ms cubic-bezier(0.42, 0, 0.24, 1); transform: rotate(0deg);"><path d="m18.707 9.7075 4e-4 -3.75e-4q0.1407-0.14065 0.2168-0.32442 0.0761-0.18377 0.0761-0.38268t-0.0761-0.38268q-0.0761-0.18377-0.2168-0.32442-0.1406-0.14065-0.3244-0.21677-0.1838-0.07612-0.3827-0.07612t-0.3827 0.076121q-0.1838 0.07612-0.3244 0.21677l-4e-4 3.75e-4 -5.2925 5.2925-5.2929-5.2929q-0.14065-0.14065-0.32442-0.21677-0.18377-0.07612-0.38268-0.07612t-0.38268 0.07612q-0.18377 0.076121-0.32442 0.21677t-0.21677 0.32442q-0.07612 0.18377-0.07612 0.38268t0.07612 0.38268q0.076121 0.18377 0.21677 0.32442l6 6q0.14066 0.14065 0.32443 0.21677 0.18377 0.07612 0.38268 0.07612t0.38268-0.07612q0.18377-0.07612 0.32443-0.21677l5.9996-5.9996z" fill="currentColor" fill-rule="evenodd"></path></svg>`;

            // 包裹 <a> 标签的 <div>
            var tocItemWrapper = $('<div>', { 
                class: 'toc-item-wrapper' // 添加 class="toc-item-wrapper"
            }).append(tocItem).append(arrowSvg); // 将 <a> 添加到 <div>

            // 为 TOC 项添加相应的缩进
            // tocItem.css('padding-left', (level - 1) * 20 + 'px');

            // 将 <a> 添加到 <li>
            tocListItem.append(tocItemWrapper);
             // 如果当前标题层级比上一个标题层级高，创建新的嵌套 <ol>
                if (level > currentLevel) {
                var nestedList = $('<ol>', { class: 'toc-list' }); // 创建嵌套的 <ol>
                parentStack[parentStack.length - 1].children('li:last').append(nestedList); // 将嵌套 <ol> 添加到父级 <li>
                parentStack.push(nestedList); // 将嵌套 <ol> 压入栈
            } 
            // 如果当前标题层级比上一个标题层级低，回退到正确的父级
            else if (level < currentLevel) {
                while (level < currentLevel) {
                    parentStack.pop(); // 弹出栈顶，回退到上一级
                    currentLevel--;
                }
            }

            // 将当前 <li> 添加到当前层级的 <ol>
            parentStack[parentStack.length - 1].append(tocListItem);
            currentLevel = level; // 更新当前层级
      
           
            
            // 查找该标题下的 evoldown 内容（#d, #e, #t, #c, #v, #a）
            $heading.nextUntil('h1, h2, h3, h4, h5, h6').each(function () {
                var $div = $(this);
                if ($div.hasClass('evoldown')) {
                    var type = $div.attr('type');
                    var id = $div.attr('id');
                    var label = $div.text(); // 假设需要从内容中提取 label
                    var icon = '';

                    // 根据类型插入相应的图标
                    switch (type) {
                        case 'd':
                            icon = '<svg type="d" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m21.15 6.85c0-2.2056-1.7944-4-4-4-4.1765-0.01989-5.4993 5.7322-1.8147 7.5629-0.263 0.63631-0.4627 1.4421-0.6559 2.2215-0.1397 0.56337-0.2841 1.1459-0.4405 1.6084-0.0728 0.2155-0.1286 0.4813-0.1891 0.4813-0.5072-0.7362-0.8126-2.2507-1.0979-3.3161-0.47879-1.5358-0.72936-4.4237-2.8018-4.558-0.77422 7e-5 -1.3844 0.52253-1.8138 1.553-0.55019 1.254-0.75064 3.2421-1.3784 4.4472-0.39648 3e-4 -0.79576 0.0045-1.1877 0.0703-0.67978 0.1073-1.3339 0.4195-1.798 0.9347-0.39707 0.4315-0.6427 0.9874-0.74275 1.5623-0.063545 0.351-0.07691 0.7094-0.07883 1.0654 0.001935 0.4718-0.01324 0.9457 0.027745 1.4163 0.09435 1.151 0.65732 2.1308 1.7281 2.6237 0.43467 0.1975 0.91053 0.2877 1.3854 0.3129 0.40096 0.0215 0.80345 0.0129 1.2048 0.0139 0.6491 2e-4 1.2891-0.0515 1.888-0.3229 0.90042-0.4067 1.4845-1.2039 1.6712-2.1666 0.0761-0.3779 0.09179-0.7654 0.09344-1.15 7.7e-4 -0.2699 0.00148-0.5413-7.8e-4 -0.8111-0.00379-0.4854-0.04143-0.9771-0.19121-1.4414-0.28748-0.9172-0.98053-1.616-1.8964-1.909 0.43984-1.1576 0.66815-2.7594 1.1268-3.8895 0.3537 0.72804 0.57113 1.7669 0.82283 2.7298 0.26567 1.0724 0.5404 2.1814 0.90896 3.0557 0.87204 2.2985 3.1124 2.7586 4.0452 0.392 0.5508-1.2642 0.7508-3.279 1.3828-4.4916 2.1142-0.10339 3.8024-1.8557 3.8024-3.995zm-12.073 8.8023c0.05605 0.2275 0.06623 0.465 0.07092 0.6983 0.00363 0.2444 0.00195 0.4906 0.00214 0.735-0.0063 0.408 0.01486 0.882-0.18359 1.2496-0.24573 0.4539-0.8026 0.501-1.2651 0.5114-0.33714 0.0058-0.67525 0.0041-1.0124 0.0018-0.46455-0.0092-1.0361-0.0245-1.3192-0.4545-0.16612-0.2552-0.19733-0.5702-0.21202-0.8673-0.01004-0.2443-0.00683-0.4906-0.0075-0.735 5.9e-4 -0.2322-0.00201-0.4664 0.01171-0.6983 0.01886-0.2936 0.06332-0.6069 0.24969-0.8453 0.34185-0.4331 1.0226-0.3889 1.5228-0.3979 0.38828 0.0035 0.77905-0.0131 1.1658 0.0285 0.49865 0.0566 0.85211 0.2621 0.97684 0.7737zm8.0732-6.8023c-2.6379-0.06696-2.6373-3.9334 0-4 2.6378 0.06697 2.6373 3.9334 0 4z" fill="currentColor"></path></svg>'; // 填入 #d 对应的 SVG 图标
                            break;
                        case 'e':
                            icon = '<svg type="e" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path fill="currentColor" d="m21.9 15.621c0.1248-1.8535-0.6087-3.4099-2.6058-3.8292-0.7712-0.15744-1.3921-0.13977-2.1113-0.14543-0.6323 0.0048-1.1718-0.01567-1.8401 0.03203 1.5356-0.8078 1.6998-2.205 1.6567-3.546 0.1272-2.3708-1.4685-3.666-3.7727-3.673-2.2427-0.04024-5.0463-0.27229-5.9443 1.9172-0.28083 0.6692-0.27606 1.2179-0.28202 1.6587-0.08527 1.4303 0.20687 2.9224 1.662 3.6429-2.3051-0.05275-5.3273-0.39212-6.28 1.8983-0.28073 0.66862-0.27595 1.2174-0.282 1.6572-0.10329 1.6061 0.3059 3.171 2.0252 3.8067 1.2061 0.4187 2.2175 0.2869 3.3945 0.3134 2.0524 0.0901 4.0448-0.4637 4.4796-2.4982 0.609 2.5638 3.2086 2.5463 5.3204 2.4982 2.7823 0.1278 4.7024-0.9368 4.5798-3.7329zm-12.899-7.6287c-0.14889-1.8665 1.8839-1.4921 3.1358-1.546 0.8939 0.05358 2.4743-0.21158 2.8003 0.88445 0.2729 2.4494-0.0297 2.8555-2.5242 2.8232-0.94713-0.07259-2.869 0.28949-3.3134-0.77077-0.14881-0.44557-0.08538-0.92893-0.09846-1.3909zm0.2606 9.2128c-0.56638 0.162-1.1652 0.1412-1.7487 0.1488-0.59786-0.0036-1.1977 0.0131-1.7948-0.0233-0.93407-0.0365-1.6776-0.3579-1.6157-1.4217 0.01574-0.5119-0.06845-1.0551 0.11822-1.5436 0.4432-0.84155 1.5978-0.6728 2.4032-0.7191 0.81712 0.01614 1.6464-0.05154 2.4536 0.10154 0.99382 0.17537 1.0564 0.91742 1.0227 1.7752-6.1e-4 0.7729 0.04085 1.416-0.83867 1.6821zm2.9212-3.6286c-0.0836 0.19457-0.14194 0.3848-0.18279 0.56614-0.18535-0.87758-0.76293-1.6189-1.5605-2.02 1.0871 0.04933 2.0387 0.04959 3.1216-8e-5 -0.7672 0.39034-1.1687 0.96486-1.3783 1.4539zm6.8788 3.6286c-0.5664 0.162-1.1652 0.1412-1.7488 0.1488-0.5978-0.0036-1.1977 0.0131-1.7947-0.0233-0.9341-0.0365-1.6776-0.3579-1.6157-1.4217 0.0157-0.5119-0.0685-1.0551 0.1182-1.5436 0.4432-0.84155 1.5978-0.6728 2.4033-0.7191 0.8171 0.01614 1.6464-0.05154 2.4536 0.10154 0.9938 0.17537 1.0563 0.91742 1.0227 1.7752-6e-4 0.7729 0.0409 1.416-0.8386 1.6821z"></path></svg>'; // 填入 #e 对应的 SVG 图标
                            break;
                        case 't':
                            icon = '<svg type="t" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m15.385 10.538c-0.52922 1.222-0.74082 3.1121-1.2852 4.3107-0.06906-2e-5 -0.24102-0.40954-0.40553-0.85764-0.54849-1.4968-0.91293-3.7816-1.4977-5.2179-0.49825-1.7178-2.7313-2.8836-3.8104-0.24557-0.55221 1.2498-0.75261 3.2793-1.3921 4.4683-0.45354 0.09492-0.79418 0.49706-0.79418 0.9788 0 0.5523 0.4477 1 1 1 0.77414 0 1.3844-0.52246 1.8137-1.5529 0.50969-1.1819 0.73444-2.9587 1.2241-4.138 0.07175 2e-5 0.14687 0.33291 0.23664 0.59492 0.20698 0.60425 0.39119 1.3477 0.58618 2.1349 0.2657 1.0724 0.54043 2.1814 0.90899 3.0557 0.87212 2.2985 3.1123 2.7586 4.0452 0.39202 0.55283-1.2608 0.75203-3.309 1.3936-4.5083 0.4522-0.0959 0.7915-0.49744 0.7915-0.97823 0-0.55229-0.4477-1-1-1-0.7755 0-1.3861 0.526-1.8148 1.5634z" fill="currentColor"></path><path d="m15.802 6.9697c-0.1557 0.1946-0.1882 0.58884 0.1331 0.60533 1.2616 0.02168 2.5193 0.48654 3.5913 1.2655 0.2705 0.19453 0.6808 0.05368 0.7176-0.30435 0.0793-0.76097 0.0572-1.5713-0.086-2.401-0.1456-0.82752-0.4109-1.6736-0.8018-2.5036-0.1536-0.34251-0.6624-0.55548-0.9204-0.23779l-0.7238 0.98277c-3.8989-2.9446-9.692-2.2836-12.827 1.4659-6.4518 7.8165 1.8281 18.818 11.123 14.783 1.8924-0.8564 3.4853-2.3528 4.4507-4.1927 0.0679-0.1218 0.1291-0.2481 0.1823-0.377 0.1017-0.2304 0.1549-0.518-0.0557-0.7052-0.1162-0.1043-0.2646-0.1628-0.4074-0.221-0.1475-0.0577-0.2953-0.116-0.4439-0.1706-0.2042-0.0713-0.4475-0.1531-0.6498-0.0358-0.0846 0.0496-0.1444 0.131-0.1982 0.2109-0.0747 0.1157-0.1266 0.2445-0.1952 0.3636-0.4837 0.9276-1.1717 1.74-1.9925 2.3831-0.8208 0.6431-1.7745 1.1169-2.7897 1.3673-7.0612 1.7198-12.182-6.5444-7.5021-12.107 2.4634-2.9539 7.0543-3.4782 10.119-1.154" fill="currentColor"></path></svg>'; // 填入 #t 对应的 SVG 图标
                            break;
                        case 'v':
                            icon = '<svg type="v" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m12.006 2.4861c8.295-0.034635 12.587 10.042 6.9396 15.995 0.302-0.0792 0.5884 0.106 0.8099 0.2931 0.1763 0.1517 0.337 0.3223 0.4938 0.4938 0.1806 0.1987 0.3602 0.3999 0.5393 0.6 0.158 0.1775 0.3162 0.3571 0.4573 0.5485 0.0932 0.127 0.1803 0.2635 0.2402 0.4098 0.0591 0.1432 0.0867 0.3066 0.0463 0.4586l-0.0182 0.058c-0.0546 0.1443-0.1606 0.2646-0.2695 0.3712-0.0972 0.0941-0.2013 0.1853-0.3018 0.2759-0.1104 0.0982-0.2212 0.201-0.3417 0.287-0.1188 0.0852-0.2583 0.1531-0.4066 0.159-0.2688 9e-3 -0.5043-0.1558-0.7006-0.3227-0.1407-0.1218-0.2719-0.2564-0.3983-0.3929-0.2101-0.2279-0.4164-0.4606-0.6233-0.6914-0.1578-0.1777-0.3167-0.3566-0.4572-0.5485-0.0869-0.1186-0.1682-0.2449-0.2272-0.3799-0.06-0.136-0.0946-0.2901-0.0688-0.4385l0.0117-0.0521 0.0161-0.0498c-1.7182 1.3134-3.966 2.0444-6.2474 1.9119-12.23-1.0527-11.717-18.608 0.50643-18.986zm-6.8e-4 2c-3.9794 3.5e-4 -7.2654 3.1166-7.4809 7.0946-0.30103 4.0208 3.0533 7.76 7.0834 7.8947 4.1153 0.2383 7.6845-2.9602 7.8946-7.0833 0.319-4.1746-3.3113-8.0014-7.4964-7.9059" fill="currentColor"></path><path d="m8.2769 7.8469c0.29326 0.69532 0.64074 1.1934 1.5 1.3397 0.4567-0.53241 1.0671-0.92645 1.7212-0.97652 0.65414-0.05007 1.1756 0.26304 1.2305 0.98096 0.10016 1.3082-2.47 2.532-1.899 4.9596 0.64656 0.38624 1.7475 0.36741 2.2073 0.03029-0.36861-2.09 2.575-3.1725 2.4052-5.3901-0.16975-2.2175-1.7734-3.0416-3.7676-2.8889-1.4358 0.10991-2.597 0.87279-3.3975 1.945z" fill="currentColor"></path><path d="m12.01 14.568c-0.99198 0-1.696 0.76802-1.696 1.7601 0 0.992 0.70406 1.776 1.696 1.776 0.97603 0 1.696-0.78404 1.696-1.776 0-0.99204-0.72002-1.7601-1.696-1.7601z" fill="currentColor"></path></svg>'; // 填入 #v 对应的 SVG 图标
                            break;
                        case 'a':
                            icon = '<svg type="a" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m15.45 7.35c-0.0022-1.4574-0.7043-2.0002-2.0001-2.0002-0.5281 0-1.0428 0.12066-1.6692 0.8986-1.2172 1.2052-3.5662 1.5773-6.4138 1.5566-0.92067 0.00495-1.8844 0.27586-2.521 0.97407-0.89662 0.97053-0.8534 2.1136-0.84541 3.3436-0.088935 2.0639 1.0163 3.5806 3.1554 3.6639 0.18073 0.9556 0.68251 3.671 0.86079 4.5885 0.11273 0.6047 0.44099 0.6361 0.97316 0.525 0.52124-0.1078 1.1127-0.1057 0.99809-0.819-0.14025-0.8342-0.63023-3.3751-0.78778-4.2434 2.2128 0.1862 3.6134 0.5907 4.5806 1.5138 0.63361 0.6782 1.2967 0.8987 1.6692 0.8987 1.2958-1e-4 2.0107-0.6194 2.0001-2.0002v-3.2681c0.2954-0.13425 0.725-0.23189 1.35-0.23189v-2c-0.625 0-1.0546-0.09763-1.35-0.23189v-3.1681zm-2 8.9q-1.45-2.45-7.4205-2.45c-1.4917 0.02186-2.072-0.06445-2.0295-1.7275 0.00524-1.5258-0.13158-2.3285 1.723-2.2725 5.5801 0.23384 7.964-2.492 7.727-2.45v8.9z" fill="currentColor"></path><path d="m22.024 11.62c0.00399-0.58801-0.05448-1.0153-0.74975-1.0361-0.41509-0.00662-0.82816 0.057395-1.2409 0.094325-0.33033 0.040455-0.73566 0.076976-1.0072 0.28268-0.28398 0.21724-0.23153 0.59429-0.23733 0.9112-0.0015854 0.30307-0.0045853 0.60983 0.27663 0.79666 0.23484 0.15349 0.52158 0.19534 0.7942 0.23343 0.23915 0.02956 0.48002 0.05101 0.71976 0.07523 0.48243 0.03148 1.2248 0.19557 1.394-0.41829 0.0757-0.30577 0.04467-0.627 0.05067-0.93912z" fill="currentColor"></path><path d="m17.348 5.7962c0.042171 0.25853 0.19707 0.48146 0.30883 0.71387 0.28865 0.62708 0.76754 0.52952 1.3216 0.33695 0.29707-0.1074 0.5898-0.22819 0.88354-0.34427 1.2431-0.47478 0.99431-0.8753 0.46485-1.8723-0.42612-0.90268-0.91649-0.67014-1.6207-0.2097-0.32028 0.21007-0.65168 0.40646-0.95187 0.64525-0.21815 0.17815-0.44959 0.42625-0.40623 0.73022z" fill="currentColor"></path><path d="m20.756 17.801c-0.08779-0.41834-0.59472-0.57-0.94009-0.72238-0.31748-0.12454-0.63252-0.2579-0.95618-0.36584-0.27393-0.083771-0.59373-0.17244-0.86319-0.031395-0.21247 0.11853-0.30992 0.35702-0.4191 0.56205-0.12688 0.25243-0.31107 0.53775-0.19892 0.82794 0.1101 0.27652 0.36419 0.46004 0.59732 0.62904 0.18414 0.12824 0.3747 0.24849 0.56281 0.37079 0.15333 0.0986 0.3065 0.19968 0.46418 0.29127 0.21755 0.12307 0.46707 0.25848 0.72501 0.21843 0.34543-0.06224 0.50617-0.44433 0.6571-0.72156 0.07714-0.15037 0.15704-0.30255 0.23064-0.4547 0.08692-0.18674 0.17446-0.39353 0.14043-0.60364z" fill="currentColor"></path></svg>'; // 填入 #a 对应的 SVG 图标
                            break;
                        case 'c':
                            icon = '<svg type="c" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" version="1.1" aria-hidden="true" class=""><path d="m6.825 4.8749c1.8175-0.03033 2.3249 0.02869 2.25 2.0152 0.01496 1.139 0.01338 1.984-1.3875 1.9798-1.6108-0.01491-2.7285 0.30288-2.6124-1.796-0.019-1.5193-0.04171-2.2697 1.7499-2.1989zm0-2c-2.5847-0.10689-3.8882 1.4181-3.7496 3.8782-0.058825 1.6262 0.20934 2.9456 1.5713 3.7018 0.98591 0.49526 1.6843 0.40204 2.4713 0.42016 0.661-0.00557 1.2079 0.02014 1.9275-0.21866 1.051-0.35295 1.7794-1.2693 1.9533-2.3675 0.08948-0.54803 0.07327-0.95095 0.0762-1.3975-0.00196-0.42752 0.01114-0.8053-0.05632-1.306-0.24162-1.9408-1.9089-2.8188-3.6634-2.7097-0.17686-7.9441e-4 -0.35349-2.3937e-4 -0.53038-7.7934e-4z" fill="currentColor"></path><path d="m17.075 8.6749c1.8175-0.03034 2.3249 0.02868 2.25 2.0152 0.01495 1.139 0.01338 1.984-1.3875 1.9797-1.6108-0.01491-2.7285 0.30288-2.6124-1.796-0.01899-1.5193-0.04171-2.2697 1.7499-2.1989zm0-2c-2.5847-0.10689-3.8882 1.4181-3.7496 3.8782-0.05882 1.6262 0.20933 2.9457 1.5713 3.7017 0.98593 0.49528 1.6843 0.40205 2.4713 0.42017 0.66099-0.00556 1.2079 0.02015 1.9275-0.21865 1.051-0.35295 1.7794-1.2693 1.9533-2.3675 0.08949-0.54803 0.07328-0.95095 0.07621-1.3975-0.00197-0.42839 0.0112-0.80698-0.05673-1.3089-0.24288-1.9391-1.9097-2.8158-3.663-2.7068-0.17688-7.9346e-4 -0.35351-2.388e-4 -0.5304-7.7896e-4z" fill="currentColor"></path><path d="m8.4749 15.525c1.8175-0.03033 2.3249 0.02868 2.25 2.0152 0.01496 1.139 0.01338 1.984-1.3875 1.9797-1.6108-0.01491-2.7285 0.30288-2.6124-1.796-0.01899-1.5193-0.04172-2.2697 1.7499-2.1989zm0-2c-2.5847-0.10689-3.8882 1.4181-3.7496 3.8782-0.058825 1.6262 0.20934 2.9456 1.5713 3.7018 0.98591 0.49526 1.6843 0.40203 2.4713 0.42016 0.66099-0.00557 1.2079 0.02014 1.9276-0.21866 1.051-0.35294 1.7794-1.2693 1.9533-2.3675 0.08949-0.54803 0.07328-0.95095 0.07621-1.3975-0.00197-0.42753 0.01113-0.80529-0.05633-1.306-0.24162-1.9408-1.9089-2.8188-3.6634-2.7097-0.17688-7.9346e-4 -0.35351-2.4262e-4 -0.5304-7.8736e-4z" fill="currentColor"></path></svg>'; // 填入 #c 对应的 SVG 图标
                            break;
                    }
                    // 创建 <span> 包裹图标和附加信息
                    var iconSpan = $('<span>', { class: 'icon' }).html(`
                        <a href="#${id}" class: 'toc-link evoldown_toc_link'>
                            ${icon}
                            <p name="label">${id}</p>
                        </a>
                    `);

                    // 创建 <ol> 容器，设置与标题相同的缩进
                    var tocIconList = $('<ol>', { 
                        class: 'toc-list evoldown ', 
                        type: type,
                    });
                    tocIconList.append(iconSpan);
                    // 将 <ol> 添加到当前 TOC 项
                    tocListItem.append(tocIconList);
                }
            });
            

            // 点击箭头切换展开/隐藏
            tocItemWrapper.find('.arrow-icon').click(function (e) {
                e.stopPropagation(); // 阻止事件冒泡
                var $arrow = $(this);
                var $parentDiv = $arrow.closest('.toc-item-wrapper'); // 获取箭头所在的父级 <div>
                var $nextLists =  $parentDiv.siblings('ol.toc-list'); // 获取与父级 <div> 同级的 <ol>

                // 判断箭头当前的旋转状态
                if ($arrow.css('transform') === 'matrix(1, 0, 0, 1, 0, 0)') { // rotate(0deg) 表示箭头指向下
                    // 隐藏逻辑
                    $arrow.css('transform', 'rotate(90deg)'); // 将箭头旋转为向左
                    $nextLists.css('display', 'none'); // 隐藏内容
                } else {
                    // 展开逻辑
                    $arrow.css('transform', 'rotate(0deg)'); // 将箭头旋转为向下
                    $nextLists.css('display', 'block'); // 显示内容
                }
            });

            // 将 <li> 添加到 <ol>
            // tocList.append(tocListItem);

            // 将 TOC 项添加到 TOC 容器
            $('#toc-content').append(tocList);


        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    
<footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="6638358192"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="/libs/aplayer/Meting.min.js"></script>

    

    <div class="container row center-align"
         style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2022-2025</span>
            
            <a href="/about" target="_blank">Hkini</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
                &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                        class="white-color">103.7k</span>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
                <span id="sitetime"> Loading ...</span>
                <script>
                    var calcSiteTime = function () {
                        var seconds = 1000;
                        var minutes = seconds * 60;
                        var hours = minutes * 60;
                        var days = hours * 24;
                        var years = days * 365;
                        var today = new Date();
                        var startYear = "2022";
                        var startMonth = "12";
                        var startDate = "25";
                        var startHour = "0";
                        var startMinute = "0";
                        var startSecond = "0";
                        var todayYear = today.getFullYear();
                        var todayMonth = today.getMonth() + 1;
                        var todayDate = today.getDate();
                        var todayHour = today.getHours();
                        var todayMinute = today.getMinutes();
                        var todaySecond = today.getSeconds();
                        var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                        var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                        var diff = t2 - t1;
                        var diffYears = Math.floor(diff / years);
                        var diffDays = Math.floor((diff / days) - diffYears * 365);

                        // 区分是否有年份.
                        var language = 'zh-CN';
                        if (startYear === String(todayYear)) {
                            document.getElementById("year").innerHTML = todayYear;
                            var daysTip = 'This site has been running for ' + diffDays + ' days';
                            if (language === 'zh-CN') {
                                daysTip = '本站已运行 ' + diffDays + ' 天';
                            } else if (language === 'zh-HK') {
                                daysTip = '本站已運行 ' + diffDays + ' 天';
                            }
                            document.getElementById("sitetime").innerHTML = daysTip;
                        } else {
                            document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                            var yearsAndDaysTip = 'This site has been running for ' + diffYears + ' years and '
                                + diffDays + ' days';
                            if (language === 'zh-CN') {
                                yearsAndDaysTip = '本站已运行 ' + diffYears + ' 年 ' + diffDays + ' 天';
                            } else if (language === 'zh-HK') {
                                yearsAndDaysTip = '本站已運行 ' + diffYears + ' 年 ' + diffDays + ' 天';
                            }
                            document.getElementById("sitetime").innerHTML = yearsAndDaysTip;
                        }
                    }

                    calcSiteTime();
                </script>
            
            <br>
            
                <span id="icp"><img src="/medias/icp.png"
                                    style="vertical-align: text-bottom;"/>
                <a href="https://beian.miit.gov.cn/" target="_blank">蜀ICP备2023000334号-1</a>
            </span>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/togetherhkl" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:hekailin@gmail.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1778267485" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1778267485" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>





    <a href="https://www.zhihu.com/people/wei-lai-ke-qi-49-69" class="tooltipped" target="_blank" data-tooltip="关注我的知乎: https://www.zhihu.com/people/wei-lai-ke-qi-49-69" data-position="top" data-delay="50">
        <i class="fab fa-zhihu1">知</i>
    </a>



    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 白天和黑夜主题 -->
<div class="stars-con">
    <div id="stars"></div>
    <div id="stars2"></div>
    <div id="stars3"></div>  
</div>

<script>
    function switchNightMode() {
        $('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($('body')),
        setTimeout(function () {
            $('body').hasClass('DarkMode') 
            ? ($('body').removeClass('DarkMode'), localStorage.setItem('isDark', '0'), $('#sum-moon-icon').removeClass("fa-sun").addClass('fa-moon')) 
            : ($('body').addClass('DarkMode'), localStorage.setItem('isDark', '1'), $('#sum-moon-icon').addClass("fa-sun").removeClass('fa-moon')),
            
            setTimeout(function () {
            $('.Cuteen_DarkSky').fadeOut(1e3, function () {
                $(this).remove()
            })
            }, 2e3)
        })
    }
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    

    

    <!-- 雪花特效 -->
    

    <!-- 鼠标星星特效 -->
    

     
        <script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
        <script src="/libs/others/TencentCaptcha.js"></script>
        <button id="TencentCaptcha" data-appid="195339201" data-cbfn="callback" type="button" hidden></button>
    

    <!-- Baidu Analytics -->

<script>
    var _hmt = _hmt || [];
    (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
